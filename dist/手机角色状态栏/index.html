<head><script type="module">var e={235:(e,t)=>{t.A=(e,t)=>{const a=e.__vccOpts||e;for(const[e,l]of t)a[e]=l;return a}}},t={};function a(l){var n=t[l];if(void 0!==n)return n.exports;var o=t[l]={exports:{}};return e[l](o,o.exports,a),o.exports}a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var l in t)a.o(t,l)&&!a.o(e,l)&&Object.defineProperty(e,l,{enumerable:!0,get:t[l]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);const l=Vue,n=_;var o=a.n(n);const s=z,r={class:'phone-wrapper'},c={class:'phone-body'},i={class:'phone-screen'},m={class:'status-bar'},u={class:'time-block'},p={class:'time'},d={class:'date'},v={class:'signal-block'},E={class:'signal-bars'},b={class:'battery'},g={class:'battery-icon'},y={class:'hero-card'},f={key:0},h={class:'hero-main'},N={class:'subtitle'},V={class:'location'},k={class:'hero-objective'},S={class:'stats-panel'},D={class:'stat-header'},B={class:'stat-title'},w={class:'stat-value'},x={class:'stat-bar'},C={class:'buff-panel'},A={class:'buff-tags'},j={class:'chat-panel'},T={class:'chat-list'},M={class:'chat-text'},L={class:'chat-meta'},O={key:0,class:'chat-placeholder'},I=(0,l.defineComponent)({__name:'app',setup(e){const t={name:'角色',mood:'情緒穩定',location:'未知位置',objective:'等待玩家指示',hp:88,mp:64,stamina:72,focus:55,battery:76,signal:3,buffs:[{label:'專注',type:'positive'},{label:'輕裝',type:'positive'},{label:'輕微疲勞',type:'neutral'}]},a=s.z.object({name:s.z.string().min(1).optional(),mood:s.z.string().optional(),location:s.z.string().optional(),objective:s.z.string().optional(),hp:s.z.number().min(0).max(100).optional(),mp:s.z.number().min(0).max(100).optional(),stamina:s.z.number().min(0).max(100).optional(),focus:s.z.number().min(0).max(100).optional(),battery:s.z.number().min(0).max(100).optional(),signal:s.z.number().min(0).max(4).optional(),buffs:s.z.array(s.z.object({label:s.z.string(),type:s.z.enum(['positive','negative','neutral']).default('neutral')})).optional()}).partial(),n=(0,l.reactive)({...t}),I=(0,l.ref)([]),P=(0,l.ref)(new Date),F=(0,l.ref)(null);let G=null;const H=[],R=(0,l.computed)(()=>P.value.toLocaleTimeString('zh-TW',{hour:'2-digit',minute:'2-digit'})),U=(0,l.computed)(()=>P.value.toLocaleDateString('zh-TW',{month:'short',day:'numeric',weekday:'short'})),W=(0,l.computed)(()=>Array.from({length:4},(_,e)=>e<n.signal)),q=(0,l.computed)(()=>[{key:'hp',label:'生命',value:n.hp},{key:'mp',label:'意志',value:n.mp},{key:'stamina',label:'體力',value:n.stamina},{key:'focus',label:'專注',value:n.focus}]),J=(0,l.computed)(()=>n.name.replace(/\s+/g,'').slice(0,2).toUpperCase()),K=(0,l.computed)(()=>F.value?{backgroundImage:`url(${F.value})`}:{});function Q(){try{n.name=substitudeMacros('{{char}}').trim()||t.name}catch(e){console.warn('[手机角色状态栏] 解析角色名失敗',e),n.name=t.name}try{const e=getVariables({type:'character'}),l=o().get(e,'手机角色状态栏')??o().get(e,'mobile_status')??o().get(e,'角色狀態');o().isPlainObject(l)?function(e){if(!e)return;const l=a.safeParse(e);if(!l.success)return void console.warn('[手机角色状态栏] 無法解析狀態數據',l.error);const{buffs:o,...s}=l.data;Object.entries(s).forEach(([e,t])=>{null!=t&&(n[e]=t)}),n.buffs=o?.length?o:t.buffs}(l):(n.battery=t.battery,n.signal=t.signal)}catch(e){console.info('[手机角色状态栏] 無法取得角色變量, 使用預設值',e),Object.assign(n,t)}try{const e=getCharAvatarPath('current',!0);F.value=e}catch(e){console.warn('[手机角色状态栏] 無法取得頭像',e),F.value=null}}function X(e){const t=(e??'').replace(/```[\s\S]*?```/g,'[代碼]').replace(/!\[[^\]]*]\([^)]+\)/g,'').replace(/\[[^\]]*]\([^)]+\)/g,'$1').replace(/\r?\n+/g,' ').replace(/\s+/g,' ').trim();return t.length>52?`${t.slice(0,52)}…`:t}function Y(e){const t='number'==typeof e?e:Date.now();return new Date(t).toLocaleTimeString('zh-TW',{hour:'2-digit',minute:'2-digit'})}function Z(){Q(),function(){try{const e=getLastMessageId();if(Number.isNaN(e)||e<0)return void(I.value=[]);const t=Math.max(0,e-5),a=t===e?e:`${t}-${e}`,l=getChatMessages(a).filter(e=>['assistant','user'].includes(e.role));I.value=l.slice(-4).map(e=>({id:e.message_id,sender:'assistant'===e.role?'char':'user',text:X(e.message),time:Y(e.extra?.timestamp??Date.now())}))}catch(e){console.warn('[手机角色状态栏] 無法載入聊天',e),I.value=[]}}()}function ee(e,t){const a=eventOn(e,(...e)=>t());H.push(()=>a.stop())}return(0,l.onMounted)(()=>{Z(),G=window.setInterval(()=>{P.value=new Date},3e4),ee(tavern_events.MESSAGE_RECEIVED,Z),ee(tavern_events.MESSAGE_SENT,Z),ee(tavern_events.MESSAGE_UPDATED,Z),ee(tavern_events.CHARACTER_EDITED,Q),ee(tavern_events.CHAT_CHANGED,Z)}),(0,l.onUnmounted)(()=>{null!==G&&(clearInterval(G),G=null),H.forEach(e=>e())}),(e,t)=>((0,l.openBlock)(),(0,l.createElementBlock)('div',r,[(0,l.createElementVNode)('div',c,[t[6]||(t[6]=(0,l.createElementVNode)('div',{class:'phone-notch'},null,-1)),(0,l.createElementVNode)('div',i,[(0,l.createElementVNode)('header',m,[(0,l.createElementVNode)('div',u,[(0,l.createElementVNode)('span',p,(0,l.toDisplayString)(R.value),1),(0,l.createElementVNode)('span',d,(0,l.toDisplayString)(U.value),1)]),(0,l.createElementVNode)('div',v,[(0,l.createElementVNode)('div',E,[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(W.value,(e,t)=>((0,l.openBlock)(),(0,l.createElementBlock)('span',{key:t,class:(0,l.normalizeClass)(['signal-bar',{active:e}])},null,2))),128))]),(0,l.createElementVNode)('div',b,[(0,l.createElementVNode)('span',g,[(0,l.createElementVNode)('span',{class:'battery-fill',style:(0,l.normalizeStyle)({width:`${n.battery}%`})},null,4)]),(0,l.createElementVNode)('span',null,(0,l.toDisplayString)(n.battery)+'%',1)])])]),(0,l.createElementVNode)('section',y,[(0,l.createElementVNode)('div',{class:'avatar',style:(0,l.normalizeStyle)(K.value)},[F.value?(0,l.createCommentVNode)('v-if',!0):((0,l.openBlock)(),(0,l.createElementBlock)('span',f,(0,l.toDisplayString)(J.value),1))],4),(0,l.createElementVNode)('div',h,[t[1]||(t[1]=(0,l.createElementVNode)('p',{class:'label'},'檔案同步',-1)),(0,l.createElementVNode)('h1',null,(0,l.toDisplayString)(n.name),1),(0,l.createElementVNode)('p',N,(0,l.toDisplayString)(n.mood),1),(0,l.createElementVNode)('p',V,[t[0]||(t[0]=(0,l.createElementVNode)('span',{class:'dot'},null,-1)),(0,l.createTextVNode)(' '+(0,l.toDisplayString)(n.location),1)])]),(0,l.createElementVNode)('div',k,[t[2]||(t[2]=(0,l.createElementVNode)('span',null,'當前目標',-1)),(0,l.createElementVNode)('p',null,(0,l.toDisplayString)(n.objective),1)])]),(0,l.createElementVNode)('section',S,[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(q.value,e=>((0,l.openBlock)(),(0,l.createElementBlock)('article',{key:e.key,class:'stat-card'},[(0,l.createElementVNode)('header',D,[(0,l.createElementVNode)('span',B,(0,l.toDisplayString)(e.label),1),(0,l.createElementVNode)('span',w,(0,l.toDisplayString)(e.value)+'%',1)]),(0,l.createElementVNode)('div',x,[(0,l.createElementVNode)('div',{class:'stat-fill',style:(0,l.normalizeStyle)({width:`${e.value}%`})},null,4)])]))),128))]),(0,l.createElementVNode)('section',C,[t[3]||(t[3]=(0,l.createElementVNode)('div',{class:'buff-header'},[(0,l.createElementVNode)('span',null,'狀態效果'),(0,l.createElementVNode)('small',null,'即時同步')],-1)),(0,l.createElementVNode)('div',A,[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(n.buffs,e=>((0,l.openBlock)(),(0,l.createElementBlock)('span',{key:e.label,class:(0,l.normalizeClass)(['buff-pill',e.type])},(0,l.toDisplayString)(e.label),3))),128))])]),(0,l.createElementVNode)('section',j,[(0,l.createElementVNode)('div',{class:'chat-header'},[t[4]||(t[4]=(0,l.createElementVNode)('span',null,'最近通訊',-1)),(0,l.createElementVNode)('button',{type:'button',class:'refresh',onClick:Z},'重新整理')]),(0,l.createElementVNode)('ul',T,[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(I.value,e=>((0,l.openBlock)(),(0,l.createElementBlock)('li',{key:e.id,class:(0,l.normalizeClass)(['chat-bubble',e.sender])},[(0,l.createElementVNode)('p',M,(0,l.toDisplayString)(e.text),1),(0,l.createElementVNode)('span',L,(0,l.toDisplayString)('char'===e.sender?n.name:'你')+' · '+(0,l.toDisplayString)(e.time),1)],2))),128)),I.value.length?(0,l.createCommentVNode)('v-if',!0):((0,l.openBlock)(),(0,l.createElementBlock)('li',O,[...t[5]||(t[5]=[(0,l.createElementVNode)('p',null,'暫無聊天紀錄, 等待新的互動...',-1)])]))])])])])]))}});const P=(0,a(235).A)(I,[['__scopeId','data-v-449f6a60']]);$(()=>{(0,l.createApp)(P).mount('#app')});</script><style>body{margin:0;font-family:"Noto Sans TC","PingFang TC","Microsoft YaHei",sans-serif}.phone-wrapper[data-v-449f6a60]{width:100%;display:flex;justify-content:center;padding:16px 0;background:linear-gradient(140deg,#f6f1ff,#f8fbff 45%,#fef4f4)}.phone-body[data-v-449f6a60]{position:relative;width:min(420px,100%);aspect-ratio:9/19.5;background:#0c0d12;border-radius:36px;padding:18px;box-shadow:0 12px 45px rgba(17,21,56,.35),0 8px 20px rgba(58,96,159,.18);overflow:hidden}.phone-notch[data-v-449f6a60]{position:absolute;top:10px;left:50%;transform:translateX(-50%);width:120px;height:18px;background:#000;border-radius:0 0 16px 16px}.phone-screen[data-v-449f6a60]{width:100%;height:100%;background:linear-gradient(160deg,#141824,#0d111a 40%,#191d2c);border-radius:24px;padding:24px;color:#f5f5ff;display:flex;flex-direction:column;gap:18px;overflow:hidden}.status-bar[data-v-449f6a60]{display:flex;justify-content:space-between;align-items:flex-start;font-size:12px;color:hsla(0,0%,100%,.75)}.time-block[data-v-449f6a60]{display:flex;flex-direction:column;gap:2px}.time-block .time[data-v-449f6a60]{font-size:20px;font-weight:600;color:#fff}.time-block .date[data-v-449f6a60]{letter-spacing:.05em}.signal-block[data-v-449f6a60]{display:flex;align-items:center;gap:10px}.signal-bars[data-v-449f6a60]{display:flex;gap:2px}.signal-bar[data-v-449f6a60]{width:4px;height:12px;border-radius:2px;background:hsla(0,0%,100%,.2);transition:background .3s}.signal-bar.active[data-v-449f6a60]{background:#5ee4ff}.battery[data-v-449f6a60]{display:flex;align-items:center;gap:6px;font-variant-numeric:tabular-nums}.battery-icon[data-v-449f6a60]{width:24px;height:12px;border:1px solid hsla(0,0%,100%,.6);border-radius:6px;position:relative;padding:1px}.battery-icon[data-v-449f6a60]::after{content:"";position:absolute;right:-4px;top:3px;width:3px;height:6px;background:hsla(0,0%,100%,.6);border-radius:2px}.battery-fill[data-v-449f6a60]{display:block;height:100%;border-radius:4px;background:linear-gradient(90deg,#3af1d5,#5ee4ff);transition:width .4s ease}.hero-card[data-v-449f6a60]{display:grid;grid-template-columns:auto 1fr;gap:16px;background:linear-gradient(135deg,rgba(67,92,219,0.4),rgba(168,111,255,0.35));padding:18px;border-radius:22px;position:relative;overflow:hidden}.hero-card[data-v-449f6a60]::before{content:"";position:absolute;inset:0;background:radial-gradient(circle at top right,rgba(255,255,255,0.25),transparent 55%)}.avatar[data-v-449f6a60]{width:72px;height:72px;border-radius:20px;background:hsla(0,0%,100%,.08);display:flex;align-items:center;justify-content:center;font-size:24px;font-weight:700;letter-spacing:.1em;text-transform:uppercase;color:#fff;background-size:cover;background-position:center;border:1px solid hsla(0,0%,100%,.25);z-index:1}.hero-main[data-v-449f6a60]{display:flex;flex-direction:column;gap:6px;z-index:1}.hero-main .label[data-v-449f6a60]{font-size:12px;letter-spacing:.2em;opacity:.7;text-transform:uppercase}.hero-main h1[data-v-449f6a60]{margin:0;font-size:22px;font-weight:700}.hero-main .subtitle[data-v-449f6a60]{margin:0;color:hsla(0,0%,100%,.8)}.hero-main .location[data-v-449f6a60]{display:flex;align-items:center;gap:6px;margin:0;font-size:13px;color:hsla(0,0%,100%,.7)}.hero-main .dot[data-v-449f6a60]{width:8px;height:8px;border-radius:50%;background:#55ffb7;box-shadow:0 0 8px rgba(85,255,183,.8)}.hero-objective[data-v-449f6a60]{grid-column:1/-1;margin-top:8px;padding:12px;border-radius:14px;background:rgba(6,8,18,.3);backdrop-filter:blur(12px);border:1px solid hsla(0,0%,100%,.1);z-index:1}.hero-objective span[data-v-449f6a60]{font-size:11px;letter-spacing:.15em;text-transform:uppercase;opacity:.65}.hero-objective p[data-v-449f6a60]{margin:4px 0 0;font-size:14px}.stats-panel[data-v-449f6a60]{display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:12px}.stat-card[data-v-449f6a60]{padding:14px;background:hsla(0,0%,100%,.04);border-radius:16px;border:1px solid hsla(0,0%,100%,.08);backdrop-filter:blur(10px)}.stat-header[data-v-449f6a60]{display:flex;justify-content:space-between;margin-bottom:8px;font-size:13px;color:hsla(0,0%,100%,.8)}.stat-header .stat-value[data-v-449f6a60]{font-weight:600;font-size:14px}.stat-bar[data-v-449f6a60]{width:100%;height:6px;border-radius:99px;background:hsla(0,0%,100%,.12);overflow:hidden}.stat-fill[data-v-449f6a60]{height:100%;border-radius:99px;background:linear-gradient(90deg,#55ffb7,#5ee4ff);transition:width .35s ease}.buff-panel[data-v-449f6a60]{padding:16px;border-radius:18px;background:hsla(0,0%,100%,.03);border:1px dashed hsla(0,0%,100%,.2);display:flex;flex-direction:column;gap:10px}.buff-header[data-v-449f6a60]{display:flex;justify-content:space-between;font-size:13px;color:hsla(0,0%,100%,.7)}.buff-tags[data-v-449f6a60]{display:flex;flex-wrap:wrap;gap:8px}.buff-pill[data-v-449f6a60]{padding:6px 12px;border-radius:999px;font-size:12px;letter-spacing:.05em;text-transform:uppercase;border:1px solid rgba(0,0,0,0)}.buff-pill.positive[data-v-449f6a60]{background:rgba(85,255,183,.12);border-color:rgba(85,255,183,.4);color:#bfffed}.buff-pill.neutral[data-v-449f6a60]{background:hsla(0,0%,100%,.08);border-color:hsla(0,0%,100%,.2);color:hsla(0,0%,100%,.8)}.buff-pill.negative[data-v-449f6a60]{background:rgba(255,120,143,.12);border-color:rgba(255,120,143,.4);color:#ffcfd8}.chat-panel[data-v-449f6a60]{flex:1;min-height:0;display:flex;flex-direction:column;background:rgba(10,13,22,.8);border-radius:20px;border:1px solid hsla(0,0%,100%,.08);padding:16px;gap:12px}.chat-header[data-v-449f6a60]{display:flex;justify-content:space-between;align-items:center;font-size:13px;color:hsla(0,0%,100%,.7)}.refresh[data-v-449f6a60]{border:none;background:hsla(0,0%,100%,.08);color:#fff;border-radius:20px;padding:4px 10px;font-size:12px;cursor:pointer;transition:background .2s}.refresh[data-v-449f6a60]:hover{background:hsla(0,0%,100%,.15)}.chat-list[data-v-449f6a60]{list-style:none;margin:0;padding:0;display:flex;flex-direction:column;gap:12px;overflow:hidden}.chat-bubble[data-v-449f6a60]{padding:10px 12px;border-radius:16px;max-width:90%;background:hsla(0,0%,100%,.05);align-self:flex-start}.chat-bubble.char[data-v-449f6a60]{background:rgba(94,228,255,.12);border:1px solid rgba(94,228,255,.2);margin-left:auto;align-self:flex-end}.chat-text[data-v-449f6a60]{margin:0 0 4px;font-size:13px;color:hsla(0,0%,100%,.92)}.chat-meta[data-v-449f6a60]{font-size:11px;color:hsla(0,0%,100%,.6)}.chat-placeholder[data-v-449f6a60]{padding:12px;border-radius:14px;background:hsla(0,0%,100%,.03);text-align:center;font-size:13px;color:hsla(0,0%,100%,.65)}@media (max-width:480px){.phone-body[data-v-449f6a60]{padding:14px;border-radius:30px}.phone-screen[data-v-449f6a60]{padding:18px;border-radius:20px}}
</style></head><body><div id="app"></div></body>