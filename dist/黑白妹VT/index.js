var e={n:t=>{var r=t&&t.__esModule?()=>t.default:()=>t;return e.d(r,{a:r}),r},d:(t,r)=>{for(var s in r)e.o(r,s)&&!e.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:r[s]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=_;var r=e.n(t);class s{registry=new Map;register(e){return t=>(e||(e=t.name),this.registry.set(e,t),t)}get(e){return this.registry.get(e)}getAll(){return this.registry}has(e){return this.registry.has(e)}}var a,n,i,l,o,c,u,g=function(e,t,r,s){var a,n=arguments.length,i=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if('object'==typeof Reflect&&'function'==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,s);else for(var l=e.length-1;l>=0;l--)(a=e[l])&&(i=(n<3?a(i):n>3?a(t,r,i):a(t,r))||i);return n>3&&i&&Object.defineProperty(t,r,i),i},E=function(e,t){if('object'==typeof Reflect&&'function'==typeof Reflect.metadata)return Reflect.metadata(e,t)};class m{static registry=new s;constructor(...e){}static fromObject(e){return this.prototype.fromObject(e)}}let h=a=class extends m{low;high;num;constructor(e,t,r){super(),this.low=e,this.high=t,this.num=r}fromObject(e){const t=e.low,r=e.high,s=e.num;return new a(t,r,s)}get TYPE(){return'num'}getValue(){return{low:this.low,high:this.high,num:this.num}}getLow(){return this.low}getHigh(){return this.high}getNum(){return this.num}deltaLow(e){null===e?this.low=null:null===this.low?this.low=e:this.low+=e,this.applyConstrain()}deltaHigh(e){null===e?this.high=null:null===this.high?this.high=e:this.high+=e,this.applyConstrain()}deltaNum(e){this.num+=e,this.applyConstrain()}applyConstrain(){null!==this.low&&this.num<this.low&&(this.num=this.low),null!==this.high&&this.num>this.high&&(this.num=this.high)}};h=a=g([m.registry.register(h.prototype.TYPE),E('design:paramtypes',[Object,Object,Number])],h);let d=n=class extends m{str;constructor(e){super(),this.str=e}fromObject(e){const t=e.str;return new n(t)}get TYPE(){return'str'}getValue(){return{str:this.str}}getStr(){return this.str}setStr(e){this.str=e}};d=n=g([m.registry.register(d.prototype.TYPE),E('design:paramtypes',[String])],d);let S=i=class extends m{datetime;constructor(e){super(),this.datetime=new Date(e)}fromObject(e){const t=e.datetime;return new i(t)}get TYPE(){return'datetime'}getValue(){return{datetime:this.datetime}}getYear(){return this.datetime.getFullYear()}getMonth(){return this.datetime.getMonth()}getDate(){return this.datetime.getDate()}getHours(){return this.datetime.getHours()}getMinutes(){return this.datetime.getMinutes()}getSeconds(){return this.datetime.getSeconds()}getDay(){return this.datetime.getDay()}getDateTime(){return this.datetime}deltaDatetime(e,t,r,s,a,n){this.datetime.setFullYear(this.datetime.getFullYear()+e),this.datetime.setMonth(this.datetime.getMonth()+t),this.datetime.setDate(this.datetime.getDate()+r),this.datetime.setHours(this.datetime.getHours()+s),this.datetime.setMinutes(this.datetime.getMinutes()+a),this.datetime.setSeconds(this.datetime.getSeconds()+n)}};S=i=g([m.registry.register(S.prototype.TYPE),E('design:paramtypes',['function'==typeof(c='undefined'!=typeof Date&&Date)?c:Object])],S);let T=l=class extends m{outcome;random_events;constructor(e,t){super(),this.outcome=e,this.random_events=t}fromObject(e){const t=e?.outcome,r=e.random_events;return new l(t,r)}get TYPE(){return'random'}getValue(){return{outcome:this.outcome,random_events:this.random_events}}roll(){this.outcome=function(e){let t=0;for(const r of e)t+=r.weighting;let r=Math.random()*t;for(const t of e)if(r-=t.weighting,r<=0)return t.event;return e[-1].event}(this.random_events)}};T=l=g([m.registry.register(T.prototype.TYPE),E('design:paramtypes',[Object,Array])],T);let R=o=class extends m{map;constructor(e){if(super(),this.map=new Map,e)for(const[t,r]of Object.entries(e)){const e=m.registry.get(r.type)?.fromObject(r.values);e&&this.map.set(t,e)}}get TYPE(){return'map'}fromObject(e){return new o(e)}getValue(){const e={};for(const[t,r]of this.map.entries())e[t]={type:r.TYPE,values:r.getValue()};return e}getVariable(e){return this.map.get(e)}setVariable(e,t){this.map.set(e,t)}deleteVariable(e){this.map.delete(e)}get size(){return this.map.size}keys(){return this.map.keys()}};R=o=g([m.registry.register(R.prototype.TYPE),E('design:paramtypes',['function'==typeof(u='undefined'!=typeof Record&&Record)?u:Object])],R);var p,y,C,N,b,A,K,M,Y,I,O,V,f,w,L,P,D=function(e,t,r,s){var a,n=arguments.length,i=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if('object'==typeof Reflect&&'function'==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,s);else for(var l=e.length-1;l>=0;l--)(a=e[l])&&(i=(n<3?a(i):n>3?a(t,r,i):a(t,r))||i);return n>3&&i&&Object.defineProperty(t,r,i),i},x=function(e,t){if('object'==typeof Reflect&&'function'==typeof Reflect.metadata)return Reflect.metadata(e,t)};class U{static registry=new s;constructor(...e){}static parseString(e){if(void 0===e)return[];return[...e.matchAll(this.prototype.REGEX)].map(e=>({command:this.prototype.create(e.slice(1).map(e=>e.trim())),index:e.index})).filter(({command:e})=>e.isValid())}}class k extends U{}let v=p=class extends U{key;low;high;num;constructor(e,t,r,s){super(),this.key=e,this.low=t,this.high=r,this.num=s}get REGEX(){return/init_num\s*\(\s*([^(),:]+?)\s*,\s*([^(),:]+?)\s*,\s*([^(),:]+?)\s*,\s*([^)]+?)\s*\)/g}create(e){const t=e[0],r='null'===e[1]?null:Number(e[1]),s='null'===e[2]?null:Number(e[2]),a=Number(e[3]);return new p(t,r,s,a)}isValid(){return(null===this.low||!isNaN(this.low))&&((null===this.high||!isNaN(this.high))&&(!isNaN(this.num)&&!(null!==this.low&&null!==this.high&&this.low>this.high)))}execute(e){const t=new h(this.low,this.high,this.num);return e.setVariable(this.key,t),e}};v=p=D([U.registry.register(),x('design:paramtypes',[String,Object,Object,Number])],v);let G=y=class extends U{key;delta;constructor(e,t){super(),this.key=e,this.delta=t}get REGEX(){return/delta_num\s*\(\s*([^(),:]+?)\s*,\s*([^)]+?)\s*\)/g}create(e){const t=e[0],r=Number(e[1]);return new y(t,r)}isValid(){return!isNaN(this.delta)}execute(e){const t=e.getVariable(this.key);return null===t||t instanceof h==!1||(t.deltaNum(this.delta),e.setVariable(this.key,t)),e}};G=y=D([U.registry.register(),x('design:paramtypes',[String,Number])],G);let F=C=class extends U{key;delta;constructor(e,t){super(),this.key=e,this.delta=t}get REGEX(){return/delta_low\s*\(\s*([^(),:]+?)\s*,\s*([^)]+?)\s*\)/g}create(e){const t=e[0],r='null'===e[1]?null:Number(e[1]);return new C(t,r)}isValid(){return null===this.delta||!isNaN(this.delta)}execute(e){const t=e.getVariable(this.key);return null===t||t instanceof h==!1||(t.deltaLow(this.delta),e.setVariable(this.key,t)),e}};F=C=D([U.registry.register(),x('design:paramtypes',[String,Object])],F);let B=N=class extends U{key;delta;constructor(e,t){super(),this.key=e,this.delta=t}get REGEX(){return/delta_high\s*\(\s*([^(),:]+?)\s*,\s*([^)]+?)\s*\)/g}create(e){const t=e[0],r='null'===e[1]?null:Number(e[1]);return new N(t,r)}isValid(){return null===this.delta||!isNaN(this.delta)}execute(e){const t=e.getVariable(this.key);return null===t||t instanceof h==!1||(t.deltaHigh(this.delta),e.setVariable(this.key,t)),e}};B=N=D([U.registry.register(),x('design:paramtypes',[String,Object])],B);let X=b=class extends U{key;str;constructor(e,t){super(),this.key=e,this.str=t}get REGEX(){return/init_str\s*\(\s*([^(),:]+?)\s*,\s*([^)]+?)\s*\)/g}create(e){const t=e[0],r=e[1];return new b(t,r)}isValid(){return!0}execute(e){const t=new d(this.str);return e.setVariable(this.key,t),e}};X=b=D([U.registry.register(),x('design:paramtypes',[String,String])],X);let H=A=class extends U{key;str;constructor(e,t){super(),this.key=e,this.str=t}get REGEX(){return/set_str\s*\(\s*([^(),:]+?)\s*,\s*([^)]+?)\s*\)/g}create(e){const t=e[0],r=e[1];return new A(t,r)}isValid(){return!0}execute(e){const t=e.getVariable(this.key);return null===t||t instanceof d==!1||(t.setStr(this.str),e.setVariable(this.key,t)),e}};H=A=D([U.registry.register(),x('design:paramtypes',[String,String])],H);let j=K=class extends U{key;datetime_string;constructor(e,t){super(),this.key=e,this.datetime_string=t}get REGEX(){return/init_datetime\(([^,:]+),\s*([^)]+)\)/g}create(e){const t=e[0],r=e[1];return new K(t,r)}isValid(){const e=new Date(this.datetime_string);return!isNaN(e.getTime())}execute(e){const t=new Date(this.datetime_string),r=new S(t);return e.setVariable(this.key,r),e}};j=K=D([U.registry.register(),x('design:paramtypes',[String,String])],j);let W=M=class extends U{key;delta_year;delta_month;delta_date;delta_hour;delta_minute;delta_second;constructor(e,t,r,s,a,n,i){super(),this.key=e,this.delta_year=t,this.delta_month=r,this.delta_date=s,this.delta_hour=a,this.delta_minute=n,this.delta_second=i}get REGEX(){return/delta_datetime\(([^,]+),\s*([^)]+),\s*([^)]+),\s*([^)]+),\s*([^)]+),\s*([^)]+),\s*([^)]+)\)/g}create(e){const t=e[0],r=Number(e[1]),s=Number(e[2]),a=Number(e[3]),n=Number(e[4]),i=Number(e[5]),l=Number(e[6]);return new M(t,r,s,a,n,i,l)}isValid(){return!isNaN(this.delta_year)&&(!isNaN(this.delta_month)&&(!isNaN(this.delta_date)&&(!isNaN(this.delta_hour)&&(!isNaN(this.delta_minute)&&!isNaN(this.delta_second)))))}execute(e){const t=e.getVariable(this.key);return null===t||t instanceof S==!1||(t.deltaDatetime(this.delta_year,this.delta_month,this.delta_date,this.delta_hour,this.delta_minute,this.delta_second),e.setVariable(this.key,t)),e}};W=M=D([U.registry.register(),x('design:paramtypes',[String,Number,Number,Number,Number,Number,Number])],W);let q=Y=class extends U{command_name;key;delta;constructor(e,t,r){super(),this.command_name=e,this.key=t,this.delta=r}get REGEX(){return/(delta_year|delta_month|delta_date|delta_hour|delta_minute|delta_second)\(([^,]+),\s*([^)]+)\)/g}create(e){const t=e[0],r=e[1],s=Number(e[2]);return new Y(t,r,s)}isValid(){return!isNaN(this.delta)}execute(e){const t=e.getVariable(this.key);if(null===t||t instanceof S==!1)return e;const r='delta_year'===this.command_name?this.delta:0,s='delta_month'===this.command_name?this.delta:0,a='delta_date'===this.command_name?this.delta:0,n='delta_hour'===this.command_name?this.delta:0,i='delta_minute'===this.command_name?this.delta:0,l='delta_second'===this.command_name?this.delta:0;return t.deltaDatetime(r,s,a,n,i,l),e.setVariable(this.key,t),e}};q=Y=D([U.registry.register(),x('design:paramtypes',[String,String,Number])],q);let J=I=class extends U{key;random_events;constructor(e,t){super(),this.key=e,this.random_events=t}get REGEX(){return/init_random\(\s*([^,]+)\s*,\s*(.+)\s*\)/g}create(e){const t=e[0],r=e[1],s=[];for(const e of r.split(',')){const[t,r]=e.split(':');s.push({event:t,weighting:Number(r)})}return new I(t,s)}isValid(){for(const e of this.random_events)if(Number.isNaN(e.weighting))return!1;return!0}execute(e){const t=new T(null,this.random_events);return e.setVariable(this.key,t),e}};J=I=D([U.registry.register(),x('design:paramtypes',[String,Array])],J);let Q=O=class extends k{key;constructor(e){super(),this.key=e}get REGEX(){return/roll\(\s*([^,()]+)\s*\)/g}create(e){const t=e[0];return new O(t)}isValid(){return!0}execute(e){const t=e.getVariable(this.key);return null===t||t instanceof T==!1||(t.roll(),e.setVariable(this.key,t)),e}getRestoreKeys(e){return[this.key]}};Q=O=D([U.registry.register(),x('design:paramtypes',[String])],Q);let Z=V=class extends U{key;constructor(e){super(),this.key=e}get REGEX(){return/delete\(([^,()]+)\s*\)/g}create(e){const t=e[0];return new V(t)}isValid(){return!0}execute(e){return e.deleteVariable(this.key),e}};Z=V=D([U.registry.register(),x('design:paramtypes',[String])],Z);let ee=f=class extends U{key;constructor(e){super(),this.key=e}get REGEX(){return/init_map\(\s*([^,]+)\s*\)/g}create(e){const t=e[0];return new f(t)}isValid(){return!0}execute(e){const t=new R;return e.setVariable(this.key,t),e}};ee=f=D([U.registry.register(),x('design:paramtypes',[String])],ee);let te=w=class extends U{map_key;variable_key;constructor(e,t){super(),this.map_key=e,this.variable_key=t}get REGEX(){return/add_map\(\s*([^,]+)\s*,\s*(.+)\s*\)/g}create(e){const t=e[0],r=e[1];return new w(t,r)}isValid(){return!0}execute(e){const t=e.getVariable(this.map_key);if(null===t||t instanceof R==!1)return e;const r=e.getVariable(this.variable_key);return null===r||(t.setVariable(this.variable_key,r),e.deleteVariable(this.variable_key),e.setVariable(this.map_key,t)),e}};te=w=D([U.registry.register(),x('design:paramtypes',[String,String])],te);let re=L=class extends U{map_key;variable_key;constructor(e,t){super(),this.map_key=e,this.variable_key=t}get REGEX(){return/pop_map\(\s*([^,]+)\s*,\s*(.+)\s*\)/g}create(e){const t=e[0],r=e[1];return new L(t,r)}isValid(){return!0}execute(e){const t=e.getVariable(this.map_key);if(null===t||t instanceof R==!1)return e;const r=t.getVariable(this.variable_key);return void 0===r||(t.deleteVariable(this.variable_key),e.setVariable(this.variable_key,r),e.setVariable(this.map_key,t)),e}};re=L=D([U.registry.register(),x('design:paramtypes',[String,String])],re);let se=P=class extends U{map_key;variable_key;constructor(e,t){super(),this.map_key=e,this.variable_key=t}get REGEX(){return/delete_map\(\s*([^,]+)\s*,\s*(.+)\s*\)/g}create(e){const t=e[0],r=e[1];return new P(t,r)}isValid(){return!0}execute(e){const t=e.getVariable(this.map_key);return null===t||t instanceof R==!1||(t.deleteVariable(this.variable_key),e.setVariable(this.map_key,t)),e}};se=P=D([U.registry.register(),x('design:paramtypes',[String,String])],se);class ae{commands=[];constructor(e){this.commands=e??[]}pushCommand(e){this.commands.push(e)}static fromString(e,t='normal'){let r=e.split('<UserPerspective>');if(!e.includes('<VTC>'))return new ae;r=r[r.length-1].split('<VTC>');const s=r[r.length-1].split('</VTC>')[0];let a=[];for(const e of U.registry.getAll().values())'normal'===t&&e.prototype instanceof k||('post'!==t||e.prototype instanceof k)&&(a=a.concat(e.parseString(s)));a.sort((e,t)=>e.index-t.index);const n=a.map(e=>e.command);return console.log('[VariableTracker] commands:',n),new ae(n)}execute(e){for(const t of this.commands)t.execute(e);return e}*[Symbol.iterator](){for(const e of this.commands)yield e}}class ne{state;constructor(e){this.state=e?e.state:new Map}static fromVariables(e){const t=new ne;if(null===e)return t;for(const[r,s]of Object.entries(e)){const e=m.registry.get(s.type)?.fromObject(s.values);e&&t.setVariable(r,e)}return t}toVariables(){const e={};for(const[t,r]of this.state)e[t]={type:r.TYPE,values:r.getValue()};return e}getVariable(e){return this.state.get(e)??null}setVariable(e,t){this.state.set(e,t)}deleteVariable(e){this.state.delete(e)}}const ie={type:'chat'};function le(e){return e<0&&(e=getLastMessageId()+e+1),e}function oe(){const e=getVariables(ie).current??null;return ne.fromVariables(e)}function ce(e){const t=getVariables(ie);t.current=e.toVariables(),replaceVariables(t,ie)}function ue(){const e=getVariables(ie);e.current={},replaceVariables(e,ie)}function ge(e){if(0===e)ue();else{const t=e-1;ce(Ee(t,he(t)))}}function Ee(e,t){e=le(e);const r=getVariables(ie);return ne.fromVariables(r.history[e][t])}function _e(e,t=-1,r){t=le(t);const s=getVariables(ie);s.history=s.history??[],s.history[t]=s.history[t]??[],s.history[t][r]=e.toVariables(),replaceVariables(s,ie)}function me(e){const t=getVariables(ie);t.history&&(t.history.splice(e),replaceVariables(t,ie))}function he(e){return getChatMessages(e,{include_swipes:!0})[0].swipe_id}function de(e){return getChatMessages(e,{include_swipes:!0})[0].swipes.length}function Se(e,t){let r;console.log('[VariableTracker] executeCommand strat'),r=void 0===t?getChatMessages(e)[0].message:getChatMessages(e,{include_swipes:!0})[0].swipes[t];const s=ae.fromString(r);console.log('[VariableTracker] commands:',s);const a=oe();s.execute(a),console.log('[VariableTracker] state:',a),ce(a),console.log('[VariableTracker] executeCommand end')}function Te(e,t){let r;console.log('[VariableTracker] executePostCommand strat'),r=void 0===t?getChatMessages(e)[0].message:getChatMessages(e,{include_swipes:!0})[0].swipes[t];const s=ae.fromString(r,'post');console.log('[VariableTracker] post commands:',s);const a=oe();s.execute(a),console.log('[VariableTracker] state:',a),ce(a),console.log('[VariableTracker] executePostCommand end')}function Re(e,t){t||(t=he(e));const r=getChatMessages(e,{include_swipes:!0})[0].swipes[t],s=ae.fromString(r,'post'),a=Ee(e,t),n=e+1,i=Ee(n,he(n));for(const e of s){const t=e;for(const e of t.getRestoreKeys(a)){const t=i.getVariable(e);t&&a.setVariable(e,t)}}_e(a,e,t)}function pe(e){ge(e);for(let t=e;t<=getLastMessageId();t++){console.log('[DEBUG] message_id:',t);for(let e=0;e<de(t);e++)Se(t,e),_e(oe(),t,e),ge(t);ce(Ee(t,he(t)))}}eventOn(tavern_events.MESSAGE_SENT,async e=>{console.log('[VariableTracker] MESSAGE_SENT strat'),Se(e),Te(e);const t=he(e);_e(oe(),e,t),console.log('[VariableTracker] MESSAGE_SENT end')}),eventOn(tavern_events.MESSAGE_UPDATED,async e=>{await new Promise(e=>setTimeout(e,100)),console.log('[VariableTracker] MESSAGE_UPDATED strat');const t=de(e=Number(e)),r=function(e){return e=le(e),getVariables(ie).history[e].length}(e);if(t<r){!function(e,t){const r=getVariables(ie);r.history&&(r.history[e].splice(t,1),replaceVariables(r,ie))}(e,he(e))}ge(e),pe(e),0!==e&&Re(e-1),console.log('[VariableTracker] MESSAGE_UPDATED end')}),eventOn(tavern_events.MESSAGE_RECEIVED,async e=>{console.log('[VariableTracker] MESSAGE_RECEIVED strat'),Se(e),Te(e);const t=he(e);_e(oe(),e,t),console.log('[VariableTracker] MESSAGE_RECEIVED end')}),eventOn(tavern_events.MESSAGE_SWIPED,async e=>{console.log('[VariableTracker] MESSAGE_SWIPED strat');const t=he(e),r=0===e?null:e-1;if(function(e,t){return t<getChatMessages(e,{include_swipes:!0})[0].swipes.length}(e,t))ce(Ee(e,t)),null!==r&&Re(r);else if(null!==r){ge(r),0!==r&&(Se(r-1),Te(r-1));const e=he(r);Te(r),_e(oe(),r,e)}else ue();console.log('[VariableTracker] MESSAGE_SWIPED end')}),eventOn(tavern_events.MESSAGE_DELETED,async e=>{console.log('[VariableTracker] MESSAGE_DELETED strat');const t=getChatMessages('0-{{lastMessageId}}',{include_swipes:!0});let s,a;s=getCharData('current')?.first_mes?'assistant':'user';for(const e of t){if(e.role!==s){a=e.message_id;break}s='assistant'===s?'user':'assistant'}a||(a=t.length),ge(a),me(a),deleteChatMessages(r().range(a,getLastMessageId()+1)),console.log('[VariableTracker] MESSAGE_DELETED end')}),eventOn(getButtonEvent('清除所有變數'),function(){toastr.info('開始清除所有變數...','VariableTracker Debug');const e=getVariables(ie);e.current={},e.history=[],replaceVariables(e,ie),toastr.success('所有變數已清除！','VariableTracker Debug')}),eventOn(getButtonEvent('重新讀取所有變數'),async function(){toastr.info('開始重新讀取所有變數...','VariableTracker Debug');try{me(0),pe(0)}catch(e){return console.error('[VariableTracker] 重新讀取變數時發生錯誤:',e),void toastr.error('重新讀取變數失敗，請檢查控制台日誌','VariableTracker Debug')}toastr.success('所有變數已重新讀取完成！','VariableTracker Debug')});class ye{registry=new Map;register(e,t){this.registry.set(e,t)}get(e){return this.registry.get(e)}getAll(){return this.registry}has(e){return this.registry.has(e)}}class Ce{static registry=new ye;name;description;constructor(e,t){this.name=e,this.description=t}static register(e){Ce.registry.register(e.name,e)}static get(e){return Ce.registry.get(e)}}class Ne extends ne{constructor(e){super(e)}static get STAMINA_KEY(){return'行動力'}static get MONEY_KEY(){return'金錢'}static get TRUST_KEY(){return'信賴'}static get INTEREST_KEY(){return'興致'}static get MOOD_KEY(){return'心情'}static get CURRENT_ACTION_KEY(){return'當前行動'}static get EXPECT_RESULT_KEY(){return'預期結果'}static get DATETIME_KEY(){return'時間'}static get BIG_PLACE_KEY(){return'大地點'}static get MIDDLE_PLACE_KEY(){return'中地點'}static get SMALL_PLACE_KEY(){return'小地點'}static get WEATHER_KEY(){return'天氣'}static get FLAGS_KEY(){return'flags'}static get FLAG_BATH_KEY(){return'洗澡了'}static get SHOP_ITEMS_KEY(){return'shop_items'}static get INVENTORIES_KEY(){return'inventories'}static get TRUST_ROC_KEY(){return'信賴變動'}static get INTEREST_ROC_KEY(){return'興致變動'}static get MOOD_ROC_KEY(){return'心情變動'}static get ITEM_TABLE_KEY(){return'item_table'}static get CLOTHING_KEY(){return'妹妹衣著'}static get SUMMARY_TABLE_KEY(){return'summary_table'}static get SUMMARY_KEY(){return'總結'}static get WEIGHTING_KEY(){return'權重'}getNumVariable(e){const t=this.state.get(e);return t instanceof h?t:null}getStrVariable(e){const t=this.state.get(e);return t instanceof d?t:null}getMapVariable(e){const t=this.state.get(e);return t instanceof R?t:null}getStaminaVariable(){return this.getNumVariable(Ne.STAMINA_KEY)}getStamina(){return this.getStaminaVariable().getNum()}deltaStamina(e){this.getStaminaVariable().deltaNum(e)}getStaminaHigh(){return this.getStaminaVariable().getHigh()}deltaStaminaHigh(e){this.getStaminaVariable().deltaHigh(e)}getMoneyVariable(){return this.getNumVariable(Ne.MONEY_KEY)}getMoney(){return this.getMoneyVariable().getNum()}deltaMoney(e){this.getMoneyVariable().deltaNum(e)}getTrustVariable(){return this.getNumVariable(Ne.TRUST_KEY)}getTrust(){return this.getTrustVariable().getNum()}deltaTrust(e){this.getTrustVariable().deltaNum(e)}getInterestVariable(){return this.getNumVariable(Ne.INTEREST_KEY)}getInterest(){return this.getInterestVariable().getNum()}deltaInterest(e){this.getInterestVariable().deltaNum(e)}getMoodVariable(){return this.getNumVariable(Ne.MOOD_KEY)}getMood(){return this.getMoodVariable().getNum()}deltaMood(e){this.getMoodVariable().deltaNum(e)}getCurrentAction(){return this.getStrVariable(Ne.CURRENT_ACTION_KEY).getStr()}setCurrentAction(e){this.getStrVariable(Ne.CURRENT_ACTION_KEY).setStr(e)}getExpectResult(){return this.getStrVariable(Ne.EXPECT_RESULT_KEY).getStr()}setExpectResult(e){this.getStrVariable(Ne.EXPECT_RESULT_KEY).setStr(e)}getDatetimeVariable(){const e=this.state.get(Ne.DATETIME_KEY);return e instanceof S?e:null}getYear(){return this.getDatetimeVariable().getYear()}getMonth(){return this.getDatetimeVariable().getMonth()}getDate(){return this.getDatetimeVariable().getDate()}getHours(){return this.getDatetimeVariable().getHours()}getMinutes(){return this.getDatetimeVariable().getMinutes()}getSeconds(){return this.getDatetimeVariable().getSeconds()}getDay(){return this.getDatetimeVariable().getDay()}isWeekday(){switch(this.getDay()){case 1:case 2:case 3:case 4:case 5:return!0}return!1}isWeekend(){switch(this.getDay()){case 0:case 6:return!0}return!1}deltaMinutes(e){this.getDatetimeVariable().deltaDatetime(0,0,0,0,e,0)}deltaDatetimeUntil(e,t){const r=this.getDatetimeVariable(),s=60*r.getHours()+r.getMinutes();let a=60*e+t;s>a&&(a+=1440);const n=a-s;r.deltaDatetime(0,0,0,0,n,0)}getBigPlace(){return this.getStrVariable(Ne.BIG_PLACE_KEY).getStr()}setBigPlace(e){this.getStrVariable(Ne.BIG_PLACE_KEY).setStr(e)}getMiddlePlace(){return this.getStrVariable(Ne.MIDDLE_PLACE_KEY).getStr()}setMiddlePlace(e){this.getStrVariable(Ne.MIDDLE_PLACE_KEY).setStr(e)}getSmallPlace(){return this.getStrVariable(Ne.SMALL_PLACE_KEY).getStr()}setSmallPlace(e){this.getStrVariable(Ne.SMALL_PLACE_KEY).setStr(e)}getWeather(){return this.getStrVariable(Ne.WEATHER_KEY).getStr()}setWeather(e){this.getStrVariable(Ne.WEATHER_KEY).setStr(e)}getFlagsVariable(){return this.getMapVariable(Ne.FLAGS_KEY)}getFlagBathVariable(){return this.getFlagsVariable().getVariable(Ne.FLAG_BATH_KEY)}isAlreadyBath(){return 1===this.getFlagBathVariable().getNum()}setFlagBath(e){e?this.getFlagBathVariable().deltaNum(1):this.getFlagBathVariable().deltaNum(-1)}getShopItemsVariable(){return this.getMapVariable(Ne.SHOP_ITEMS_KEY)}addShopItem(e,t,r){const s=Ce.get(e);if(!s)return;const a=new R;a.setVariable('price',new h(null,null,t)),null!==r&&a.setVariable('max_quantity',new h(0,r,r));this.getShopItemsVariable().setVariable(s.name,a)}getShopItem(e){const t=this.getShopItemsVariable().getVariable(e);if(!t)return null;const r=Ce.get(e),s=t.getVariable('price').getNum();let a;const n=t.getVariable('max_quantity');return a=n?n.getNum():null,{item:r,price:s,max_quantity:a}}getShopItems(){const e=this.getShopItemsVariable(),t=[];for(const r of e.keys())t.push(this.getShopItem(r));return t}getShopItemsSize(){return this.getShopItemsVariable().size}clearShopItems(){this.setVariable(Ne.SHOP_ITEMS_KEY,new R)}buyShopItem(e,t){const r=this.getShopItemsVariable().getVariable(e);if(!r)return;const s=r.getVariable('price').getNum();this.deltaMoney(-s*t);const a=r.getVariable('max_quantity');a&&a.deltaNum(-t),this.deltaInventory(e,t)}sellShopItem(e,t){if(!this.getInventory(e))return;const r=this.getShopItem(e);let s=r.max_quantity;null!==s&&(s+=t),this.deltaInventory(e,-t),this.deltaMoney(r.price*t),this.addShopItem(e,r.price,s)}getInventoriesVariable(){return this.getMapVariable(Ne.INVENTORIES_KEY)}deltaInventory(e,t){const r=this.getInventoriesVariable();let s=r.getVariable(e);s?s.deltaNum(t):s=new h(0,null,t),0===s.getNum()?r.deleteVariable(e):r.setVariable(e,s)}getInventory(e){const t=this.getInventoriesVariable().getVariable(e);if(!t)return null;const r=t.getNum();return{name:e,description:this.getItem(e).description,quantity:r}}hasInventory(e){const t=Ce.get(e);return!!t&&void 0!==this.getInventoriesVariable().getVariable(t.name)}getInventories(){const e=this.getInventoriesVariable(),t=[];for(const r of e.keys())t.push(this.getInventory(r));return t}getDinnerInventory(){return this.hasInventory('體力食材')?'體力食材':this.hasInventory('便當')?'便當':this.hasInventory('食材')?'食材':'泡麵'}getTrustROCVariable(){return this.getNumVariable(Ne.TRUST_ROC_KEY)}getTrustROC(){return this.getTrustROCVariable().getNum()}deltaTrustROC(e){this.getTrustROCVariable().deltaNum(e)}resetTrustROC(){this.getTrustROCVariable().deltaNum(-this.getTrustROC())}getInterestROCVariable(){return this.getNumVariable(Ne.INTEREST_ROC_KEY)}getInterestROC(){return this.getInterestROCVariable().getNum()}deltaInterestROC(e){this.getInterestROCVariable().deltaNum(e)}resetInterestROC(){this.getInterestROCVariable().deltaNum(-this.getInterestROC())}getMoodROCVariable(){return this.getNumVariable(Ne.MOOD_ROC_KEY)}getMoodROC(){return this.getMoodROCVariable().getNum()}deltaMoodROC(e){this.getMoodROCVariable().deltaNum(e)}resetMoodROC(){this.getMoodROCVariable().deltaNum(-this.getMoodROC())}getItemTableVariable(){return this.getMapVariable(Ne.ITEM_TABLE_KEY)}createItem(e,t){const r=this.getItemTableVariable(),s=new d(t);r.setVariable(e,s)}getItem(e){const t=this.getItemTableVariable().getVariable(e);if(!t)return null;return{description:t.getStr()}}getItemTable(){const e=this.getItemTableVariable(),t=new Map;for(const r of e.keys()){const s=e.getVariable(r).getStr();t.set(r,s)}return t}getClothing(){return this.getStrVariable(Ne.CLOTHING_KEY).getStr()}setClothing(e){this.getStrVariable(Ne.CLOTHING_KEY).setStr(e)}getSummaryTableVariable(){return this.getMapVariable(Ne.SUMMARY_TABLE_KEY)}addSummary(e,t){const r=this.getSummaryTableVariable(),s=r.size,a=this.getDatetimeVariable(),n=this.getBigPlace(),i=this.getMiddlePlace(),l=this.getSmallPlace(),o=new R;o.setVariable(Ne.DATETIME_KEY,a),o.setVariable(Ne.BIG_PLACE_KEY,new d(n)),o.setVariable(Ne.MIDDLE_PLACE_KEY,new d(i)),o.setVariable(Ne.SMALL_PLACE_KEY,new d(l)),o.setVariable(Ne.SUMMARY_KEY,new d(e)),o.setVariable(Ne.WEIGHTING_KEY,new h(0,1,t)),r.setVariable(String(s),o)}getSummary(e){const t=this.getSummaryTableVariable().getVariable(String(e));if(!t)return null;return{datetime:t.getVariable(Ne.DATETIME_KEY).getDateTime(),big_place:t.getVariable(Ne.BIG_PLACE_KEY).getStr(),middle_place:t.getVariable(Ne.MIDDLE_PLACE_KEY).getStr(),small_place:t.getVariable(Ne.SMALL_PLACE_KEY).getStr(),summary:t.getVariable(Ne.SUMMARY_KEY).getStr(),weighting:t.getVariable(Ne.WEIGHTING_KEY).getNum()}}getSummaries(){const e=this.getSummaryTableVariable(),t=[];for(let r=0;r<e.size;r++)t.push(this.getSummary(r));return t}finishCurrentAction(e,t){this.addSummary(e,t),t=Math.trunc(10*t);const r=this.getTrustROC(),s=this.getInterestROC(),a=Math.max(1,Math.abs(r)+Math.abs(s));let n=Math.trunc(r/a*t);n<0&&(n*=2);let i=Math.trunc(s/a*t);i<0&&(i*=2);const l=this.getMoodROC();let o=0;l>0&&l>10-t?o=1:l<0&&2*l<t-10&&(o=-1),console.log('[Action Command] weighting:',t),console.log('[Action Command] trust_roc:',r),console.log('[Action Command] interest_roc:',s),console.log('[Action Command] roc_sum:',a),console.log('[Action Command] delta_trust:',n),console.log('[Action Command] delta_interest:',i),console.log('[Action Command] mood_roc:',l),console.log('[Action Command] delta_mood:',o),this.deltaTrust(n),this.deltaInterest(i),this.deltaMood(o),this.resetTrustROC(),this.resetInterestROC(),this.resetMoodROC()}handleChangeDateEvents(e,t,r,s,a,n){const i=new Date(e,t,r),l=new Date(s,a,n),o=Math.floor((l.getTime()-i.getTime())/864e5);o<=0||this.deltaMoney(2e3*o)}isCurrentDateTimeBetween(e,t,r,s){const a=this.state.get(Ne.DATETIME_KEY);if(!(a instanceof S))return!1;const n=60*a.getHours()+a.getMinutes(),i=60*e+t,l=60*r+s;return i<=l?n>=i&&n<=l:n>=i||n<=l}isCurrentDateTimeAtNight(){return this.isCurrentDateTimeBetween(19,0,0,0)}}var be,Ae,Ke,Me,Ye,Ie,Oe,Ve,fe,we,Le,Pe,De,xe,Ue=function(e,t,r,s){var a,n=arguments.length,i=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if('object'==typeof Reflect&&'function'==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,s);else for(var l=e.length-1;l>=0;l--)(a=e[l])&&(i=(n<3?a(i):n>3?a(t,r,i):a(t,r))||i);return n>3&&i&&Object.defineProperty(t,r,i),i};class ke{static registry=new s;static NONE_STR='無'}let ve=class extends ke{static{be=this}static SUCCESS_STR='成功提高信賴';static NORMAL_STR='普通';get category(){return'說話'}get name(){return'無關緊要的話題'}start(e){e.setCurrentAction(this.name),e.deltaStamina(-10),Math.random()<.33?e.setExpectResult(be.SUCCESS_STR):e.setExpectResult(be.NORMAL_STR)}getStartRestoreKeys(){return[Ne.CURRENT_ACTION_KEY,Ne.EXPECT_RESULT_KEY,Ne.STAMINA_KEY]}finish(e){switch(e.getExpectResult()){case be.SUCCESS_STR:e.deltaTrust(4);break;case be.NORMAL_STR:e.deltaTrust(2)}e.deltaMinutes(30),e.setCurrentAction(ke.NONE_STR),e.setExpectResult(ke.NONE_STR)}getFinishRestoreKeys(){return[Ne.CURRENT_ACTION_KEY,Ne.EXPECT_RESULT_KEY,Ne.TRUST_KEY,Ne.DATETIME_KEY]}isPossible(e){return e.getCurrentAction()===ke.NONE_STR&&(!(e.getStamina()<10)&&!!e.isCurrentDateTimeAtNight())}isForce(e){return!1}};ve=be=Ue([ke.registry.register(ve.prototype.name)],ve);let Ge=class extends ke{static{Ae=this}static SUCCESS_STR='成功，提高興致';static NORMAL_STR='普通';static FAIL_STR='失敗，降低信賴';get category(){return'說話'}get name(){return'色色的話題'}start(e){e.setCurrentAction(this.name),e.deltaStamina(-15);const t=Math.random();t<.25?e.setExpectResult(Ae.SUCCESS_STR):t<.5?e.setExpectResult(Ae.FAIL_STR):e.setExpectResult(Ae.NORMAL_STR)}getStartRestoreKeys(){return[Ne.CURRENT_ACTION_KEY,Ne.EXPECT_RESULT_KEY,Ne.STAMINA_KEY]}finish(e){let t=-1,r=2;switch(e.getExpectResult()){case Ae.SUCCESS_STR:r+=2;break;case Ae.FAIL_STR:t-=1,r-=1}e.deltaTrust(t),e.deltaInterest(r),e.deltaMinutes(30),e.setCurrentAction(ke.NONE_STR),e.setExpectResult(ke.NONE_STR)}getFinishRestoreKeys(){return[Ne.TRUST_KEY,Ne.INTEREST_KEY,Ne.DATETIME_KEY,Ne.CURRENT_ACTION_KEY,Ne.EXPECT_RESULT_KEY]}isPossible(e){return e.getCurrentAction()===ke.NONE_STR&&(!(e.getStamina()<15)&&!!e.isCurrentDateTimeAtNight())}isForce(e){return!1}};Ge=Ae=Ue([ke.registry.register(Ge.prototype.name)],Ge);let Fe=class extends ke{static{Ke=this}static SUCCESS_STR='成功，提高心情';get category(){return'說話'}get name(){return'討好'}start(e){e.setCurrentAction(this.name),e.deltaStamina(-20),e.setExpectResult(Ke.SUCCESS_STR)}getStartRestoreKeys(){return[Ne.CURRENT_ACTION_KEY,Ne.STAMINA_KEY,Ne.EXPECT_RESULT_KEY]}finish(e){e.getMood()<=0&&e.deltaMood(1),e.deltaMinutes(60),e.setCurrentAction(ke.NONE_STR),e.setExpectResult(ke.NONE_STR)}getFinishRestoreKeys(){return[Ne.MOOD_KEY,Ne.DATETIME_KEY,Ne.CURRENT_ACTION_KEY,Ne.EXPECT_RESULT_KEY]}isPossible(e){return e.getCurrentAction()===ke.NONE_STR&&(!(e.getStamina()<20)&&!!e.isCurrentDateTimeAtNight())}isForce(e){return!1}};Fe=Ke=Ue([ke.registry.register(Fe.prototype.name)],Fe);let Be=class extends ke{static{Me=this}static SUCCESS_STR='成功，提高信賴、心情';static NORMAL_STR='普通';static FAIL_STR='失敗，降低心情';get category(){return'玩遊戲吧'}get name(){return'對戰遊戲'}start(e){e.setCurrentAction(this.name),e.deltaStamina(-20);const t=Math.random();t<.3?e.setExpectResult(Me.SUCCESS_STR):t<.4?e.setExpectResult(Me.FAIL_STR):e.setExpectResult(Me.NORMAL_STR)}getStartRestoreKeys(){return[Ne.CURRENT_ACTION_KEY,Ne.STAMINA_KEY,Ne.EXPECT_RESULT_KEY]}finish(e){let t=5,r=0;switch(e.getExpectResult()){case Me.SUCCESS_STR:t+=4,r+=1;break;case Me.FAIL_STR:r-=1}e.deltaMinutes(120),e.deltaTrust(t),e.deltaMood(r),e.setCurrentAction(ke.NONE_STR),e.setExpectResult(ke.NONE_STR)}getFinishRestoreKeys(){return[Ne.DATETIME_KEY,Ne.TRUST_KEY,Ne.MOOD_KEY,Ne.CURRENT_ACTION_KEY,Ne.EXPECT_RESULT_KEY]}isPossible(e){return e.getCurrentAction()===ke.NONE_STR&&(!(e.getStamina()<20)&&!!e.isCurrentDateTimeAtNight())}isForce(e){return!1}};Be=Me=Ue([ke.registry.register(Be.prototype.name)],Be);let Xe=class extends ke{static{Ye=this}static SUCCESS_STR='成功，提高信賴、心情';static NORMAL_STR='普通';static FAIL_STR='失敗，降低心情';get category(){return'玩遊戲吧'}get name(){return'格鬥遊戲'}start(e){e.setCurrentAction(this.name),e.deltaStamina(-20);const t=Math.random();t<.5?e.setExpectResult(Ye.SUCCESS_STR):t<.8?e.setExpectResult(Ye.FAIL_STR):e.setExpectResult(Ye.NORMAL_STR)}getStartRestoreKeys(){return[Ne.CURRENT_ACTION_KEY,Ne.STAMINA_KEY,Ne.EXPECT_RESULT_KEY]}finish(e){let t=3,r=0;switch(e.getExpectResult()){case Ye.SUCCESS_STR:t+=6,r+=1;break;case Ye.FAIL_STR:r-=1}e.deltaMinutes(120),e.deltaTrust(t),e.deltaMood(r),e.setCurrentAction(ke.NONE_STR),e.setExpectResult(ke.NONE_STR)}getFinishRestoreKeys(){return[Ne.DATETIME_KEY,Ne.TRUST_KEY,Ne.MOOD_KEY,Ne.CURRENT_ACTION_KEY,Ne.EXPECT_RESULT_KEY]}isPossible(e){return e.getCurrentAction()===ke.NONE_STR&&(!(e.getStamina()<20)&&!!e.isCurrentDateTimeAtNight())}isForce(e){return!1}};Xe=Ye=Ue([ke.registry.register(Xe.prototype.name)],Xe);let He=class extends ke{static{Ie=this}static SUCCESS_STR='成功，提高信賴、心情';static NORMAL_STR='普通';static FAIL_STR='失敗，降低信賴、心情';get category(){return'玩遊戲吧'}get name(){return'競速遊戲'}start(e){e.setCurrentAction(this.name),e.deltaStamina(-20);const t=Math.random();t<.7?e.setExpectResult(Ie.SUCCESS_STR):t<.8?e.setExpectResult(Ie.FAIL_STR):e.setExpectResult(Ie.NORMAL_STR)}getStartRestoreKeys(){return[Ne.CURRENT_ACTION_KEY,Ne.STAMINA_KEY,Ne.EXPECT_RESULT_KEY]}finish(e){let t=2,r=0;switch(e.getExpectResult()){case Ie.SUCCESS_STR:t+=2,r+=1;break;case Ie.FAIL_STR:t-=3,r-=1}e.deltaMinutes(120),e.deltaTrust(t),e.deltaMood(r),e.setCurrentAction(ke.NONE_STR),e.setExpectResult(ke.NONE_STR)}getFinishRestoreKeys(){return[Ne.DATETIME_KEY,Ne.TRUST_KEY,Ne.MOOD_KEY,Ne.CURRENT_ACTION_KEY,Ne.EXPECT_RESULT_KEY]}isPossible(e){return e.getCurrentAction()===ke.NONE_STR&&(!(e.getStamina()<20)&&!!e.isCurrentDateTimeAtNight())}isForce(e){return!1}};He=Ie=Ue([ke.registry.register(He.prototype.name)],He);let je=class extends ke{static{Oe=this}static SUCCESS_STR='成功，提高信賴、心情';static NORMAL_STR='普通';static FAIL_STR='失敗，降低信賴、心情';get category(){return'玩遊戲吧'}get name(){return'角色扮演遊戲'}start(e){e.setCurrentAction(this.name),e.deltaStamina(-20);const t=Math.random();t<.4?e.setExpectResult(Oe.SUCCESS_STR):t<.8?e.setExpectResult(Oe.FAIL_STR):e.setExpectResult(Oe.NORMAL_STR)}getStartRestoreKeys(){return[Ne.CURRENT_ACTION_KEY,Ne.STAMINA_KEY,Ne.EXPECT_RESULT_KEY]}finish(e){let t=3,r=0;switch(e.getExpectResult()){case Oe.SUCCESS_STR:t+=10,r+=1;break;case Oe.FAIL_STR:t-=2,r-=1}e.deltaMinutes(120),e.deltaTrust(t),e.deltaMood(r),e.setCurrentAction(ke.NONE_STR),e.setExpectResult(ke.NONE_STR)}getFinishRestoreKeys(){return[Ne.DATETIME_KEY,Ne.TRUST_KEY,Ne.MOOD_KEY,Ne.CURRENT_ACTION_KEY,Ne.EXPECT_RESULT_KEY]}isPossible(e){return e.getCurrentAction()===ke.NONE_STR&&(!(e.getStamina()<20)&&!!e.isCurrentDateTimeAtNight())}isForce(e){return!1}};je=Oe=Ue([ke.registry.register(je.prototype.name)],je);let $e=class extends ke{get category(){return'洗澡！'}get name(){return'哥哥一個人洗澡'}start(e){e.setCurrentAction(this.name),e.setSmallPlace('浴室')}getStartRestoreKeys(){return[Ne.CURRENT_ACTION_KEY,Ne.SMALL_PLACE_KEY]}finish(e){e.deltaStamina(15),e.deltaMinutes(30),e.setFlagBath(!0),e.setSmallPlace('客廳'),e.setCurrentAction(We.prototype.name)}getFinishRestoreKeys(){return[Ne.STAMINA_KEY,Ne.DATETIME_KEY,Ne.FLAGS_KEY,Ne.BIG_PLACE_KEY,Ne.CURRENT_ACTION_KEY]}isPossible(e){return e.getCurrentAction()===ke.NONE_STR&&(!e.isAlreadyBath()&&!!e.isCurrentDateTimeAtNight())}isForce(e){return e.getCurrentAction()===ke.NONE_STR&&(!e.isAlreadyBath()&&!!e.isCurrentDateTimeBetween(21,0,2,0))}};$e=Ue([ke.registry.register($e.prototype.name)],$e);let We=class extends ke{get category(){return null}get name(){return'妹妹一個人洗澡'}start(e){e.setCurrentAction(this.name)}getStartRestoreKeys(){return[Ne.CURRENT_ACTION_KEY]}finish(e){e.deltaMinutes(30),e.setCurrentAction(ke.NONE_STR)}getFinishRestoreKeys(){return[Ne.DATETIME_KEY,Ne.CURRENT_ACTION_KEY]}isPossible(e){return!1}isForce(e){return!1}};We=Ue([ke.registry.register(We.prototype.name)],We);let qe=class extends ke{static{Ve=this}static SUCCESS_STR='沒有被妹妹察覺';static FAIL_STR='引起妹妹疑心，降低信賴';get category(){return null}get name(){return'偷看妹妹換下來的胸罩'}start(e){e.setSmallPlace('更衣間'),e.setCurrentAction(this.name),e.deltaStamina(-10);Math.random()<.1?e.setExpectResult(Ve.FAIL_STR):e.setExpectResult(Ve.SUCCESS_STR)}getStartRestoreKeys(){return[Ne.SMALL_PLACE_KEY,Ne.STAMINA_KEY,Ne.CURRENT_ACTION_KEY,Ne.EXPECT_RESULT_KEY]}finish(e){e.getExpectResult()===Ve.FAIL_STR&&e.deltaTrust(-2),e.deltaMinutes(30),e.setSmallPlace('客廳'),e.setCurrentAction(ke.NONE_STR),e.setExpectResult(ke.NONE_STR)}getFinishRestoreKeys(){return[Ne.TRUST_KEY,Ne.DATETIME_KEY,Ne.SMALL_PLACE_KEY,Ne.CURRENT_ACTION_KEY,Ne.EXPECT_RESULT_KEY]}isPossible(e){return e.getCurrentAction()===We.prototype.name}isForce(e){return!1}};qe=Ve=Ue([ke.registry.register(qe.prototype.name)],qe);let ze=class extends ke{static{fe=this}static SUCCESS_STR='成功在妹妹洗澡完畢前自慰至射精在妹妹的胸罩上，沒有被妹妹察覺';static FAIL_STR='被妹妹發現哥哥闖進更衣間，降低信賴、心情';get category(){return null}get name(){return'拿妹妹的胸罩自慰'}start(e){e.setCurrentAction(this.name);Math.random()<.2?e.setExpectResult(fe.FAIL_STR):e.setExpectResult(fe.SUCCESS_STR)}getStartRestoreKeys(){return[Ne.CURRENT_ACTION_KEY,Ne.EXPECT_RESULT_KEY]}finish(e){let t=0,r=0;switch(e.getExpectResult()){case fe.SUCCESS_STR:t-=1;break;case fe.FAIL_STR:-2===e.getMood()?t-=5:r-=1}e.deltaMinutes(30),e.setSmallPlace('客廳'),e.setCurrentAction(ke.NONE_STR),e.setExpectResult(ke.NONE_STR)}getFinishRestoreKeys(){return[Ne.TRUST_KEY,Ne.MOOD_KEY,Ne.DATETIME_KEY,Ne.SMALL_PLACE_KEY,Ne.CURRENT_ACTION_KEY,Ne.EXPECT_RESULT_KEY]}isPossible(e){return e.getCurrentAction()===qe.prototype.name}isForce(e){return!1}};ze=fe=Ue([ke.registry.register(ze.prototype.name)],ze);let Je=class extends ke{static{we=this}static MOOD_INCREASE_STR='提高心情';static MOOD_DECREASE_STR='降低心情';get category(){return null}get name(){return'今天就這樣睡吧'}start(e){e.setSmallPlace('哥哥的睡房'),e.setCurrentAction(this.name);const t=Math.random();switch(e.getMood()){case-2:t<.63&&e.setExpectResult(we.MOOD_INCREASE_STR);break;case 1:case 2:t<.13&&e.setExpectResult(we.MOOD_DECREASE_STR)}}getStartRestoreKeys(){return[Ne.SMALL_PLACE_KEY,Ne.CURRENT_ACTION_KEY,Ne.EXPECT_RESULT_KEY]}finish(e){e.isCurrentDateTimeBetween(19,0,20,0)?e.deltaStamina(65):e.isCurrentDateTimeBetween(20,0,21,0)?e.deltaStamina(60):e.isCurrentDateTimeBetween(21,0,22,0)?e.deltaStamina(55):e.isCurrentDateTimeBetween(22,0,23,0)?e.deltaStamina(50):e.isCurrentDateTimeBetween(24,0,0,0)?e.deltaStamina(45):e.isCurrentDateTimeBetween(0,0,1,0)?e.deltaStamina(40):e.isCurrentDateTimeBetween(1,0,2,0)?e.deltaStamina(35):e.isCurrentDateTimeBetween(2,0,3,0)?e.deltaStamina(30):e.isCurrentDateTimeBetween(3,0,4,0)?e.deltaStamina(20):e.isCurrentDateTimeBetween(4,0,5,0)&&e.deltaStamina(10);let t=0,r=0,s=0;switch(e.getMood()){case-2:r-=3,s-=2,e.getExpectResult()===we.MOOD_INCREASE_STR&&(t+=1);break;case-1:r-=2,s-=1;break;case 0:r-=1,s-=1;break;case 1:s-=1,e.getExpectResult()==we.MOOD_DECREASE_STR&&(t-=1);break;case 2:r+=1,e.getExpectResult()===we.MOOD_DECREASE_STR&&(t-=1)}s-=2,e.getInterest()>=200&&(s-=3),e.deltaTrust(r),e.deltaInterest(s),e.deltaMood(t),e.deltaDatetimeUntil(7,0),e.setSmallPlace('客廳'),e.setCurrentAction(Qe.prototype.name),e.setExpectResult(ke.NONE_STR),e.setFlagBath(!1)}getFinishRestoreKeys(){return[Ne.STAMINA_KEY,Ne.TRUST_KEY,Ne.INTEREST_KEY,Ne.MOOD_KEY,Ne.DATETIME_KEY,Ne.SMALL_PLACE_KEY,Ne.CURRENT_ACTION_KEY,Ne.EXPECT_RESULT_KEY,Ne.FLAGS_KEY]}isPossible(e){return!!e.isCurrentDateTimeAtNight()&&!!e.isAlreadyBath()}isForce(e){return!1}};Je=we=Ue([ke.registry.register(Je.prototype.name)],Je);let Qe=Le=class extends ke{get category(){return null}get name(){return'早上互動'}start(e){e.setCurrentAction(Le.prototype.name),e.setExpectResult(ke.NONE_STR)}getStartRestoreKeys(){return[Ne.CURRENT_ACTION_KEY,Ne.EXPECT_RESULT_KEY]}finish(e){e.isWeekday()&&(e.deltaDatetimeUntil(8,30),(new Ze).start(e))}getFinishRestoreKeys(){const e=[Ne.DATETIME_KEY];return e.concat((new Ze).getStartRestoreKeys()),e}isPossible(e){return!1}isForce(e){return!1}};Qe=Le=Ue([ke.registry.register(Qe.prototype.name)],Qe);let Ze=Pe=class extends ke{get category(){return null}get name(){return'上學'}start(e){e.setBigPlace('校園區'),e.setMiddlePlace('校舍'),e.setSmallPlace('課室'),e.setCurrentAction(Pe.prototype.name),e.setExpectResult(ke.NONE_STR)}getStartRestoreKeys(){return[Ne.BIG_PLACE_KEY,Ne.MIDDLE_PLACE_KEY,Ne.SMALL_PLACE_KEY,Ne.CURRENT_ACTION_KEY,Ne.EXPECT_RESULT_KEY]}finish(e){e.deltaDatetimeUntil(18,0),(new et).start(e)}getFinishRestoreKeys(){const e=[Ne.DATETIME_KEY];return e.concat((new et).getStartRestoreKeys()),e}isPossible(e){return!1}isForce(e){return!1}};Ze=Pe=Ue([ke.registry.register(Ze.prototype.name)],Ze);let et=De=class extends ke{get category(){return null}get name(){return'哥哥一個人購買晚餐食材'}start(e){e.addShopItem('茶',1e3,null),e.addShopItem('玉露',5e3,null),e.addShopItem('咖啡',1e3,null),e.addShopItem('紅茶',2e3,null),e.setBigPlace('市中心'),e.setMiddlePlace('商業街'),e.setSmallPlace('街道'),e.setCurrentAction(De.prototype.name),e.setExpectResult(ke.NONE_STR)}getStartRestoreKeys(){return[Ne.SHOP_ITEMS_KEY,Ne.BIG_PLACE_KEY,Ne.MIDDLE_PLACE_KEY,Ne.SMALL_PLACE_KEY,Ne.CURRENT_ACTION_KEY,Ne.EXPECT_RESULT_KEY]}finish(e){e.deltaDatetimeUntil(18,30),(new nt).start(e)}getFinishRestoreKeys(){const e=[Ne.DATETIME_KEY];return e.concat((new nt).getStartRestoreKeys()),e}isPossible(e){return!1}isForce(e){return!1}};et=De=Ue([ke.registry.register(et.prototype.name)],et);let tt=class extends ke{get category(){return null}get name(){return'把泡麵買回家'}start(e){e.setBigPlace('市中心'),e.setMiddlePlace('商業街'),e.setSmallPlace('便利店'),e.setCurrentAction(this.name),e.setExpectResult(ke.NONE_STR)}getStartRestoreKeys(){return[Ne.BIG_PLACE_KEY,Ne.MIDDLE_PLACE_KEY,Ne.SMALL_PLACE_KEY,Ne.CURRENT_ACTION_KEY,Ne.EXPECT_RESULT_KEY]}finish(e){e.deltaInventory('泡麵',1),e.deltaDatetimeUntil(18,30),(new nt).start(e)}getFinishRestoreKeys(){const e=[Ne.INVENTORIES_KEY,Ne.DATETIME_KEY];return e.concat((new nt).getStartRestoreKeys()),e}isPossible(e){return e.getCurrentAction()===et.prototype.name}isForce(e){return!1}};tt=Ue([ke.registry.register(tt.prototype.name)],tt);let rt=class extends ke{get category(){return null}get name(){return'把體力食材買回家 [3000元]'}start(e){e.setBigPlace('市中心'),e.setMiddlePlace('商業街'),e.setSmallPlace('菜市場'),e.setCurrentAction(this.name),e.setExpectResult(ke.NONE_STR)}getStartRestoreKeys(){return[Ne.BIG_PLACE_KEY,Ne.MIDDLE_PLACE_KEY,Ne.SMALL_PLACE_KEY,Ne.CURRENT_ACTION_KEY,Ne.EXPECT_RESULT_KEY]}finish(e){e.deltaInventory('體力食材',1),e.deltaMoney(-3e3),e.deltaDatetimeUntil(18,30),(new nt).start(e)}getFinishRestoreKeys(){const e=[Ne.INVENTORIES_KEY,Ne.MONEY_KEY,Ne.DATETIME_KEY];return e.concat((new nt).getStartRestoreKeys()),e}isPossible(e){return e.getCurrentAction()===et.prototype.name&&!(e.getMoney()<3e3)}isForce(e){return!1}};rt=Ue([ke.registry.register(rt.prototype.name)],rt);let st=class extends ke{get category(){return null}get name(){return'把便當買回家 [2000元]'}start(e){e.setBigPlace('市中心'),e.setMiddlePlace('商業街'),e.setSmallPlace('便當店'),e.setCurrentAction(this.name),e.setExpectResult(ke.NONE_STR)}getStartRestoreKeys(){return[Ne.BIG_PLACE_KEY,Ne.MIDDLE_PLACE_KEY,Ne.SMALL_PLACE_KEY,Ne.CURRENT_ACTION_KEY,Ne.EXPECT_RESULT_KEY]}finish(e){e.deltaInventory('便當',1),e.deltaMoney(-2e3),e.deltaDatetimeUntil(18,30),(new nt).start(e)}getFinishRestoreKeys(){const e=[Ne.INVENTORIES_KEY,Ne.MONEY_KEY,Ne.DATETIME_KEY];return e.concat((new nt).getStartRestoreKeys()),e}isPossible(e){return e.getCurrentAction()===et.prototype.name&&!(e.getMoney()<2e3)}isForce(e){return!1}};st=Ue([ke.registry.register(st.prototype.name)],st);let at=class extends ke{get category(){return null}get name(){return'把食材買回家 [1000元]'}start(e){e.setBigPlace('市中心'),e.setMiddlePlace('商業街'),e.setSmallPlace('超級市場'),e.setCurrentAction(this.name),e.setExpectResult(ke.NONE_STR)}getStartRestoreKeys(){return[Ne.BIG_PLACE_KEY,Ne.MIDDLE_PLACE_KEY,Ne.SMALL_PLACE_KEY,Ne.CURRENT_ACTION_KEY,Ne.EXPECT_RESULT_KEY]}finish(e){e.deltaInventory('食材',1),e.deltaMoney(-1e3),e.deltaDatetimeUntil(18,30),(new nt).start(e)}getFinishRestoreKeys(){const e=[Ne.INVENTORIES_KEY,Ne.MONEY_KEY,Ne.DATETIME_KEY];return e.concat((new nt).getStartRestoreKeys()),e}isPossible(e){return e.getCurrentAction()===et.prototype.name&&!(e.getMoney()<1e3)}isForce(e){return!1}};at=Ue([ke.registry.register(at.prototype.name)],at);let nt=class extends ke{static{xe=this}static CUP_NOODLE_SUCCESS_STR='食完杯麵作為晚餐，沒有特別變化';static CUP_NOODLE_FAIL_STR='食完杯麵作為晚餐，降低妹妹心情';static STAMINA_INGREDIENTS_STR='食完用體力食材做的晚餐';static BENTO_STR='食完便當作為晚餐';static COOKING_INGREDIENTS_STR='食完用食材做的晚餐';get category(){return null}get name(){return'吃晚餐'}start(e){switch(e.getDinnerInventory()){case'體力食材':e.setExpectResult(xe.STAMINA_INGREDIENTS_STR);break;case'便當':e.setExpectResult(xe.BENTO_STR);break;case'食材':e.setExpectResult(xe.COOKING_INGREDIENTS_STR);break;case'杯麵':Math.random()<.5?e.setExpectResult(xe.CUP_NOODLE_SUCCESS_STR):e.setExpectResult(xe.CUP_NOODLE_FAIL_STR)}e.clearShopItems(),e.setBigPlace('住宅區'),e.setMiddlePlace('家中'),e.setSmallPlace('客廳'),e.setCurrentAction(this.name)}getStartRestoreKeys(){return[Ne.SHOP_ITEMS_KEY,Ne.BIG_PLACE_KEY,Ne.MIDDLE_PLACE_KEY,Ne.SMALL_PLACE_KEY,Ne.CURRENT_ACTION_KEY,Ne.EXPECT_RESULT_KEY]}finish(e){let t='',r=0,s=0,a=0;switch(e.getExpectResult()){case xe.STAMINA_INGREDIENTS_STR:t='體力食材',r+=20,s+=90;break;case xe.BENTO_STR:t='便當',r+=10,s+=30;break;case xe.COOKING_INGREDIENTS_STR:t='食材',r+=15,s+=90;break;case xe.CUP_NOODLE_SUCCESS_STR:t='泡麵',r+=5,s+=30;break;case xe.CUP_NOODLE_FAIL_STR:t='泡麵',r+=5,s+=30,a-=1}e.deltaInventory(t,-1),e.deltaStamina(r),e.deltaMinutes(s),e.deltaMood(a),e.setCurrentAction(ke.NONE_STR),e.setExpectResult(ke.NONE_STR)}getFinishRestoreKeys(){return[Ne.INVENTORIES_KEY,Ne.STAMINA_KEY,Ne.DATETIME_KEY,Ne.MOOD_KEY,Ne.CURRENT_ACTION_KEY,Ne.EXPECT_RESULT_KEY]}isPossible(e){return!1}isForce(e){return!1}};nt=xe=Ue([ke.registry.register(nt.prototype.name)],nt);var it,lt,ot,ct,ut,gt,Et,_t,mt,ht,dt,St,Tt,Rt,pt,yt=function(e,t,r,s){var a,n=arguments.length,i=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if('object'==typeof Reflect&&'function'==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,s);else for(var l=e.length-1;l>=0;l--)(a=e[l])&&(i=(n<3?a(i):n>3?a(t,r,i):a(t,r))||i);return n>3&&i&&Object.defineProperty(t,r,i),i},Ct=function(e,t){if('object'==typeof Reflect&&'function'==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Nt=it=class extends U{get REGEX(){return/initialize\(\)/g}create(e){return new it}isValid(){return!0}execute(e){const t=new Ne(e),r=new ae;return r.pushCommand(new v(Ne.STAMINA_KEY,0,60,40)),r.pushCommand(new v(Ne.MONEY_KEY,0,null,6e3)),r.pushCommand(new v(Ne.TRUST_KEY,0,1e3,25)),r.pushCommand(new v(Ne.INTEREST_KEY,0,1e3,10)),r.pushCommand(new v(Ne.MOOD_KEY,-2,2,0)),r.pushCommand(new j(Ne.DATETIME_KEY,'2025-11-19T19:00:00')),r.pushCommand(new X(Ne.BIG_PLACE_KEY,'住宅區')),r.pushCommand(new X(Ne.MIDDLE_PLACE_KEY,'家中')),r.pushCommand(new X(Ne.SMALL_PLACE_KEY,'客廳')),r.pushCommand(new X(Ne.WEATHER_KEY,'晴朗')),r.pushCommand(new X(Ne.CLOTHING_KEY,'初中生水手服，領口的鈕扣解開了，胸前鈕扣間的縫隙露出一小片屬於胸罩的白色布料')),r.pushCommand(new X(Ne.CURRENT_ACTION_KEY,ke.NONE_STR)),r.pushCommand(new X(Ne.EXPECT_RESULT_KEY,ke.NONE_STR)),r.pushCommand(new ee(Ne.FLAGS_KEY)),r.pushCommand(new v(Ne.FLAG_BATH_KEY,0,1,0)),r.pushCommand(new te(Ne.FLAGS_KEY,Ne.FLAG_BATH_KEY)),r.pushCommand(new ee(Ne.SHOP_ITEMS_KEY)),r.pushCommand(new ee(Ne.INVENTORIES_KEY)),r.pushCommand(new v(Ne.TRUST_ROC_KEY,null,null,0)),r.pushCommand(new v(Ne.INTEREST_ROC_KEY,null,null,0)),r.pushCommand(new v(Ne.MOOD_ROC_KEY,null,null,0)),r.pushCommand(new ee(Ne.ITEM_TABLE_KEY)),r.pushCommand(new ee(Ne.SUMMARY_TABLE_KEY)),r.execute(t),t}};Nt=it=yt([U.registry.register()],Nt);let bt=lt=class extends U{current_action;expected_result;constructor(e,t){super(),this.current_action=e,this.expected_result=t}get REGEX(){return/actionStart\(\s*([^,()]+)\s*,\s*(.+)\s*\)/g}create(e){const t=e[0].slice(1,-1),r=e[1].slice(1,-1);return new lt(t,r)}isValid(){return!0}execute(e){const t=new Ne(e);return t.setCurrentAction(this.current_action),t.setExpectResult(this.expected_result),t.resetTrustROC(),t.resetInterestROC(),t.resetMoodROC(),t}};bt=lt=yt([U.registry.register(),Ct('design:paramtypes',[String,String])],bt);let At=ot=class extends U{summary;weighting;constructor(e,t){super(),this.summary=e,this.weighting=t}get REGEX(){return/actionFinish\(\s*([^,()]+)\s*,\s*(.+)\s*\)/g}create(e){const t=e[0].slice(1,-1),r=Number(e[1]);return new ot(t,r)}isValid(){return!isNaN(this.weighting)}execute(e){const t=new Ne(e);return t.setCurrentAction(ke.NONE_STR),t.setExpectResult(ke.NONE_STR),t.finishCurrentAction(this.summary,this.weighting),t}};At=ot=yt([U.registry.register(),Ct('design:paramtypes',[String,Number])],At);let Kt=ct=class extends U{delta_minutes;constructor(e){super(),this.delta_minutes=e}get REGEX(){return/deltaMinutes\(\s*([^,()]+)\s*\)/g}create(e){const t=Number(e[0]);return new ct(t)}isValid(){return!isNaN(this.delta_minutes)}execute(e){const t=new Ne(e),r=t.getYear(),s=t.getMonth(),a=t.getDate();t.deltaMinutes(this.delta_minutes);const n=t.getYear(),i=t.getMonth(),l=t.getDate();return t.handleChangeDateEvents(r,s,a,n,i,l),t}};Kt=ct=yt([U.registry.register(),Ct('design:paramtypes',[Number])],Kt);let Mt=ut=class extends U{big_place;constructor(e){super(),this.big_place=e}get REGEX(){return/setBigPlace\(\s*([^,()]+)\s*\)/g}create(e){const t=e[0].slice(1,-1);return new ut(t)}isValid(){return!0}execute(e){const t=new Ne(e);return t.setBigPlace(this.big_place),t}};Mt=ut=yt([U.registry.register(),Ct('design:paramtypes',[String])],Mt);let Yt=gt=class extends U{middle_place;constructor(e){super(),this.middle_place=e}get REGEX(){return/setMiddlePlace\(\s*([^,()]+)\s*\)/g}create(e){const t=e[0].slice(1,-1);return new gt(t)}isValid(){return!0}execute(e){const t=new Ne(e);return t.setMiddlePlace(this.middle_place),t}};Yt=gt=yt([U.registry.register(),Ct('design:paramtypes',[String])],Yt);let It=Et=class extends U{small_place;constructor(e){super(),this.small_place=e}get REGEX(){return/setSmallPlace\(\s*([^,()]+)\s*\)/g}create(e){const t=e[0].slice(1,-1);return new Et(t)}isValid(){return!0}execute(e){const t=new Ne(e);return t.setSmallPlace(this.small_place),t}};It=Et=yt([U.registry.register(),Ct('design:paramtypes',[String])],It);let Ot=_t=class extends U{weather;constructor(e){super(),this.weather=e}get REGEX(){return/setWeather\(\s*([^,()]+)\s*\)/g}create(e){const t=e[0].slice(1,-1);return new _t(t)}isValid(){return!0}execute(e){const t=new Ne(e);return t.setWeather(this.weather),t}};Ot=_t=yt([U.registry.register(),Ct('design:paramtypes',[String])],Ot);let Vt=mt=class extends U{clothing;constructor(e){super(),this.clothing=e}get REGEX(){return/setClothing\(\s*([^,()]+)\s*\)/g}create(e){const t=e[0].slice(1,-1);return new mt(t)}isValid(){return!0}execute(e){const t=new Ne(e);return t.setClothing(this.clothing),t}};Vt=mt=yt([U.registry.register(),Ct('design:paramtypes',[String])],Vt);let ft=ht=class extends U{delta_trust_roc;constructor(e){super(),this.delta_trust_roc=e}get REGEX(){return/deltaTrustROC\(\s*([^,()]+)\s*\)/g}create(e){const t=Number(e[0]);return new ht(t)}isValid(){return!isNaN(this.delta_trust_roc)}execute(e){const t=new Ne(e);return this.delta_trust_roc<-3&&(this.delta_trust_roc=-3),this.delta_trust_roc>3&&(this.delta_trust_roc=3),this.delta_trust_roc<0&&(this.delta_trust_roc*=2),t.deltaTrustROC(this.delta_trust_roc),t}};ft=ht=yt([U.registry.register(),Ct('design:paramtypes',[Number])],ft);let wt=dt=class extends U{delta_interest_roc;constructor(e){super(),this.delta_interest_roc=e}get REGEX(){return/deltaInterestROC\(\s*([^,()]+)\s*\)/g}create(e){const t=Number(e[0]);return new dt(t)}isValid(){return!isNaN(this.delta_interest_roc)}execute(e){const t=new Ne(e);return this.delta_interest_roc<-3&&(this.delta_interest_roc=-3),this.delta_interest_roc>3&&(this.delta_interest_roc=3),this.delta_interest_roc<0&&(this.delta_interest_roc*=2),t.deltaInterestROC(this.delta_interest_roc),t}};wt=dt=yt([U.registry.register(),Ct('design:paramtypes',[Number])],wt);let Lt=St=class extends U{delta_mood_roc;constructor(e){super(),this.delta_mood_roc=e}get REGEX(){return/deltaMoodROC\(\s*([^,()]+)\s*\)/g}create(e){const t=Number(e[0]);return new St(t)}isValid(){return!isNaN(this.delta_mood_roc)}execute(e){const t=new Ne(e);return this.delta_mood_roc<-3&&(this.delta_mood_roc=-3),this.delta_mood_roc>3&&(this.delta_mood_roc=3),this.delta_mood_roc<0&&(this.delta_mood_roc*=2),t.deltaMoodROC(this.delta_mood_roc),t}};Lt=St=yt([U.registry.register(),Ct('design:paramtypes',[Number])],Lt);let Pt=Tt=class extends U{delta_money;constructor(e){super(),this.delta_money=e}get REGEX(){return/deltaMoney\(\s*([^,()]+)\s*\)/g}create(e){const t=Number(e[0]);return new Tt(t)}isValid(){return!isNaN(this.delta_money)}execute(e){const t=new Ne(e);return t.deltaMoney(this.delta_money),t}};Pt=Tt=yt([U.registry.register(),Ct('design:paramtypes',[Number])],Pt);let Dt=Rt=class extends U{name;description;constructor(e,t){super(),this.name=e,this.description=t}get REGEX(){return/createItem\(\s*([^,()]+)\s*,\s*(.+)\s*\)/g}create(e){const t=e[0].slice(1,-1),r=e[1].slice(1,-1);return new Rt(t,r)}isValid(){return!0}execute(e){const t=new Ne(e);return t.createItem(this.name,this.description),t}};Dt=Rt=yt([U.registry.register(),Ct('design:paramtypes',[String,String])],Dt);let xt=pt=class extends U{name;delta_quantity;constructor(e,t){super(),this.name=e,this.delta_quantity=t}get REGEX(){return/deltaInventory\(\s*([^,()]+)\s*,\s*(.+)\s*\)/g}create(e){const t=e[0].slice(1,-1),r=Number(e[1]);return new pt(t,r)}isValid(){return!isNaN(this.delta_quantity)}execute(e){const t=new Ne(e);return t.deltaInventory(this.name,this.delta_quantity),t}};xt=pt=yt([U.registry.register(),Ct('design:paramtypes',[String,Number])],xt);class Ut{game_state;constructor(e){this.game_state=new Ne(e)}getGameState(){return this.game_state}initiateState(){const e=new ae;e.pushCommand(new v(Ne.STAMINA_KEY,0,60,40)),e.pushCommand(new v(Ne.MONEY_KEY,0,null,6e3)),e.pushCommand(new v(Ne.TRUST_KEY,0,1e3,25)),e.pushCommand(new v(Ne.INTEREST_KEY,0,1e3,10)),e.pushCommand(new v(Ne.MOOD_KEY,-2,2,0)),e.pushCommand(new j(Ne.DATETIME_KEY,'2025-11-19T19:00:00')),e.pushCommand(new X(Ne.BIG_PLACE_KEY,'住宅區')),e.pushCommand(new X(Ne.MIDDLE_PLACE_KEY,'家中')),e.pushCommand(new X(Ne.SMALL_PLACE_KEY,'客廳')),e.pushCommand(new X(Ne.WEATHER_KEY,'晴朗')),e.pushCommand(new X(Ne.CLOTHING_KEY,'初中生水手服，領口的鈕扣解開了，胸前鈕扣間的縫隙露出一小片屬於胸罩的白色布料')),e.pushCommand(new X(Ne.CURRENT_ACTION_KEY,ke.NONE_STR)),e.pushCommand(new X(Ne.EXPECT_RESULT_KEY,ke.NONE_STR)),e.pushCommand(new ee(Ne.FLAGS_KEY)),e.pushCommand(new v(Ne.FLAG_BATH_KEY,0,1,0)),e.pushCommand(new te(Ne.FLAGS_KEY,Ne.FLAG_BATH_KEY)),e.pushCommand(new ee(Ne.SHOP_ITEMS_KEY)),e.pushCommand(new ee(Ne.INVENTORIES_KEY)),e.pushCommand(new v(Ne.TRUST_ROC_KEY,null,null,0)),e.pushCommand(new v(Ne.INTEREST_ROC_KEY,null,null,0)),e.pushCommand(new v(Ne.MOOD_ROC_KEY,null,null,0)),e.pushCommand(new ee(Ne.ITEM_TABLE_KEY)),e.pushCommand(new ee(Ne.SUMMARY_TABLE_KEY)),e.execute(this.game_state)}getForceActionStr(){const e=new Map;for(const[t,r]of ke.registry.getAll())if(r.prototype.isForce(this.game_state))if(r.prototype.category){const s=r.prototype.category,a=e.get(s)??[];a.push(t),e.set(s,a)}else e.set(t,null);let t='';for(const[r,s]of e)if(null===s)t+=`[${r}]\n`;else{t+=`[${r}]:\n`;for(const e of s)t+=`  [${e}]\n`}return t&&(t='<ActionBlock>\n'+t+'</ActionBlock>'),t}getPossibleActionStr(){const e=new Map;for(const[t,r]of ke.registry.getAll())if(r.prototype.isPossible(this.game_state))if(r.prototype.category){const s=r.prototype.category,a=e.get(s)??[];a.push(t),e.set(s,a)}else e.set(t,null);let t='';for(const[r,s]of e)if(null===s)t+=`[${r}]\n`;else{t+=`[${r}]:\n`;for(const e of s)t+=`  [${e}]\n`}return t&&(t='<ActionBlock>\n'+t+'</ActionBlock>'),t}getForceActions(){const e=new Map;for(const[t,r]of ke.registry.getAll())if(r.prototype.isForce(this.game_state))if(r.prototype.category){const s=r.prototype.category,a=e.get(s)??[];a.push(t),e.set(s,a)}else e.set(t,null);return e}getPossibleActions(){const e=new Map;for(const[t,r]of ke.registry.getAll())if(r.prototype.isPossible(this.game_state))if(r.prototype.category){const s=r.prototype.category,a=e.get(s)??[];a.push(t),e.set(s,a)}else e.set(t,null);return e}getStatusStr(){let e='';e+=`金錢:$${this.game_state.getMoney()}\n`,e+=`信賴:${this.game_state.getTrust()}\n`,e+=`興致:${this.game_state.getInterest()}\n`;e+=`心情:${['隨時都會爆發的狀態','不高興','普通','不錯','高興'][this.game_state.getMood()+2]}\n`;return e+=`星期:${['日','一','二','三','四','五','六'][this.game_state.getDay()]}\n`,e+=`月日:${this.game_state.getMonth()}月${this.game_state.getDate()}日\n`,e+=`時刻:${this.game_state.getHours().toString().padStart(2,'0')}:${this.game_state.getMinutes().toString().padStart(2,'0')}\n`,e+=`大地點:${this.game_state.getBigPlace()}\n`,e+=`中地點:${this.game_state.getMiddlePlace()}\n`,e+=`小地點:${this.game_state.getSmallPlace()}\n`,e+=`天氣:${this.game_state.getWeather()}\n`,e+=`妹妹衣著:${this.game_state.getClothing()}\n`,e+=`當前行動:${this.game_state.getCurrentAction()}\n`,e+=`預期結果:${this.game_state.getExpectResult()}\n`,e&&(e='<StatusBlock>\n'+e+'</StatusBlock>'),e}getItemTableStr(){let e='<ItemTable>\n';const t=this.game_state.getItemTable();for(const[r,s]of t)e+=`${r}: ${s}\n`;return e+='<ItemTable>',e}getSummaryTableStr(){let e='<SummaryTable>\n';e+='  #以下為歷史記錄格式，在敍事有需要時必須嚴格遵守此記錄，以免作出矛盾或重複的描寫。\n',e+='  #| 時間 | 地點 | 事件總結 | 權重(0.0~1.0)，用以標示該事件的重要程度 |\n';const t=this.game_state.getSummaries();for(const r of t){if(null===r)continue;const t=r.datetime.getFullYear(),s=r.datetime.getMonth(),a=r.datetime.getDate(),n=r.datetime.getHours(),i=r.datetime.getMinutes();e+=`| ${`${t}年${s}月${a}日 (${['日','一','二','三','四','五','六'][r.datetime.getDay()]}) ${n.toString().padStart(2,'0')}:${i.toString().padStart(2,'0')}`} | ${`${r.big_place}-${r.middle_place}-${r.small_place}`} | ${r.summary} | ${r.weighting} |\n`}return e+='<SummaryTable>',e}}function kt(){uninjectPrompts(['variable_injection']);const e=new Ut(oe());let t='';t+=`${e.getStatusStr()}\n`,t+=`${e.getItemTableStr()}`,injectPrompts([{id:'variable_injection',position:'in_chat',depth:0,role:'system',content:t,should_scan:!0}],{once:!1}),injectPrompts([{id:'summary_injection',position:'in_chat',depth:9999,role:'system',content:e.getSummaryTableStr(),should_scan:!0}],{once:!1})}eventMakeFirst(tavern_events.CHAT_CREATED,()=>{console.log('[黑白妹VT] CHAT_CREATED start'),console.log('[黑白妹VT] CHAT_CREATED end')}),eventMakeLast(tavern_events.GENERATE_AFTER_COMBINE_PROMPTS,()=>{console.log('[黑白妹VT] GENERATE_AFTER_COMBINE_PROMPTS start'),kt(),console.log('[黑白妹VT] GENERATE_AFTER_COMBINE_PROMPTS end')});