<head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><script type="module">import{klona as e}from'https://testingcf.jsdelivr.net/npm/klona/+esm';var t={235:(e,t)=>{t.A=(e,t)=>{const a=e.__vccOpts||e;for(const[e,n]of t)a[e]=n;return a}}},a={};const n=Vue,l={class:'fold-bar'},r={class:'fold-bar-header'},o={class:'fold-bar-title-actions'},i={class:'fold-bar-header-actions'},s={class:'fold-bar-content-text'},c=(0,n.defineComponent)({__name:'fold_bar',props:{title:{},isOpen:{type:Boolean}},emits:['toggle'],setup(e,{emit:t}){const a=e,c=t,d=(0,n.ref)(a.isOpen),u=(0,n.ref)(),m=()=>{u.value&&(d.value?(d.value=!1,u.value.style.maxHeight='0'):(d.value=!0,setTimeout(()=>{if(u.value){const e=u.value.scrollHeight,t=.8*window.innerHeight,a=Math.min(e,t);u.value.style.maxHeight=a+'px'}},0)),c('toggle',d.value))};return(0,n.watch)(()=>a.isOpen,e=>{e!==d.value&&(u.value&&(e?setTimeout(()=>{if(u.value){const e=u.value.scrollHeight,t=.8*window.innerHeight,a=Math.min(e,t);u.value.style.maxHeight=a+'px'}},0):u.value.style.maxHeight='0'),d.value=e)}),(t,a)=>((0,n.openBlock)(),(0,n.createElementBlock)('div',l,[(0,n.createElementVNode)('div',r,[(0,n.createElementVNode)('button',{class:'fold-bar-btn',onClick:m},[(0,n.createElementVNode)('span',null,(0,n.toDisplayString)(e.title),1),(0,n.createElementVNode)('div',o,[(0,n.renderSlot)(t.$slots,'title-actions')]),(0,n.createElementVNode)('div',{class:(0,n.normalizeClass)(['fold-bar-toggle-icon',{open:(0,n.unref)(d)}])},null,2)]),(0,n.createElementVNode)('div',i,[(0,n.renderSlot)(t.$slots,'header-actions')])]),(0,n.createElementVNode)('div',{ref_key:'contentRef',ref:u,class:(0,n.normalizeClass)(['fold-bar-content',{open:(0,n.unref)(d)}])},[(0,n.createElementVNode)('div',s,[(0,n.renderSlot)(t.$slots,'default')]),(0,n.createElementVNode)('div',{class:'fold-bar-footer-toggle',onClick:m},'▲ 收起 ▲')],2)]))}});var d=function e(n){var l=a[n];if(void 0!==l)return l.exports;var r=a[n]={exports:{}};return t[n](r,r.exports,e),r.exports}(235);const u=(0,d.A)(c,[['__scopeId','data-v-112e8be8']]),m=u,v={class:'character-tabs-container'},p=['onClick'],g={class:'character-info-container'},h={class:'section'},E={class:'form-grid'},y={class:'input-group'},b=['onUpdate:modelValue'],V={key:0,class:'generated-result'},N={class:'generated-text'},f=['onClick'],k={class:'input-group'},w=['onUpdate:modelValue'],B={key:0,class:'generated-result'},C={class:'generated-text'},S=['onClick'],x={class:'input-group'},I=['value','onInput'],D={key:0,class:'generated-result'},T={class:'generated-text'},M=['onClick'],O={class:'input-group'},Y=['onUpdate:modelValue'],A={key:0,class:'generated-result'},R={class:'generated-text'},K=['onClick'],U={class:'input-group'},L=['onUpdate:modelValue'],F={key:0,class:'generated-result'},H={class:'generated-text'},j=['onClick'],P={class:'input-group'},q=['value','onInput'],G={key:0,class:'generated-result'},W={class:'generated-text'},X=['onClick'],Z={class:'input-group'},J=['value','onInput'],Q={key:0,class:'generated-result'},ee={class:'generated-text'},te=['onClick'],ae={class:'input-group'},ne=['value','onInput'],le={key:0,class:'generated-result'},re={class:'generated-text'},oe=['onClick'],ie={class:'input-group'},se=['onUpdate:modelValue'],ce={key:0,class:'generated-result'},de={class:'generated-text'},ue=['onClick'],me={class:'input-group'},ve=['value','onInput'],pe={key:0,class:'generated-result'},ge={class:'generated-text'},_e=['onClick'],he={class:'input-group'},Ee=['value','onInput'],ye={key:0,class:'generated-result'},be={class:'generated-text'},Ve=['onClick'],Ne={class:'input-group full-width'},fe=['onUpdate:modelValue'],ke={key:0,class:'generated-result'},we={class:'generated-text'},Be=['onClick'],Ce={class:'input-group full-width'},$e={class:'birthday-inputs'},Se=['value','onInput'],xe=['value','onInput'],Ie={key:0,class:'generated-result'},De={class:'generated-text'},Te=['onClick'],Me={class:'section'},Oe={class:'form-grid'},Ye={class:'input-group full-width'},Ae=['onUpdate:modelValue'],Re={key:0,class:'generated-result'},Ke={class:'generated-text'},Ue=['onClick'],ze={class:'input-group full-width'},Le=['onUpdate:modelValue'],Fe={key:0,class:'generated-result'},He={class:'generated-text'},je=['onClick'],Pe={class:'section'},qe={class:'form-grid'},Ge={class:'input-group full-width'},We=['onUpdate:modelValue'],Xe={key:0,class:'generated-result'},Ze={class:'generated-text'},Je=['onClick'],Qe={class:'input-group full-width'},et=['onUpdate:modelValue'],tt={key:0,class:'generated-result'},at={class:'generated-text'},nt=['onClick'],lt={class:'input-group full-width'},rt=['onUpdate:modelValue'],ot={key:0,class:'generated-result'},it={class:'generated-text'},st=['onClick'],ct={class:'section'},dt={class:'form-grid'},ut={class:'input-group'},mt=['value','onInput'],vt={key:0,class:'generated-result'},pt={class:'generated-text'},gt=['onClick'],_t={class:'input-group'},ht=['value','onInput'],Et={key:0,class:'generated-result'},yt={class:'generated-text'},bt=['onClick'],Vt={class:'input-group'},Nt=['value','onInput'],ft={key:0,class:'generated-result'},kt={class:'generated-text'},wt=['onClick'],Bt={class:'input-group full-width'},Ct=['onUpdate:modelValue'],$t={key:0,class:'generated-result'},St={class:'generated-text'},xt=['onClick'],It={class:'input-group full-width'},Dt={class:'relations-list'},Tt={class:'relation-target'},Mt=['value','onInput'],Ot=['onClick'],Yt={class:'add-relation'},At=['onUpdate:modelValue'],Rt=['value'],Kt=['disabled','onClick'],Ut={key:0,class:'generated-result'},zt={class:'generated-text'},Lt=['onClick'],Ft={class:'input-group full-width'},Ht={class:'relations-list'},jt={class:'relation-target'},Pt=['value','onInput'],qt=['onClick'],Gt={class:'add-relation'},Wt=['onUpdate:modelValue'],Xt=['value'],Zt=['disabled','onClick'],Jt={key:0,class:'generated-result'},Qt={class:'generated-text'},ea=['onClick'],ta={class:'input-group full-width'},aa={class:'relations-list'},na={class:'relation-target'},la=['value','onInput'],ra=['onClick'],oa={class:'add-relation'},ia=['onUpdate:modelValue'],sa=['value'],ca=['disabled','onClick'],da={key:0,class:'generated-result'},ua={class:'generated-text'},ma=['onClick'],va={class:'input-group full-width'},pa={class:'inventory-list'},ga={class:'inventory-target'},_a=['value','onInput'],ha=['onClick'],Ea={class:'add-inventory'},ya=['onUpdate:modelValue'],ba=['value'],Va=['onUpdate:modelValue','disabled'],Na=['disabled','onClick'],fa={key:0,class:'generated-result'},ka={class:'generated-text'},wa=['onClick'],Ba={class:'section'},Ca={class:'form-grid'},$a={class:'input-group full-width'},Sa=['onUpdate:modelValue'],xa={class:'action-section'},Ia=['disabled','onClick'],Da={key:0,class:'loading-spinner'},Ta=['disabled','onClick'],Ma=(0,n.defineComponent)({__name:'character_tab',setup(e){const t=(e,t)=>{const a=e[t];return a?.toString()||''},a=(e,t,a)=>{if(''===a||''===a.trim())e[t]=null;else{const n=parseInt(a);e[t]=isNaN(n)?null:n}},l=(e,t,a)=>{const n=c.value.get(e);if(!n)return;const l={姓氏:{field:'姓氏'},名字:{field:'名字'},年齡:{field:'年齡',parser:e=>parseInt(e)||null},性別:{field:'性別'},身份:{field:'身份'},身高:{field:'身高',parser:e=>parseInt(e)||null},體重:{field:'體重',parser:e=>parseInt(e)||null},胸圍:{field:'胸圍',parser:e=>parseInt(e)||null},罩杯:{field:'罩杯'},腰圍:{field:'腰圍',parser:e=>parseInt(e)||null},臀圍:{field:'臀圍',parser:e=>parseInt(e)||null},髮型:{field:'髮型'},樣貌:{field:'樣貌'},衣著:{field:'衣著'},簡介:{field:'簡介'},性格:{field:'性格'},愛好:{field:'愛好'},金錢:{field:'金錢',parser:e=>parseInt(e)||null},心情:{field:'心情',parser:e=>parseInt(e)||null},性慾:{field:'性慾',parser:e=>parseInt(e)||null},生日月份:{field:'生日月份',parser:e=>parseInt(e)||null},生日日期:{field:'生日日期',parser:e=>parseInt(e)||null},其他重要資訊:{field:'其他重要資訊'}}[t];if(l){const e=l.parser?l.parser(a):a;n[l.field]=e,n[`generated_${t}`]=''}else if('生日'===t){const e=a.split('-');2===e.length&&(n.生日月份=parseInt(e[0])||null,n.生日日期=parseInt(e[1])||null,n.generated_birthday_month='',n.generated_birthday_day='')}else'關係'===t?r(n,a):'友好度'===t?o(n,a):'愛情度'===t?i(n,a):'所持物'===t&&s(n,a);c.value.set(e,{...n}),ja(e)},r=(e,t)=>{e.關係||(e.關係=new Map);const a=t.replace(/^["']|["']$/g,'');if(a.startsWith('[')&&a.endsWith(']')){const t=a.slice(1,-1).split(',').map(e=>e.trim());for(const a of t){const t=a.indexOf(':');if(t>0){const n=a.substring(0,t).replace(/^["']|["']$/g,'').trim(),l=a.substring(t+1).replace(/^["']|["']$/g,'').trim();n&&l&&e.關係.set(n,l)}}}else e.selected_relation_target&&e.關係.set(e.selected_relation_target,t);e.generated_relationship=''},o=(e,t)=>{e.友好度||(e.友好度=new Map);const a=t.replace(/^["']|["']$/g,'');if(a.startsWith('[')&&a.endsWith(']')){const t=a.slice(1,-1).split(',').map(e=>e.trim());for(const a of t){const t=a.indexOf(':');if(t>0){const n=a.substring(0,t).replace(/^["']|["']$/g,'').trim(),l=parseInt(a.substring(t+1).replace(/^["']|["']$/g,'').trim());n&&!isNaN(l)&&e.友好度.set(n,l)}}}e.generated_friendship=''},i=(e,t)=>{e.愛情度||(e.愛情度=new Map);const a=t.replace(/^["']|["']$/g,'');if(a.startsWith('[')&&a.endsWith(']')){const t=a.slice(1,-1).split(',').map(e=>e.trim());for(const a of t){const t=a.indexOf(':');if(t>0){const n=a.substring(0,t).replace(/^["']|["']$/g,'').trim(),l=parseInt(a.substring(t+1).replace(/^["']|["']$/g,'').trim());n&&!isNaN(l)&&e.愛情度.set(n,l)}}}e.generated_love=''},s=(e,t)=>{e.所持物||(e.所持物=new Map);const a=t.replace(/^["']|["']$/g,'');if(a.startsWith('[')&&a.endsWith(']')){const t=a.slice(1,-1).split(',').map(e=>e.trim());for(const a of t){const t=a.indexOf(':');if(t>0){const n=a.substring(0,t).replace(/^["']|["']$/g,'').trim(),l=parseInt(a.substring(t+1).replace(/^["']|["']$/g,'').trim());n&&!isNaN(l)&&l>0&&e.所持物.set(n,l)}}}e.generated_inventory=''},c=(0,n.ref)(new Map),d=(0,n.ref)(new Map),u=(0,n.computed)(()=>{const e=new Map;for(const[t,a]of c.value)'c1'!==t&&e.set(t,a);return e}),Ma=(0,n.computed)(()=>Array.from(u.value.entries())),Oa=e=>{const t=new Map(c.value),a=getVariables({type:'chat'}),l=a.characters?.c1;return l&&!t.has('c1')&&t.set('c1',(0,n.reactive)(l)),Array.from(t.entries()).filter(([t])=>t!==e)},Ya=()=>{const e=new Map,t=getVariables({type:'chat'});if(t?.items)for(const[a,l]of Object.entries(t.items))e.set(a,(0,n.reactive)(l));return Array.from(e.entries())},Aa=e=>{const t=getVariables({type:'chat'}),a=t.items?.[e];return a&&a.name||'未知物品'},Ra=e=>`${e?.姓氏||''}${e?.名字||''}`.trim()||'未知角色',Ka=e=>{const t=getVariables({type:'chat'}),a=t.characters?.[e];if(a){return`${a.姓氏||''}${a.名字||''}`.trim()||'未知角色'}return'未知角色'},Ua=e=>!!(e?.generated_surname||e?.generated_name||e?.generated_age||e?.generated_gender||e?.generated_identity||e?.generated_height||e?.generated_weight||e?.generated_chest_size||e?.generated_cup_size||e?.generated_waist_size||e?.generated_hips_size||e?.generated_hairstyle||e?.generated_appearance||e?.generated_clothes||e?.generated_introduction||e?.generated_personality||e?.generated_favourite||e?.generated_money||e?.generated_mood||e?.generated_sexuality||e?.generated_birthday_month||e?.generated_birthday_day||e?.generated_extra_information||e?.generated_relationship||e?.generated_friendship||e?.generated_love||e?.generated_inventory),za=e=>{const t=(()=>{if(!(e?.關係 instanceof Map))return!1;if(0===e.關係.size)return!0;for(const[t,a]of e.關係)if(!a||!a.trim())return!1;return!0})();return!!(e?.姓氏?.trim()&&e?.名字?.trim()&&null!==e?.年齡&&e?.性別?.trim()&&e?.身份?.trim()&&null!==e?.身高&&null!==e?.體重&&null!==e?.胸圍&&e?.罩杯?.trim()&&null!==e?.腰圍&&null!==e?.臀圍&&e?.髮型?.trim()&&e?.樣貌?.trim()&&e?.衣著?.trim()&&e?.簡介?.trim()&&e?.性格?.trim()&&e?.愛好?.trim()&&null!==e?.金錢&&null!==e?.心情&&null!==e?.性慾&&null!==e?.生日月份&&null!==e?.生日日期&&e?.其他重要資訊?.trim()&&t)},La=(0,n.computed)(()=>{try{const e=getVariables({type:'chat'});return!!e?.world_info?.trim()}catch{return!1}}),Fa=e=>{['generated_surname','generated_name','generated_age','generated_gender','generated_identity','generated_height','generated_weight','generated_chest_size','generated_cup_size','generated_waist_size','generated_hips_size','generated_hairstyle','generated_appearance','generated_clothes','generated_introduction','generated_personality','generated_favourite','generated_money','generated_mood','generated_sexuality','generated_birthday_month','generated_birthday_day','generated_extra_information','generated_relationship','generated_selected_relation_target','generated_friendship','generated_love','generated_inventory'].forEach(t=>{e[t]||(e[t]='')}),e.generation_requirement||(e.generation_requirement='')},Ha=e=>{!e.關係||'object'!=typeof e.關係||e.關係 instanceof Map?e.關係||(e.關係=new Map):e.關係=new Map(Object.entries(e.關係)),!e.友好度||'object'!=typeof e.友好度||e.友好度 instanceof Map?e.友好度||(e.友好度=new Map):e.友好度=new Map(Object.entries(e.友好度)),!e.愛情度||'object'!=typeof e.愛情度||e.愛情度 instanceof Map?e.愛情度||(e.愛情度=new Map):e.愛情度=new Map(Object.entries(e.愛情度)),!e.所持物||'object'!=typeof e.所持物||e.所持物 instanceof Map?e.所持物||(e.所持物=new Map):e.所持物=new Map(Object.entries(e.所持物)),e.selected_relation_target||(e.selected_relation_target=''),e.selected_friendship_target||(e.selected_friendship_target=''),e.selected_love_target||(e.selected_love_target=''),e.selected_inventory_item||(e.selected_inventory_item=''),void 0!==e.selected_inventory_quantity&&null!==e.selected_inventory_quantity||(e.selected_inventory_quantity=1)},ja=e=>{try{const t=getVariables({type:'chat'}),a={...t.characters||{}},n=c.value.get(e);if(!n)return;const l={姓氏:n.姓氏||'',名字:n.名字||'',年齡:n.年齡,性別:n.性別||'',身份:n.身份||'',身高:n.身高,體重:n.體重,胸圍:n.胸圍,罩杯:n.罩杯||'',腰圍:n.腰圍,臀圍:n.臀圍,髮型:n.髮型||'',樣貌:n.樣貌||'',衣著:n.衣著||'',簡介:n.簡介||'',性格:n.性格||'',愛好:n.愛好||'',金錢:n.金錢,心情:n.心情,性慾:n.性慾,生日月份:n.生日月份,生日日期:n.生日日期,其他重要資訊:n.其他重要資訊||'',關係:Object.fromEntries(n.關係||new Map),友好度:Object.fromEntries(n.友好度||new Map),愛情度:Object.fromEntries(n.愛情度||new Map),所持物:Object.fromEntries(n.所持物||new Map)};a[e]=l,t.characters=a,replaceVariables(t,{type:'chat'})}catch(t){console.error(`保存角色 ${e} 資料失敗:`,t)}},Pa=e=>'['+Object.entries(e).map(([e,t])=>'string'==typeof t?`'${e}':'${t}'`:`'${e}':${t}`).join(', ')+']',qa=(e,t)=>{let a='\n</世界背景>\n';return a+='\n',a+=`${(()=>{const e=getVariables({type:'chat'}).characters.c1,t=`${e.姓氏}${e.名字}`;let a=`<${t}Status>\n`;return a+='id：c1\n',a+=`  姓氏：${e.姓氏||''}\n`,a+=`  名字：${e.名字||''}\n`,a+=`  年齡：${e.年齡||''}\n`,a+=`  性別：${e.性別||''}\n`,a+=`  身份：${e.身份||''}\n`,a+=`  身高：${e.身高||''}\n`,a+=`  體重：${e.體重||''}\n`,a+=`  胸圍：${e.胸圍||''}\n`,a+=`  罩杯：${e.罩杯||''}\n`,a+=`  腰圍：${e.腰圍||''}\n`,a+=`  臀圍：${e.臀圍||''}\n`,a+=`  髮型：${e.髮型||''}\n`,a+=`  樣貌：${e.樣貌||''}\n`,a+=`  衣著：${e.衣著||''}\n`,a+=`  簡介：${e.簡介||''}\n`,a+=`  性格：${e.性格||''}\n`,a+=`  愛好：${e.愛好||''}\n`,a+=`  金錢：${e.金錢||''}\n`,a+=`  生日月份：${e.生日月份||''}\n`,a+=`  生日日期：${e.生日日期||''}\n`,a+=`  其他重要資訊：${e.其他重要資訊||''}\n`,a+=`  關係：${Pa(e.關係)}\n`,a+=`  友好度：${Pa(e.友好度)}\n`,a+=`  愛情度：${Pa(e.愛情度)}\n`,a+=`</${t}Status>`,a})()}\n`,a+='\n',a+=`${(e=>{const t=getVariables({type:'chat'}).characters;if(void 0===t)return'';let a='<CharacterStatus>\n';for(const[n,l]of Object.entries(t))'c1'!==n&&n!==e&&(a+=`id：${n}\n`,a+=`  姓氏：${l.姓氏||''}\n`,a+=`  名字：${l.名字||''}\n`,a+=`  年齡：${l.年齡||''}\n`,a+=`  性別：${l.性別||''}\n`,a+=`  身份：${l.身份||''}\n`,a+=`  身高：${l.身高||''}\n`,a+=`  體重：${l.體重||''}\n`,a+=`  胸圍：${l.胸圍||''}\n`,a+=`  罩杯：${l.罩杯||''}\n`,a+=`  腰圍：${l.腰圍||''}\n`,a+=`  臀圍：${l.臀圍||''}\n`,a+=`  髮型：${l.髮型||''}\n`,a+=`  樣貌：${l.樣貌||''}\n`,a+=`  衣著：${l.衣著||''}\n`,a+=`  簡介：${l.簡介||''}\n`,a+=`  性格：${l.性格||''}\n`,a+=`  愛好：${l.愛好||''}\n`,a+=`  金錢：${l.金錢||''}\n`,a+=`  心情：${l.心情||''}\n`,a+=`  性慾：${l.性慾||''}\n`,a+=`  生日月份：${l.生日月份||''}\n`,a+=`  生日日期：${l.生日日期||''}\n`,a+=`  其他重要資訊：${l.其他重要資訊||''}\n`,a+=`  關係：${Pa(l.關係)}\n`,a+=`  友好度：${Pa(l.友好度)}\n`,a+=`  愛情度：${Pa(l.愛情度)}\n\n`);return a+='</CharacterStatus>',a})(e)}\n`,a+='\n',a+=`${(()=>{let e='<ItemTable>\n';e+='|id|名稱|描述|價值|\n',e+='|---|---|---|---|\n';const t=getVariables({type:'chat'}).items;if(void 0===t)return'';for(const[a,n]of Object.entries(t))e+=`|${a}|${n.name}|${n.description}|${n.value}|\n`;return e+='</ItemTable>',e})()}\n`,a+='\n',a+=`${(()=>{let e='<LocationTable>\n';e+='|id|地點|位置|描述|子地點|\n',e+='|---|---|---|---|---|\n';const t=getVariables({type:'chat'}).locations;if(void 0===t)return'';for(const[a,n]of Object.entries(t)){const t=n.sub_location?n.sub_location.join(', '):'';e+=`|${a}|${n.name}|${n.location||''}|${n.description}|${t}|\n`}return e+='</LocationTable>',e})()}\n`,a+='\n',a+=`${(()=>{let e='';const t=getVariables({type:'chat'}).extra_world_info;if(void 0===t)return'';for(const a of Array.from(t))''!==a.name&&''!==a.content&&(e+=`<${a.name}>\n`,e+=`${a.content}\n`,e+=`</${a.name}>\n`,e+='\n');return e})()}\n`,a+='\n',a+='<生成要求>\n',a+=`${t.generation_requirement||'無特殊要求'}\n`,a+='</生成要求>\n',a+='\n',a+='<example>\n',a+='# The following is an example of user input and expected output. Please strictly follow the style and format to generate the output. Output anything other than this format is prohibited.\n',a+='姓氏：string\n',a+='名字：string\n',a+='年齡：number\n',a+='性別：\'男\' | \'女\' | \'不明\'\n',a+='身份：\'以第三人稱客觀地描述\'\n',a+='身高：number\n',a+='體重：number\n',a+='胸圍：number\n',a+='罩杯：\'Capital Letter\' | \'不適用\'\n',a+='腰圍：number\n',a+='臀圍：number\n',a+='髮型：\'以第三人稱客觀地描述\'\n',a+='樣貌：\'以第三人稱客觀地描述\'\n',a+='衣著：\'以第三人稱客觀地描述當前身上服裝\'\n',a+='簡介：\'以第三人稱客觀地描述\'\n',a+='性格：\'以第三人稱客觀地描述\'\n',a+='愛好：\'以第三人稱客觀地描述\'\n',a+='金錢：number\n',a+='心情：number[-100~100]\n',a+='性慾：number[0~100]\n',a+='生日月份：number\n',a+='生日日期：number\n',a+='其他重要資訊：\'以第三人稱客觀地描述\'\n',a+='關係：[\'id\':\'對此角色的關係\', ...]\n',a+='友好度：\'[\'id\':number[-1000~1000], ...]\'\n',a+='愛情度：\'[\'id\':number[1~1000], ...]\'\n',a+='所持物：[\'item_id\':quantity, ...]\n',a+='</example>\n',a},Ga=async e=>{const t=c.value.get(e);if(!t)return;const a=new Map(d.value);a.set(e,!0),d.value=a;try{const a=(e=>{let t='請根據世界背景資訊、生成要求及已有角色資料，為以下角色完善角色資料設定：\n\n';return t+=`姓氏：${e.姓氏||''}\n`,t+=`名字：${e.名字||''}\n`,t+=`年齡：${e.年齡||''}\n`,t+=`性別：${e.性別||''}\n`,t+=`身份：${e.身份||''}\n`,t+=`身高：${e.身高||''}\n`,t+=`體重：${e.體重||''}\n`,t+=`胸圍：${e.胸圍||''}\n`,t+=`罩杯：${e.罩杯||''}\n`,t+=`腰圍：${e.腰圍||''}\n`,t+=`臀圍：${e.臀圍||''}\n`,t+=`髮型：${e.髮型||''}\n`,t+=`樣貌：${e.樣貌||''}\n`,t+=`衣著：${e.衣著||''}\n`,t+=`簡介：${e.簡介||''}\n`,t+=`性格：${e.性格||''}\n`,t+=`愛好：${e.愛好||''}\n`,t+=`金錢：${e.金錢||''}\n`,t+=`心情：${e.心情||''}\n`,t+=`性慾：${e.性慾||''}\n`,t+=`生日月份：${e.生日月份||''}\n`,t+=`生日日期：${e.生日日期||''}\n`,t+=`其他重要資訊：${e.其他重要資訊||''}\n`,t+=`關係：${Pa(Object.fromEntries(e.關係||new Map))}\n`,t+=`友好度：${Pa(Object.fromEntries(e.友好度||new Map))}\n`,t+=`愛情度：${Pa(Object.fromEntries(e.愛情度||new Map))}\n`,t+=`所持物：${Pa(Object.fromEntries(e.所持物||new Map))}\n`,t})(t),n=(()=>{const e=getVariables({type:'chat'}).world_info;let t=getCharData('current').description;t=t.replace('{{getvar::world_info}}',e);let a='你是一個專業的角色設計助手，擅長創造豐富多彩的角色設定。請根據提供的世界背景及生成要求，為角色完善資料。\n';return a+='\n',a+='<世界背景>\n','你是一個專業的角色設計助手，擅長創造豐富多彩的角色設定。請根據提供的世界背景及生成要求，為角色完善資料。\n\n<世界背景>\n'})(),l=qa(e,t);((e,t)=>{const a=e.split('\n');for(const e of a){const a=e.indexOf('：');if(a>0){const n=e.substring(0,a).trim(),l=e.substring(a+1).trim();switch(n){case'姓氏':t.generated_surname=l.replace(/^["']|["']$/g,'');break;case'名字':t.generated_name=l.replace(/^["']|["']$/g,'');break;case'年齡':t.generated_age=l.replace(/[^\d]/g,'');break;case'性別':t.generated_gender=l.replace(/^["']|["']$/g,'');break;case'身份':t.generated_identity=l.replace(/^["']|["']$/g,'');break;case'身高':t.generated_height=l.replace(/[^\d]/g,'');break;case'體重':t.generated_weight=l.replace(/[^\d]/g,'');break;case'胸圍':t.generated_chest_size=l.replace(/[^\d]/g,'');break;case'罩杯':t.generated_cup_size=l.replace(/^["']|["']$/g,'');break;case'腰圍':t.generated_waist_size=l.replace(/[^\d]/g,'');break;case'臀圍':t.generated_hips_size=l.replace(/[^\d]/g,'');break;case'髮型':t.generated_hairstyle=l.replace(/^["']|["']$/g,'');break;case'樣貌':t.generated_appearance=l.replace(/^["']|["']$/g,'');break;case'衣著':t.generated_clothes=l.replace(/^["']|["']$/g,'');break;case'簡介':t.generated_introduction=l.replace(/^["']|["']$/g,'');break;case'性格':t.generated_personality=l.replace(/^["']|["']$/g,'');break;case'愛好':t.generated_favourite=l.replace(/^["']|["']$/g,'');break;case'金錢':t.generated_money=l.replace(/[^\d]/g,'');break;case'心情':t.generated_mood=l.replace(/[^\d]/g,'');break;case'性慾':t.generated_sexuality=l.replace(/[^\d]/g,'');break;case'生日月份':t.generated_birthday_month=l.replace(/[^\d]/g,'');break;case'生日日期':t.generated_birthday_day=l.replace(/[^\d]/g,'');break;case'其他重要資訊':t.generated_extra_information=l.replace(/^["']|["']$/g,'');break;case'關係':t.generated_relationship=l.replace(/^["']|["']$/g,'');break;case'友好度':t.generated_friendship=l.replace(/^["']|["']$/g,'');break;case'愛情度':t.generated_love=l.replace(/^["']|["']$/g,'');break;case'所持物':t.generated_inventory=l.replace(/^["']|["']$/g,'')}}}})(await generateRaw({user_input:a,ordered_prompts:[{role:'system',content:n},'char_description',{role:'system',content:l},'user_input']}),t);try{localStorage.setItem(`character_profile_generated_${e}`,JSON.stringify({generation_requirement:t.generation_requirement,generated_surname:t.generated_surname,generated_name:t.generated_name,generated_age:t.generated_age,generated_gender:t.generated_gender,generated_identity:t.generated_identity,generated_height:t.generated_height,generated_weight:t.generated_weight,generated_chest_size:t.generated_chest_size,generated_cup_size:t.generated_cup_size,generated_waist_size:t.generated_waist_size,generated_hips_size:t.generated_hips_size,generated_hairstyle:t.generated_hairstyle,generated_appearance:t.generated_appearance,generated_clothes:t.generated_clothes,generated_introduction:t.generated_introduction,generated_personality:t.generated_personality,generated_favourite:t.generated_favourite,generated_money:t.generated_money,generated_mood:t.generated_mood,generated_sexuality:t.generated_sexuality,generated_birthday_month:t.generated_birthday_month,generated_birthday_day:t.generated_birthday_day,generated_extra_information:t.generated_extra_information,generated_relationship:t.generated_relationship,generated_friendship:t.generated_friendship,generated_love:t.generated_love,generated_inventory:t.generated_inventory}))}catch(t){console.error(`Failed to save generated character profile for ${e} to localStorage:`,t)}c.value.set(e,{...t})}catch(a){console.error(`生成角色 ${e} 資料失敗:`,a),t.generated_age='生成失敗，請重試。'}finally{const t=new Map(d.value);t.set(e,!1),d.value=t}};(0,n.watch)(()=>getVariables({type:'chat'}),e=>{if(e?.characters){const t=new Map;for(const[a,l]of Object.entries(e.characters)){const e=(0,n.reactive)(l);Fa(e),Ha(e),t.set(a,e)}c.value=t}},{deep:!0}),(0,n.watch)(c,()=>{for(const[e]of c.value.entries())ja(e)},{deep:!0}),(0,n.watch)(()=>c.value,e=>{for(const[t,a]of e.entries())(0,n.watch)(()=>a.generation_requirement,e=>{try{const a=localStorage.getItem(`character_profile_generated_${t}`),n=a?JSON.parse(a):{};n.generation_requirement=e,localStorage.setItem(`character_profile_generated_${t}`,JSON.stringify(n))}catch(e){console.error(`Failed to save generation_requirement for ${t} to localStorage:`,e)}},{immediate:!1})},{deep:!0,immediate:!0}),(0,n.onMounted)(()=>{(()=>{try{const e=getVariables({type:'chat'});if(e?.characters){const t=new Map;for(const[a,l]of Object.entries(e.characters)){const e=(0,n.reactive)(l);Fa(e),Ha(e),t.set(a,e)}c.value=t}else c.value=new Map}catch(e){console.error('載入角色資料失敗:',e),c.value=new Map}try{for(const[e,t]of c.value){const a=localStorage.getItem(`character_profile_generated_${e}`);a&&Object.assign(t,JSON.parse(a))}}catch(e){console.error('Failed to load generated character profiles from localStorage:',e)}})()});const Wa=()=>{const e=(()=>{const e=Array.from(c.value.keys());let t=2;for(;e.includes(`c${t}`);)t++;return`c${t}`})(),t={姓氏:'',名字:'',年齡:null,性別:'',身份:'',身高:null,體重:null,胸圍:null,罩杯:'',腰圍:null,臀圍:null,髮型:'',樣貌:'',衣著:'',簡介:'',性格:'',愛好:'',金錢:null,心情:50,性慾:0,生日月份:null,生日日期:null,其他重要資訊:'',關係:new Map,selected_relation_target:'',友好度:new Map,愛情度:new Map,selected_friendship_target:'',selected_love_target:'',所持物:new Map,selected_inventory_item:'',selected_inventory_quantity:1,generation_requirement:'',generated_surname:'',generated_name:'',generated_age:'',generated_gender:'',generated_identity:'',generated_height:'',generated_weight:'',generated_chest_size:'',generated_cup_size:'',generated_waist_size:'',generated_hips_size:'',generated_hairstyle:'',generated_appearance:'',generated_clothes:'',generated_introduction:'',generated_personality:'',generated_favourite:'',generated_money:'',generated_mood:'',generated_sexuality:'',generated_birthday_month:'',generated_birthday_day:'',generated_extra_information:''},a=(0,n.reactive)(t);c.value.set(e,a);try{const t=getVariables({type:'chat'}).characters||{};t[e]={姓氏:'',名字:'',年齡:null,性別:'',身份:'',身高:null,體重:null,胸圍:null,罩杯:'',腰圍:null,臀圍:null,髮型:'',樣貌:'',衣著:'',簡介:'',性格:'',愛好:'',金錢:null,心情:50,性慾:0,生日月份:null,生日日期:null,其他重要資訊:'',關係:{},友好度:{},愛情度:{}},insertOrAssignVariables({characters:t},{type:'chat'})}catch(e){console.error('Failed to add new character to chat variables:',e)}},Xa=(e,t,a,n,l)=>{const r=c.value.get(e);if(!r)return;const o=r[t];o||(r[t]=new Map);const i=new Map(o),s=l?l(n):n;i.set(a,s),r[t]=i,c.value.set(e,{...r}),ja(e)},Za=(e,t,a,n)=>{const l=c.value.get(e);if(!l)return;const r=l[a];if(!r)return;l[t]||(l[t]=new Map),l[t].set(r,n),l[a]='',c.value.set(e,{...l}),ja(e)},Ja=(e,t,a)=>{const n=c.value.get(e);if(!n)return;const l=n[t];if(!l)return;const r=new Map(l);r.delete(a),n[t]=r,c.value.set(e,{...n}),ja(e)};return(e,u)=>((0,n.openBlock)(),(0,n.createElementBlock)('div',v,[u[68]||(u[68]=(0,n.createElementVNode)('h3',null,'角色資料設定',-1)),(0,n.createCommentVNode)(' 其他角色動態摺疊欄 '),((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(Ma.value,([e,v])=>((0,n.openBlock)(),(0,n.createElementBlock)('div',{key:e,class:(0,n.normalizeClass)(['character-fold-bar',{'character-incomplete':!za(v)}])},[(0,n.createVNode)(m,{title:`${e}: ${Ra(v)}`,'is-open':!1},{'title-actions':(0,n.withCtx)(()=>[(0,n.createElementVNode)('button',{class:'remove-character-btn',title:'移除角色',onClick:t=>(e=>{c.value.delete(e);try{const t=getVariables({type:'chat'});delete t.characters[e],replaceVariables(t,{type:'chat'})}catch(t){console.error(`Failed to remove character ${e} from chat variables:`,t)}})(e)},[...u[0]||(u[0]=[(0,n.createElementVNode)('span',null,'×',-1)])],8,p)]),default:(0,n.withCtx)(()=>[(0,n.createElementVNode)('div',g,[(0,n.createElementVNode)('div',h,[u[27]||(u[27]=(0,n.createElementVNode)('h4',null,'基本資訊',-1)),(0,n.createElementVNode)('div',E,[(0,n.createElementVNode)('div',y,[u[2]||(u[2]=(0,n.createElementVNode)('label',null,'姓氏',-1)),(0,n.withDirectives)((0,n.createElementVNode)('input',{'onUpdate:modelValue':e=>v.姓氏=e,type:'text',placeholder:'例如：張',class:'text-input'},null,8,b),[[n.vModelText,v.姓氏]]),v.generated_surname?((0,n.openBlock)(),(0,n.createElementBlock)('div',V,[u[1]||(u[1]=(0,n.createElementVNode)('label',null,'生成結果：',-1)),(0,n.createElementVNode)('div',N,(0,n.toDisplayString)(v.generated_surname),1),(0,n.createElementVNode)('button',{class:'replace-btn',onClick:t=>l(e,'姓氏',v.generated_surname)},' 使用 ',8,f)])):(0,n.createCommentVNode)('v-if',!0)]),(0,n.createElementVNode)('div',k,[u[4]||(u[4]=(0,n.createElementVNode)('label',null,'名字',-1)),(0,n.withDirectives)((0,n.createElementVNode)('input',{'onUpdate:modelValue':e=>v.名字=e,type:'text',placeholder:'例如：小明',class:'text-input'},null,8,w),[[n.vModelText,v.名字]]),v.generated_name?((0,n.openBlock)(),(0,n.createElementBlock)('div',B,[u[3]||(u[3]=(0,n.createElementVNode)('label',null,'生成結果：',-1)),(0,n.createElementVNode)('div',C,(0,n.toDisplayString)(v.generated_name),1),(0,n.createElementVNode)('button',{class:'replace-btn',onClick:t=>l(e,'名字',v.generated_name)},' 使用 ',8,S)])):(0,n.createCommentVNode)('v-if',!0)]),(0,n.createElementVNode)('div',x,[u[6]||(u[6]=(0,n.createElementVNode)('label',null,'年齡',-1)),(0,n.createElementVNode)('input',{value:t(v,'年齡'),type:'number',placeholder:'例如：18',class:'text-input',min:'0',max:'200',onInput:e=>a(v,'年齡',e.target.value)},null,40,I),v.generated_age?((0,n.openBlock)(),(0,n.createElementBlock)('div',D,[u[5]||(u[5]=(0,n.createElementVNode)('label',null,'生成結果：',-1)),(0,n.createElementVNode)('div',T,(0,n.toDisplayString)(v.generated_age),1),(0,n.createElementVNode)('button',{class:'replace-btn',onClick:t=>l(e,'年齡',v.generated_age)},' 使用 ',8,M)])):(0,n.createCommentVNode)('v-if',!0)]),(0,n.createElementVNode)('div',O,[u[8]||(u[8]=(0,n.createElementVNode)('label',null,'性別',-1)),(0,n.withDirectives)((0,n.createElementVNode)('input',{'onUpdate:modelValue':e=>v.性別=e,type:'text',placeholder:'例如：女',class:'text-input'},null,8,Y),[[n.vModelText,v.性別]]),v.generated_gender?((0,n.openBlock)(),(0,n.createElementBlock)('div',A,[u[7]||(u[7]=(0,n.createElementVNode)('label',null,'生成結果：',-1)),(0,n.createElementVNode)('div',R,(0,n.toDisplayString)(v.generated_gender),1),(0,n.createElementVNode)('button',{class:'replace-btn',onClick:t=>l(e,'性別',v.generated_gender)},' 使用 ',8,K)])):(0,n.createCommentVNode)('v-if',!0)]),(0,n.createElementVNode)('div',U,[u[10]||(u[10]=(0,n.createElementVNode)('label',null,'身份',-1)),(0,n.withDirectives)((0,n.createElementVNode)('input',{'onUpdate:modelValue':e=>v.身份=e,type:'text',placeholder:'例如：高中生',class:'text-input'},null,8,L),[[n.vModelText,v.身份]]),v.generated_identity?((0,n.openBlock)(),(0,n.createElementBlock)('div',F,[u[9]||(u[9]=(0,n.createElementVNode)('label',null,'生成結果：',-1)),(0,n.createElementVNode)('div',H,(0,n.toDisplayString)(v.generated_identity),1),(0,n.createElementVNode)('button',{class:'replace-btn',onClick:t=>l(e,'身份',v.generated_identity)},' 使用 ',8,j)])):(0,n.createCommentVNode)('v-if',!0)]),(0,n.createElementVNode)('div',P,[u[12]||(u[12]=(0,n.createElementVNode)('label',null,'身高 (cm)',-1)),(0,n.createElementVNode)('input',{value:t(v,'身高'),type:'number',placeholder:'例如：165',class:'text-input',min:'0',max:'300',onInput:e=>a(v,'身高',e.target.value)},null,40,q),v.generated_height?((0,n.openBlock)(),(0,n.createElementBlock)('div',G,[u[11]||(u[11]=(0,n.createElementVNode)('label',null,'生成結果：',-1)),(0,n.createElementVNode)('div',W,(0,n.toDisplayString)(v.generated_height),1),(0,n.createElementVNode)('button',{class:'replace-btn',onClick:t=>l(e,'身高',v.generated_height)},' 使用 ',8,X)])):(0,n.createCommentVNode)('v-if',!0)]),(0,n.createElementVNode)('div',Z,[u[14]||(u[14]=(0,n.createElementVNode)('label',null,'體重 (kg)',-1)),(0,n.createElementVNode)('input',{value:t(v,'體重'),type:'number',placeholder:'例如：50',class:'text-input',min:'0',max:'500',onInput:e=>a(v,'體重',e.target.value)},null,40,J),v.generated_weight?((0,n.openBlock)(),(0,n.createElementBlock)('div',Q,[u[13]||(u[13]=(0,n.createElementVNode)('label',null,'生成結果：',-1)),(0,n.createElementVNode)('div',ee,(0,n.toDisplayString)(v.generated_weight),1),(0,n.createElementVNode)('button',{class:'replace-btn',onClick:t=>l(e,'體重',v.generated_weight)},' 使用 ',8,te)])):(0,n.createCommentVNode)('v-if',!0)]),(0,n.createElementVNode)('div',ae,[u[16]||(u[16]=(0,n.createElementVNode)('label',null,'胸圍 (cm)',-1)),(0,n.createElementVNode)('input',{value:t(v,'胸圍'),type:'number',placeholder:'例如：85',class:'text-input',min:'0',max:'200',onInput:e=>a(v,'胸圍',e.target.value)},null,40,ne),v.generated_chest_size?((0,n.openBlock)(),(0,n.createElementBlock)('div',le,[u[15]||(u[15]=(0,n.createElementVNode)('label',null,'生成結果：',-1)),(0,n.createElementVNode)('div',re,(0,n.toDisplayString)(v.generated_chest_size),1),(0,n.createElementVNode)('button',{class:'replace-btn',onClick:t=>l(e,'胸圍',v.generated_chest_size)},' 使用 ',8,oe)])):(0,n.createCommentVNode)('v-if',!0)]),(0,n.createElementVNode)('div',ie,[u[18]||(u[18]=(0,n.createElementVNode)('label',null,'罩杯',-1)),(0,n.withDirectives)((0,n.createElementVNode)('input',{'onUpdate:modelValue':e=>v.罩杯=e,type:'text',placeholder:'例如：C',class:'text-input'},null,8,se),[[n.vModelText,v.罩杯]]),v.generated_cup_size?((0,n.openBlock)(),(0,n.createElementBlock)('div',ce,[u[17]||(u[17]=(0,n.createElementVNode)('label',null,'生成結果：',-1)),(0,n.createElementVNode)('div',de,(0,n.toDisplayString)(v.generated_cup_size),1),(0,n.createElementVNode)('button',{class:'replace-btn',onClick:t=>l(e,'罩杯',v.generated_cup_size)},' 使用 ',8,ue)])):(0,n.createCommentVNode)('v-if',!0)]),(0,n.createElementVNode)('div',me,[u[20]||(u[20]=(0,n.createElementVNode)('label',null,'腰圍 (cm)',-1)),(0,n.createElementVNode)('input',{value:t(v,'腰圍'),type:'number',placeholder:'例如：60',class:'text-input',min:'0',max:'200',onInput:e=>a(v,'腰圍',e.target.value)},null,40,ve),v.generated_waist_size?((0,n.openBlock)(),(0,n.createElementBlock)('div',pe,[u[19]||(u[19]=(0,n.createElementVNode)('label',null,'生成結果：',-1)),(0,n.createElementVNode)('div',ge,(0,n.toDisplayString)(v.generated_waist_size),1),(0,n.createElementVNode)('button',{class:'replace-btn',onClick:t=>l(e,'腰圍',v.generated_waist_size)},' 使用 ',8,_e)])):(0,n.createCommentVNode)('v-if',!0)]),(0,n.createElementVNode)('div',he,[u[22]||(u[22]=(0,n.createElementVNode)('label',null,'臀圍 (cm)',-1)),(0,n.createElementVNode)('input',{value:t(v,'臀圍'),type:'number',placeholder:'例如：88',class:'text-input',min:'0',max:'200',onInput:e=>a(v,'臀圍',e.target.value)},null,40,Ee),v.generated_hips_size?((0,n.openBlock)(),(0,n.createElementBlock)('div',ye,[u[21]||(u[21]=(0,n.createElementVNode)('label',null,'生成結果：',-1)),(0,n.createElementVNode)('div',be,(0,n.toDisplayString)(v.generated_hips_size),1),(0,n.createElementVNode)('button',{class:'replace-btn',onClick:t=>l(e,'臀圍',v.generated_hips_size)},' 使用 ',8,Ve)])):(0,n.createCommentVNode)('v-if',!0)]),(0,n.createElementVNode)('div',Ne,[u[24]||(u[24]=(0,n.createElementVNode)('label',null,'髮型',-1)),(0,n.withDirectives)((0,n.createElementVNode)('input',{'onUpdate:modelValue':e=>v.髮型=e,type:'text',placeholder:'例如：黑色長直髮',class:'text-input'},null,8,fe),[[n.vModelText,v.髮型]]),v.generated_hairstyle?((0,n.openBlock)(),(0,n.createElementBlock)('div',ke,[u[23]||(u[23]=(0,n.createElementVNode)('label',null,'生成結果：',-1)),(0,n.createElementVNode)('div',we,(0,n.toDisplayString)(v.generated_hairstyle),1),(0,n.createElementVNode)('button',{class:'replace-btn',onClick:t=>l(e,'髮型',v.generated_hairstyle)},' 使用 ',8,Be)])):(0,n.createCommentVNode)('v-if',!0)]),(0,n.createElementVNode)('div',Ce,[u[26]||(u[26]=(0,n.createElementVNode)('label',null,'生日',-1)),(0,n.createElementVNode)('div',$e,[(0,n.createElementVNode)('input',{value:t(v,'生日月份'),type:'number',placeholder:'月',class:'birthday-input',min:'1',max:'12',onInput:e=>a(v,'生日月份',e.target.value)},null,40,Se),(0,n.createElementVNode)('input',{value:t(v,'生日日期'),type:'number',placeholder:'日',class:'birthday-input',min:'1',max:'31',onInput:e=>a(v,'生日日期',e.target.value)},null,40,xe)]),v.generated_birthday_month||v.generated_birthday_day?((0,n.openBlock)(),(0,n.createElementBlock)('div',Ie,[u[25]||(u[25]=(0,n.createElementVNode)('label',null,'生成結果：',-1)),(0,n.createElementVNode)('div',De,(0,n.toDisplayString)(v.generated_birthday_month)+'月 '+(0,n.toDisplayString)(v.generated_birthday_day)+'日 ',1),(0,n.createElementVNode)('button',{class:'replace-btn',onClick:t=>l(e,'生日',`${v.generated_birthday_month}-${v.generated_birthday_day}`)},' 使用 ',8,Te)])):(0,n.createCommentVNode)('v-if',!0)])])]),(0,n.createElementVNode)('div',Me,[u[32]||(u[32]=(0,n.createElementVNode)('h4',null,'外貌描述',-1)),(0,n.createElementVNode)('div',Oe,[(0,n.createElementVNode)('div',Ye,[u[29]||(u[29]=(0,n.createElementVNode)('label',null,'外貌',-1)),(0,n.withDirectives)((0,n.createElementVNode)('textarea',{'onUpdate:modelValue':e=>v.樣貌=e,placeholder:'描述外貌特徵...',class:'text-area',rows:'3'},null,8,Ae),[[n.vModelText,v.樣貌]]),v.generated_appearance?((0,n.openBlock)(),(0,n.createElementBlock)('div',Re,[u[28]||(u[28]=(0,n.createElementVNode)('label',null,'生成結果：',-1)),(0,n.createElementVNode)('div',Ke,(0,n.toDisplayString)(v.generated_appearance),1),(0,n.createElementVNode)('button',{class:'replace-btn',onClick:t=>l(e,'樣貌',v.generated_appearance)},' 使用 ',8,Ue)])):(0,n.createCommentVNode)('v-if',!0)]),(0,n.createElementVNode)('div',ze,[u[31]||(u[31]=(0,n.createElementVNode)('label',null,'服裝',-1)),(0,n.withDirectives)((0,n.createElementVNode)('textarea',{'onUpdate:modelValue':e=>v.衣著=e,placeholder:'描述常穿的服裝...',class:'text-area',rows:'3'},null,8,Le),[[n.vModelText,v.衣著]]),v.generated_clothes?((0,n.openBlock)(),(0,n.createElementBlock)('div',Fe,[u[30]||(u[30]=(0,n.createElementVNode)('label',null,'生成結果：',-1)),(0,n.createElementVNode)('div',He,(0,n.toDisplayString)(v.generated_clothes),1),(0,n.createElementVNode)('button',{class:'replace-btn',onClick:t=>l(e,'衣著',v.generated_clothes)},' 使用 ',8,je)])):(0,n.createCommentVNode)('v-if',!0)])])]),(0,n.createElementVNode)('div',Pe,[u[39]||(u[39]=(0,n.createElementVNode)('h4',null,'性格與喜好',-1)),(0,n.createElementVNode)('div',qe,[(0,n.createElementVNode)('div',Ge,[u[34]||(u[34]=(0,n.createElementVNode)('label',null,'簡介',-1)),(0,n.withDirectives)((0,n.createElementVNode)('textarea',{'onUpdate:modelValue':e=>v.簡介=e,placeholder:'簡單介紹角色...',class:'text-area',rows:'3'},null,8,We),[[n.vModelText,v.簡介]]),v.generated_introduction?((0,n.openBlock)(),(0,n.createElementBlock)('div',Xe,[u[33]||(u[33]=(0,n.createElementVNode)('label',null,'生成結果：',-1)),(0,n.createElementVNode)('div',Ze,(0,n.toDisplayString)(v.generated_introduction),1),(0,n.createElementVNode)('button',{class:'replace-btn',onClick:t=>l(e,'簡介',v.generated_introduction)},' 使用 ',8,Je)])):(0,n.createCommentVNode)('v-if',!0)]),(0,n.createElementVNode)('div',Qe,[u[36]||(u[36]=(0,n.createElementVNode)('label',null,'性格',-1)),(0,n.withDirectives)((0,n.createElementVNode)('textarea',{'onUpdate:modelValue':e=>v.性格=e,placeholder:'描述性格特點...',class:'text-area',rows:'3'},null,8,et),[[n.vModelText,v.性格]]),v.generated_personality?((0,n.openBlock)(),(0,n.createElementBlock)('div',tt,[u[35]||(u[35]=(0,n.createElementVNode)('label',null,'生成結果：',-1)),(0,n.createElementVNode)('div',at,(0,n.toDisplayString)(v.generated_personality),1),(0,n.createElementVNode)('button',{class:'replace-btn',onClick:t=>l(e,'性格',v.generated_personality)},' 使用 ',8,nt)])):(0,n.createCommentVNode)('v-if',!0)]),(0,n.createElementVNode)('div',lt,[u[38]||(u[38]=(0,n.createElementVNode)('label',null,'愛好',-1)),(0,n.withDirectives)((0,n.createElementVNode)('textarea',{'onUpdate:modelValue':e=>v.愛好=e,placeholder:'描述喜歡的事物...',class:'text-area',rows:'3'},null,8,rt),[[n.vModelText,v.愛好]]),v.generated_favourite?((0,n.openBlock)(),(0,n.createElementBlock)('div',ot,[u[37]||(u[37]=(0,n.createElementVNode)('label',null,'生成結果：',-1)),(0,n.createElementVNode)('div',it,(0,n.toDisplayString)(v.generated_favourite),1),(0,n.createElementVNode)('button',{class:'replace-btn',onClick:t=>l(e,'愛好',v.generated_favourite)},' 使用 ',8,st)])):(0,n.createCommentVNode)('v-if',!0)])])]),(0,n.createElementVNode)('div',ct,[u[64]||(u[64]=(0,n.createElementVNode)('h4',null,'其他資訊',-1)),(0,n.createElementVNode)('div',dt,[(0,n.createElementVNode)('div',ut,[u[41]||(u[41]=(0,n.createElementVNode)('label',null,'金錢',-1)),(0,n.createElementVNode)('input',{value:t(v,'金錢'),type:'number',placeholder:'例如：10000',class:'text-input',min:'0',onInput:e=>a(v,'金錢',e.target.value)},null,40,mt),v.generated_money?((0,n.openBlock)(),(0,n.createElementBlock)('div',vt,[u[40]||(u[40]=(0,n.createElementVNode)('label',null,'生成結果：',-1)),(0,n.createElementVNode)('div',pt,(0,n.toDisplayString)(v.generated_money),1),(0,n.createElementVNode)('button',{class:'replace-btn',onClick:t=>l(e,'金錢',v.generated_money)},' 使用 ',8,gt)])):(0,n.createCommentVNode)('v-if',!0)]),(0,n.createElementVNode)('div',_t,[u[43]||(u[43]=(0,n.createElementVNode)('label',null,'心情 (-100~100)',-1)),(0,n.createElementVNode)('input',{value:t(v,'心情'),type:'number',placeholder:'例如：50',class:'text-input',min:'0',max:'100',onInput:e=>a(v,'心情',e.target.value)},null,40,ht),v.generated_mood?((0,n.openBlock)(),(0,n.createElementBlock)('div',Et,[u[42]||(u[42]=(0,n.createElementVNode)('label',null,'生成結果：',-1)),(0,n.createElementVNode)('div',yt,(0,n.toDisplayString)(v.generated_mood),1),(0,n.createElementVNode)('button',{class:'replace-btn',onClick:t=>l(e,'心情',v.generated_mood)},' 使用 ',8,bt)])):(0,n.createCommentVNode)('v-if',!0)]),(0,n.createElementVNode)('div',Vt,[u[45]||(u[45]=(0,n.createElementVNode)('label',null,'性慾 (0~100)',-1)),(0,n.createElementVNode)('input',{value:t(v,'性慾'),type:'number',placeholder:'例如：0',class:'text-input',min:'0',max:'100',onInput:e=>a(v,'性慾',e.target.value)},null,40,Nt),v.generated_sexuality?((0,n.openBlock)(),(0,n.createElementBlock)('div',ft,[u[44]||(u[44]=(0,n.createElementVNode)('label',null,'生成結果：',-1)),(0,n.createElementVNode)('div',kt,(0,n.toDisplayString)(v.generated_sexuality),1),(0,n.createElementVNode)('button',{class:'replace-btn',onClick:t=>l(e,'性慾',v.generated_sexuality)},' 使用 ',8,wt)])):(0,n.createCommentVNode)('v-if',!0)]),(0,n.createElementVNode)('div',Bt,[u[47]||(u[47]=(0,n.createElementVNode)('label',null,'其他重要資訊',-1)),(0,n.withDirectives)((0,n.createElementVNode)('textarea',{'onUpdate:modelValue':e=>v.其他重要資訊=e,placeholder:'其他需要描述的資訊...',class:'text-area',rows:'3'},null,8,Ct),[[n.vModelText,v.其他重要資訊]]),v.generated_extra_information?((0,n.openBlock)(),(0,n.createElementBlock)('div',$t,[u[46]||(u[46]=(0,n.createElementVNode)('label',null,'生成結果：',-1)),(0,n.createElementVNode)('div',St,(0,n.toDisplayString)(v.generated_extra_information),1),(0,n.createElementVNode)('button',{class:'replace-btn',onClick:t=>l(e,'其他重要資訊',v.generated_extra_information)},' 使用 ',8,xt)])):(0,n.createCommentVNode)('v-if',!0)]),(0,n.createElementVNode)('div',It,[u[51]||(u[51]=(0,n.createElementVNode)('label',null,'關係',-1)),(0,n.createElementVNode)('div',Dt,[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(Array.from(v.關係||new Map),([t,a])=>((0,n.openBlock)(),(0,n.createElementBlock)('div',{key:t,class:'relation-item'},[(0,n.createElementVNode)('span',Tt,'['+(0,n.toDisplayString)(t)+'] '+(0,n.toDisplayString)(Ka(t)),1),u[48]||(u[48]=(0,n.createTextVNode)(' 是此角色的 ',-1)),(0,n.createElementVNode)('input',{value:a,type:'text',placeholder:'輸入關係描述',class:'relation-input',onInput:a=>((e,t,a)=>Xa(e,'關係',t,a))(e,t,a.target.value)},null,40,Mt),(0,n.createElementVNode)('button',{class:'remove-relation-btn',onClick:a=>((e,t)=>Ja(e,'關係',t))(e,t)},'×',8,Ot)]))),128)),(0,n.createElementVNode)('div',Yt,[(0,n.withDirectives)((0,n.createElementVNode)('select',{'onUpdate:modelValue':e=>v.selected_relation_target=e,class:'relation-select'},[u[49]||(u[49]=(0,n.createElementVNode)('option',{value:''},'選擇目標角色',-1)),((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(Oa(e),([e,t])=>((0,n.openBlock)(),(0,n.createElementBlock)('option',{key:e,value:e},(0,n.toDisplayString)(`${e}: ${t.姓氏||''}${t.名字||''}`),9,Rt))),128))],8,At),[[n.vModelSelect,v.selected_relation_target]]),(0,n.createElementVNode)('button',{class:'add-relation-btn',disabled:!v.selected_relation_target,onClick:t=>(e=>Za(e,'關係','selected_relation_target',''))(e)},' 添加關係 ',8,Kt)])]),v.generated_relationship?((0,n.openBlock)(),(0,n.createElementBlock)('div',Ut,[u[50]||(u[50]=(0,n.createElementVNode)('label',null,'生成結果：',-1)),(0,n.createElementVNode)('div',zt,(0,n.toDisplayString)(v.generated_relationship),1),(0,n.createElementVNode)('button',{class:'replace-btn',onClick:t=>l(e,'關係',v.generated_relationship)},' 使用 ',8,Lt)])):(0,n.createCommentVNode)('v-if',!0)]),(0,n.createElementVNode)('div',Ft,[u[55]||(u[55]=(0,n.createElementVNode)('label',null,'友好度 (-1000~1000)',-1)),(0,n.createElementVNode)('div',Ht,[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(Array.from(v.友好度||new Map),([t,a])=>((0,n.openBlock)(),(0,n.createElementBlock)('div',{key:t,class:'relation-item'},[(0,n.createElementVNode)('span',jt,'['+(0,n.toDisplayString)(t)+'] '+(0,n.toDisplayString)(Ka(t)),1),u[52]||(u[52]=(0,n.createTextVNode)(' : ',-1)),(0,n.createElementVNode)('input',{value:a,type:'number',placeholder:'輸入友好度數值',class:'relation-input',min:'0',max:'100',onInput:a=>((e,t,a)=>Xa(e,'友好度',t,a,e=>parseInt(e)||0))(e,t,a.target.value)},null,40,Pt),(0,n.createElementVNode)('button',{class:'remove-relation-btn',onClick:a=>((e,t)=>Ja(e,'友好度',t))(e,t)},'×',8,qt)]))),128)),(0,n.createElementVNode)('div',Gt,[(0,n.withDirectives)((0,n.createElementVNode)('select',{'onUpdate:modelValue':e=>v.selected_friendship_target=e,class:'relation-select'},[u[53]||(u[53]=(0,n.createElementVNode)('option',{value:''},'選擇目標角色',-1)),((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(Oa(e),([e,t])=>((0,n.openBlock)(),(0,n.createElementBlock)('option',{key:e,value:e},(0,n.toDisplayString)(`${e}: ${t.姓氏||''}${t.名字||''}`),9,Xt))),128))],8,Wt),[[n.vModelSelect,v.selected_friendship_target]]),(0,n.createElementVNode)('button',{class:'add-relation-btn',disabled:!v.selected_friendship_target,onClick:t=>(e=>Za(e,'友好度','selected_friendship_target',0))(e)},' 添加友好度 ',8,Zt)])]),v.generated_friendship?((0,n.openBlock)(),(0,n.createElementBlock)('div',Jt,[u[54]||(u[54]=(0,n.createElementVNode)('label',null,'生成結果：',-1)),(0,n.createElementVNode)('div',Qt,(0,n.toDisplayString)(v.generated_friendship),1),(0,n.createElementVNode)('button',{class:'replace-btn',onClick:t=>l(e,'友好度',v.generated_friendship)},' 使用 ',8,ea)])):(0,n.createCommentVNode)('v-if',!0)]),(0,n.createElementVNode)('div',ta,[u[59]||(u[59]=(0,n.createElementVNode)('label',null,'愛情度 (0~1000)',-1)),(0,n.createElementVNode)('div',aa,[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(Array.from(v.愛情度||new Map),([t,a])=>((0,n.openBlock)(),(0,n.createElementBlock)('div',{key:t,class:'relation-item'},[(0,n.createElementVNode)('span',na,'['+(0,n.toDisplayString)(t)+'] '+(0,n.toDisplayString)(Ka(t)),1),u[56]||(u[56]=(0,n.createTextVNode)(' : ',-1)),(0,n.createElementVNode)('input',{value:a,type:'number',placeholder:'輸入愛情度數值',class:'relation-input',min:'0',max:'100',onInput:a=>((e,t,a)=>Xa(e,'愛情度',t,a,e=>parseInt(e)||0))(e,t,a.target.value)},null,40,la),(0,n.createElementVNode)('button',{class:'remove-relation-btn',onClick:a=>((e,t)=>Ja(e,'愛情度',t))(e,t)},'×',8,ra)]))),128)),(0,n.createElementVNode)('div',oa,[(0,n.withDirectives)((0,n.createElementVNode)('select',{'onUpdate:modelValue':e=>v.selected_love_target=e,class:'relation-select'},[u[57]||(u[57]=(0,n.createElementVNode)('option',{value:''},'選擇目標角色',-1)),((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(Oa(e),([e,t])=>((0,n.openBlock)(),(0,n.createElementBlock)('option',{key:e,value:e},(0,n.toDisplayString)(`${e}: ${t.姓氏||''}${t.名字||''}`),9,sa))),128))],8,ia),[[n.vModelSelect,v.selected_love_target]]),(0,n.createElementVNode)('button',{class:'add-relation-btn',disabled:!v.selected_love_target,onClick:t=>(e=>Za(e,'愛情度','selected_love_target',0))(e)},' 添加愛情度 ',8,ca)])]),v.generated_love?((0,n.openBlock)(),(0,n.createElementBlock)('div',da,[u[58]||(u[58]=(0,n.createElementVNode)('label',null,'生成結果：',-1)),(0,n.createElementVNode)('div',ua,(0,n.toDisplayString)(v.generated_love),1),(0,n.createElementVNode)('button',{class:'replace-btn',onClick:t=>l(e,'愛情度',v.generated_love)},' 使用 ',8,ma)])):(0,n.createCommentVNode)('v-if',!0)]),(0,n.createElementVNode)('div',va,[u[63]||(u[63]=(0,n.createElementVNode)('label',null,'所持物',-1)),(0,n.createElementVNode)('div',pa,[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(Array.from(v.所持物||new Map),([t,a])=>((0,n.openBlock)(),(0,n.createElementBlock)('div',{key:t,class:'inventory-item'},[(0,n.createElementVNode)('span',ga,'['+(0,n.toDisplayString)(t)+'] '+(0,n.toDisplayString)(Aa(t)),1),u[60]||(u[60]=(0,n.createTextVNode)(' : ',-1)),(0,n.createElementVNode)('input',{value:a,type:'number',placeholder:'數量',class:'inventory-input',min:'1',onInput:a=>((e,t,a)=>{const n=c.value.get(e);if(!n)return;n.所持物||(n.所持物=new Map);const l=new Map(n.所持物);a>0?l.set(t,a):l.delete(t),n.所持物=l,ja(e)})(e,t,parseInt(a.target.value)||1)},null,40,_a),(0,n.createElementVNode)('button',{class:'remove-inventory-btn',onClick:a=>((e,t)=>{const a=c.value.get(e);if(!a||!a.所持物)return;const n=new Map(a.所持物);n.delete(t),a.所持物=n,ja(e)})(e,t)},'×',8,ha)]))),128)),(0,n.createElementVNode)('div',Ea,[(0,n.withDirectives)((0,n.createElementVNode)('select',{'onUpdate:modelValue':e=>v.selected_inventory_item=e,class:'inventory-select'},[u[61]||(u[61]=(0,n.createElementVNode)('option',{value:''},'選擇物品',-1)),((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(Ya(),([e,t])=>((0,n.openBlock)(),(0,n.createElementBlock)('option',{key:e,value:e},(0,n.toDisplayString)(`${e}: ${t.name||'未知物品'}`),9,ba))),128))],8,ya),[[n.vModelSelect,v.selected_inventory_item]]),(0,n.withDirectives)((0,n.createElementVNode)('input',{'onUpdate:modelValue':e=>v.selected_inventory_quantity=e,type:'number',placeholder:'數量',class:'quantity-input',min:'1',disabled:!v.selected_inventory_item},null,8,Va),[[n.vModelText,v.selected_inventory_quantity,void 0,{number:!0}]]),(0,n.createElementVNode)('button',{class:'add-inventory-btn',disabled:!v.selected_inventory_item||!v.selected_inventory_quantity,onClick:t=>(e=>{const t=c.value.get(e);if(!t||!t.selected_inventory_item||!t.selected_inventory_quantity)return;t.所持物||(t.所持物=new Map);const a=t.所持物.get(t.selected_inventory_item)||0;t.所持物.set(t.selected_inventory_item,a+t.selected_inventory_quantity),t.selected_inventory_item='',t.selected_inventory_quantity=1,ja(e)})(e)},' 添加物品 ',8,Na)])]),v.generated_inventory?((0,n.openBlock)(),(0,n.createElementBlock)('div',fa,[u[62]||(u[62]=(0,n.createElementVNode)('label',null,'生成結果：',-1)),(0,n.createElementVNode)('div',ka,(0,n.toDisplayString)(v.generated_inventory),1),(0,n.createElementVNode)('button',{class:'replace-btn',onClick:t=>l(e,'所持物',v.generated_inventory)},' 使用 ',8,wa)])):(0,n.createCommentVNode)('v-if',!0)])])]),(0,n.createCommentVNode)(' 生成要求區域 '),(0,n.createElementVNode)('div',Ba,[u[66]||(u[66]=(0,n.createElementVNode)('h4',null,'生成要求',-1)),(0,n.createElementVNode)('div',Ca,[(0,n.createElementVNode)('div',$a,[u[65]||(u[65]=(0,n.createElementVNode)('label',null,'對AI生成的要求',-1)),(0,n.withDirectives)((0,n.createElementVNode)('textarea',{'onUpdate:modelValue':e=>v.generation_requirement=e,placeholder:'對AI生成的要求...',class:'text-area',rows:'3'},null,8,Sa),[[n.vModelText,v.generation_requirement]])])])]),(0,n.createCommentVNode)(' 生成按鈕區域 '),(0,n.createElementVNode)('div',xa,[(0,n.createElementVNode)('button',{class:'generate-btn',disabled:!La.value||d.value.get(e),onClick:t=>Ga(e)},[d.value.get(e)?((0,n.openBlock)(),(0,n.createElementBlock)('span',Da)):(0,n.createCommentVNode)('v-if',!0),(0,n.createTextVNode)(' '+(0,n.toDisplayString)(d.value.get(e)?'生成中...':La.value?'生成未填寫的字段':'請先完成世界背景設定'),1)],8,Ia),(0,n.createElementVNode)('button',{class:'apply-all-btn',disabled:!Ua(v),onClick:t=>(e=>{const t=c.value.get(e);if(!t)return;[{generated:'generated_surname',field:'姓氏',parser:e=>e},{generated:'generated_name',field:'名字',parser:e=>e},{generated:'generated_age',field:'年齡',parser:e=>parseInt(e)||null},{generated:'generated_gender',field:'性別',parser:e=>e},{generated:'generated_identity',field:'身份',parser:e=>e},{generated:'generated_height',field:'身高',parser:e=>parseInt(e)||null},{generated:'generated_weight',field:'體重',parser:e=>parseInt(e)||null},{generated:'generated_chest_size',field:'胸圍',parser:e=>parseInt(e)||null},{generated:'generated_cup_size',field:'罩杯',parser:e=>e},{generated:'generated_waist_size',field:'腰圍',parser:e=>parseInt(e)||null},{generated:'generated_hips_size',field:'臀圍',parser:e=>parseInt(e)||null},{generated:'generated_hairstyle',field:'髮型',parser:e=>e},{generated:'generated_appearance',field:'樣貌',parser:e=>e},{generated:'generated_clothes',field:'衣著',parser:e=>e},{generated:'generated_introduction',field:'簡介',parser:e=>e},{generated:'generated_personality',field:'性格',parser:e=>e},{generated:'generated_favourite',field:'愛好',parser:e=>e},{generated:'generated_money',field:'金錢',parser:e=>parseInt(e)||null},{generated:'generated_mood',field:'心情',parser:e=>parseInt(e)||null},{generated:'generated_sexuality',field:'性慾',parser:e=>parseInt(e)||null},{generated:'generated_birthday_month',field:'生日月份',parser:e=>parseInt(e)||null},{generated:'generated_birthday_day',field:'生日日期',parser:e=>parseInt(e)||null},{generated:'generated_extra_information',field:'其他重要資訊',parser:e=>e}].forEach(({generated:e,field:a,parser:n})=>{const l=t[e];l&&(t[a]=n(l),t[e]='')}),t.generated_relationship&&r(t,t.generated_relationship),t.generated_friendship&&o(t,t.generated_friendship),t.generated_love&&i(t,t.generated_love),t.generated_inventory&&s(t,t.generated_inventory),c.value.set(e,{...t}),ja(e);try{localStorage.removeItem(`character_profile_generated_${e}`)}catch(t){console.error(`Failed to remove generated character profile for ${e} from localStorage:`,t)}})(e)},' 應用全部 ',8,Ta)])])]),_:2},1032,['title'])],2))),128)),(0,n.createCommentVNode)(' 添加角色按鈕 '),(0,n.createElementVNode)('div',{class:'add-character-section'},[(0,n.createElementVNode)('button',{class:'add-character-btn',onClick:Wa},[...u[67]||(u[67]=[(0,n.createElementVNode)('span',null,'+ 添加角色',-1)])])])]))}}),Oa=(0,d.A)(Ma,[['__scopeId','data-v-41c909bc']]),Ya={class:'extra-container'},Aa={class:'section'},Ra={class:'sortable-container'},Ka={key:0,class:'drop-indicator'},Ua=['data-id','onDragstart','onDragover','onDrop'],za=['onClick'],La={class:'fold-content'},Fa={class:'input-group'},Ha=['onUpdate:modelValue'],ja={class:'input-group'},Pa=['onUpdate:modelValue'],qa={class:'input-group'},Ga=['onUpdate:modelValue'],Wa={key:0,class:'generated-result'},Xa={class:'generated-text'},Za=['onClick'],Ja={class:'item-actions'},Qa=['disabled','onClick'],en={key:0,class:'loading-spinner'},tn=['disabled','onClick'],an={key:0,class:'drop-indicator'},nn=(0,n.defineComponent)({__name:'extra_tab',setup(e){const t=(0,n.ref)([]),a=(0,n.ref)(new Map),l=(0,n.computed)(()=>{try{const e=getVariables({type:'chat'});return!!e?.world_info?.trim()}catch{return!1}}),r=(0,n.ref)(null),o=(0,n.ref)(null),i=e=>{const a=t.value[e];if(a&&a.generated_content){a.content=a.generated_content,a.generated_content='',t.value[e]={...a};try{a.name&&a.name.trim()&&localStorage.removeItem(`extra_item_generated_${a.name.trim()}`)}catch(e){console.error(`Failed to remove generated extra item for ${a.name} from localStorage:`,e)}}},s=()=>{const e={id:Date.now().toString(),name:'',content:'',generation_requirement:'',is_open:!1,generated_content:''};t.value.push(e)},c=()=>{try{const e=getVariables({type:'chat'}),a=t.value.map(e=>({name:e.name,content:e.content}));e.extra_world_info=a,replaceVariables(e,{type:'chat'}),(()=>{const e=getVariables({type:'chat'});let t='';for(const a of Array.from(e.extra_world_info))''!==a.name.trim()&&''!==a.content.trim()&&(t+=`<${a.name}>\n`,t+=`${a.content}\n`,t+=`</${a.name}>\n`,t+='\n');e.extra_world_info_prompt=t,replaceVariables(e,{type:'chat'})})()}catch(e){console.error('保存 extra_world_info 失敗:',e)}},d=()=>{try{const e=getVariables({type:'chat'});if(e?.extra_world_info&&Array.isArray(e.extra_world_info)){const a=e.extra_world_info.map((e,t)=>({id:`loaded_${t}_${Date.now()}`,name:e.name||'未命名項目',content:e.content||'',generation_requirement:'',is_open:!1,generated_content:''}));t.value=a}}catch(e){console.error('加載 extra_world_info 失敗:',e)}},u=()=>{o.value=null},v=()=>{r.value=null,o.value=null};(0,n.onMounted)(()=>{d(),p()});const p=()=>{try{const e=localStorage.getItem('extra_tab_generation_requirements');if(e){const a=JSON.parse(e);t.value.forEach(e=>{e.name&&e.name.trim()&&a[e.name.trim()]&&(e.generation_requirement=a[e.name.trim()])})}t.value.forEach(e=>{if(e.name&&e.name.trim()){const t=localStorage.getItem(`extra_item_generated_${e.name.trim()}`);if(t)try{const a=JSON.parse(t);a[e.name.trim()]&&(e.generated_content=a[e.name.trim()])}catch(t){console.error(`Failed to parse generated content for ${e.name}:`,t)}}})}catch(e){console.error('從 localStorage 加載生成要求失敗:',e)}};(0,n.watch)(t,()=>{c(),(()=>{try{const e={};t.value.forEach(t=>{t.name&&t.name.trim()&&(e[t.name.trim()]=t.generation_requirement)}),localStorage.setItem('extra_tab_generation_requirements',JSON.stringify(e))}catch(e){console.error('保存生成要求到 localStorage 失敗:',e)}})()},{deep:!0}),(0,n.watch)(()=>getVariables({type:'chat'}),e=>{e?.extra_world_info&&d()},{deep:!0});const g=e=>{let t='請根據世界背景資訊、生成要求及已有項目資料，為以下項目完善內容設定：\n\n';return t+=`名稱：${e.name||''}\n`,t+=`內容：${e.content||''}\n`,t},h=()=>{const e=getVariables({type:'chat'}).world_info;let t=getCharData('current').description;t=t.replace('{{getvar::world_info}}',e);let a='你是一個專業的項目內容設計助手，擅長創造豐富多彩的項目設定。請根據提供的世界背景及生成要求，為項目完善內容。\n';return a+='\n',a+='<世界背景>\n','你是一個專業的項目內容設計助手，擅長創造豐富多彩的項目設定。請根據提供的世界背景及生成要求，為項目完善內容。\n\n<世界背景>\n'},E=e=>{let t='\n</世界背景>\n';return t+='\n',t+=`${(()=>{const e=getVariables({type:'chat'}).characters.c1,t=`${e.姓氏}${e.名字}`;let a=`<${t}Status>\n`;return a+='id：c1\n',a+=`  姓氏：${e.姓氏||''}\n`,a+=`  名字：${e.名字||''}\n`,a+=`  年齡：${e.年齡||''}\n`,a+=`  性別：${e.性別||''}\n`,a+=`  身份：${e.身份||''}\n`,a+=`  身高：${e.身高||''}\n`,a+=`  體重：${e.體重||''}\n`,a+=`  胸圍：${e.胸圍||''}\n`,a+=`  罩杯：${e.罩杯||''}\n`,a+=`  腰圍：${e.腰圍||''}\n`,a+=`  臀圍：${e.臀圍||''}\n`,a+=`  髮型：${e.髮型||''}\n`,a+=`  樣貌：${e.樣貌||''}\n`,a+=`  衣著：${e.衣著||''}\n`,a+=`  簡介：${e.簡介||''}\n`,a+=`  性格：${e.性格||''}\n`,a+=`  愛好：${e.愛好||''}\n`,a+=`  金錢：${e.金錢||''}\n`,a+=`  生日月份：${e.生日月份||''}\n`,a+=`  生日日期：${e.生日日期||''}\n`,a+=`  其他重要資訊：${e.其他重要資訊||''}\n`,a+=`  關係：${y(e.關係)}\n`,a+=`  友好度：${y(e.友好度)}\n`,a+=`  愛情度：${y(e.愛情度)}\n`,a+=`</${t}Status>`,a})()}\n`,t+='\n',t+=`${(()=>{const e=getVariables({type:'chat'}).characters;if(void 0===e)return'';let t='<CharacterStatus>\n';for(const[a,n]of Object.entries(e))'c1'!==a&&(t+=`id：${a}\n`,t+=`  姓氏：${n.姓氏||''}\n`,t+=`  名字：${n.名字||''}\n`,t+=`  年齡：${n.年齡||''}\n`,t+=`  性別：${n.性別||''}\n`,t+=`  身份：${n.身份||''}\n`,t+=`  身高：${n.身高||''}\n`,t+=`  體重：${n.體重||''}\n`,t+=`  胸圍：${n.胸圍||''}\n`,t+=`  罩杯：${n.罩杯||''}\n`,t+=`  腰圍：${n.腰圍||''}\n`,t+=`  臀圍：${n.臀圍||''}\n`,t+=`  髮型：${n.髮型||''}\n`,t+=`  樣貌：${n.樣貌||''}\n`,t+=`  衣著：${n.衣著||''}\n`,t+=`  簡介：${n.簡介||''}\n`,t+=`  性格：${n.性格||''}\n`,t+=`  愛好：${n.愛好||''}\n`,t+=`  金錢：${n.金錢||''}\n`,t+=`  心情：${n.心情||''}\n`,t+=`  性慾：${n.性慾||''}\n`,t+=`  生日月份：${n.生日月份||''}\n`,t+=`  生日日期：${n.生日日期||''}\n`,t+=`  其他重要資訊：${n.其他重要資訊||''}\n`,t+=`  關係：${y(n.關係)}\n`,t+=`  友好度：${y(n.友好度)}\n`,t+=`  愛情度：${y(n.愛情度)}\n\n`);return t+='</CharacterStatus>',t})()}\n`,t+='\n',t+=`${(()=>{let e='<ItemTable>\n';e+='|id|名稱|描述|價值|\n',e+='|---|---|---|---|\n';const t=getVariables({type:'chat'}).items;if(void 0===t)return'';for(const[a,n]of Object.entries(t))e+=`|${a}|${n.name}|${n.description}|${n.value}|\n`;return e+='</ItemTable>',e})()}\n`,t+='\n',t+=`${(()=>{let e='<LocationTable>\n';e+='|id|地點|位置|描述|子地點|\n',e+='|---|---|---|---|---|\n';const t=getVariables({type:'chat'}).locations;if(void 0===t)return'';for(const[a,n]of Object.entries(t)){const t=n.sub_location?n.sub_location.join(', '):'';e+=`|${a}|${n.name}|${n.location||''}|${n.description}|${t}|\n`}return e+='</LocationTable>',e})()}\n`,t+='\n',t+=`${(()=>{let e='';const t=getVariables({type:'chat'}).extra_world_info;if(void 0===t)return'';for(const a of Array.from(t))''!==a.name&&''!==a.content&&(e+=`<${a.name}>\n`,e+=`${a.content}\n`,e+=`</${a.name}>\n`,e+='\n');return e})()}\n`,t+='\n',t+='<生成要求>\n',t+=`${e.generation_requirement||'無特殊要求'}\n`,t+='</生成要求>\n',t},y=e=>'['+Object.entries(e).map(([e,t])=>'string'==typeof t?`'${e}':'${t}'`:`'${e}':${t}`).join(', ')+']',b=(e,t)=>{t.generated_content=e};return(e,c)=>((0,n.openBlock)(),(0,n.createElementBlock)('div',Ya,[c[5]||(c[5]=(0,n.createElementVNode)('h3',null,'其他設定',-1)),(0,n.createElementVNode)('div',Aa,[(0,n.createElementVNode)('div',Ra,[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(t.value,(e,s)=>((0,n.openBlock)(),(0,n.createElementBlock)(n.Fragment,{key:e.id},[o.value===s&&null!==r.value&&r.value!==s?((0,n.openBlock)(),(0,n.createElementBlock)('div',Ka)):(0,n.createCommentVNode)('v-if',!0),(0,n.createElementVNode)('div',{class:(0,n.normalizeClass)(['sortable-item',{dragging:r.value===s}]),'data-id':e.id,draggable:'true',onDragstart:e=>((e,t)=>{r.value=t,e.dataTransfer&&(e.dataTransfer.effectAllowed='move')})(e,s),onDragover:(0,n.withModifiers)(e=>((e,t)=>{e.preventDefault(),e.dataTransfer&&(e.dataTransfer.dropEffect='move');const a=e.target.getBoundingClientRect(),n=e.clientY-a.top,l=a.height;o.value=n<l/2?t:t+1})(e,s),['prevent']),onDrop:e=>((e,a)=>{e.preventDefault();const n=r.value;if(null!==n&&n!==a){const e=[...t.value],[l]=e.splice(n,1);e.splice(a,0,l),t.value=e}r.value=null})(e,s),onDragend:v,onDragleave:u},[(0,n.createVNode)(m,{title:e.name||'未設定','is-open':e.is_open,class:(0,n.normalizeClass)(['draggable-fold-bar',{incomplete:!e.name||!e.content}]),onToggle:e=>(e=>{t.value[e].is_open=!t.value[e].is_open})(s)},{'title-actions':(0,n.withCtx)(()=>[(0,n.createElementVNode)('button',{class:'remove-btn',title:'移除此項目',onClick:(0,n.withModifiers)(e=>(e=>{t.value.splice(e,1)})(s),['stop'])},[...c[0]||(c[0]=[(0,n.createElementVNode)('span',null,'×',-1)])],8,za)]),default:(0,n.withCtx)(()=>[(0,n.createElementVNode)('div',La,[(0,n.createElementVNode)('div',Fa,[c[1]||(c[1]=(0,n.createElementVNode)('label',null,'名稱',-1)),(0,n.withDirectives)((0,n.createElementVNode)('input',{'onUpdate:modelValue':t=>e.name=t,type:'text',class:'form-input',placeholder:'輸入項目名稱'},null,8,Ha),[[n.vModelText,e.name]])]),(0,n.createElementVNode)('div',ja,[c[2]||(c[2]=(0,n.createElementVNode)('label',null,'內容',-1)),(0,n.withDirectives)((0,n.createElementVNode)('textarea',{'onUpdate:modelValue':t=>e.content=t,class:'form-textarea',placeholder:'輸入項目內容',rows:'3'},null,8,Pa),[[n.vModelText,e.content]])]),(0,n.createElementVNode)('div',qa,[c[3]||(c[3]=(0,n.createElementVNode)('label',null,'生成要求',-1)),(0,n.withDirectives)((0,n.createElementVNode)('textarea',{'onUpdate:modelValue':t=>e.generation_requirement=t,class:'form-textarea',placeholder:'輸入生成此項目的要求',rows:'2'},null,8,Ga),[[n.vModelText,e.generation_requirement]])]),e.generated_content?((0,n.openBlock)(),(0,n.createElementBlock)('div',Wa,[c[4]||(c[4]=(0,n.createElementVNode)('label',null,'生成結果：',-1)),(0,n.createElementVNode)('div',Xa,(0,n.toDisplayString)(e.generated_content),1),(0,n.createElementVNode)('button',{class:'replace-btn',onClick:e=>i(s)},'使用',8,Za)])):(0,n.createCommentVNode)('v-if',!0),(0,n.createElementVNode)('div',Ja,[(0,n.createElementVNode)('button',{class:'action-btn generate',disabled:!(0,n.unref)(l)||a.value.get(e.id),onClick:e=>(async e=>{const n=t.value[e];if(n){a.value.set(n.id,!0);try{const a=g(n),l=h(),r=E(n),o=await generateRaw({user_input:a,ordered_prompts:[{role:'system',content:l},'char_description',{role:'system',content:r},'user_input']});b(o,n);try{if(n.name&&n.name.trim()){const e={};e[n.name.trim()]=n.generated_content||'',localStorage.setItem(`extra_item_generated_${n.name.trim()}`,JSON.stringify(e))}}catch(e){console.error(`Failed to save generated extra item for ${n.name} to localStorage:`,e)}t.value[e]={...n}}catch(e){console.error(`生成項目 ${n.name} 內容失敗:`,e)}finally{a.value.set(n.id,!1)}}})(s)},[a.value.get(e.id)?((0,n.openBlock)(),(0,n.createElementBlock)('span',en)):(0,n.createCommentVNode)('v-if',!0),(0,n.createTextVNode)(' '+(0,n.toDisplayString)(a.value.get(e.id)?'生成中...':(0,n.unref)(l)?'生成內容':'請先完成世界背景設定'),1)],8,Qa),(0,n.createElementVNode)('button',{class:'action-btn apply',disabled:!e.generated_content,onClick:e=>i(s)},' 應用結果 ',8,tn)])])]),_:2},1032,['title','is-open','class','onToggle'])],42,Ua)],64))),128)),o.value===t.value.length&&null!==r.value?((0,n.openBlock)(),(0,n.createElementBlock)('div',an)):(0,n.createCommentVNode)('v-if',!0)]),(0,n.createElementVNode)('div',{class:'add-item-section'},[(0,n.createElementVNode)('button',{class:'add-btn',onClick:s},'+ 添加新項目')])])]))}}),ln=(0,d.A)(nn,[['__scopeId','data-v-09fb0ec2']]),rn={class:'item-tabs-container'},on=['onClick'],sn={class:'item-info-container'},cn={class:'section'},dn={class:'form-grid'},un={class:'input-group'},mn=['onUpdate:modelValue'],vn={key:0,class:'generated-result'},pn={class:'generated-text'},gn=['onClick'],_n={class:'input-group'},hn=['value','onInput'],En={key:0,class:'generated-result'},yn={class:'generated-text'},bn=['onClick'],Vn={class:'input-group full-width'},Nn=['onUpdate:modelValue'],fn={key:0,class:'generated-result'},kn={class:'generated-text'},wn=['onClick'],Bn={class:'section'},Cn={class:'form-grid'},$n={class:'input-group full-width'},Sn=['onUpdate:modelValue'],xn={class:'action-section'},In=['disabled','onClick'],Dn={key:0,class:'loading-spinner'},Tn=['disabled','onClick'],Mn=(0,n.defineComponent)({__name:'item_tab',setup(e){const t=(e,t)=>{const a=e[t];return a?.toString()||''},a=(0,n.ref)(new Map),l=(0,n.ref)(new Map),r=(0,n.computed)(()=>{try{const e=getVariables({type:'chat'});return!!e?.world_info?.trim()}catch{return!1}}),o=(0,n.computed)(()=>{const e=new Map;for(const[t,n]of a.value)e.set(t,n);return e}),i=(0,n.computed)(()=>Array.from(o.value.entries())),s=e=>e?.name||'未知物品',c=e=>!!(e?.generated_name||e?.generated_description||e?.generated_value),d=e=>!(!e?.name?.trim()||!e?.description?.trim()||null===e?.value),u=e=>{['generated_name','generated_description','generated_value'].forEach(t=>{e[t]||(e[t]='')}),e.generation_requirement||(e.generation_requirement='')},v=e=>{try{const t=getVariables({type:'chat'}),n={...t.items||{}},l=a.value.get(e);if(!l)return;n[e]={name:l.name||'',description:l.description||'',value:l.value},t.items=n,replaceVariables(t,{type:'chat'})}catch(t){console.error(`保存物品 ${e} 資料失敗:`,t)}};(0,n.watch)(()=>getVariables({type:'chat'}),e=>{if(e?.items){const t=new Map;for(const[a,l]of Object.entries(e.items)){const e=(0,n.reactive)(l);u(e),t.set(a,e)}a.value=t}},{deep:!0}),(0,n.watch)(a,()=>{for(const[e]of a.value.entries())v(e)},{deep:!0}),(0,n.watch)(()=>a.value,e=>{for(const[t,a]of e.entries())(0,n.watch)(()=>a.generation_requirement,e=>{try{const a=localStorage.getItem(`item_profile_generated_${t}`),n=a?JSON.parse(a):{};n.generation_requirement=e,localStorage.setItem(`item_profile_generated_${t}`,JSON.stringify(n))}catch(e){console.error(`Failed to save generation_requirement for ${t} to localStorage:`,e)}},{immediate:!1})},{deep:!0,immediate:!0}),(0,n.onMounted)(()=>{(()=>{try{const e=getVariables({type:'chat'});if(e?.items){const t=new Map;for(const[a,l]of Object.entries(e.items)){const e=(0,n.reactive)(l);u(e),t.set(a,e)}a.value=t}else a.value=new Map}catch(e){console.error('載入物品資料失敗:',e),a.value=new Map}try{for(const[e,t]of a.value){const a=localStorage.getItem(`item_profile_generated_${e}`);a&&Object.assign(t,JSON.parse(a))}}catch(e){console.error('Failed to load generated item profiles from localStorage:',e)}})()});const p=(e,t,n)=>{const l=a.value.get(e);if(!l)return;const r={name:{field:'name'},description:{field:'description'},value:{field:'value',parser:e=>parseInt(e)||null}}[t];if(r){const e=r.parser?r.parser(n):n;l[r.field]=e,l[`generated_${t}`]=''}a.value.set(e,{...l}),v(e)},g=e=>'['+Object.entries(e).map(([e,t])=>'string'==typeof t?`'${e}':'${t}'`:`'${e}':${t}`).join(', ')+']',h=()=>{const e=(()=>{const e=Array.from(a.value.keys());let t=1;for(;e.includes(`i${t}`);)t++;return`i${t}`})(),t=(0,n.reactive)({name:'',description:'',value:null,generation_requirement:'',generated_name:'',generated_description:'',generated_value:''});a.value.set(e,t);try{const t=getVariables({type:'chat'}).items||{};t[e]={name:'',description:'',value:null},insertOrAssignVariables({items:t},{type:'chat'})}catch(e){console.error('Failed to add new item to chat variables:',e)}},E=e=>{let t='\n</世界背景>\n';return t+='\n',t+=`${(()=>{const e=getVariables({type:'chat'}).characters.c1,t=`${e.姓氏}${e.名字}`;let a=`<${t}Status>\n`;return a+='id：c1\n',a+=`  姓氏：${e.姓氏||''}\n`,a+=`  名字：${e.名字||''}\n`,a+=`  年齡：${e.年齡||''}\n`,a+=`  性別：${e.性別||''}\n`,a+=`  身份：${e.身份||''}\n`,a+=`  身高：${e.身高||''}\n`,a+=`  體重：${e.體重||''}\n`,a+=`  胸圍：${e.胸圍||''}\n`,a+=`  罩杯：${e.罩杯||''}\n`,a+=`  腰圍：${e.腰圍||''}\n`,a+=`  臀圍：${e.臀圍||''}\n`,a+=`  髮型：${e.髮型||''}\n`,a+=`  樣貌：${e.樣貌||''}\n`,a+=`  衣著：${e.衣著||''}\n`,a+=`  簡介：${e.簡介||''}\n`,a+=`  性格：${e.性格||''}\n`,a+=`  愛好：${e.愛好||''}\n`,a+=`  金錢：${e.金錢||''}\n`,a+=`  生日月份：${e.生日月份||''}\n`,a+=`  生日日期：${e.生日日期||''}\n`,a+=`  其他重要資訊：${e.其他重要資訊||''}\n`,a+=`  關係：${g(e.關係)}\n`,a+=`  友好度：${g(e.友好度)}\n`,a+=`  愛情度：${g(e.愛情度)}\n`,a+=`</${t}Status>`,a})()}\n`,t+='\n',t+=`${(()=>{const e=getVariables({type:'chat'}).characters;if(void 0===e)return'';let t='<CharacterStatus>\n';for(const[a,n]of Object.entries(e))'c1'!==a&&(t+=`id：${a}\n`,t+=`  姓氏：${n.姓氏||''}\n`,t+=`  名字：${n.名字||''}\n`,t+=`  年齡：${n.年齡||''}\n`,t+=`  性別：${n.性別||''}\n`,t+=`  身份：${n.身份||''}\n`,t+=`  身高：${n.身高||''}\n`,t+=`  體重：${n.體重||''}\n`,t+=`  胸圍：${n.胸圍||''}\n`,t+=`  罩杯：${n.罩杯||''}\n`,t+=`  腰圍：${n.腰圍||''}\n`,t+=`  臀圍：${n.臀圍||''}\n`,t+=`  髮型：${n.髮型||''}\n`,t+=`  樣貌：${n.樣貌||''}\n`,t+=`  衣著：${n.衣著||''}\n`,t+=`  簡介：${n.簡介||''}\n`,t+=`  性格：${n.性格||''}\n`,t+=`  愛好：${n.愛好||''}\n`,t+=`  金錢：${n.金錢||''}\n`,t+=`  心情：${n.心情||''}\n`,t+=`  性慾：${n.性慾||''}\n`,t+=`  生日月份：${n.生日月份||''}\n`,t+=`  生日日期：${n.生日日期||''}\n`,t+=`  其他重要資訊：${n.其他重要資訊||''}\n`,t+=`  關係：${g(n.關係)}\n`,t+=`  友好度：${g(n.友好度)}\n`,t+=`  愛情度：${g(n.愛情度)}\n\n`);return t+='</CharacterStatus>',t})()}\n`,t+='\n',t+=`${(()=>{let e='<ItemTable>\n';e+='|id|名稱|描述|價值|\n',e+='|---|---|---|---|\n';const t=getVariables({type:'chat'}).items;if(void 0===t)return'';for(const[a,n]of Object.entries(t))e+=`|${a}|${n.name}|${n.description}|${n.value}|\n`;return e+='</ItemTable>',e})()}\n`,t+='\n',t+=`${(()=>{let e='<LocationTable>\n';e+='|id|地點|位置|描述|子地點|\n',e+='|---|---|---|---|---|\n';const t=getVariables({type:'chat'}).locations;if(void 0===t)return'';for(const[a,n]of Object.entries(t)){const t=n.sub_location?n.sub_location.join(', '):'';e+=`|${a}|${n.name}|${n.location||''}|${n.description}|${t}|\n`}return e+='</LocationTable>',e})()}\n`,t+='\n',t+=`${(()=>{let e='';const t=getVariables({type:'chat'}).extra_world_info;if(void 0===t)return'';for(const a of Array.from(t))''!==a.name&&''!==a.content&&(e+=`<${a.name}>\n`,e+=`${a.content}\n`,e+=`</${a.name}>\n`,e+='\n');return e})()}\n`,t+='\n',t+='<生成要求>\n',t+=`${e.generation_requirement||'無特殊要求'}\n`,t+='</生成要求>\n',t+='\n',t+='<example>\n',t+='# The following is an example of user input and expected output. Please strictly follow the style and format to generate the output. Output anything other than this format is prohibited.\n',t+='名稱：string\n',t+='描述：\'以第三人稱客觀地描述\'\n',t+='價值：number\n',t+='</example>\n',t},y=async e=>{const t=a.value.get(e);if(!t)return;const n=new Map(l.value);n.set(e,!0),l.value=n;try{const n=(e=>{let t='請根據世界背景資訊、生成要求及已有物品資料，為以下物品完善物品資料設定：\n\n';return t+=`名稱：${e.name||''}\n`,t+=`描述：${e.description||''}\n`,t+=`價值：${e.value||''}\n`,t})(t),l=(()=>{const e=getVariables({type:'chat'}).world_info;let t=getCharData('current').description;t=t.replace('{{getvar::world_info}}',e);let a='你是一個專業的物品設計助手，擅長創造豐富多彩的物品設定。請根據提供的世界背景及生成要求，為物品完善資料。\n';return a+='\n',a+='<世界背景>\n','你是一個專業的物品設計助手，擅長創造豐富多彩的物品設定。請根據提供的世界背景及生成要求，為物品完善資料。\n\n<世界背景>\n'})(),r=E(t);((e,t)=>{const a=e.split('\n');for(const e of a){const a=e.indexOf('：');if(a>0){const n=e.substring(0,a).trim(),l=e.substring(a+1).trim();switch(n){case'名稱':t.generated_name=l.replace(/^["']|["']$/g,'');break;case'描述':t.generated_description=l.replace(/^["']|["']$/g,'');break;case'價值':t.generated_value=l.replace(/[^\d]/g,'')}}}})(await generateRaw({user_input:n,ordered_prompts:[{role:'system',content:l},'char_description',{role:'system',content:r},'user_input']}),t);try{localStorage.setItem(`item_profile_generated_${e}`,JSON.stringify({generation_requirement:t.generation_requirement,generated_name:t.generated_name,generated_description:t.generated_description,generated_value:t.generated_value}))}catch(t){console.error(`Failed to save generated item profile for ${e} to localStorage:`,t)}a.value.set(e,{...t})}catch(a){console.error(`生成物品 ${e} 資料失敗:`,a),t.generated_name='生成失敗，請重試。'}finally{const t=new Map(l.value);t.set(e,!1),l.value=t}};return(e,o)=>((0,n.openBlock)(),(0,n.createElementBlock)('div',rn,[o[11]||(o[11]=(0,n.createElementVNode)('h3',null,'物品資料設定',-1)),(0,n.createCommentVNode)(' 其他物品動態摺疊欄 '),((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(i.value,([e,i])=>((0,n.openBlock)(),(0,n.createElementBlock)('div',{key:e,class:(0,n.normalizeClass)(['item-fold-bar',{'item-incomplete':!d(i)}])},[(0,n.createVNode)(m,{title:`${e}: ${s(i)}`,'is-open':!1},{'title-actions':(0,n.withCtx)(()=>[(0,n.createElementVNode)('button',{class:'remove-item-btn',title:'移除物品',onClick:t=>(e=>{a.value.delete(e);try{const t=getVariables({type:'chat'});delete t.items[e],replaceVariables(t,{type:'chat'})}catch(t){console.error(`Failed to remove item ${e} from chat variables:`,t)}})(e)},[...o[0]||(o[0]=[(0,n.createElementVNode)('span',null,'×',-1)])],8,on)]),default:(0,n.withCtx)(()=>[(0,n.createElementVNode)('div',sn,[(0,n.createElementVNode)('div',cn,[o[7]||(o[7]=(0,n.createElementVNode)('h4',null,'基本資訊',-1)),(0,n.createElementVNode)('div',dn,[(0,n.createElementVNode)('div',un,[o[2]||(o[2]=(0,n.createElementVNode)('label',null,'名稱',-1)),(0,n.withDirectives)((0,n.createElementVNode)('input',{'onUpdate:modelValue':e=>i.name=e,type:'text',placeholder:'例如：魔法書',class:'text-input'},null,8,mn),[[n.vModelText,i.name]]),i.generated_name?((0,n.openBlock)(),(0,n.createElementBlock)('div',vn,[o[1]||(o[1]=(0,n.createElementVNode)('label',null,'生成結果：',-1)),(0,n.createElementVNode)('div',pn,(0,n.toDisplayString)(i.generated_name),1),(0,n.createElementVNode)('button',{class:'replace-btn',onClick:t=>p(e,'name',i.generated_name)},' 使用 ',8,gn)])):(0,n.createCommentVNode)('v-if',!0)]),(0,n.createElementVNode)('div',_n,[o[4]||(o[4]=(0,n.createElementVNode)('label',null,'價值',-1)),(0,n.createElementVNode)('input',{value:t(i,'value'),type:'number',placeholder:'例如：100',class:'text-input',min:'0',onInput:e=>((e,t,a)=>{if(''===a||''===a.trim())e[t]=null;else{const n=parseInt(a);e[t]=isNaN(n)?null:n}})(i,'value',e.target.value)},null,40,hn),i.generated_value?((0,n.openBlock)(),(0,n.createElementBlock)('div',En,[o[3]||(o[3]=(0,n.createElementVNode)('label',null,'生成結果：',-1)),(0,n.createElementVNode)('div',yn,(0,n.toDisplayString)(i.generated_value),1),(0,n.createElementVNode)('button',{class:'replace-btn',onClick:t=>p(e,'value',i.generated_value)},' 使用 ',8,bn)])):(0,n.createCommentVNode)('v-if',!0)]),(0,n.createElementVNode)('div',Vn,[o[6]||(o[6]=(0,n.createElementVNode)('label',null,'描述',-1)),(0,n.withDirectives)((0,n.createElementVNode)('textarea',{'onUpdate:modelValue':e=>i.description=e,placeholder:'描述物品的特點...',class:'text-area',rows:'3'},null,8,Nn),[[n.vModelText,i.description]]),i.generated_description?((0,n.openBlock)(),(0,n.createElementBlock)('div',fn,[o[5]||(o[5]=(0,n.createElementVNode)('label',null,'生成結果：',-1)),(0,n.createElementVNode)('div',kn,(0,n.toDisplayString)(i.generated_description),1),(0,n.createElementVNode)('button',{class:'replace-btn',onClick:t=>p(e,'description',i.generated_description)},' 使用 ',8,wn)])):(0,n.createCommentVNode)('v-if',!0)])])]),(0,n.createCommentVNode)(' 生成要求區域 '),(0,n.createElementVNode)('div',Bn,[o[9]||(o[9]=(0,n.createElementVNode)('h4',null,'生成要求',-1)),(0,n.createElementVNode)('div',Cn,[(0,n.createElementVNode)('div',$n,[o[8]||(o[8]=(0,n.createElementVNode)('label',null,'對AI生成的要求',-1)),(0,n.withDirectives)((0,n.createElementVNode)('textarea',{'onUpdate:modelValue':e=>i.generation_requirement=e,placeholder:'對AI生成的要求...',class:'text-area',rows:'3'},null,8,Sn),[[n.vModelText,i.generation_requirement]])])])]),(0,n.createCommentVNode)(' 生成按鈕區域 '),(0,n.createElementVNode)('div',xn,[(0,n.createElementVNode)('button',{class:'generate-btn',disabled:!r.value||l.value.get(e),onClick:t=>y(e)},[l.value.get(e)?((0,n.openBlock)(),(0,n.createElementBlock)('span',Dn)):(0,n.createCommentVNode)('v-if',!0),(0,n.createTextVNode)(' '+(0,n.toDisplayString)(l.value.get(e)?'生成中...':r.value?'生成未填寫的字段':'請先完成世界背景設定'),1)],8,In),(0,n.createElementVNode)('button',{class:'apply-all-btn',disabled:!c(i),onClick:t=>(e=>{const t=a.value.get(e);if(!t)return;[{generated:'generated_name',field:'name',parser:e=>e},{generated:'generated_description',field:'description',parser:e=>e},{generated:'generated_value',field:'value',parser:e=>parseInt(e)||null}].forEach(({generated:e,field:a,parser:n})=>{const l=t[e];l&&(t[a]=n(l),t[e]='')}),a.value.set(e,{...t}),v(e);try{localStorage.removeItem(`item_profile_generated_${e}`)}catch(t){console.error(`Failed to remove generated item profile for ${e} from localStorage:`,t)}})(e)},' 應用全部 ',8,Tn)])])]),_:2},1032,['title'])],2))),128)),(0,n.createCommentVNode)(' 添加物品按鈕 '),(0,n.createElementVNode)('div',{class:'add-item-section'},[(0,n.createElementVNode)('button',{class:'add-item-btn',onClick:h},[...o[10]||(o[10]=[(0,n.createElementVNode)('span',null,'+ 添加物品',-1)])])])]))}}),On=(0,d.A)(Mn,[['__scopeId','data-v-d8256cea']]),Yn={class:'location-tabs-container'},An=['onClick'],Rn={class:'location-info-container'},Kn={class:'section'},Un={class:'form-grid'},zn={class:'input-group'},Ln=['onUpdate:modelValue'],Fn={key:0,class:'generated-result'},Hn={class:'generated-text'},jn=['onClick'],Pn={class:'input-group'},qn=['onUpdate:modelValue'],Gn={key:0,class:'generated-result'},Wn={class:'generated-text'},Xn=['onClick'],Zn={class:'input-group full-width'},Jn=['onUpdate:modelValue'],Qn={key:0,class:'generated-result'},el={class:'generated-text'},tl=['onClick'],al={class:'input-group full-width'},nl={key:0,class:'generated-result'},ll={class:'generated-text'},rl=['onClick'],ol={class:'input-group full-width'},il={class:'sub-locations-container'},sl=['value','onChange'],cl=['value','disabled'],dl=['onClick'],ul=['onClick'],ml={class:'section'},vl={class:'form-grid'},pl={class:'input-group full-width'},gl=['onUpdate:modelValue'],_l={class:'action-section'},hl=['disabled','onClick'],El={key:0,class:'loading-spinner'},yl=['disabled','onClick'],bl={class:'bulk-generate-section'},Vl={class:'form-grid'},Nl={class:'input-group'},fl={class:'count-input-row'},kl=['disabled'],wl={class:'ai-count-checkbox'},Bl={class:'input-group full-width'},Cl=['disabled'],$l={key:0,class:'loading-spinner'},Sl=(0,n.defineComponent)({__name:'location_tab',setup(e){const t=(0,n.ref)(new Map),a=(0,n.ref)(new Map),l=(0,n.ref)(!1),r=(0,n.ref)(3),o=(0,n.ref)(''),i=(0,n.ref)(!1),s=['generated_name','generated_location','generated_description'],c=['generated_name','generated_location','generated_description','generated_sub_location'],d=(0,n.computed)(()=>{try{const e=getVariables({type:'chat'});return!!e?.world_info?.trim()}catch{return!1}}),u=(0,n.computed)(()=>Array.from(t.value.entries())),v=e=>e?.name||'未知地點',p=e=>!!(e?.generated_name||e?.generated_location||e?.generated_description||e?.generated_sub_location),g=e=>!!(e?.name?.trim()&&e?.location?.trim()&&e?.description?.trim()),h=e=>{s.forEach(t=>{e[t]||(e[t]='')}),e.generated_sub_location||(e.generated_sub_location=[]),e.sub_location||(e.sub_location=[]),e.location||(e.location=''),e.generated_location||(e.generated_location=''),e.generation_requirement||(e.generation_requirement='')},E=e=>{try{const a=getVariables({type:'chat'}),n={...a.locations||{}},l=t.value.get(e);if(!l)return;n[e]={name:l.name||'',location:l.location||'',description:l.description||'',sub_location:l.sub_location||[]},a.locations=n,replaceVariables(a,{type:'chat'})}catch(t){console.error(`保存地點 ${e} 資料失敗:`,t)}};(0,n.watch)(()=>getVariables({type:'chat'}),e=>{if(e?.locations){const a=new Map;for(const[t,l]of Object.entries(e.locations)){const e=(0,n.reactive)(l);h(e),a.set(t,e)}t.value=a}},{deep:!0}),(0,n.watch)(t,()=>{for(const[e]of t.value.entries())E(e)},{deep:!0}),(0,n.watch)(()=>t.value,e=>{for(const[t,a]of e.entries())(0,n.watch)(()=>a.generation_requirement,e=>{try{const a=localStorage.getItem(`location_profile_generated_${t}`),n=a?JSON.parse(a):{};n.generation_requirement=e,localStorage.setItem(`location_profile_generated_${t}`,JSON.stringify(n))}catch(e){console.error(`Failed to save generation_requirement for ${t} to localStorage:`,e)}},{immediate:!1})},{deep:!0,immediate:!0}),(0,n.onMounted)(()=>{(()=>{try{const e=getVariables({type:'chat'});if(e?.locations){const a=new Map;for(const[t,l]of Object.entries(e.locations)){const e=(0,n.reactive)(l);h(e),a.set(t,e)}t.value=a}else t.value=new Map}catch(e){console.error('載入地點資料失敗:',e),t.value=new Map}try{for(const[e,a]of t.value){const t=localStorage.getItem(`location_profile_generated_${e}`);t&&Object.assign(a,JSON.parse(t))}}catch(e){console.error('Failed to load generated location profiles from localStorage:',e)}try{const e=localStorage.getItem('bulk_location_generation_requirement');e&&(o.value=e);const t=localStorage.getItem('bulk_location_allow_ai_count');t&&(i.value='true'===t)}catch(e){console.error('Failed to load bulk generation settings from localStorage:',e)}})()});const y=()=>{const e=Array.from(t.value.keys());let a=1;for(;e.includes(`l${a}`);)a++;return`l${a}`},b=(e,a,n)=>{const l=t.value.get(e);if(!l)return;const r={name:{field:'name'},location:{field:'location'},description:{field:'description'},sub_location:{field:'sub_location',parser:e=>e}}[a];if(r){const e=r.parser?r.parser(n):n;l[r.field]=e,l[`generated_${a}`]=''}t.value.set(e,{...l}),E(e)},V=()=>{const e=y(),a=(0,n.reactive)({name:'',location:'',description:'',sub_location:[],generation_requirement:'',generated_name:'',generated_location:'',generated_description:'',generated_sub_location:[]});t.value.set(e,a);try{const t=getVariables({type:'chat'}).locations||{};t[e]={name:'',location:'',description:'',sub_location:[]},insertOrAssignVariables({locations:t},{type:'chat'})}catch(e){console.error('Failed to add new location to chat variables:',e)}},N=()=>{const e=getVariables({type:'chat'}).world_info;let t=getCharData('current').description;t=t.replace('{{getvar::world_info}}',e);let a='你是一個專業的地點設計助手，擅長創造豐富多彩的地點設定。請根據提供的世界背景及生成要求，為地點完善資料。\n';return a+='\n',a+='<世界背景>\n','你是一個專業的地點設計助手，擅長創造豐富多彩的地點設定。請根據提供的世界背景及生成要求，為地點完善資料。\n\n<世界背景>\n'},f=['姓氏','名字','年齡','性別','身份','身高','體重','胸圍','罩杯','腰圍','臀圍','髮型','樣貌','衣著','簡介','性格','愛好','金錢','生日月份','生日日期','其他重要資訊'],k=['關係','友好度','愛情度'],w=(e,t,a=!1)=>{let n=`id：${t}\n`;return f.forEach(t=>{n+=`  ${t}：${e[t]||''}\n`}),a&&(n+=`  心情：${e.心情||''}\n`,n+=`  性慾：${e.性慾||''}\n`),k.forEach(t=>{var a;n+=`  ${t}：${a=e[t],'['+Object.entries(a).map(([e,t])=>'string'==typeof t?`'${e}':'${t}'`:`'${e}':${t}`).join(', ')+']'}\n`}),n},B=()=>{const e=getVariables({type:'chat'}).characters.c1,t=`${e.姓氏}${e.名字}`;let a=`<${t}Status>\n`;return a+=w(e,'c1'),a+=`</${t}Status>`,a},C=()=>{const e=getVariables({type:'chat'}).characters;if(void 0===e)return'';let t='<CharacterStatus>\n';for(const[a,n]of Object.entries(e))'c1'!==a&&(t+=w(n,a,!0)+'\n');return t+='</CharacterStatus>',t},S=()=>{let e='<LocationTable>\n';e+='|id|地點|位置|描述|子地點|\n',e+='|---|---|---|---|---|\n';const t=getVariables({type:'chat'}).locations;if(void 0===t)return'';for(const[a,n]of Object.entries(t)){const t=n.sub_location?n.sub_location.join(', '):'';e+=`|${a}|${n.name}|${n.location||''}|${n.description}|${t}|\n`}return e+='</LocationTable>',e},x=()=>{let e='';const t=getVariables({type:'chat'}).extra_world_info;if(void 0===t)return'';for(const a of Array.from(t))''!==a.name&&''!==a.content&&(e+=`<${a.name}>\n`,e+=`${a.content}\n`,e+=`</${a.name}>\n`,e+='\n');return e},I={id:{field:'id',parser:e=>e.replace(/^["']|["']$/g,'')},地點:{field:'name',parser:e=>e.replace(/^["']|["']$/g,'')},位置:{field:'location',parser:e=>e.replace(/^["']|["']$/g,'')},描述:{field:'description',parser:e=>e.replace(/^["']|["']$/g,'')},子地點:{field:'sub_location',parser:e=>{try{let t=e;t.startsWith('\'')&&t.endsWith('\'')&&(t=t.slice(1,-1)),t=t.replace(/'/g,'"');const a=JSON.parse(t);return Array.isArray(a)?a:[]}catch(t){return console.warn('Failed to parse sub_location:',e,t),[]}}}},D=(e,t,a=!1)=>{const n=e.indexOf('：');if(n<=0)return;const l=e.substring(0,n).trim(),r=e.substring(n+1).trim(),o=I[l];if(o){t[a?`generated_${o.field}`:o.field]=o.parser(r)}},T=async e=>{const n=t.value.get(e);if(!n)return;const l=new Map(a.value);l.set(e,!0),a.value=l;try{const a=(e=>{let t='請根據世界背景資訊、生成要求及已有地點資料，為以下地點完善地點資料設定：\n\n';return t+=`id：${e.id||''}\n`,t+=`地點：${e.name||''}\n`,t+=`位置：${e.location||''}\n`,t+=`描述：${e.description||''}\n`,t+=`子地點：${e.sub_location&&e.sub_location.length>0?JSON.stringify(e.sub_location):'[]'}\n`,t+='\n請生成一個唯一的地點ID，格式必須是 "l1", "l2", "l3", ... 且不能與現有地點ID重複。\n',t})(n),l=N(),r=(e=>{let t='\n</世界背景>\n';return t+='\n',t+=`${B()}\n`,t+='\n',t+=`${C()}\n`,t+='\n',t+=`${S()}\n`,t+='\n',t+=`${x()}\n`,t+='\n',t+='<生成要求>\n',t+=`${e.generation_requirement||'無特殊要求'}\n`,t+='</生成要求>\n',t+='\n',t+='<子地點說明>\n',t+='子地點表示直接包含在當前地點內的子區域。例如：\n',t+='- 如果地點 l2 位於地點 l1 內，則 l2 是 l1 的子地點\n',t+='- 如果地點 l3 是 l2 的子地點，則 l3 不是 l1 的子地點（因為 l3 間接位於 l1 內）\n',t+='- 子地點id必須是現有的地點id，不能使用不存在的id\n',t+='</子地點說明>\n',t+='\n',t+='<example>\n',t+='# The following is an example of user input and expected output. Please strictly follow the style and format to generate the output. Output anything other than this format is prohibited.\n',t+='id：l1\n',t+='地點：\'地點名稱\'\n',t+='位置：\'地點的地理位置\'\n',t+='描述：\'以第三人稱客觀地描述\'\n',t+='子地點：[\'l2\', \'l4\']\n',t+='</example>\n',t})(n);((e,t)=>{e.split('\n').forEach(e=>D(e,t,!0))})(await generateRaw({user_input:a,ordered_prompts:[{role:'system',content:l},'char_description',{role:'system',content:r},'user_input']}),n);try{localStorage.setItem(`location_profile_generated_${e}`,JSON.stringify({generation_requirement:n.generation_requirement,generated_name:n.generated_name,generated_location:n.generated_location,generated_description:n.generated_description,generated_sub_location:n.generated_sub_location}))}catch(t){console.error(`Failed to save generated location profile for ${e} to localStorage:`,t)}t.value.set(e,{...n})}catch(t){console.error(`生成地點 ${e} 資料失敗:`,t),n.generated_name='生成失敗，請重試。'}finally{const t=new Map(a.value);t.set(e,!1),a.value=t}},M=async()=>{if(i.value||!(r.value<1||r.value>10)){l.value=!0;try{try{localStorage.setItem('bulk_location_generation_requirement',o.value),localStorage.setItem('bulk_location_allow_ai_count',i.value.toString())}catch(e){console.error('Failed to save bulk generation settings to localStorage:',e)}const e=`請根據世界背景資訊和批量生成要求，${i.value?'請根據世界背景和生成要求自行決定生成適當數量的地點':`請一次性生成 ${r.value} 個地點`}。每個地點應包含地點名稱、位置、描述和子地點數組。\n\n批量生成要求：${o.value||'無特殊要求'}\n\n請以以下格式輸出，每個地點占一行：\nid：l1\n地點：地點名稱\n位置：地點的地理位置\n描述：地點描述\n子地點：['子地點id1', '子地點id2', ...]\n\n---\n\n請注意：\n- id格式必須是 "l1", "l2", "l3", ... 且不能與現有地點id重複\n- 子地點ID必須是現有的地點id，不能使用不存在的id\n`,a=N(),l=(()=>{let e='\n</世界背景>\n';return e+='\n',e+=`${B()}\n`,e+='\n',e+=`${C()}\n`,e+='\n',e+=`${S()}\n`,e+='\n',e+=`${x()}\n`,e+='\n',e+='<子地點說明>\n',e+='子地點表示直接包含在當前地點內的子區域。例如：\n',e+='- 如果地點 l2 位於地點 l1 內，則 l2 是 l1 的子地點\n',e+='- 如果地點 l3 是 l2 的子地點，則 l3 不是 l1 的子地點（因為 l3 間接位於 l1 內）\n',e+='- 子地點id必須是現有的地點id，不能使用不存在的id\n',e+='</子地點說明>\n',e+='\n',i.value&&(e+='<生成數量說明>\n',e+='請根據世界背景和生成要求決定生成適當數量的地點。\n',e+='請根據世界背景的複雜度和生成要求的具體性來決定數量。\n',e+='</生成數量說明>\n',e+='\n'),e+='<example>\n',e+='# The following is an example of user input and expected output. Please strictly follow the style and format to generate the output. Output anything other than this format is prohibited.\n',e+='id：l1\n',e+='地點：\'地點名稱\'\n',e+='位置：\'地點的地理位置\'\n',e+='描述：\'以第三人稱客觀地描述\'\n',e+='子地點：[\'id\', ...]\n',e+='\n---\n',e+='id：l2\n',e+='地點：\'地點名稱\'\n',e+='位置：\'地點的地理位置\'\n',e+='描述：\'以第三人稱客觀地描述\'\n',e+='子地點：[\'id\', ...]\n',e+='</example>\n',e})(),s=(e=>{const t=[],a=e.split('---').map(e=>e.trim()).filter(e=>e);for(const e of a){const a=e.split('\n'),n={id:'',name:'',location:'',description:'',sub_location:[]};a.forEach(e=>D(e,n)),n.name&&n.name.trim()&&t.push(n)}return t})(await generateRaw({user_input:e,ordered_prompts:[{role:'system',content:a},'char_description',{role:'system',content:l},'user_input']}));for(const e of s){const a=e.id||y(),l={id:a,name:e.name||'',location:e.location||'',description:e.description||'',sub_location:e.sub_location||[],generation_requirement:o.value,generated_name:'',generated_location:'',generated_description:'',generated_sub_location:[]},r=(0,n.reactive)(l);t.value.set(a,r);try{const e=getVariables({type:'chat'}).locations||{};e[a]={name:l.name,location:l.location,description:l.description,sub_location:l.sub_location},insertOrAssignVariables({locations:e},{type:'chat'})}catch(e){console.error('Failed to add bulk generated location to chat variables:',e)}}toastr.success(`成功生成 ${s.length} 個地點！`)}catch(e){console.error('批量生成地點失敗:',e),toastr.error('批量生成失敗，請重試。')}finally{l.value=!1}}};return(e,s)=>((0,n.openBlock)(),(0,n.createElementBlock)('div',Yn,[s[24]||(s[24]=(0,n.createElementVNode)('h3',null,'地點資料設定',-1)),(0,n.createCommentVNode)(' 其他地點動態摺疊欄 '),((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(u.value,([e,l])=>((0,n.openBlock)(),(0,n.createElementBlock)('div',{key:e,class:(0,n.normalizeClass)(['location-fold-bar',{'location-incomplete':!g(l)}])},[(0,n.createVNode)(m,{title:`${e}: ${v(l)}`,'is-open':!1},{'title-actions':(0,n.withCtx)(()=>[(0,n.createElementVNode)('button',{class:'remove-location-btn',title:'移除地點',onClick:a=>(e=>{t.value.delete(e);try{const t=getVariables({type:'chat'});delete t.locations[e],replaceVariables(t,{type:'chat'})}catch(t){console.error(`Failed to remove location ${e} from chat variables:`,t)}})(e)},[...s[3]||(s[3]=[(0,n.createElementVNode)('span',null,'×',-1)])],8,An)]),default:(0,n.withCtx)(()=>[(0,n.createElementVNode)('div',Rn,[(0,n.createElementVNode)('div',Kn,[s[16]||(s[16]=(0,n.createElementVNode)('h4',null,'基本資訊',-1)),(0,n.createElementVNode)('div',Un,[(0,n.createElementVNode)('div',zn,[s[5]||(s[5]=(0,n.createElementVNode)('label',null,'地點',-1)),(0,n.withDirectives)((0,n.createElementVNode)('input',{'onUpdate:modelValue':e=>l.name=e,type:'text',placeholder:'例如：魔法森林',class:'text-input'},null,8,Ln),[[n.vModelText,l.name]]),l.generated_name?((0,n.openBlock)(),(0,n.createElementBlock)('div',Fn,[s[4]||(s[4]=(0,n.createElementVNode)('label',null,'生成結果：',-1)),(0,n.createElementVNode)('div',Hn,(0,n.toDisplayString)(l.generated_name),1),(0,n.createElementVNode)('button',{class:'replace-btn',onClick:t=>b(e,'name',l.generated_name)},' 使用 ',8,jn)])):(0,n.createCommentVNode)('v-if',!0)]),(0,n.createElementVNode)('div',Pn,[s[7]||(s[7]=(0,n.createElementVNode)('label',null,'位置',-1)),(0,n.withDirectives)((0,n.createElementVNode)('input',{'onUpdate:modelValue':e=>l.location=e,type:'text',placeholder:'例如：森林深處',class:'text-input'},null,8,qn),[[n.vModelText,l.location]]),l.generated_location?((0,n.openBlock)(),(0,n.createElementBlock)('div',Gn,[s[6]||(s[6]=(0,n.createElementVNode)('label',null,'生成結果：',-1)),(0,n.createElementVNode)('div',Wn,(0,n.toDisplayString)(l.generated_location),1),(0,n.createElementVNode)('button',{class:'replace-btn',onClick:t=>b(e,'location',l.generated_location)},' 使用 ',8,Xn)])):(0,n.createCommentVNode)('v-if',!0)]),(0,n.createElementVNode)('div',Zn,[s[9]||(s[9]=(0,n.createElementVNode)('label',null,'描述',-1)),(0,n.withDirectives)((0,n.createElementVNode)('textarea',{'onUpdate:modelValue':e=>l.description=e,placeholder:'描述地點的特點...',class:'text-area',rows:'3'},null,8,Jn),[[n.vModelText,l.description]]),l.generated_description?((0,n.openBlock)(),(0,n.createElementBlock)('div',Qn,[s[8]||(s[8]=(0,n.createElementVNode)('label',null,'生成結果：',-1)),(0,n.createElementVNode)('div',el,(0,n.toDisplayString)(l.generated_description),1),(0,n.createElementVNode)('button',{class:'replace-btn',onClick:t=>b(e,'description',l.generated_description)},' 使用 ',8,tl)])):(0,n.createCommentVNode)('v-if',!0)]),(0,n.createElementVNode)('div',al,[s[11]||(s[11]=(0,n.createElementVNode)('label',null,'子地點生成結果',-1)),l.generated_sub_location&&l.generated_sub_location.length>0?((0,n.openBlock)(),(0,n.createElementBlock)('div',nl,[s[10]||(s[10]=(0,n.createElementVNode)('label',null,'生成結果：',-1)),(0,n.createElementVNode)('div',ll,(0,n.toDisplayString)(l.generated_sub_location.join(', ')),1),(0,n.createElementVNode)('button',{class:'replace-btn',onClick:t=>b(e,'sub_location',l.generated_sub_location)},' 使用 ',8,rl)])):(0,n.createCommentVNode)('v-if',!0)]),(0,n.createElementVNode)('div',ol,[s[15]||(s[15]=(0,n.createElementVNode)('label',null,'子地點',-1)),(0,n.createElementVNode)('div',il,[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(l.sub_location||[],(a,l)=>((0,n.openBlock)(),(0,n.createElementBlock)('div',{key:l,class:'sub-location-item'},[(0,n.createElementVNode)('select',{value:a,class:'text-input',onChange:a=>((e,a,n)=>{const l=t.value.get(e);l&&l.sub_location&&(l.sub_location[a]=n,t.value.set(e,{...l}),E(e))})(e,l,a.target.value)},[s[12]||(s[12]=(0,n.createElementVNode)('option',{value:''},'選擇子地點...',-1)),((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(t.value,([t,a])=>((0,n.openBlock)(),(0,n.createElementBlock)('option',{key:t,value:t,disabled:t===e},(0,n.toDisplayString)(t)+': '+(0,n.toDisplayString)(v(a)),9,cl))),128))],40,sl),(0,n.createElementVNode)('button',{class:'remove-sub-location-btn',onClick:a=>((e,a)=>{const n=t.value.get(e);n&&n.sub_location&&(n.sub_location.splice(a,1),t.value.set(e,{...n}),E(e))})(e,l)},[...s[13]||(s[13]=[(0,n.createElementVNode)('span',null,'×',-1)])],8,dl)]))),128)),(0,n.createElementVNode)('button',{class:'add-sub-location-btn',onClick:a=>(e=>{const a=t.value.get(e);a&&(a.sub_location||(a.sub_location=[]),a.sub_location.push(''),t.value.set(e,{...a}),E(e))})(e)},[...s[14]||(s[14]=[(0,n.createElementVNode)('span',null,'+ 添加子地點',-1)])],8,ul)])])])]),(0,n.createCommentVNode)(' 生成要求區域 '),(0,n.createElementVNode)('div',ml,[s[18]||(s[18]=(0,n.createElementVNode)('h4',null,'生成要求',-1)),(0,n.createElementVNode)('div',vl,[(0,n.createElementVNode)('div',pl,[s[17]||(s[17]=(0,n.createElementVNode)('label',null,'對AI生成的要求',-1)),(0,n.withDirectives)((0,n.createElementVNode)('textarea',{'onUpdate:modelValue':e=>l.generation_requirement=e,placeholder:'對AI生成的要求...',class:'text-area',rows:'3'},null,8,gl),[[n.vModelText,l.generation_requirement]])])])]),(0,n.createCommentVNode)(' 生成按鈕區域 '),(0,n.createElementVNode)('div',_l,[(0,n.createElementVNode)('button',{class:'generate-btn',disabled:!d.value||a.value.get(e),onClick:t=>T(e)},[a.value.get(e)?((0,n.openBlock)(),(0,n.createElementBlock)('span',El)):(0,n.createCommentVNode)('v-if',!0),(0,n.createTextVNode)(' '+(0,n.toDisplayString)(a.value.get(e)?'生成中...':d.value?'生成未填寫的字段':'請先完成世界背景設定'),1)],8,hl),(0,n.createElementVNode)('button',{class:'apply-all-btn',disabled:!p(l),onClick:a=>(e=>{const a=t.value.get(e);if(a){c.forEach(e=>{const t=e,n=e.replace('generated_',''),l=a[t];l&&(a[n]=l,a[t]='generated_sub_location'===e?[]:'')}),t.value.set(e,{...a}),E(e);try{localStorage.removeItem(`location_profile_generated_${e}`)}catch(t){console.error(`Failed to remove generated location profile for ${e} from localStorage:`,t)}}})(e)},' 應用全部 ',8,yl)])])]),_:2},1032,['title'])],2))),128)),(0,n.createCommentVNode)(' 批量生成地點區域 '),(0,n.createElementVNode)('div',bl,[s[22]||(s[22]=(0,n.createElementVNode)('h4',null,'批量生成地點',-1)),(0,n.createElementVNode)('div',Vl,[(0,n.createElementVNode)('div',Nl,[s[20]||(s[20]=(0,n.createElementVNode)('label',null,'生成數量',-1)),(0,n.createElementVNode)('div',fl,[(0,n.withDirectives)((0,n.createElementVNode)('input',{'onUpdate:modelValue':s[0]||(s[0]=e=>r.value=e),type:'number',min:'1',max:'10',class:'text-input count-input',placeholder:'1-10',disabled:i.value},null,8,kl),[[n.vModelText,r.value,void 0,{number:!0}]]),(0,n.createElementVNode)('div',wl,[(0,n.withDirectives)((0,n.createElementVNode)('input',{id:'allow_ai_count','onUpdate:modelValue':s[1]||(s[1]=e=>i.value=e),type:'checkbox'},null,512),[[n.vModelCheckbox,i.value]]),s[19]||(s[19]=(0,n.createElementVNode)('label',{for:'allow_ai_count'},'讓AI決定生成數量',-1))])])]),(0,n.createElementVNode)('div',Bl,[s[21]||(s[21]=(0,n.createElementVNode)('label',null,'批量生成要求',-1)),(0,n.withDirectives)((0,n.createElementVNode)('textarea',{'onUpdate:modelValue':s[2]||(s[2]=e=>o.value=e),placeholder:'描述要生成的地點類型、主題等...',class:'text-area',rows:'3'},null,512),[[n.vModelText,o.value]])])]),(0,n.createElementVNode)('button',{class:'bulk-generate-btn',disabled:!d.value||l.value||!i.value&&(r.value<1||r.value>10),onClick:M},[l.value?((0,n.openBlock)(),(0,n.createElementBlock)('span',$l)):(0,n.createCommentVNode)('v-if',!0),(0,n.createTextVNode)(' '+(0,n.toDisplayString)(l.value?'批量生成中...':d.value?i.value?'讓AI決定生成數量':`生成 ${r.value} 個地點`:'請先完成世界背景設定'),1)],8,Cl)]),(0,n.createCommentVNode)(' 添加地點按鈕 '),(0,n.createElementVNode)('div',{class:'add-location-section'},[(0,n.createElementVNode)('button',{class:'add-location-btn',onClick:V},[...s[23]||(s[23]=[(0,n.createElementVNode)('span',null,'+ 添加地點',-1)])])])]))}}),xl=(0,d.A)(Sl,[['__scopeId','data-v-890af5d4']]);class Il{_date;constructor(e){this._date=e}static fromString(e){return new Il(new Date(e))}toString(){return this._date.toString()}get year(){return this._date.getFullYear()}get month(){return this._date.getMonth()+1}get date(){return this._date.getDate()}get hours(){return this._date.getHours()}get minutes(){return this._date.getMinutes()}get seconds(){return this._date.getSeconds()}toDate(){return this._date}deltaMinutes(e){this._date.setMinutes(this._date.getMinutes()+e)}clone(){return new Il(new Date(this._date))}}class Dl{name;static NAME_KEY='名稱';age;static AGE_KEY='年齡';gender;static GENDER_KEY='性別';identity;static IDENTITY_KEY='身份';introduction;static INTRODUCTION_KEY='簡介';personality;static PERSONALITY_KEY='性格';height;static HEIGHT_KEY='身高';weight;static WEIGHT_KEY='體重';chest_size;static CHEST_SIZE_KEY='胸圍';cup_size;static CUP_SIZE_KEY='罩杯';waist_size;static WAIST_SIZE_KEY='腰圍';hips_size;static HIPS_SIZE_KEY='臀圍';hairstyle;static HAIRSTYLE_KEY='髮型';appearance;static APPEARANCE_KEY='樣貌';clothes;static CLOTHES_KEY='衣著';birthday;static BIRTHDAY_KEY='生日';favourite;static FAVOURITE_KEY='愛好';extra_information;static EXTRA_INFORMATION_KEY='其他重要資訊';money;static MONEY_KEY='金錢';mood;static MOOD_KEY='心情';horny;static HORNY_KEY='性慾';relations;static RELATIONS_KEY='關係';friendships;static FRIENDSHIPS_KEY='友好度';loves;static LOVES_KEY='愛情度';inventory;static INVENTORY_KEY='所持物';static MOOD_LOW=-100;static MOOD_HIGH=100;static HORNY_LOW=0;static HORNY_HIGH=100;static FRIENDSHIP_LOW=-1e3;static FRIENDSHIP_HIGH=1e3;static LOVE_LOW=0;static LOVE_HIGH=1e3;constructor(e,t,a,n,l,r,o,i,s,c,d,u,m,v,p,g,h,E,y,b,V,N,f,k,w){this.name=e,this.age=t,this.gender=a,this.identity=n,this.introduction=l,this.personality=r,this.height=o,this.weight=i,this.chest_size=s,this.cup_size=c,this.waist_size=d,this.hips_size=u,this.hairstyle=m,this.appearance=v,this.clothes=p,this.birthday=g,this.favourite=h,this.extra_information=E,this.money=y,this.mood=b,this.horny=V,this.relations=N,this.friendships=f,this.loves=k,this.inventory=w}static instantiate(){return new Dl('紫月',17,'男','高中二年級學生','一段介紹','平淡，膽小',172,52,70,null,50,55,'黑色短髮','普通，平平無奇','居家服',new Il(new Date(1998,8,22,0,0,0)),'妹妹','沒有額外資訊',1e4,20,0,new Map([['c2','哥哥']]),new Map([['c2',100],['c5',70],['c6',-40]]),new Map([['c2',50]]),new Map([['i2',2]]))}static fromRecord(e){return new Dl(e[Dl.NAME_KEY],e[Dl.AGE_KEY],e[Dl.GENDER_KEY],e[Dl.IDENTITY_KEY],e[Dl.INTRODUCTION_KEY],e[Dl.PERSONALITY_KEY],e[Dl.HEIGHT_KEY],e[Dl.WEIGHT_KEY],e[Dl.CHEST_SIZE_KEY],e[Dl.CUP_SIZE_KEY]??null,e[Dl.WAIST_SIZE_KEY],e[Dl.HIPS_SIZE_KEY],e[Dl.HAIRSTYLE_KEY],e[Dl.APPEARANCE_KEY],e[Dl.CLOTHES_KEY],Il.fromString(e[Dl.BIRTHDAY_KEY]),e[Dl.FAVOURITE_KEY],e[Dl.EXTRA_INFORMATION_KEY],e[Dl.MONEY_KEY],e[Dl.MOOD_KEY],e[Dl.HORNY_KEY],new Map(Object.entries(e[Dl.RELATIONS_KEY])),new Map(Object.entries(e[Dl.FRIENDSHIPS_KEY])),new Map(Object.entries(e[Dl.LOVES_KEY])),new Map(Object.entries(e[Dl.INVENTORY_KEY])))}toRecord(){return{[Dl.NAME_KEY]:this.name,[Dl.AGE_KEY]:this.age,[Dl.GENDER_KEY]:this.gender,[Dl.IDENTITY_KEY]:this.identity,[Dl.INTRODUCTION_KEY]:this.introduction,[Dl.PERSONALITY_KEY]:this.personality,[Dl.HEIGHT_KEY]:this.height,[Dl.WEIGHT_KEY]:this.weight,[Dl.CHEST_SIZE_KEY]:this.chest_size,[Dl.CUP_SIZE_KEY]:this.cup_size,[Dl.WAIST_SIZE_KEY]:this.waist_size,[Dl.HIPS_SIZE_KEY]:this.hips_size,[Dl.HAIRSTYLE_KEY]:this.hairstyle,[Dl.APPEARANCE_KEY]:this.appearance,[Dl.CLOTHES_KEY]:this.clothes,[Dl.BIRTHDAY_KEY]:this.birthday.toString(),[Dl.FAVOURITE_KEY]:this.favourite,[Dl.EXTRA_INFORMATION_KEY]:this.extra_information,[Dl.MONEY_KEY]:this.money,[Dl.MOOD_KEY]:this.mood,[Dl.HORNY_KEY]:this.horny,[Dl.RELATIONS_KEY]:Object.fromEntries(this.relations),[Dl.FRIENDSHIPS_KEY]:Object.fromEntries(this.friendships),[Dl.LOVES_KEY]:Object.fromEntries(this.loves),[Dl.INVENTORY_KEY]:Object.fromEntries(this.inventory)}}deltaFriendship(e,t){let a=this.friendships.get(e)||0;a+=t,a<Dl.FRIENDSHIP_LOW&&(a=Dl.FRIENDSHIP_LOW),a>Dl.FRIENDSHIP_HIGH&&(a=Dl.FRIENDSHIP_HIGH),this.friendships.set(e,a)}deltaLove(e,t){let a=this.loves.get(e)||0;a+=t,a<Dl.LOVE_LOW&&(a=Dl.LOVE_LOW),a>Dl.LOVE_HIGH&&(a=Dl.LOVE_HIGH),0===a?this.loves.delete(e):this.loves.set(e,a)}deltaMood(e){this.mood+=e,this.mood<Dl.MOOD_LOW&&(this.mood=Dl.MOOD_LOW),this.mood>Dl.MOOD_HIGH&&(this.mood=Dl.MOOD_HIGH)}deltaHorny(e){this.horny+=e,this.horny<Dl.HORNY_LOW&&(this.horny=Dl.HORNY_LOW),this.horny>Dl.HORNY_HIGH&&(this.horny=Dl.HORNY_HIGH)}}class Tl{name;static NAME_KEY='名稱';description;static DESCRIPTION_KEY='描述';value;static VALUE_KEY='價值';constructor(e,t,a){this.name=e,this.description=t,this.value=a}static fromRecord(e){return new Tl(e[Tl.NAME_KEY],e[Tl.DESCRIPTION_KEY],e[Tl.VALUE_KEY])}toRecord(){return{[Tl.NAME_KEY]:this.name,[Tl.DESCRIPTION_KEY]:this.description,[Tl.VALUE_KEY]:this.value}}}class Ml{id;static ID_KEY='id';name;static NAME_KEY='地點';location;static LOCATION_KEY='位置';description;static DESCRIPTION_KEY='描述';parent_location_id;static PARENT_LOCATION_ID_KEY='父地點id';sub_location_ids;static SUB_LOCATION_IDS_KEY='子地點ids';storage_ids;static STORAGE_IDS_KEY='貯存點ids';constructor(e,t,a,n,l,r,o){this.id=e,this.name=t,this.location=a,this.description=n,this.parent_location_id=l,this.sub_location_ids=r,this.storage_ids=o}static fromRecord(e){return new Ml(e[Ml.ID_KEY],e[Ml.NAME_KEY],e[Ml.LOCATION_KEY],e[Ml.DESCRIPTION_KEY],e[Ml.PARENT_LOCATION_ID_KEY],e[Ml.SUB_LOCATION_IDS_KEY]||[],e[Ml.STORAGE_IDS_KEY]||[])}toRecord(){return{[Ml.ID_KEY]:this.id,[Ml.NAME_KEY]:this.name,[Ml.LOCATION_KEY]:this.location,[Ml.DESCRIPTION_KEY]:this.description,[Ml.PARENT_LOCATION_ID_KEY]:this.parent_location_id,[Ml.SUB_LOCATION_IDS_KEY]:this.sub_location_ids,[Ml.STORAGE_IDS_KEY]:this.storage_ids}}}class Ol{deadline;static DEADLINE_KEY='期限';character_ids;static CHARACTER_IDS_KEY='角色';location_id;static LOCATION_ID_KEY='地點';description;static DESCRIPTION_KEY='內容';constructor(e,t,a,n){this.deadline=e,this.character_ids=t,this.location_id=a,this.description=n}static fromRecord(e){return new Ol(Il.fromString(e[Ol.DEADLINE_KEY]),e[Ol.CHARACTER_IDS_KEY],e[Ol.LOCATION_ID_KEY],e[Ol.DESCRIPTION_KEY])}toRecord(){return{[Ol.DEADLINE_KEY]:this.deadline.toString(),[Ol.CHARACTER_IDS_KEY]:this.character_ids,[Ol.LOCATION_ID_KEY]:this.location_id,[Ol.DESCRIPTION_KEY]:this.description}}}class Yl{name;static NAME_KEY='名稱';description;static DESCRIPTION_KEY='描述';parent_id;static PARENT_ID_KEY='父id';money;static MONEY_KEY='金錢';inventory;static INVENTORY_KEY='貯存物';constructor(e,t,a,n,l){this.name=e,this.description=t,this.parent_id=a,this.money=n,this.inventory=l}static fromRecord(e){const t=new Map,a=e[Yl.INVENTORY_KEY]||{};for(const[e,n]of Object.entries(a))t.set(e,n);return new Yl(e[Yl.NAME_KEY],e[Yl.DESCRIPTION_KEY],e[Yl.PARENT_ID_KEY],e[Yl.MONEY_KEY],t)}toRecord(){const e={};for(const[t,a]of Array.from(this.inventory))e[t]=a;return{[Yl.NAME_KEY]:this.name,[Yl.DESCRIPTION_KEY]:this.description,[Yl.PARENT_ID_KEY]:this.parent_id,[Yl.MONEY_KEY]:this.money,[Yl.INVENTORY_KEY]:e}}}class Al{datetime;static DATETIME_KEY='時間';summary;static SUMMARY_KEY='總結';weighting;static WEIGHTING_KEY='權重';last_message_id;static LAST_MESSAGE_ID_KEY='最後樓層';constructor(e,t,a,n){this.datetime=e,this.summary=t,this.weighting=a,this.last_message_id=n}static fromRecord(e){return new Al(Il.fromString(e[Al.DATETIME_KEY]),e[Al.SUMMARY_KEY],e[Al.WEIGHTING_KEY],e[Al.LAST_MESSAGE_ID_KEY])}toRecord(){return{[Al.DATETIME_KEY]:this.datetime.toString(),[Al.SUMMARY_KEY]:this.summary,[Al.WEIGHTING_KEY]:this.weighting,[Al.LAST_MESSAGE_ID_KEY]:this.last_message_id}}}class Rl{datetime;static DATETIME_KEY='當前時間';current_location_id;static CURRENT_LOCATION_ID_KEY='當前地點';weather;static WEATHER_KEY='天氣';current_event;static CURRENT_EVENT_KEY='當前事件';static CURRENT_EVENT_NULL_VALUE='無';active_characters;static ACTIVE_CHARACTERS_KEY='當前角色';deactive_characters;static DEACTIVE_CHARACTERS_KEY='背景角色';items;static ITEMS_KEY='物品';storages;static STORAGES_KEY='貯存點';locations;static LOCATIONS_KEY='地點';promises;static PROMISES_KEY='約定';summaries;static SUMMARIES_KEY='總結';constructor(e,t,a,n,l,r,o,i,s,c,d){this.datetime=e,this.current_location_id=t,this.weather=a,this.current_event=n,this.active_characters=l,this.deactive_characters=r,this.items=o,this.storages=i,this.locations=s,this.promises=c,this.summaries=d}static loadFromVariable(e){let t;t=e<0?getVariables({type:'chat'}).state:getVariables({type:'message',message_id:e});const a=new Map,n=t[Rl.ACTIVE_CHARACTERS_KEY];for(const[e,t]of Object.entries(n))a.set(e,Dl.fromRecord(t));const l=new Map,r=t[Rl.DEACTIVE_CHARACTERS_KEY];for(const[e,t]of Object.entries(r))l.set(e,Dl.fromRecord(t));const o=new Map,i=t[Rl.ITEMS_KEY];for(const[e,t]of Object.entries(i))o.set(e,Tl.fromRecord(t));const s=new Map;if(t[Rl.STORAGES_KEY]){const e=t[Rl.STORAGES_KEY];for(const[t,a]of Object.entries(e))s.set(t,Yl.fromRecord(a))}const c=new Map,d=t[Rl.LOCATIONS_KEY];for(const[e,t]of Object.entries(d))c.set(e,Ml.fromRecord(t));const u=new Map,m=t[Rl.PROMISES_KEY];for(const[e,t]of Object.entries(m))u.set(e,Ol.fromRecord(t));const v=new Array,p=t[Rl.SUMMARIES_KEY];for(const e of p)v.push(Al.fromRecord(e));return new Rl(Il.fromString(t[Rl.DATETIME_KEY]),t[Rl.CURRENT_LOCATION_ID_KEY],t[Rl.WEATHER_KEY],t[Rl.CURRENT_EVENT_KEY],a,l,o,s,c,u,v)}saveAsVariable(e){const t={};for(const[e,a]of this.active_characters)t[e]=a.toRecord();const a={};for(const[e,t]of this.deactive_characters)a[e]=t.toRecord();const n={};for(const[e,t]of this.items)n[e]=t.toRecord();const l={};for(const[e,t]of this.storages)l[e]=t.toRecord();const r={};for(const[e,t]of this.locations)r[e]=t.toRecord();const o={};for(const[e,t]of this.promises)o[e]=t.toRecord();const i=[],s=[...this.summaries].sort((e,t)=>e.last_message_id-t.last_message_id);for(const e of s)i.push(e.toRecord());const c={[Rl.DATETIME_KEY]:this.datetime.toString(),[Rl.CURRENT_LOCATION_ID_KEY]:this.current_location_id,[Rl.WEATHER_KEY]:this.weather,[Rl.CURRENT_EVENT_KEY]:this.current_event,[Rl.ACTIVE_CHARACTERS_KEY]:t,[Rl.DEACTIVE_CHARACTERS_KEY]:a,[Rl.ITEMS_KEY]:n,[Rl.STORAGES_KEY]:l,[Rl.LOCATIONS_KEY]:r,[Rl.PROMISES_KEY]:o,[Rl.SUMMARIES_KEY]:i};if(e<0){const e=getVariables({type:'chat'});e.state=c,replaceVariables(e,{type:'chat'})}else replaceVariables(c,{type:'message',message_id:e})}getCharacter(e){return this.active_characters.get(e)||this.deactive_characters.get(e)}hasCharacter(e){return this.active_characters.has(e)||this.deactive_characters.has(e)}getCurrentLocations(){const e=new Set,t=[];let a=this.locations.get(this.current_location_id);for(;a&&!e.has(a.id);)t.push(a),e.add(a.id),a=this.locations.get(a.parent_location_id||'');return t.reverse()}addStorage(e,t,a,n){if(this.storages.has(e))return;if(!(this.hasCharacter(n)||this.storages.has(n)||this.locations.has(n)))return;const l=new Yl(t,a,n,0,new Map);if(this.storages.set(e,l),this.hasCharacter(n)){const t=this.getCharacter(n);t&&t.inventory.set(e,1)}else if(this.storages.has(n)){const t=this.storages.get(n);t&&t.inventory.set(e,1)}else if(this.locations.has(n)){const t=this.locations.get(n);t&&t.storage_ids.push(e)}}removeStorage(e){const t=this.storages.get(e);if(!t)return;this.storages.delete(e);const a=t.parent_id;if(this.hasCharacter(a)){const t=this.getCharacter(a);t&&t.inventory.delete(e)}else if(this.storages.has(a)){const t=this.storages.get(a);t&&t.inventory.delete(e)}else if(this.locations.has(a)){const t=this.locations.get(a);if(t){const a=t.storage_ids.indexOf(e);-1!==a&&t.storage_ids.splice(a,1)}}}setStorageParent(e,t){const a=this.storages.get(e);if(!a)return;if(!(this.hasCharacter(t)||this.storages.has(t)&&t!==e||this.locations.has(t)))return;const n=a.parent_id;if(this.hasCharacter(n)){const t=this.getCharacter(n);t&&t.inventory.delete(e)}else if(this.storages.has(n)){const t=this.storages.get(n);t&&t.inventory.delete(e)}else if(this.locations.has(n)){const t=this.locations.get(n);if(t){const a=t.storage_ids.indexOf(e);-1!==a&&t.storage_ids.splice(a,1)}}if(a.parent_id=t,this.hasCharacter(t)){const a=this.getCharacter(t);a&&a.inventory.set(e,1)}else if(this.storages.has(t)){const a=this.storages.get(t);a&&a.inventory.set(e,1)}else if(this.locations.has(t)){const a=this.locations.get(t);a&&a.storage_ids.push(e)}}addPromise(e,t,a,n){const l=Array.from(this.promises.keys()).map(e=>parseInt(e.substring(1))).filter(e=>!isNaN(e)),r=`p${Math.max(...l,0)+1}`,o=new Ol(e,t,a,n);this.promises.set(r,o)}addSummary(e,t,a){const n=this.datetime.clone();this.summaries.push(new Al(n,e,t,a))}getLatestSummaryLastMessageId(){const e=getVariables({type:'chat'}),t=e.settings?.exclude_latest_summaries||0;if(t>=this.summaries.length)return-1;const a=this.summaries.slice(0,this.summaries.length-t);return 0===a.length?-1:a[a.length-1].last_message_id}getGeneralStatusPrompt(){const e=this.datetime.year,t=this.datetime.month,a=this.datetime.date,n=this.datetime.hours,l=this.datetime.minutes,r=`${e}年${t}月${a}日 (星期${['日','一','二','三','四','五','六'][this.datetime.toDate().getDay()]}) ${n.toString().padStart(2,'0')}:${l.toString().padStart(2,'0')}`,o=this.getCurrentLocations().map(e=>`${e.name}(${e.id})`).join('-');let i='<GeneralStatus>\n';return i+=`  ${Rl.DATETIME_KEY}:${r}\n`,i+=`  ${Rl.CURRENT_LOCATION_ID_KEY}:${o}\n`,i+=`  ${Rl.WEATHER_KEY}:${this.weather}\n`,i+=`  ${Rl.CURRENT_EVENT_KEY}:${this.current_event}\n`,i+='</GeneralStatus>\n',i}getUserPrompt(){const e=this.active_characters.get('c1');let t=`<${e.name}Status>\n`;t+='id: c1\n',t+=`  ${Dl.NAME_KEY}:${e.name}\n`,t+=`  ${Dl.AGE_KEY}:${e.age}\n`,t+=`  ${Dl.GENDER_KEY}:${e.gender}\n`,t+=`  ${Dl.IDENTITY_KEY}:${e.identity}\n`,t+=`  ${Dl.INTRODUCTION_KEY}:${e.introduction}\n`,t+=`  ${Dl.PERSONALITY_KEY}:${e.personality}\n`,t+=`  ${Dl.HEIGHT_KEY}:${e.height}\n`,t+=`  ${Dl.WEIGHT_KEY}:${e.weight}\n`,t+=`  ${Dl.CHEST_SIZE_KEY}:${e.chest_size}\n`,e.cup_size&&(t+=`  ${Dl.CUP_SIZE_KEY}:${e.cup_size}\n`),t+=`  ${Dl.WAIST_SIZE_KEY}:${e.waist_size}\n`,t+=`  ${Dl.HIPS_SIZE_KEY}:${e.hips_size}\n`,t+=`  ${Dl.HAIRSTYLE_KEY}:${e.hairstyle}\n`,t+=`  ${Dl.CLOTHES_KEY}:${e.clothes}\n`,t+=`  ${Dl.BIRTHDAY_KEY}:${e.birthday.month}月${e.birthday.date}日\n`,t+=`  ${Dl.FAVOURITE_KEY}:${e.favourite}\n`,t+=`  ${Dl.EXTRA_INFORMATION_KEY}:${e.extra_information}\n`,t+=`  ${Dl.MONEY_KEY}:${e.money}\n`,t+=`  ${Dl.RELATIONS_KEY}:\n`;for(const[a,n]of e.relations)t+=`    ${a}:${n}\n`;t+=`  ${Dl.INVENTORY_KEY}:\n`;for(const[a,n]of e.inventory)t+=`    ${a}:${n}\n`;return t+=`</${e.name}Status>\n`,t}getActiveCharacterPrompt(){let e='<ActiveCharacterStatus>\n';for(const[t,a]of this.active_characters)if('c1'!==t){e+=`id: ${t}\n`,e+=`  ${Dl.NAME_KEY}:${a.name}\n`,e+=`  ${Dl.AGE_KEY}:${a.age}\n`,e+=`  ${Dl.GENDER_KEY}:${a.gender}\n`,e+=`  ${Dl.IDENTITY_KEY}:${a.identity}\n`,e+=`  ${Dl.INTRODUCTION_KEY}:${a.introduction}\n`,e+=`  ${Dl.PERSONALITY_KEY}:${a.personality}\n`,e+=`  ${Dl.HEIGHT_KEY}:${a.height}\n`,e+=`  ${Dl.WEIGHT_KEY}:${a.weight}\n`,e+=`  ${Dl.CHEST_SIZE_KEY}:${a.chest_size}\n`,a.cup_size&&(e+=`  ${Dl.CUP_SIZE_KEY}:${a.cup_size}\n`),e+=`  ${Dl.WAIST_SIZE_KEY}:${a.waist_size}\n`,e+=`  ${Dl.HIPS_SIZE_KEY}:${a.hips_size}\n`,e+=`  ${Dl.HAIRSTYLE_KEY}:${a.hairstyle}\n`,e+=`  ${Dl.CLOTHES_KEY}:${a.clothes}\n`,e+=`  ${Dl.BIRTHDAY_KEY}:${a.birthday.month}月${a.birthday.date}日\n`,e+=`  ${Dl.FAVOURITE_KEY}:${a.favourite}\n`,e+=`  ${Dl.EXTRA_INFORMATION_KEY}:${a.extra_information}\n`,e+=`  ${Dl.MONEY_KEY}:${a.money}\n`,e+=`  ${Dl.MOOD_KEY}:${a.mood}\n`,e+=`  ${Dl.HORNY_KEY}:${a.horny}\n`,e+=`  ${Dl.RELATIONS_KEY}:\n`;for(const[t,n]of a.relations)e+=`    ${t}:${n}\n`;e+=`  ${Dl.FRIENDSHIPS_KEY}:\n`;for(const[t,n]of a.friendships)e+=`    ${t}:${n}\n`;e+=`  ${Dl.LOVES_KEY}:\n`;for(const[t,n]of a.loves)e+=`    ${t}:${n}\n`;e+=`  ${Dl.INVENTORY_KEY}:\n`;for(const[t,n]of a.inventory)e+=`    ${t}:${n}\n`;e+='\n'}return e+='</ActiveCharacterStatus>\n',e}getDeactiveCharacterPrompt(){let e='<DeactiveCharacterStatus>\n';for(const[t,a]of this.deactive_characters){e+=`id: ${t}\n`,e+=`  ${Dl.NAME_KEY}:${a.name}\n`,e+=`  ${Dl.AGE_KEY}:${a.age}\n`,e+=`  ${Dl.GENDER_KEY}:${a.gender}\n`,e+=`  ${Dl.IDENTITY_KEY}:${a.identity}\n`,e+=`  ${Dl.INTRODUCTION_KEY}:${a.introduction}\n`,e+=`  ${Dl.PERSONALITY_KEY}:${a.personality}\n`,e+=`  ${Dl.FAVOURITE_KEY}:${a.favourite}\n`,e+=`  ${Dl.EXTRA_INFORMATION_KEY}:${a.extra_information}\n`,e+=`  ${Dl.RELATIONS_KEY}:\n`;for(const[t,n]of a.relations)e+=`    ${t}:${n}\n`;e+=`  ${Dl.FRIENDSHIPS_KEY}:\n`;for(const[t,n]of a.friendships)e+=`    ${t}:${n}\n`;e+=`  ${Dl.LOVES_KEY}:\n`;for(const[t,n]of a.loves)e+=`    ${t}:${n}\n`;e+='\n'}return e+='</DeactiveCharacterStatus>\n',e}getItemPrompt(){let e='<ItemTable>\n';e+=`|id|${Tl.NAME_KEY}|${Tl.DESCRIPTION_KEY}|${Tl.VALUE_KEY}|\n`,e+='|---|---|---|---|\n';for(const[t,a]of this.items)e+=`|${t}|${a.name}|${a.description}|${a.value}|\n`;return e+='</ItemTable>\n',e}getLocationPrompt(){let e='<LocationTable>\n';e+=`|id|${Ml.NAME_KEY}|${Ml.LOCATION_KEY}|${Ml.DESCRIPTION_KEY}|${Ml.SUB_LOCATION_IDS_KEY}|\n`,e+='|---|---|---|---|---|\n';for(const[t,a]of this.locations)e+=`|${t}|${a.name}|${a.location}|${a.description}|${a.sub_location_ids.join(',')}|\n`;return e+='</LocationTable>\n',e}getStoragePrompt(){let e='<StorageTable>\n';e+=`|id|${Yl.NAME_KEY}|${Yl.DESCRIPTION_KEY}|${Yl.MONEY_KEY}|${Yl.INVENTORY_KEY}|\n`,e+='|---|---|---|---|---|\n';for(const[t,a]of this.storages){const n=Array.from(a.inventory.entries()).map(([e,t])=>`${e}:${t}`).join(', ');e+=`|${t}|${a.name}|${a.description}|${a.money}|${n}|\n`}return e+='</StorageTable>\n',e}getPromisePrompt(){let e='<PromiseTable>\n';e+=`|id|${Ol.DEADLINE_KEY}|${Ol.CHARACTER_IDS_KEY}|${Ol.LOCATION_ID_KEY}|${Ol.DESCRIPTION_KEY}|\n`,e+='|---|---|---|---|---|\n';for(const[t,a]of this.promises){e+=`|${t}|${`${a.deadline.year}年${a.deadline.month}月${a.deadline.date}日 ${a.deadline.hours.toString().padStart(2,'0')}:${a.deadline.minutes.toString().padStart(2,'0')}`}|${a.character_ids.join(',')}|${a.location_id}|${a.description}|\n`}return e+='</PromiseTable>\n',e}getSummaryPrompt(){const e=getVariables({type:'chat'}),t=e.settings?.exclude_latest_summaries||0,a=this.summaries.slice(0,this.summaries.length-t);let n='<HistorySummary>\n';n+=`|${Al.DATETIME_KEY}|${Al.SUMMARY_KEY}|${Al.WEIGHTING_KEY}|\n`,n+='|---|---|---|\n';for(const e of a){n+=`|${`${e.datetime.year}年${e.datetime.month}月${e.datetime.date}日 ${e.datetime.hours.toString().padStart(2,'0')}:${e.datetime.minutes.toString().padStart(2,'0')}`}|${e.summary}|${e.weighting.toFixed(2)}|\n`}return n+='</HistorySummary>\n',n}getStartingBackground(){let e='<StartingBackground>\n';return e+=`${getVariables({type:'chat'}).start_settings.information}\n`,e+='</StartingBackground>\n',e}injectPrompt(e){let t='';e&&(t+=`${this.getStartingBackground()}\n`),t+=`${this.getSummaryPrompt()}`;let a=`${this.getGeneralStatusPrompt()}\n`;a+=`${this.getUserPrompt()}\n`,a+=`${this.getActiveCharacterPrompt()}\n`,a+=`${this.getDeactiveCharacterPrompt()}\n`,a+=`${this.getItemPrompt()}\n`,a+=`${this.getStoragePrompt()}\n`,a+=`${this.getLocationPrompt()}\n`,a+=`${this.getPromisePrompt()}`,injectPrompts([{id:'pre-chat_prompt',position:'in_chat',depth:9999,role:'system',content:t,should_scan:!0}]),injectPrompts([{id:'post-chat_prompt',position:'in_chat',depth:0,role:'system',content:a,should_scan:!0}])}}const Kl={class:'start-container'},Ul={class:'section'},zl={class:'datetime-group'},Ll={class:'datetime-inputs'},Fl={class:'datetime-input'},Hl={class:'datetime-input'},jl={class:'datetime-input'},Pl={class:'datetime-input'},ql={class:'datetime-input'},Gl={key:0,class:'generated-result'},Wl={class:'generated-text'},Xl={class:'input-group'},Zl=['value'],Jl={key:0,class:'generated-result'},Ql={class:'generated-text'},er={class:'input-group'},tr={key:0,class:'generated-result'},ar={class:'generated-text'},nr={class:'input-group'},lr={key:0,class:'generated-result'},rr={class:'generated-text'},or={class:'input-group'},ir={class:'item-actions'},sr=['disabled'],cr={key:0,class:'loading-spinner'},dr=['disabled'],ur={class:'completion-status'},mr={class:'status-value'},vr={class:'status-value'},pr={class:'status-value'},gr={class:'status-value'},_r={class:'status-value'},hr={class:'status-value'},Er={class:'status-value'},yr={class:'settings-actions'},br={class:'action-btn import'},Vr={class:'start-action'},Nr=['disabled'],fr=(0,n.defineComponent)({__name:'start_tab',setup(e){const t=(0,n.ref)(''),a=(0,n.ref)(''),l=(0,n.ref)(''),r=(0,n.ref)(''),o=(0,n.ref)(''),i=(0,n.ref)(''),s=(0,n.ref)(''),c=(0,n.ref)(''),d=(0,n.ref)(''),u=(0,n.ref)(!1),m=(0,n.ref)(''),v=(0,n.ref)(''),p=(0,n.ref)(''),g=(0,n.ref)(''),h=(0,n.ref)(''),E=(0,n.ref)(''),y=(0,n.ref)(''),b=(0,n.ref)(''),V=(0,n.computed)(()=>{try{const e=getVariables({type:'chat'});return!!e?.world_info?.trim()}catch{return!1}}),N=(0,n.computed)(()=>{try{const e=getVariables({type:'chat'}),t=e?.locations||{},a=new Map;for(const[e,n]of Object.entries(t))a.set(e,n);return a}catch{return new Map}}),f=(0,n.computed)(()=>m.value||v.value||p.value||g.value||h.value||E.value||y.value||b.value),k=(0,n.computed)(()=>''!==String(t.value).trim()&&''!==String(a.value).trim()&&''!==String(l.value).trim()&&''!==String(r.value).trim()&&''!==String(o.value).trim()&&''!==String(i.value).trim()&&''!==String(s.value).trim()&&''!==String(c.value).trim()),w=(0,n.computed)(()=>K()&&U()&&L()&&F()&&H()&&j()&&k.value),B=async()=>{u.value=!0;try{const e=I(),n=D(),d=T(),u=await generateRaw({user_input:e,ordered_prompts:[{role:'system',content:n},'char_description',{role:'system',content:d},'user_input']});O(u);try{const e={start_year:t.value,start_month:a.value,start_date:l.value,start_hour:r.value,start_minute:o.value,selected_location:i.value,weather:s.value,information:c.value,generated_start_year:m.value,generated_start_month:v.value,generated_start_date:p.value,generated_start_hour:g.value,generated_start_minute:h.value,generated_location:E.value,generated_weather:y.value,generated_information:b.value};localStorage.setItem('start_tab_generated',JSON.stringify(e))}catch(e){console.error('保存生成內容到 localStorage 失敗:',e)}}catch(e){console.error('生成開始設定內容失敗:',e)}finally{u.value=!1}},C=()=>{try{const e=getVariables({type:'chat'});e.start_settings={start_year:t.value,start_month:a.value,start_date:l.value,start_hour:r.value,start_minute:o.value,selected_location:i.value,weather:s.value,information:c.value},replaceVariables(e,{type:'chat'})}catch(e){console.error('保存開始設定失敗:',e)}},S=()=>{try{const e=getVariables({type:'chat'});e?.start_settings&&(t.value=String(e.start_settings.start_year||''),a.value=String(e.start_settings.start_month||''),l.value=String(e.start_settings.start_date||''),r.value=String(e.start_settings.start_hour||''),o.value=String(e.start_settings.start_minute||''),i.value=String(e.start_settings.selected_location||''),s.value=String(e.start_settings.weather||''),c.value=String(e.start_settings.information||''));const n=localStorage.getItem('start_tab_generated');if(n)try{const e=JSON.parse(n);t.value||(t.value=e.start_year||''),a.value||(a.value=e.start_month||''),l.value||(l.value=e.start_date||''),r.value||(r.value=e.start_hour||''),o.value||(o.value=e.start_minute||''),i.value||(i.value=e.selected_location||''),s.value||(s.value=e.weather||''),c.value||(c.value=e.information||''),m.value=e.generated_start_year||'',v.value=e.generated_start_month||'',p.value=e.generated_start_date||'',g.value=e.generated_start_hour||'',h.value=e.generated_start_minute||'',E.value=e.generated_location||'',y.value=e.generated_weather||'',b.value=e.generated_information||''}catch(e){console.error('解析生成內容失敗:',e)}const u=localStorage.getItem('start_tab_generation_requirement');u&&(d.value=u)}catch(e){console.error('加載開始設定失敗:',e)}};(0,n.onMounted)(()=>{S()}),(0,n.watch)([t,a,l,r,o,i,s,c,d],()=>{C(),x()},{deep:!0}),(0,n.watch)(()=>getVariables({type:'chat'}),e=>{e?.start_settings&&S()},{deep:!0});const x=()=>{try{localStorage.setItem('start_tab_generation_requirement',d.value)}catch(e){console.error('保存生成要求到 localStorage 失敗:',e)}},I=()=>{let e='請根據世界背景資訊、生成要求及已有資料，為遊戲開始設定完善以下內容：\n\n';return e+=`起始時間(年)：${t.value||'未設定'}\n`,e+=`起始時間(月)：${a.value||'未設定'}\n`,e+=`起始時間(日)：${l.value||'未設定'}\n`,e+=`起始時間(時)：${r.value||'未設定'}\n`,e+=`起始時間(分)：${o.value||'未設定'}\n`,e+=`起始地點：${i.value||'未設定'}\n`,e+=`天氣：${s.value||'未設定'}\n`,e+=`起始資訊：${c.value||'未設定'}\n`,e},D=()=>{const e=getVariables({type:'chat'}).world_info;let t=getCharData('current').description;t=t.replace('{{getvar::world_info}}',e);let a='你是一個專業的遊戲開始設定設計助手，擅長創造引人入勝的開場場景。請根據提供的世界背景及生成要求，為遊戲開始設定完善內容。\n';return a+='\n',a+='<世界背景>\n','你是一個專業的遊戲開始設定設計助手，擅長創造引人入勝的開場場景。請根據提供的世界背景及生成要求，為遊戲開始設定完善內容。\n\n<世界背景>\n'},T=()=>{let e='\n</世界背景>\n';return e+='\n',e+=`${(()=>{const e=getVariables({type:'chat'}).characters.c1,t=`${e.姓氏}${e.名字}`;let a=`<${t}Status>\n`;return a+='id：c1\n',a+=`  姓氏：${e.姓氏||''}\n`,a+=`  名字：${e.名字||''}\n`,a+=`  年齡：${e.年齡||''}\n`,a+=`  性別：${e.性別||''}\n`,a+=`  身份：${e.身份||''}\n`,a+=`  身高：${e.身高||''}\n`,a+=`  體重：${e.體重||''}\n`,a+=`  胸圍：${e.胸圍||''}\n`,a+=`  罩杯：${e.罩杯||''}\n`,a+=`  腰圍：${e.腰圍||''}\n`,a+=`  臀圍：${e.臀圍||''}\n`,a+=`  髮型：${e.髮型||''}\n`,a+=`  樣貌：${e.樣貌||''}\n`,a+=`  衣著：${e.衣著||''}\n`,a+=`  簡介：${e.簡介||''}\n`,a+=`  性格：${e.性格||''}\n`,a+=`  愛好：${e.愛好||''}\n`,a+=`  金錢：${e.金錢||''}\n`,a+=`  生日月份：${e.生日月份||''}\n`,a+=`  生日日期：${e.生日日期||''}\n`,a+=`  其他重要資訊：${e.其他重要資訊||''}\n`,a+=`  關係：${M(e.關係)}\n`,a+=`  友好度：${M(e.友好度)}\n`,a+=`  愛情度：${M(e.愛情度)}\n`,a+=`</${t}Status>`,a})()}\n`,e+='\n',e+=`${(()=>{const e=getVariables({type:'chat'}).characters;if(void 0===e)return'';let t='<CharacterStatus>\n';for(const[a,n]of Object.entries(e))'c1'!==a&&(t+=`id：${a}\n`,t+=`  姓氏：${n.姓氏||''}\n`,t+=`  名字：${n.名字||''}\n`,t+=`  年齡：${n.年齡||''}\n`,t+=`  性別：${n.性別||''}\n`,t+=`  身份：${n.身份||''}\n`,t+=`  身高：${n.身高||''}\n`,t+=`  體重：${n.體重||''}\n`,t+=`  胸圍：${n.胸圍||''}\n`,t+=`  罩杯：${n.罩杯||''}\n`,t+=`  腰圍：${n.腰圍||''}\n`,t+=`  臀圍：${n.臀圍||''}\n`,t+=`  髮型：${n.髮型||''}\n`,t+=`  樣貌：${n.樣貌||''}\n`,t+=`  衣著：${n.衣著||''}\n`,t+=`  簡介：${n.簡介||''}\n`,t+=`  性格：${n.性格||''}\n`,t+=`  愛好：${n.愛好||''}\n`,t+=`  金錢：${n.金錢||''}\n`,t+=`  心情：${n.心情||''}\n`,t+=`  性慾：${n.性慾||''}\n`,t+=`  生日月份：${n.生日月份||''}\n`,t+=`  生日日期：${n.生日日期||''}\n`,t+=`  其他重要資訊：${n.其他重要資訊||''}\n`,t+=`  關係：${M(n.關係)}\n`,t+=`  友好度：${M(n.友好度)}\n`,t+=`  愛情度：${M(n.愛情度)}\n\n`);return t+='</CharacterStatus>',t})()}\n`,e+='\n',e+=`${(()=>{let e='<ItemTable>\n';e+='|id|名稱|描述|價值|\n',e+='|---|---|---|---|\n';const t=getVariables({type:'chat'}).items;if(void 0===t)return'';for(const[a,n]of Object.entries(t))e+=`|${a}|${n.name}|${n.description}|${n.value}|\n`;return e+='</ItemTable>',e})()}\n`,e+='\n',e+=`${(()=>{let e='<LocationTable>\n';e+='|id|名稱|描述|子地點|\n',e+='|---|---|---|---|\n';const t=getVariables({type:'chat'}).locations;if(void 0===t)return'';for(const[a,n]of Object.entries(t)){const t=n.sub_location?n.sub_location.join(', '):'';e+=`|${a}|${n.name}|${n.description}|${t}|\n`}return e+='</LocationTable>',e})()}\n`,e+='\n',e+=`${(()=>{let e='';const t=getVariables({type:'chat'}).extra_world_info;if(void 0===t)return'';for(const a of Array.from(t))''!==a.name&&''!==a.content&&(e+=`<${a.name}>\n`,e+=`${a.content}\n`,e+=`</${a.name}>\n`,e+='\n');return e})()}\n`,e+='\n',e+='<生成要求>\n',e+=`${d.value||'無特殊要求'}\n`,e+='</生成要求>\n',e+='\n',e+='<example>\n',e+='# The following is an example of user input and expected output. Please strictly follow the style and format to generate the output. Output anything other than this format is prohibited.\n',e+='起始時間(年)：number\n',e+='起始時間(月)：number[1~12]\n',e+='起始時間(日)：number[1~31]\n',e+='起始時間(時)：number[0~23]\n',e+='起始時間(分)：number[0~59]\n',e+='起始地點：location id\n',e+='天氣：\'天氣描述，如：晴朗，雨天\'\n',e+='起始資訊：\'遊戲開始時的場景描述或重要資訊\'\n',e+='</example>\n',e},M=e=>'['+Object.entries(e).map(([e,t])=>'string'==typeof t?`'${e}':'${t}'`:`'${e}':${t}`).join(', ')+']',O=e=>{const t=e.split('\n'),a={};for(const e of t){const t=e.trim();if(t.includes('：')){const[e,n]=t.split('：',2),l=n?.trim().replace(/^["']|["']$/g,'')||'';switch(e.trim()){case'起始時間(年)':a.generated_start_year=l;break;case'起始時間(月)':a.generated_start_month=l;break;case'起始時間(日)':a.generated_start_date=l;break;case'起始時間(時)':a.generated_start_hour=l;break;case'起始時間(分)':a.generated_start_minute=l;break;case'起始地點':a.generated_location=l;break;case'天氣':a.generated_weather=l;break;case'起始資訊':a.generated_information=l}}}Object.assign(m,{value:a.generated_start_year||''}),Object.assign(v,{value:a.generated_start_month||''}),Object.assign(p,{value:a.generated_start_date||''}),Object.assign(g,{value:a.generated_start_hour||''}),Object.assign(h,{value:a.generated_start_minute||''}),Object.assign(E,{value:a.generated_location||''}),Object.assign(y,{value:a.generated_weather||''}),Object.assign(b,{value:a.generated_information||''})},Y=()=>{m.value&&(t.value=m.value),v.value&&(a.value=v.value),p.value&&(l.value=p.value),g.value&&(r.value=g.value),h.value&&(o.value=h.value),m.value='',v.value='',p.value='',g.value='',h.value=''},A=()=>{Y(),E.value&&(i.value=E.value),y.value&&(s.value=y.value),b.value&&(c.value=b.value),E.value='',y.value='',b.value='',C();try{localStorage.removeItem('start_tab_generated')}catch(e){console.error('從 localStorage 移除生成內容失敗:',e)}},R=e=>''===e||(null===e||void 0===e),K=()=>''!==(getVariables({type:'chat'}).world_info||'').trim(),U=()=>{const e=getVariables({type:'chat'}),t=e?.characters?.c1;if(!t)return!1;for(const e of Object.values(t))if(R(e))return!1;return!0},L=()=>{const e=getVariables({type:'chat'}),t=e?.characters;if(!t)return!1;for(const[e,a]of Object.entries(t))if('c1'!==e)for(const e of Object.values(a))if(R(e))return!1;return!0},F=()=>{const e=getVariables({type:'chat'}),t=e?.items;if(!t)return!1;for(const e of Object.values(t))for(const t of Object.values(e))if(R(t))return!1;return!0},H=()=>{const e=getVariables({type:'chat'}),t=e?.extra_world_info;if(!t)return!1;for(const e of Object.values(t))for(const t of Object.values(e))if(R(t))return!1;return!0},j=()=>{const e=getVariables({type:'chat'}),t=e?.locations;if(!t)return!1;const a=Object.keys(t);if(0===a.length)return!1;for(const e of a){const a=t[e];if(!a?.name?.trim()||!a?.location?.trim()||!a?.description?.trim())return!1}return!0},P=()=>{const e=parseInt(t.value),n=parseInt(a.value),c=parseInt(l.value),d=parseInt(r.value),u=parseInt(o.value),m=getVariables({type:'chat'}),v=m?.locations||{},p=i.value,g=s.value;let h=getVariables({type:'chat'});const E=h.characters,y=new Map,b=new Map;for(const[t,a]of Object.entries(E)){const l=`${a.姓氏}${a.名字}`,r=parseInt(a.年齡),o=parseInt(a.生日日期),i=parseInt(a.生日月份);let s=e-r;(n<i||n===i&&c<o)&&(s-=1);const d=new Il(new Date(s,i-1,o));let u=a.罩杯;/^[a-zA-Z]$/.test(a.罩杯)||(u=null);const m=new Dl(l,r,a.性別,a.身份,a.簡介,a.性格,a.身高,a.體重,a.胸圍,u,a.腰圍,a.臀圍,a.髮型,a.樣貌,a.衣著,d,a.愛好,a.其他重要資訊,a.金錢,a.心情,a.性慾,new Map(Object.entries(a.關係)),new Map(Object.entries(a.友好度)),new Map(Object.entries(a.愛情度)),new Map(Object.entries(a.所持物)));'c1'===t?y.set(t,m):b.set(t,m)}const V=h.items,N=new Map;for(const[e,t]of Object.entries(V)){const a=new Tl(t.name,t.description,t.value);N.set(e,a)}const f=new Map;for(const[e,t]of Object.entries(v)){const a=new Ml(e,t.name,t.location,t.description,null,t.sub_location,t.storage_ids||[]);f.set(e,a)}for(const[e,t]of f.entries())for(const a of t.sub_location_ids)f.has(a)&&(f.get(a).parent_location_id=e);const k=new Rl(new Il(new Date(e,n-1,c,d,u)),p,g,Rl.CURRENT_EVENT_NULL_VALUE,y,b,N,new Map,f,new Map,[]);k.saveAsVariable(-1),k.saveAsVariable(0),h=getVariables({type:'chat'}),h.is_initialized=!0,replaceVariables(h,{type:'chat'}),eventEmit('initialization_completed')},q=()=>{try{const e=getVariables({type:'chat'}),t={world_info:e.world_info||'',characters:e.characters||{},items:e.items||{},storages:e.storages||{},locations:e.locations||{},extra_world_info:e.extra_world_info||[],extra_world_info_prompt:e.extra_world_info_prompt||'',start_settings:e.start_settings||{}},a=JSON.stringify(t,null,2),n=new Blob([a],{type:'application/json'}),l=URL.createObjectURL(n),r=document.createElement('a');r.href=l,r.download=`initialization_settings_${(new Date).toISOString().split('T')[0]}.json`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(l),toastr.success('初始化設定已匯出')}catch(e){console.error('匯出初始化設定失敗:',e),toastr.error('匯出失敗')}},G=e=>{const t=e.target.files?.[0];if(!t)return;const a=new FileReader;a.onload=e=>{try{const t=e.target?.result,a=JSON.parse(t),n=['world_info','characters','items','storages','locations','extra_world_info','extra_world_info_prompt','start_settings'];for(const e of n)if(!(e in a))throw new Error(`缺少必要的鍵: ${e}`);const l=getVariables({type:'chat'});l.world_info=a.world_info,l.characters=a.characters,l.items=a.items,l.storages=a.storages,l.locations=a.locations,l.extra_world_info=a.extra_world_info,l.extra_world_info_prompt=a.extra_world_info_prompt,l.start_settings=a.start_settings,replaceVariables(l,{type:'chat'}),S(),toastr.success('初始化設定已匯入')}catch(e){console.error('匯入初始化設定失敗:',e),toastr.error('匯入失敗：檔案格式錯誤')}},a.readAsText(t)};return(e,C)=>((0,n.openBlock)(),(0,n.createElementBlock)('div',Kl,[C[35]||(C[35]=(0,n.createElementVNode)('h3',null,'開始設定',-1)),(0,n.createElementVNode)('div',Ul,[(0,n.createElementVNode)('div',zl,[C[18]||(C[18]=(0,n.createElementVNode)('label',null,'起始時間',-1)),(0,n.createElementVNode)('div',Ll,[(0,n.createElementVNode)('div',Fl,[(0,n.withDirectives)((0,n.createElementVNode)('input',{'onUpdate:modelValue':C[0]||(C[0]=e=>t.value=e),type:'number',class:'form-input',placeholder:'年',min:'1900',max:'2100'},null,512),[[n.vModelText,t.value]]),C[12]||(C[12]=(0,n.createElementVNode)('span',{class:'unit'},'年',-1))]),(0,n.createElementVNode)('div',Hl,[(0,n.withDirectives)((0,n.createElementVNode)('input',{'onUpdate:modelValue':C[1]||(C[1]=e=>a.value=e),type:'number',class:'form-input',placeholder:'月',min:'1',max:'12'},null,512),[[n.vModelText,a.value]]),C[13]||(C[13]=(0,n.createElementVNode)('span',{class:'unit'},'月',-1))]),(0,n.createElementVNode)('div',jl,[(0,n.withDirectives)((0,n.createElementVNode)('input',{'onUpdate:modelValue':C[2]||(C[2]=e=>l.value=e),type:'number',class:'form-input',placeholder:'日',min:'1',max:'31'},null,512),[[n.vModelText,l.value]]),C[14]||(C[14]=(0,n.createElementVNode)('span',{class:'unit'},'日',-1))]),(0,n.createElementVNode)('div',Pl,[(0,n.withDirectives)((0,n.createElementVNode)('input',{'onUpdate:modelValue':C[3]||(C[3]=e=>r.value=e),type:'number',class:'form-input',placeholder:'時',min:'0',max:'23'},null,512),[[n.vModelText,r.value]]),C[15]||(C[15]=(0,n.createElementVNode)('span',{class:'unit'},'時',-1))]),(0,n.createElementVNode)('div',ql,[(0,n.withDirectives)((0,n.createElementVNode)('input',{'onUpdate:modelValue':C[4]||(C[4]=e=>o.value=e),type:'number',class:'form-input',placeholder:'分',min:'0',max:'59'},null,512),[[n.vModelText,o.value]]),C[16]||(C[16]=(0,n.createElementVNode)('span',{class:'unit'},'分',-1))])]),m.value||v.value||p.value||g.value||h.value?((0,n.openBlock)(),(0,n.createElementBlock)('div',Gl,[C[17]||(C[17]=(0,n.createElementVNode)('label',null,'生成結果：',-1)),(0,n.createElementVNode)('div',Wl,(0,n.toDisplayString)(m.value?`年：${m.value}\n`:'')+(0,n.toDisplayString)(v.value?`月：${v.value}\n`:'')+(0,n.toDisplayString)(p.value?`日：${p.value}\n`:'')+(0,n.toDisplayString)(g.value?`時：${g.value}\n`:'')+(0,n.toDisplayString)(h.value?`分：${h.value}`:''),1),(0,n.createElementVNode)('button',{class:'replace-btn',onClick:Y},'使用')])):(0,n.createCommentVNode)('v-if',!0)]),(0,n.createElementVNode)('div',Xl,[C[21]||(C[21]=(0,n.createElementVNode)('label',null,'起始地點',-1)),(0,n.withDirectives)((0,n.createElementVNode)('select',{'onUpdate:modelValue':C[5]||(C[5]=e=>i.value=e),class:'form-input'},[C[19]||(C[19]=(0,n.createElementVNode)('option',{value:''},'請選擇起始地點',-1)),((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)((0,n.unref)(N),([e,t])=>((0,n.openBlock)(),(0,n.createElementBlock)('option',{key:e,value:e},(0,n.toDisplayString)(t.name)+' ('+(0,n.toDisplayString)(e)+') ',9,Zl))),128))],512),[[n.vModelSelect,i.value]]),E.value?((0,n.openBlock)(),(0,n.createElementBlock)('div',Jl,[C[20]||(C[20]=(0,n.createElementVNode)('label',null,'生成結果：',-1)),(0,n.createElementVNode)('div',Ql,(0,n.toDisplayString)(E.value),1),(0,n.createElementVNode)('button',{class:'replace-btn',onClick:C[6]||(C[6]=e=>{i.value=E.value,E.value=''})},' 使用 ')])):(0,n.createCommentVNode)('v-if',!0)]),(0,n.createElementVNode)('div',er,[C[23]||(C[23]=(0,n.createElementVNode)('label',null,'天氣',-1)),(0,n.withDirectives)((0,n.createElementVNode)('input',{'onUpdate:modelValue':C[7]||(C[7]=e=>s.value=e),type:'text',class:'form-input',placeholder:'輸入天氣'},null,512),[[n.vModelText,s.value]]),y.value?((0,n.openBlock)(),(0,n.createElementBlock)('div',tr,[C[22]||(C[22]=(0,n.createElementVNode)('label',null,'生成結果：',-1)),(0,n.createElementVNode)('div',ar,(0,n.toDisplayString)(y.value),1),(0,n.createElementVNode)('button',{class:'replace-btn',onClick:C[8]||(C[8]=e=>{s.value=y.value,y.value=''})},' 使用 ')])):(0,n.createCommentVNode)('v-if',!0)]),(0,n.createElementVNode)('div',nr,[C[25]||(C[25]=(0,n.createElementVNode)('label',null,'起始資訊',-1)),(0,n.withDirectives)((0,n.createElementVNode)('textarea',{'onUpdate:modelValue':C[9]||(C[9]=e=>c.value=e),class:'form-textarea',placeholder:'輸入起始資訊',rows:'3'},null,512),[[n.vModelText,c.value]]),b.value?((0,n.openBlock)(),(0,n.createElementBlock)('div',lr,[C[24]||(C[24]=(0,n.createElementVNode)('label',null,'生成結果：',-1)),(0,n.createElementVNode)('div',rr,(0,n.toDisplayString)(b.value),1),(0,n.createElementVNode)('button',{class:'replace-btn',onClick:C[10]||(C[10]=e=>{c.value=b.value,b.value=''})},' 使用 ')])):(0,n.createCommentVNode)('v-if',!0)]),(0,n.createElementVNode)('div',or,[C[26]||(C[26]=(0,n.createElementVNode)('label',null,'生成要求',-1)),(0,n.withDirectives)((0,n.createElementVNode)('textarea',{'onUpdate:modelValue':C[11]||(C[11]=e=>d.value=e),class:'form-textarea',placeholder:'輸入生成這些項目的要求',rows:'3'},null,512),[[n.vModelText,d.value]])]),(0,n.createElementVNode)('div',ir,[(0,n.createElementVNode)('button',{class:'action-btn generate',disabled:!(0,n.unref)(V)||u.value,onClick:B},[u.value?((0,n.openBlock)(),(0,n.createElementBlock)('span',cr)):(0,n.createCommentVNode)('v-if',!0),(0,n.createTextVNode)(' '+(0,n.toDisplayString)(u.value?'生成中...':(0,n.unref)(V)?'生成內容':'請先完成世界背景設定'),1)],8,sr),(0,n.createElementVNode)('button',{class:'action-btn apply-all',disabled:!(0,n.unref)(f),onClick:A},' 應用全部 ',8,dr)])]),(0,n.createCommentVNode)(' 標籤頁完成狀態指示器 '),(0,n.createElementVNode)('div',ur,[(0,n.createElementVNode)('div',{class:(0,n.normalizeClass)(['status-item',{completed:K()}])},[C[27]||(C[27]=(0,n.createElementVNode)('span',{class:'status-label'},'世界資訊：',-1)),(0,n.createElementVNode)('span',mr,(0,n.toDisplayString)(K()?'已完成':'未完成'),1)],2),(0,n.createElementVNode)('div',{class:(0,n.normalizeClass)(['status-item',{completed:U()}])},[C[28]||(C[28]=(0,n.createElementVNode)('span',{class:'status-label'},'用戶設定：',-1)),(0,n.createElementVNode)('span',vr,(0,n.toDisplayString)(U()?'已完成':'未完成'),1)],2),(0,n.createElementVNode)('div',{class:(0,n.normalizeClass)(['status-item',{completed:L()}])},[C[29]||(C[29]=(0,n.createElementVNode)('span',{class:'status-label'},'角色設定：',-1)),(0,n.createElementVNode)('span',pr,(0,n.toDisplayString)(L()?'已完成':'未完成'),1)],2),(0,n.createElementVNode)('div',{class:(0,n.normalizeClass)(['status-item',{completed:F()}])},[C[30]||(C[30]=(0,n.createElementVNode)('span',{class:'status-label'},'物品設定：',-1)),(0,n.createElementVNode)('span',gr,(0,n.toDisplayString)(F()?'已完成':'未完成'),1)],2),(0,n.createElementVNode)('div',{class:(0,n.normalizeClass)(['status-item',{completed:H()}])},[C[31]||(C[31]=(0,n.createElementVNode)('span',{class:'status-label'},'額外設定：',-1)),(0,n.createElementVNode)('span',_r,(0,n.toDisplayString)(H()?'已完成':'未完成'),1)],2),(0,n.createElementVNode)('div',{class:(0,n.normalizeClass)(['status-item',{completed:j()}])},[C[32]||(C[32]=(0,n.createElementVNode)('span',{class:'status-label'},'地點設定：',-1)),(0,n.createElementVNode)('span',hr,(0,n.toDisplayString)(j()?'已完成':'未完成'),1)],2),(0,n.createElementVNode)('div',{class:(0,n.normalizeClass)(['status-item',{completed:(0,n.unref)(k)}])},[C[33]||(C[33]=(0,n.createElementVNode)('span',{class:'status-label'},'開始設定：',-1)),(0,n.createElementVNode)('span',Er,(0,n.toDisplayString)((0,n.unref)(k)?'已完成':'未完成'),1)],2)]),(0,n.createCommentVNode)(' 設定匯出/匯入按鈕 '),(0,n.createElementVNode)('div',yr,[(0,n.createElementVNode)('button',{class:'action-btn export',onClick:q},'匯出初始化設定'),(0,n.createElementVNode)('label',br,[C[34]||(C[34]=(0,n.createTextVNode)(' 匯入初始化設定 ',-1)),(0,n.createElementVNode)('input',{type:'file',accept:'.json',style:{display:'none'},onChange:G},null,32)])]),(0,n.createCommentVNode)(' 開始按鈕 '),(0,n.createElementVNode)('div',Vr,[(0,n.createElementVNode)('button',{class:'action-btn start',disabled:!(0,n.unref)(w),onClick:P},'開始',8,Nr)])]))}}),kr=(0,d.A)(fr,[['__scopeId','data-v-ef5b3c42']]),wr=kr,Br={class:'user-profile-container'},Cr={class:'section'},$r={class:'form-grid'},Sr={class:'input-group'},xr={key:0,class:'generated-result'},Ir={class:'generated-text'},Dr={class:'input-group'},Tr={key:0,class:'generated-result'},Mr={class:'generated-text'},Or={class:'input-group'},Yr={key:0,class:'generated-result'},Ar={class:'generated-text'},Rr={class:'input-group'},Kr={key:0,class:'generated-result'},Ur={class:'generated-text'},zr={class:'input-group'},Lr={key:0,class:'generated-result'},Fr={class:'generated-text'},Hr={class:'input-group'},jr={class:'birthday-inputs'},Pr={key:0,class:'generated-result'},qr={class:'generated-text'},Gr={class:'section'},Wr={class:'form-grid'},Xr={class:'input-group'},Zr={key:0,class:'generated-result'},Jr={class:'generated-text'},Qr={class:'input-group'},eo={key:0,class:'generated-result'},to={class:'generated-text'},ao={class:'input-group'},no={key:0,class:'generated-result'},lo={class:'generated-text'},ro={class:'input-group'},oo={key:0,class:'generated-result'},io={class:'generated-text'},so={class:'input-group'},co={key:0,class:'generated-result'},uo={class:'generated-text'},mo={class:'input-group'},vo={key:0,class:'generated-result'},po={class:'generated-text'},go={class:'section'},_o={class:'form-grid'},ho={class:'input-group full-width'},Eo={key:0,class:'generated-result'},yo={class:'generated-text'},bo={class:'input-group full-width'},Vo={key:0,class:'generated-result'},No={class:'generated-text'},fo={class:'input-group full-width'},ko={key:0,class:'generated-result'},wo={class:'generated-text'},Bo={class:'section'},Co={class:'form-grid'},$o={class:'input-group full-width'},So={key:0,class:'generated-result'},xo={class:'generated-text'},Io={class:'input-group full-width'},Do={key:0,class:'generated-result'},To={class:'generated-text'},Mo={class:'input-group full-width'},Oo={key:0,class:'generated-result'},Yo={class:'generated-text'},Ao={class:'section'},Ro={class:'form-grid'},Ko={class:'input-group'},Uo={key:0,class:'generated-result'},zo={class:'generated-text'},Lo={class:'input-group full-width'},Fo={key:0,class:'generated-result'},Ho={class:'generated-text'},jo={class:'input-group full-width'},Po={class:'relations-list'},qo={class:'relation-target'},Go=['value','onInput'],Wo=['onClick'],Xo={class:'add-relation'},Zo=['value'],Jo=['disabled'],Qo={key:0,class:'generated-result'},ei={class:'generated-text'},ti={class:'input-group full-width'},ai={class:'inventory-list'},ni={class:'inventory-target'},li=['value','onInput'],ri=['onClick'],oi={class:'add-inventory'},ii=['value'],si=['disabled'],ci=['disabled'],di={key:0,class:'generated-result'},ui={class:'generated-text'},mi={class:'section'},vi={class:'form-grid'},pi={class:'input-group full-width'},gi={class:'action-section'},_i=['disabled'],hi={key:0,class:'loading-spinner'},Ei=['disabled'],yi=(0,n.defineComponent)({__name:'user_tab',setup(e){const t=(0,n.ref)({surname:'',name:'',age:null,gender:'',identity:'',introduction:'',personality:'',height:null,weight:null,chest_size:null,cup_size:'',waist_size:null,hips_size:null,hairstyle:'',appearance:'',clothes:'',birthday_month:null,birthday_day:null,favourite:'',extra_information:'',money:null,generation_requirement:'',關係:new Map,selected_relation_target:'',所持物:new Map,selected_inventory_item:'',selected_inventory_quantity:1,generated_surname:'',generated_name:'',generated_age:'',generated_gender:'',generated_identity:'',generated_introduction:'',generated_personality:'',generated_height:'',generated_weight:'',generated_chest_size:'',generated_cup_size:'',generated_waist_size:'',generated_hips_size:'',generated_hairstyle:'',generated_appearance:'',generated_clothes:'',generated_birthday_month:'',generated_birthday_day:'',generated_favourite:'',generated_extra_information:'',generated_money:'',generated_relationship:'',generated_inventory:''}),a=(0,n.ref)(!1),l=()=>{const e=new Map,t=getVariables({type:'chat'});if(t?.items)for(const[a,l]of Object.entries(t.items))e.set(a,(0,n.reactive)(l));return Array.from(e.entries())},r=e=>{if('c1'===e){const e=getVariables({type:'chat'}),t=e.characters?.c1;if(t){return`${t.姓氏||''}${t.名字||''}`.trim()||'未知用戶'}return'未知用戶'}{const t=getVariables({type:'chat'}),a=t.characters?.[e];if(a){return`${a.姓氏||''}${a.名字||''}`.trim()||'未知角色'}return'未知角色'}},o=e=>{const t=getVariables({type:'chat'}),a=t.items?.[e];return a&&a.name||'未知物品'},i=(0,n.computed)(()=>t.value.generated_surname||t.value.generated_name||t.value.generated_age||t.value.generated_gender||t.value.generated_identity||t.value.generated_introduction||t.value.generated_personality||t.value.generated_height||t.value.generated_weight||t.value.generated_chest_size||t.value.generated_cup_size||t.value.generated_waist_size||t.value.generated_hips_size||t.value.generated_hairstyle||t.value.generated_appearance||t.value.generated_clothes||t.value.generated_birthday_month||t.value.generated_birthday_day||t.value.generated_favourite||t.value.generated_extra_information||t.value.generated_money||t.value.generated_relationship||t.value.generated_inventory),s=()=>{const e=new Map,t=getVariables({type:'chat'});if(t?.characters)for(const[a,l]of Object.entries(t.characters))'c1'!==a&&e.set(a,(0,n.reactive)(l));return Array.from(e.entries())},c=(0,n.computed)(()=>{try{const e=getVariables({type:'chat'});return e?.world_info?.trim()}catch{return!1}}),d=()=>{try{const e=getVariables({type:'chat'}),a=e.characters||{},n={姓氏:t.value.surname,名字:t.value.name,年齡:t.value.age,性別:t.value.gender,身份:t.value.identity,簡介:t.value.introduction,性格:t.value.personality,身高:t.value.height,體重:t.value.weight,胸圍:t.value.chest_size,罩杯:t.value.cup_size,腰圍:t.value.waist_size,臀圍:t.value.hips_size,髮型:t.value.hairstyle,樣貌:t.value.appearance,衣著:t.value.clothes,生日月份:t.value.birthday_month,生日日期:t.value.birthday_day,愛好:t.value.favourite,其他重要資訊:t.value.extra_information,金錢:t.value.money,心情:50,性慾:0,關係:Object.fromEntries(t.value.關係||new Map),友好度:{},愛情度:{},所持物:Object.fromEntries(t.value.所持物||new Map)};a.c1=n,e.characters=a,replaceVariables(e,{type:'chat'})}catch(e){console.error('Failed to save user data to chat variables:',e)}},u=e=>'['+Object.entries(e).map(([e,t])=>'string'==typeof t?`'${e}':'${t}'`:`'${e}':${t}`).join(', ')+']',m=()=>{let e='\n</世界背景>\n';return e+='\n',e+=`${(()=>{const e=getVariables({type:'chat'}).characters;if(void 0===e)return'';let t='<CharacterStatus>\n';for(const[a,n]of Object.entries(e))'c1'!==a&&(t+=`id：${a}\n`,t+=`  姓氏：${n.姓氏||''}\n`,t+=`  名字：${n.名字||''}\n`,t+=`  年齡：${n.年齡||''}\n`,t+=`  性別：${n.性別||''}\n`,t+=`  身份：${n.身份||''}\n`,t+=`  身高：${n.身高||''}\n`,t+=`  體重：${n.體重||''}\n`,t+=`  胸圍：${n.胸圍||''}\n`,t+=`  罩杯：${n.罩杯||''}\n`,t+=`  腰圍：${n.腰圍||''}\n`,t+=`  臀圍：${n.臀圍||''}\n`,t+=`  髮型：${n.髮型||''}\n`,t+=`  樣貌：${n.樣貌||''}\n`,t+=`  衣著：${n.衣著||''}\n`,t+=`  簡介：${n.簡介||''}\n`,t+=`  性格：${n.性格||''}\n`,t+=`  愛好：${n.愛好||''}\n`,t+=`  金錢：${n.金錢||''}\n`,t+=`  心情：${n.心情||''}\n`,t+=`  性慾：${n.性慾||''}\n`,t+=`  生日月份：${n.生日月份||''}\n`,t+=`  生日日期：${n.生日日期||''}\n`,t+=`  其他重要資訊：${n.其他重要資訊||''}\n`,t+=`  關係：${u(n.關係)}\n`,t+=`  友好度：${u(n.友好度)}\n`,t+=`  愛情度：${u(n.愛情度)}\n\n`);return t+='</CharacterStatus>',t})()}\n`,e+='\n',e+=`${(()=>{let e='<ItemTable>\n';e+='|id|名稱|描述|價值|\n',e+='|---|---|---|---|\n';const t=getVariables({type:'chat'}).items;if(void 0===t)return'';for(const[a,n]of Object.entries(t))e+=`|${a}|${n.name}|${n.description}|${n.value}|\n`;return e+='</ItemTable>',e})()}\n`,e+='\n',e+=`${(()=>{let e='<LocationTable>\n';e+='|id|地點|位置|描述|子地點|\n',e+='|---|---|---|---|---|\n';const t=getVariables({type:'chat'}).locations;if(void 0===t)return'';for(const[a,n]of Object.entries(t)){const t=n.sub_location?n.sub_location.join(', '):'';e+=`|${a}|${n.name}|${n.location||''}|${n.description}|${t}|\n`}return e+='</LocationTable>',e})()}\n`,e+='\n',e+=`${(()=>{let e='';const t=getVariables({type:'chat'}).extra_world_info;if(void 0===t)return'';for(const a of Array.from(t))''!==a.name&&''!==a.content&&(e+=`<${a.name}>\n`,e+=`${a.content}\n`,e+=`</${a.name}>\n`,e+='\n');return e})()}\n`,e+='\n',e+='<生成要求>\n',e+=`${t.value.generation_requirement}\n`,e+='</生成要求>\n',e+='\n',e+='<example>\n',e+='# The following is an example of user input and expected output. Please strictly follow the style and format to generate the output. Output anything other than this format is prohibited.\n',e+='姓氏：string\n',e+='名字：string\n',e+='年齡：number\n',e+='性別：\'男\' | \'女\' | \'不明\'\n',e+='身份：\'以第三人稱客觀地描述\'\n',e+='簡介：\'以第三人稱客觀地描述\'\n',e+='性格：\'以第三人稱客觀地描述\'\n',e+='身高：number\n',e+='體重：number\n',e+='胸圍：number\n',e+='罩杯：\'Capital Letter\' | \'不適用\'\n',e+='腰圍：number\n',e+='臀圍：number\n',e+='髮型：\'以第三人稱客觀地描述\'\n',e+='樣貌：\'以第三人稱客觀地描述\'\n',e+='衣著：\'以第三人稱客觀地描述當前身上服裝\'\n',e+='生日(月)：number\n',e+='生日(日)：number\n',e+='喜好：\'以第三人稱客觀地描述\'\n',e+='其他重要資訊：\'以第三人稱客觀地描述\'\n',e+='金錢：number\n',e+='關係：[\'character_id\':\'對此角色的關係\', ...]\n',e+='所持物：[\'item_id\':quantity, ...]\n',e+='</example>',e},v=async()=>{a.value=!0;try{const e=(()=>{let e='請根據世界背景資訊、生成要求及已有角色資料，為用戶完善以下的角色資料設定：\n';return e+='\n',e+=`姓氏：${t.value.surname}\n`,e+=`名字：${t.value.name}\n`,e+=`年齡：${t.value.age}\n`,e+=`性別：${t.value.gender}\n`,e+=`身份：${t.value.identity}\n`,e+=`簡介：${t.value.introduction}\n`,e+=`性格：${t.value.personality}\n`,e+=`身高：${t.value.height}\n`,e+=`體重：${t.value.weight}\n`,e+=`胸圍：${t.value.chest_size}\n`,e+=`罩杯：${t.value.cup_size}\n`,e+=`腰圍：${t.value.waist_size}\n`,e+=`臀圍：${t.value.hips_size}\n`,e+=`髮型：${t.value.hairstyle}\n`,e+=`樣貌：${t.value.appearance}\n`,e+=`衣著：${t.value.clothes}\n`,e+=`生日(月)：${t.value.birthday_month}\n`,e+=`生日(日)：${t.value.birthday_day}\n`,e+=`喜好：${t.value.favourite}\n`,e+=`其他重要資訊：${t.value.extra_information}\n`,e+=`金錢：${t.value.money}\n`,e+=`關係：${u(Object.fromEntries(t.value.關係||new Map))}\n`,e+=`所持物：${u(Object.fromEntries(t.value.所持物||new Map))}\n`,e})(),a=(()=>{const e=getVariables({type:'chat'}).world_info;let t=getCharData('current').description;t=t.replace('{{getvar::world_info}}',e);let a='你是一個專業的角色設計助手，擅長創造豐富多彩的角色設定。請根據提供的世界背景及生成要求，為用戶完善角色資料。\n';return a+='\n',a+='<世界背景>\n','你是一個專業的角色設計助手，擅長創造豐富多彩的角色設定。請根據提供的世界背景及生成要求，為用戶完善角色資料。\n\n<世界背景>\n'})(),n=m(),l=await generateRaw({user_input:e,ordered_prompts:[{role:'system',content:a},'char_description',{role:'system',content:n},'user_input']});p(l);try{localStorage.setItem('user_profile_generated',JSON.stringify({generation_requirement:t.value.generation_requirement,generated_surname:t.value.generated_surname,generated_name:t.value.generated_name,generated_age:t.value.generated_age,generated_gender:t.value.generated_gender,generated_identity:t.value.generated_identity,generated_introduction:t.value.generated_introduction,generated_personality:t.value.generated_personality,generated_height:t.value.generated_height,generated_weight:t.value.generated_weight,generated_chest_size:t.value.generated_chest_size,generated_cup_size:t.value.generated_cup_size,generated_waist_size:t.value.generated_waist_size,generated_hips_size:t.value.generated_hips_size,generated_hairstyle:t.value.generated_hairstyle,generated_appearance:t.value.generated_appearance,generated_clothes:t.value.generated_clothes,generated_birthday_month:t.value.generated_birthday_month,generated_birthday_day:t.value.generated_birthday_day,generated_favourite:t.value.generated_favourite,generated_extra_information:t.value.generated_extra_information,generated_money:t.value.generated_money,generated_relationship:t.value.generated_relationship,generated_inventory:t.value.generated_inventory}))}catch(e){console.error('Failed to save generated user profile to localStorage:',e)}}catch(e){console.error('生成用戶資料失敗:',e),t.value.generated_age='生成失敗，請重試。'}finally{a.value=!1}},p=e=>{const a=e.split('\n'),n={};for(const e of a){const t=e.indexOf('：');if(t>0){const a=e.substring(0,t).trim(),l=e.substring(t+1).trim();switch(a){case'姓氏':n.generated_surname=l.replace(/^["']|["']$/g,'');break;case'名字':n.generated_name=l.replace(/^["']|["']$/g,'');break;case'年齡':n.generated_age=l.replace(/[^\d]/g,'');break;case'性別':n.generated_gender=l.replace(/^["']|["']$/g,'');break;case'身份':n.generated_identity=l.replace(/^["']|["']$/g,'');break;case'簡介':n.generated_introduction=l.replace(/^["']|["']$/g,'');break;case'性格':n.generated_personality=l.replace(/^["']|["']$/g,'');break;case'身高':n.generated_height=l.replace(/[^\d]/g,'');break;case'體重':n.generated_weight=l.replace(/[^\d]/g,'');break;case'胸圍':n.generated_chest_size=l.replace(/[^\d]/g,'');break;case'罩杯':n.generated_cup_size=l.replace(/^["']|["']$/g,'');break;case'腰圍':n.generated_waist_size=l.replace(/[^\d]/g,'');break;case'臀圍':n.generated_hips_size=l.replace(/[^\d]/g,'');break;case'髮型':n.generated_hairstyle=l.replace(/^["']|["']$/g,'');break;case'樣貌':n.generated_appearance=l.replace(/^["']|["']$/g,'');break;case'衣著':n.generated_clothes=l.replace(/^["']|["']$/g,'');break;case'生日(月)':n.generated_birthday_month=l.replace(/[^\d]/g,'');break;case'生日(日)':n.generated_birthday_day=l.replace(/[^\d]/g,'');break;case'喜好':n.generated_favourite=l.replace(/^["']|["']$/g,'');break;case'其他重要資訊':n.generated_extra_information=l.replace(/^["']|["']$/g,'');break;case'金錢':n.generated_money=l.replace(/[^\d]/g,'');break;case'關係':n.generated_relationship=l.replace(/^["']|["']$/g,'');break;case'所持物':n.generated_inventory=l.replace(/^["']|["']$/g,'')}}}Object.assign(t.value,n)},g=()=>{if(t.value.generated_surname&&(t.value.surname=t.value.generated_surname),t.value.generated_name&&(t.value.name=t.value.generated_name),t.value.generated_age&&(t.value.age=parseInt(t.value.generated_age)||null),t.value.generated_gender&&(t.value.gender=t.value.generated_gender),t.value.generated_identity&&(t.value.identity=t.value.generated_identity),t.value.generated_introduction&&(t.value.introduction=t.value.generated_introduction),t.value.generated_personality&&(t.value.personality=t.value.generated_personality),t.value.generated_height&&(t.value.height=parseInt(t.value.generated_height)||null),t.value.generated_weight&&(t.value.weight=parseInt(t.value.generated_weight)||null),t.value.generated_chest_size&&(t.value.chest_size=parseInt(t.value.generated_chest_size)||null),t.value.generated_cup_size&&(t.value.cup_size=t.value.generated_cup_size),t.value.generated_waist_size&&(t.value.waist_size=parseInt(t.value.generated_waist_size)||null),t.value.generated_hips_size&&(t.value.hips_size=parseInt(t.value.generated_hips_size)||null),t.value.generated_hairstyle&&(t.value.hairstyle=t.value.generated_hairstyle),t.value.generated_appearance&&(t.value.appearance=t.value.generated_appearance),t.value.generated_clothes&&(t.value.clothes=t.value.generated_clothes),t.value.generated_birthday_month&&(t.value.birthday_month=parseInt(t.value.generated_birthday_month)||null),t.value.generated_birthday_day&&(t.value.birthday_day=parseInt(t.value.generated_birthday_day)||null),t.value.generated_favourite&&(t.value.favourite=t.value.generated_favourite),t.value.generated_extra_information&&(t.value.extra_information=t.value.generated_extra_information),t.value.generated_money&&(t.value.money=parseInt(t.value.generated_money)||null),t.value.generated_relationship){t.value.關係||(t.value.關係=new Map);const e=t.value.generated_relationship.replace(/^["']|["']$/g,'');if(e.startsWith('[')&&e.endsWith(']')){const a=e.slice(1,-1).split(',').map(e=>e.trim());for(const e of a){const a=e.indexOf(':');if(a>0){const n=e.substring(0,a).replace(/^["']|["']$/g,'').trim(),l=e.substring(a+1).replace(/^["']|["']$/g,'').trim();n&&l&&t.value.關係.set(n,l)}}}t.value.generated_relationship=''}if(t.value.generated_inventory){t.value.所持物||(t.value.所持物=new Map);const e=t.value.generated_inventory.replace(/^["']|["']$/g,'');if(e.startsWith('[')&&e.endsWith(']')){const a=e.slice(1,-1).split(',').map(e=>e.trim());for(const e of a){const a=e.indexOf(':');if(a>0){const n=e.substring(0,a).replace(/^["']|["']$/g,'').trim(),l=parseInt(e.substring(a+1).replace(/^["']|["']$/g,'').trim());n&&!isNaN(l)&&l>0&&t.value.所持物.set(n,l)}}}t.value.generated_inventory=''}t.value.generated_surname='',t.value.generated_name='',t.value.generated_age='',t.value.generated_gender='',t.value.generated_identity='',t.value.generated_introduction='',t.value.generated_personality='',t.value.generated_height='',t.value.generated_weight='',t.value.generated_chest_size='',t.value.generated_cup_size='',t.value.generated_waist_size='',t.value.generated_hips_size='',t.value.generated_hairstyle='',t.value.generated_appearance='',t.value.generated_clothes='',t.value.generated_birthday_month='',t.value.generated_birthday_day='',t.value.generated_favourite='',t.value.generated_extra_information='',t.value.generated_money='',t.value.generated_relationship='',t.value.generated_inventory=''},h=()=>{t.value.selected_relation_target&&(t.value.關係||(t.value.關係=new Map),t.value.關係.set(t.value.selected_relation_target,''),t.value.selected_relation_target='',d())},E=()=>{if(!t.value.selected_inventory_item||!t.value.selected_inventory_quantity)return;t.value.所持物||(t.value.所持物=new Map);const e=t.value.所持物.get(t.value.selected_inventory_item)||0;t.value.所持物.set(t.value.selected_inventory_item,e+t.value.selected_inventory_quantity),t.value.selected_inventory_item='',t.value.selected_inventory_quantity=1,d()},y=(e,a)=>{switch(e){case'姓氏':t.value.surname=a,t.value.generated_surname='';break;case'名字':t.value.name=a,t.value.generated_name='';break;case'年齡':t.value.age=parseInt(a)||null,t.value.generated_age='';break;case'性別':t.value.gender=a,t.value.generated_gender='';break;case'身份':t.value.identity=a,t.value.generated_identity='';break;case'身高':t.value.height=parseInt(a)||null,t.value.generated_height='';break;case'體重':t.value.weight=parseInt(a)||null,t.value.generated_weight='';break;case'胸圍':t.value.chest_size=parseInt(a)||null,t.value.generated_chest_size='';break;case'罩杯':t.value.cup_size=a,t.value.generated_cup_size='';break;case'腰圍':t.value.waist_size=parseInt(a)||null,t.value.generated_waist_size='';break;case'臀圍':t.value.hips_size=parseInt(a)||null,t.value.generated_hips_size='';break;case'髮型':t.value.hairstyle=a,t.value.generated_hairstyle='';break;case'樣貌':t.value.appearance=a,t.value.generated_appearance='';break;case'衣著':t.value.clothes=a,t.value.generated_clothes='';break;case'簡介':t.value.introduction=a,t.value.generated_introduction='';break;case'性格':t.value.personality=a,t.value.generated_personality='';break;case'喜好':t.value.favourite=a,t.value.generated_favourite='';break;case'金錢':t.value.money=parseInt(a)||null,t.value.generated_money='';break;case'其他重要資訊':t.value.extra_information=a,t.value.generated_extra_information='';break;case'關係':{t.value.關係||(t.value.關係=new Map);const e=a.replace(/^["']|["']$/g,'');if(e.startsWith('[')&&e.endsWith(']')){const a=e.slice(1,-1).split(',').map(e=>e.trim());for(const e of a){const a=e.indexOf(':');if(a>0){const n=e.substring(0,a).replace(/^["']|["']$/g,'').trim(),l=e.substring(a+1).replace(/^["']|["']$/g,'').trim();n&&l&&t.value.關係.set(n,l)}}}t.value.generated_relationship='';break}case'所持物':{t.value.所持物||(t.value.所持物=new Map);const e=a.replace(/^["']|["']$/g,'');if(e.startsWith('[')&&e.endsWith(']')){const a=e.slice(1,-1).split(',').map(e=>e.trim());for(const e of a){const a=e.indexOf(':');if(a>0){const n=e.substring(0,a).replace(/^["']|["']$/g,'').trim(),l=parseInt(e.substring(a+1).replace(/^["']|["']$/g,'').trim());n&&!isNaN(l)&&l>0&&t.value.所持物.set(n,l)}}}t.value.generated_inventory='';break}}d()};return(0,n.watch)(t,()=>{d()},{deep:!0}),(0,n.watch)(()=>t.value.generation_requirement,e=>{try{const t=localStorage.getItem('user_profile_generated'),a=t?JSON.parse(t):{};a.generation_requirement=e,localStorage.setItem('user_profile_generated',JSON.stringify(a))}catch(e){console.error('Failed to save generation_requirement to localStorage:',e)}},{immediate:!1}),(0,n.onMounted)(()=>{(()=>{try{const e=(getVariables({type:'chat'}).characters||{}).c1;e&&(t.value.surname=e['姓氏']||'',t.value.name=e['名字']||'',t.value.age=e['年齡'],t.value.gender=e['性別']||'',t.value.identity=e['身份']||'',t.value.introduction=e['簡介']||'',t.value.personality=e['性格']||'',t.value.height=e['身高'],t.value.weight=e['體重'],t.value.chest_size=e['胸圍'],t.value.cup_size=e['罩杯']||'',t.value.waist_size=e['腰圍'],t.value.hips_size=e['臀圍'],t.value.hairstyle=e['髮型']||'',t.value.appearance=e['樣貌']||'',t.value.clothes=e['衣著']||'',t.value.favourite=e['愛好']||'',t.value.extra_information=e['其他重要資訊']||'',t.value.money=e['金錢'],t.value.birthday_month=e['生日月份'],t.value.birthday_day=e['生日日期'],e.關係?t.value.關係=new Map(Object.entries(e.關係)):t.value.關係=new Map,e.所持物?t.value.所持物=new Map(Object.entries(e.所持物)):t.value.所持物=new Map)}catch(e){console.error('Failed to load user data from chat variables:',e)}try{const e=localStorage.getItem('user_profile_generated');if(e){const a=JSON.parse(e);Object.assign(t.value,a)}}catch(e){console.error('Failed to load generated user profile from localStorage:',e)}})()}),(0,n.onBeforeUnmount)(()=>{d()}),(e,u)=>((0,n.openBlock)(),(0,n.createElementBlock)('div',Br,[u[103]||(u[103]=(0,n.createElementVNode)('h3',null,'用戶資料設定',-1)),(0,n.createCommentVNode)(' 基本資訊 '),(0,n.createElementVNode)('div',Cr,[u[60]||(u[60]=(0,n.createElementVNode)('h4',null,'基本資訊',-1)),(0,n.createElementVNode)('div',$r,[u[59]||(u[59]=(0,n.createElementVNode)('div',{class:'input-group'},[(0,n.createElementVNode)('label',null,'角色ID'),(0,n.createElementVNode)('div',{class:'display-text'},'c1')],-1)),(0,n.createElementVNode)('div',Sr,[u[48]||(u[48]=(0,n.createElementVNode)('label',{for:'surname-input'},'姓氏',-1)),(0,n.withDirectives)((0,n.createElementVNode)('input',{id:'surname-input','onUpdate:modelValue':u[0]||(u[0]=e=>t.value.surname=e),type:'text',placeholder:'例如：張',class:'text-input'},null,512),[[n.vModelText,t.value.surname]]),t.value.generated_surname?((0,n.openBlock)(),(0,n.createElementBlock)('div',xr,[u[47]||(u[47]=(0,n.createElementVNode)('label',null,'生成結果：',-1)),(0,n.createElementVNode)('div',Ir,(0,n.toDisplayString)(t.value.generated_surname),1),(0,n.createElementVNode)('button',{class:'replace-btn',onClick:u[1]||(u[1]=e=>{t.value.surname=t.value.generated_surname,t.value.generated_surname=''})},' 使用 ')])):(0,n.createCommentVNode)('v-if',!0)]),(0,n.createElementVNode)('div',Dr,[u[50]||(u[50]=(0,n.createElementVNode)('label',{for:'name-input'},'名字',-1)),(0,n.withDirectives)((0,n.createElementVNode)('input',{id:'name-input','onUpdate:modelValue':u[2]||(u[2]=e=>t.value.name=e),type:'text',placeholder:'例如：小明',class:'text-input'},null,512),[[n.vModelText,t.value.name]]),t.value.generated_name?((0,n.openBlock)(),(0,n.createElementBlock)('div',Tr,[u[49]||(u[49]=(0,n.createElementVNode)('label',null,'生成結果：',-1)),(0,n.createElementVNode)('div',Mr,(0,n.toDisplayString)(t.value.generated_name),1),(0,n.createElementVNode)('button',{class:'replace-btn',onClick:u[3]||(u[3]=e=>{t.value.name=t.value.generated_name,t.value.generated_name=''})},' 使用 ')])):(0,n.createCommentVNode)('v-if',!0)]),(0,n.createElementVNode)('div',Or,[u[52]||(u[52]=(0,n.createElementVNode)('label',{for:'age-input'},'年齡',-1)),(0,n.withDirectives)((0,n.createElementVNode)('input',{id:'age-input','onUpdate:modelValue':u[4]||(u[4]=e=>t.value.age=e),type:'number',placeholder:'例如：18',class:'text-input',min:'0',max:'200'},null,512),[[n.vModelText,t.value.age,void 0,{number:!0}]]),t.value.generated_age?((0,n.openBlock)(),(0,n.createElementBlock)('div',Yr,[u[51]||(u[51]=(0,n.createElementVNode)('label',null,'生成結果：',-1)),(0,n.createElementVNode)('div',Ar,(0,n.toDisplayString)(t.value.generated_age),1),(0,n.createElementVNode)('button',{class:'replace-btn',onClick:u[5]||(u[5]=e=>{t.value.age=parseInt(t.value.generated_age)||null,t.value.generated_age=''})},' 使用 ')])):(0,n.createCommentVNode)('v-if',!0)]),(0,n.createElementVNode)('div',Rr,[u[54]||(u[54]=(0,n.createElementVNode)('label',{for:'gender-input'},'性別',-1)),(0,n.withDirectives)((0,n.createElementVNode)('input',{id:'gender-input','onUpdate:modelValue':u[6]||(u[6]=e=>t.value.gender=e),type:'text',placeholder:'例如：女',class:'text-input'},null,512),[[n.vModelText,t.value.gender]]),t.value.generated_gender?((0,n.openBlock)(),(0,n.createElementBlock)('div',Kr,[u[53]||(u[53]=(0,n.createElementVNode)('label',null,'生成結果：',-1)),(0,n.createElementVNode)('div',Ur,(0,n.toDisplayString)(t.value.generated_gender),1),(0,n.createElementVNode)('button',{class:'replace-btn',onClick:u[7]||(u[7]=e=>{t.value.gender=t.value.generated_gender,t.value.generated_gender=''})},' 使用 ')])):(0,n.createCommentVNode)('v-if',!0)]),(0,n.createElementVNode)('div',zr,[u[56]||(u[56]=(0,n.createElementVNode)('label',{for:'identity-input'},'身份',-1)),(0,n.withDirectives)((0,n.createElementVNode)('input',{id:'identity-input','onUpdate:modelValue':u[8]||(u[8]=e=>t.value.identity=e),type:'text',placeholder:'例如：高中生',class:'text-input'},null,512),[[n.vModelText,t.value.identity]]),t.value.generated_identity?((0,n.openBlock)(),(0,n.createElementBlock)('div',Lr,[u[55]||(u[55]=(0,n.createElementVNode)('label',null,'生成結果：',-1)),(0,n.createElementVNode)('div',Fr,(0,n.toDisplayString)(t.value.generated_identity),1),(0,n.createElementVNode)('button',{class:'replace-btn',onClick:u[9]||(u[9]=e=>{t.value.identity=t.value.generated_identity,t.value.generated_identity=''})},' 使用 ')])):(0,n.createCommentVNode)('v-if',!0)]),(0,n.createElementVNode)('div',Hr,[u[58]||(u[58]=(0,n.createElementVNode)('label',{for:'birthday-input'},'生日',-1)),(0,n.createElementVNode)('div',jr,[(0,n.withDirectives)((0,n.createElementVNode)('input',{'onUpdate:modelValue':u[10]||(u[10]=e=>t.value.birthday_month=e),type:'number',placeholder:'月',class:'birthday-input',min:'1',max:'12'},null,512),[[n.vModelText,t.value.birthday_month,void 0,{number:!0}]]),(0,n.withDirectives)((0,n.createElementVNode)('input',{'onUpdate:modelValue':u[11]||(u[11]=e=>t.value.birthday_day=e),type:'number',placeholder:'日',class:'birthday-input',min:'1',max:'31'},null,512),[[n.vModelText,t.value.birthday_day,void 0,{number:!0}]])]),t.value.generated_birthday_month||t.value.generated_birthday_day?((0,n.openBlock)(),(0,n.createElementBlock)('div',Pr,[u[57]||(u[57]=(0,n.createElementVNode)('label',null,'生成結果：',-1)),(0,n.createElementVNode)('div',qr,(0,n.toDisplayString)(t.value.generated_birthday_month)+'月 '+(0,n.toDisplayString)(t.value.generated_birthday_day)+'日 ',1),(0,n.createElementVNode)('button',{class:'replace-btn',onClick:u[12]||(u[12]=e=>{t.value.birthday_month=parseInt(t.value.generated_birthday_month)||null,t.value.birthday_day=parseInt(t.value.generated_birthday_day)||null,t.value.generated_birthday_month='',t.value.generated_birthday_day=''})},' 使用 ')])):(0,n.createCommentVNode)('v-if',!0)])])]),(0,n.createCommentVNode)(' 外貌特徵 '),(0,n.createElementVNode)('div',Gr,[u[73]||(u[73]=(0,n.createElementVNode)('h4',null,'外貌特徵',-1)),(0,n.createElementVNode)('div',Wr,[(0,n.createElementVNode)('div',Xr,[u[62]||(u[62]=(0,n.createElementVNode)('label',{for:'height-input'},'身高 (cm)',-1)),(0,n.withDirectives)((0,n.createElementVNode)('input',{id:'height-input','onUpdate:modelValue':u[13]||(u[13]=e=>t.value.height=e),type:'number',placeholder:'例如：165',class:'text-input',min:'0',max:'300'},null,512),[[n.vModelText,t.value.height,void 0,{number:!0}]]),t.value.generated_height?((0,n.openBlock)(),(0,n.createElementBlock)('div',Zr,[u[61]||(u[61]=(0,n.createElementVNode)('label',null,'生成結果：',-1)),(0,n.createElementVNode)('div',Jr,(0,n.toDisplayString)(t.value.generated_height),1),(0,n.createElementVNode)('button',{class:'replace-btn',onClick:u[14]||(u[14]=e=>{t.value.height=parseInt(t.value.generated_height)||null,t.value.generated_height=''})},' 使用 ')])):(0,n.createCommentVNode)('v-if',!0)]),(0,n.createElementVNode)('div',Qr,[u[64]||(u[64]=(0,n.createElementVNode)('label',{for:'weight-input'},'體重 (kg)',-1)),(0,n.withDirectives)((0,n.createElementVNode)('input',{id:'weight-input','onUpdate:modelValue':u[15]||(u[15]=e=>t.value.weight=e),type:'number',placeholder:'例如：50',class:'text-input',min:'0',max:'500'},null,512),[[n.vModelText,t.value.weight,void 0,{number:!0}]]),t.value.generated_weight?((0,n.openBlock)(),(0,n.createElementBlock)('div',eo,[u[63]||(u[63]=(0,n.createElementVNode)('label',null,'生成結果：',-1)),(0,n.createElementVNode)('div',to,(0,n.toDisplayString)(t.value.generated_weight),1),(0,n.createElementVNode)('button',{class:'replace-btn',onClick:u[16]||(u[16]=e=>{t.value.weight=parseInt(t.value.generated_weight)||null,t.value.generated_weight=''})},' 使用 ')])):(0,n.createCommentVNode)('v-if',!0)]),(0,n.createElementVNode)('div',ao,[u[66]||(u[66]=(0,n.createElementVNode)('label',{for:'chest-size-input'},'胸圍 (cm)',-1)),(0,n.withDirectives)((0,n.createElementVNode)('input',{id:'chest-size-input','onUpdate:modelValue':u[17]||(u[17]=e=>t.value.chest_size=e),type:'number',placeholder:'例如：85',class:'text-input',min:'0',max:'200'},null,512),[[n.vModelText,t.value.chest_size,void 0,{number:!0}]]),t.value.generated_chest_size?((0,n.openBlock)(),(0,n.createElementBlock)('div',no,[u[65]||(u[65]=(0,n.createElementVNode)('label',null,'生成結果：',-1)),(0,n.createElementVNode)('div',lo,(0,n.toDisplayString)(t.value.generated_chest_size),1),(0,n.createElementVNode)('button',{class:'replace-btn',onClick:u[18]||(u[18]=e=>{t.value.chest_size=parseInt(t.value.generated_chest_size)||null,t.value.generated_chest_size=''})},' 使用 ')])):(0,n.createCommentVNode)('v-if',!0)]),(0,n.createElementVNode)('div',ro,[u[68]||(u[68]=(0,n.createElementVNode)('label',{for:'cup-size-input'},'罩杯',-1)),(0,n.withDirectives)((0,n.createElementVNode)('input',{id:'cup-size-input','onUpdate:modelValue':u[19]||(u[19]=e=>t.value.cup_size=e),type:'text',placeholder:'例如：C',class:'text-input'},null,512),[[n.vModelText,t.value.cup_size]]),t.value.generated_cup_size?((0,n.openBlock)(),(0,n.createElementBlock)('div',oo,[u[67]||(u[67]=(0,n.createElementVNode)('label',null,'生成結果：',-1)),(0,n.createElementVNode)('div',io,(0,n.toDisplayString)(t.value.generated_cup_size),1),(0,n.createElementVNode)('button',{class:'replace-btn',onClick:u[20]||(u[20]=e=>{t.value.cup_size=t.value.generated_cup_size,t.value.generated_cup_size=''})},' 使用 ')])):(0,n.createCommentVNode)('v-if',!0)]),(0,n.createElementVNode)('div',so,[u[70]||(u[70]=(0,n.createElementVNode)('label',{for:'waist-size-input'},'腰圍 (cm)',-1)),(0,n.withDirectives)((0,n.createElementVNode)('input',{id:'waist-size-input','onUpdate:modelValue':u[21]||(u[21]=e=>t.value.waist_size=e),type:'number',placeholder:'例如：60',class:'text-input',min:'0',max:'200'},null,512),[[n.vModelText,t.value.waist_size,void 0,{number:!0}]]),t.value.generated_waist_size?((0,n.openBlock)(),(0,n.createElementBlock)('div',co,[u[69]||(u[69]=(0,n.createElementVNode)('label',null,'生成結果：',-1)),(0,n.createElementVNode)('div',uo,(0,n.toDisplayString)(t.value.generated_waist_size),1),(0,n.createElementVNode)('button',{class:'replace-btn',onClick:u[22]||(u[22]=e=>{t.value.waist_size=parseInt(t.value.generated_waist_size)||null,t.value.generated_waist_size=''})},' 使用 ')])):(0,n.createCommentVNode)('v-if',!0)]),(0,n.createElementVNode)('div',mo,[u[72]||(u[72]=(0,n.createElementVNode)('label',{for:'hips-size-input'},'臀圍 (cm)',-1)),(0,n.withDirectives)((0,n.createElementVNode)('input',{id:'hips-size-input','onUpdate:modelValue':u[23]||(u[23]=e=>t.value.hips_size=e),type:'number',placeholder:'例如：88',class:'text-input',min:'0',max:'200'},null,512),[[n.vModelText,t.value.hips_size,void 0,{number:!0}]]),t.value.generated_hips_size?((0,n.openBlock)(),(0,n.createElementBlock)('div',vo,[u[71]||(u[71]=(0,n.createElementVNode)('label',null,'生成結果：',-1)),(0,n.createElementVNode)('div',po,(0,n.toDisplayString)(t.value.generated_hips_size),1),(0,n.createElementVNode)('button',{class:'replace-btn',onClick:u[24]||(u[24]=e=>{t.value.hips_size=parseInt(t.value.generated_hips_size)||null,t.value.generated_hips_size=''})},' 使用 ')])):(0,n.createCommentVNode)('v-if',!0)])])]),(0,n.createCommentVNode)(' 外觀描述 '),(0,n.createElementVNode)('div',go,[u[80]||(u[80]=(0,n.createElementVNode)('h4',null,'外觀描述',-1)),(0,n.createElementVNode)('div',_o,[(0,n.createElementVNode)('div',ho,[u[75]||(u[75]=(0,n.createElementVNode)('label',{for:'hairstyle-input'},'髮型',-1)),(0,n.withDirectives)((0,n.createElementVNode)('input',{id:'hairstyle-input','onUpdate:modelValue':u[25]||(u[25]=e=>t.value.hairstyle=e),type:'text',placeholder:'例如：黑色長直髮',class:'text-input'},null,512),[[n.vModelText,t.value.hairstyle]]),t.value.generated_hairstyle?((0,n.openBlock)(),(0,n.createElementBlock)('div',Eo,[u[74]||(u[74]=(0,n.createElementVNode)('label',null,'生成結果：',-1)),(0,n.createElementVNode)('div',yo,(0,n.toDisplayString)(t.value.generated_hairstyle),1),(0,n.createElementVNode)('button',{class:'replace-btn',onClick:u[26]||(u[26]=e=>{t.value.hairstyle=t.value.generated_hairstyle,t.value.generated_hairstyle=''})},' 使用 ')])):(0,n.createCommentVNode)('v-if',!0)]),(0,n.createElementVNode)('div',bo,[u[77]||(u[77]=(0,n.createElementVNode)('label',{for:'appearance-input'},'外貌',-1)),(0,n.withDirectives)((0,n.createElementVNode)('textarea',{id:'appearance-input','onUpdate:modelValue':u[27]||(u[27]=e=>t.value.appearance=e),placeholder:'描述外貌特徵...',class:'text-area',rows:'3'},null,512),[[n.vModelText,t.value.appearance]]),t.value.generated_appearance?((0,n.openBlock)(),(0,n.createElementBlock)('div',Vo,[u[76]||(u[76]=(0,n.createElementVNode)('label',null,'生成結果：',-1)),(0,n.createElementVNode)('div',No,(0,n.toDisplayString)(t.value.generated_appearance),1),(0,n.createElementVNode)('button',{class:'replace-btn',onClick:u[28]||(u[28]=e=>{t.value.appearance=t.value.generated_appearance,t.value.generated_appearance=''})},' 使用 ')])):(0,n.createCommentVNode)('v-if',!0)]),(0,n.createElementVNode)('div',fo,[u[79]||(u[79]=(0,n.createElementVNode)('label',{for:'clothes-input'},'服裝',-1)),(0,n.withDirectives)((0,n.createElementVNode)('textarea',{id:'clothes-input','onUpdate:modelValue':u[29]||(u[29]=e=>t.value.clothes=e),placeholder:'描述常穿的服裝...',class:'text-area',rows:'3'},null,512),[[n.vModelText,t.value.clothes]]),t.value.generated_clothes?((0,n.openBlock)(),(0,n.createElementBlock)('div',ko,[u[78]||(u[78]=(0,n.createElementVNode)('label',null,'生成結果：',-1)),(0,n.createElementVNode)('div',wo,(0,n.toDisplayString)(t.value.generated_clothes),1),(0,n.createElementVNode)('button',{class:'replace-btn',onClick:u[30]||(u[30]=e=>{t.value.clothes=t.value.generated_clothes,t.value.generated_clothes=''})},' 使用 ')])):(0,n.createCommentVNode)('v-if',!0)])])]),(0,n.createCommentVNode)(' 個性與喜好 '),(0,n.createElementVNode)('div',Bo,[u[87]||(u[87]=(0,n.createElementVNode)('h4',null,'個性與喜好',-1)),(0,n.createElementVNode)('div',Co,[(0,n.createElementVNode)('div',$o,[u[82]||(u[82]=(0,n.createElementVNode)('label',{for:'introduction-input'},'角色簡介',-1)),(0,n.withDirectives)((0,n.createElementVNode)('textarea',{id:'introduction-input','onUpdate:modelValue':u[31]||(u[31]=e=>t.value.introduction=e),placeholder:'簡單介紹自己...',class:'text-area',rows:'3'},null,512),[[n.vModelText,t.value.introduction]]),t.value.generated_introduction?((0,n.openBlock)(),(0,n.createElementBlock)('div',So,[u[81]||(u[81]=(0,n.createElementVNode)('label',null,'生成結果：',-1)),(0,n.createElementVNode)('div',xo,(0,n.toDisplayString)(t.value.generated_introduction),1),(0,n.createElementVNode)('button',{class:'replace-btn',onClick:u[32]||(u[32]=e=>{t.value.introduction=t.value.generated_introduction,t.value.generated_introduction=''})},' 使用 ')])):(0,n.createCommentVNode)('v-if',!0)]),(0,n.createElementVNode)('div',Io,[u[84]||(u[84]=(0,n.createElementVNode)('label',{for:'personality-input'},'個性',-1)),(0,n.withDirectives)((0,n.createElementVNode)('textarea',{id:'personality-input','onUpdate:modelValue':u[33]||(u[33]=e=>t.value.personality=e),placeholder:'描述性格特點...',class:'text-area',rows:'3'},null,512),[[n.vModelText,t.value.personality]]),t.value.generated_personality?((0,n.openBlock)(),(0,n.createElementBlock)('div',Do,[u[83]||(u[83]=(0,n.createElementVNode)('label',null,'生成結果：',-1)),(0,n.createElementVNode)('div',To,(0,n.toDisplayString)(t.value.generated_personality),1),(0,n.createElementVNode)('button',{class:'replace-btn',onClick:u[34]||(u[34]=e=>{t.value.personality=t.value.generated_personality,t.value.generated_personality=''})},' 使用 ')])):(0,n.createCommentVNode)('v-if',!0)]),(0,n.createElementVNode)('div',Mo,[u[86]||(u[86]=(0,n.createElementVNode)('label',{for:'favourite-input'},'喜好',-1)),(0,n.withDirectives)((0,n.createElementVNode)('textarea',{id:'favourite-input','onUpdate:modelValue':u[35]||(u[35]=e=>t.value.favourite=e),placeholder:'描述喜歡的事物...',class:'text-area',rows:'3'},null,512),[[n.vModelText,t.value.favourite]]),t.value.generated_favourite?((0,n.openBlock)(),(0,n.createElementBlock)('div',Oo,[u[85]||(u[85]=(0,n.createElementVNode)('label',null,'生成結果：',-1)),(0,n.createElementVNode)('div',Yo,(0,n.toDisplayString)(t.value.generated_favourite),1),(0,n.createElementVNode)('button',{class:'replace-btn',onClick:u[36]||(u[36]=e=>{t.value.favourite=t.value.generated_favourite,t.value.generated_favourite=''})},' 使用 ')])):(0,n.createCommentVNode)('v-if',!0)])])]),(0,n.createCommentVNode)(' 其他資訊 '),(0,n.createElementVNode)('div',Ao,[u[100]||(u[100]=(0,n.createElementVNode)('h4',null,'其他資訊',-1)),(0,n.createElementVNode)('div',Ro,[(0,n.createElementVNode)('div',Ko,[u[89]||(u[89]=(0,n.createElementVNode)('label',{for:'money-input'},'金錢',-1)),(0,n.withDirectives)((0,n.createElementVNode)('input',{id:'money-input','onUpdate:modelValue':u[37]||(u[37]=e=>t.value.money=e),type:'number',placeholder:'例如：10000',class:'text-input',min:'0'},null,512),[[n.vModelText,t.value.money,void 0,{number:!0}]]),t.value.generated_money?((0,n.openBlock)(),(0,n.createElementBlock)('div',Uo,[u[88]||(u[88]=(0,n.createElementVNode)('label',null,'生成結果：',-1)),(0,n.createElementVNode)('div',zo,(0,n.toDisplayString)(t.value.generated_money),1),(0,n.createElementVNode)('button',{class:'replace-btn',onClick:u[38]||(u[38]=e=>{t.value.money=parseInt(t.value.generated_money)||null,t.value.generated_money=''})},' 使用 ')])):(0,n.createCommentVNode)('v-if',!0)]),(0,n.createElementVNode)('div',Lo,[u[91]||(u[91]=(0,n.createElementVNode)('label',{for:'extra-info-input'},'其他重要資訊',-1)),(0,n.withDirectives)((0,n.createElementVNode)('textarea',{id:'extra-info-input','onUpdate:modelValue':u[39]||(u[39]=e=>t.value.extra_information=e),placeholder:'其他需要描述的資訊...',class:'text-area',rows:'3'},null,512),[[n.vModelText,t.value.extra_information]]),t.value.generated_extra_information?((0,n.openBlock)(),(0,n.createElementBlock)('div',Fo,[u[90]||(u[90]=(0,n.createElementVNode)('label',null,'生成結果：',-1)),(0,n.createElementVNode)('div',Ho,(0,n.toDisplayString)(t.value.generated_extra_information),1),(0,n.createElementVNode)('button',{class:'replace-btn',onClick:u[40]||(u[40]=e=>{t.value.extra_information=t.value.generated_extra_information,t.value.generated_extra_information=''})},' 使用 ')])):(0,n.createCommentVNode)('v-if',!0)]),(0,n.createElementVNode)('div',jo,[u[95]||(u[95]=(0,n.createElementVNode)('label',null,'關係',-1)),(0,n.createElementVNode)('div',Po,[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(Array.from(t.value.關係||new Map),([e,a])=>((0,n.openBlock)(),(0,n.createElementBlock)('div',{key:e,class:'relation-item'},[(0,n.createElementVNode)('span',qo,'['+(0,n.toDisplayString)(e)+'] '+(0,n.toDisplayString)(r(e)),1),u[92]||(u[92]=(0,n.createTextVNode)(' 是此角色的 ',-1)),(0,n.createElementVNode)('input',{value:a,type:'text',placeholder:'輸入關係描述',class:'relation-input',onInput:a=>((e,a)=>{t.value.關係||(t.value.關係=new Map);const n=new Map(t.value.關係);n.set(e,a),t.value.關係=n,d()})(e,a.target.value)},null,40,Go),(0,n.createElementVNode)('button',{class:'remove-relation-btn',onClick:a=>(e=>{if(!t.value.關係)return;const a=new Map(t.value.關係);a.delete(e),t.value.關係=a,d()})(e)},'×',8,Wo)]))),128)),(0,n.createElementVNode)('div',Xo,[(0,n.withDirectives)((0,n.createElementVNode)('select',{'onUpdate:modelValue':u[41]||(u[41]=e=>t.value.selected_relation_target=e),class:'relation-select'},[u[93]||(u[93]=(0,n.createElementVNode)('option',{value:''},'選擇目標角色',-1)),((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(s(),([e,t])=>((0,n.openBlock)(),(0,n.createElementBlock)('option',{key:e,value:e},(0,n.toDisplayString)(`${e}: ${t.姓氏||''}${t.名字||''}`),9,Zo))),128))],512),[[n.vModelSelect,t.value.selected_relation_target]]),(0,n.createElementVNode)('button',{class:'add-relation-btn',disabled:!t.value.selected_relation_target,onClick:h},' 添加關係 ',8,Jo)])]),t.value.generated_relationship?((0,n.openBlock)(),(0,n.createElementBlock)('div',Qo,[u[94]||(u[94]=(0,n.createElementVNode)('label',null,'生成結果：',-1)),(0,n.createElementVNode)('div',ei,(0,n.toDisplayString)(t.value.generated_relationship),1),(0,n.createElementVNode)('button',{class:'replace-btn',onClick:u[42]||(u[42]=e=>y('關係',t.value.generated_relationship))},' 使用 ')])):(0,n.createCommentVNode)('v-if',!0)]),(0,n.createElementVNode)('div',ti,[u[99]||(u[99]=(0,n.createElementVNode)('label',null,'所持物',-1)),(0,n.createElementVNode)('div',ai,[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(Array.from(t.value.所持物||new Map),([e,a])=>((0,n.openBlock)(),(0,n.createElementBlock)('div',{key:e,class:'inventory-item'},[(0,n.createElementVNode)('span',ni,'['+(0,n.toDisplayString)(e)+'] '+(0,n.toDisplayString)(o(e)),1),u[96]||(u[96]=(0,n.createTextVNode)(' : ',-1)),(0,n.createElementVNode)('input',{value:a,type:'number',placeholder:'數量',class:'inventory-input',min:'1',onInput:a=>((e,a)=>{t.value.所持物||(t.value.所持物=new Map);const n=new Map(t.value.所持物);a>0?n.set(e,a):n.delete(e),t.value.所持物=n,d()})(e,parseInt(a.target.value)||1)},null,40,li),(0,n.createElementVNode)('button',{class:'remove-inventory-btn',onClick:a=>(e=>{if(!t.value.所持物)return;const a=new Map(t.value.所持物);a.delete(e),t.value.所持物=a,d()})(e)},'×',8,ri)]))),128)),(0,n.createElementVNode)('div',oi,[(0,n.withDirectives)((0,n.createElementVNode)('select',{'onUpdate:modelValue':u[43]||(u[43]=e=>t.value.selected_inventory_item=e),class:'inventory-select'},[u[97]||(u[97]=(0,n.createElementVNode)('option',{value:''},'選擇物品',-1)),((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(l(),([e,t])=>((0,n.openBlock)(),(0,n.createElementBlock)('option',{key:e,value:e},(0,n.toDisplayString)(`${e}: ${t.name||'未知物品'}`),9,ii))),128))],512),[[n.vModelSelect,t.value.selected_inventory_item]]),(0,n.withDirectives)((0,n.createElementVNode)('input',{'onUpdate:modelValue':u[44]||(u[44]=e=>t.value.selected_inventory_quantity=e),type:'number',placeholder:'數量',class:'quantity-input',min:'1',disabled:!t.value.selected_inventory_item},null,8,si),[[n.vModelText,t.value.selected_inventory_quantity,void 0,{number:!0}]]),(0,n.createElementVNode)('button',{class:'add-inventory-btn',disabled:!t.value.selected_inventory_item||!t.value.selected_inventory_quantity,onClick:E},' 添加物品 ',8,ci)])]),t.value.generated_inventory?((0,n.openBlock)(),(0,n.createElementBlock)('div',di,[u[98]||(u[98]=(0,n.createElementVNode)('label',null,'生成結果：',-1)),(0,n.createElementVNode)('div',ui,(0,n.toDisplayString)(t.value.generated_inventory),1),(0,n.createElementVNode)('button',{class:'replace-btn',onClick:u[45]||(u[45]=e=>y('所持物',t.value.generated_inventory))},' 使用 ')])):(0,n.createCommentVNode)('v-if',!0)])])]),(0,n.createCommentVNode)(' 生成要求 '),(0,n.createElementVNode)('div',mi,[u[102]||(u[102]=(0,n.createElementVNode)('h4',null,'生成要求',-1)),(0,n.createElementVNode)('div',vi,[(0,n.createElementVNode)('div',pi,[u[101]||(u[101]=(0,n.createElementVNode)('label',{for:'generation-requirement-input'},'對AI生成的要求',-1)),(0,n.withDirectives)((0,n.createElementVNode)('textarea',{id:'generation-requirement-input','onUpdate:modelValue':u[46]||(u[46]=e=>t.value.generation_requirement=e),placeholder:'對AI生成的要求...',class:'text-area',rows:'3'},null,512),[[n.vModelText,t.value.generation_requirement]])])])]),(0,n.createCommentVNode)(' 生成按鈕 '),(0,n.createElementVNode)('div',gi,[(0,n.createElementVNode)('button',{class:'generate-btn',disabled:!(0,n.unref)(c)||a.value,onClick:v},[a.value?((0,n.openBlock)(),(0,n.createElementBlock)('span',hi)):(0,n.createCommentVNode)('v-if',!0),(0,n.createTextVNode)(' '+(0,n.toDisplayString)(a.value?'生成中...':(0,n.unref)(c)?'生成未填寫的字段':'請先完成世界背景設定'),1)],8,_i),(0,n.createElementVNode)('button',{class:'apply-all-btn',disabled:!(0,n.unref)(i),onClick:g},'應用全部',8,Ei)])]))}}),bi=(0,d.A)(yi,[['__scopeId','data-v-76149319']]),Vi={class:'world-background-container'},Ni={class:'input-group'},fi={class:'input-group'},ki={class:'input-group'},wi={class:'input-group'},Bi=['disabled'],Ci={key:0,class:'loading-spinner'},$i={class:'info-section'},Si={class:'input-group'},xi={class:'input-group'},Ii=['disabled'],Di=(0,n.defineComponent)({__name:'world_info_tab',setup(e){const t=(0,n.ref)(''),a=(0,n.ref)(''),l=(0,n.ref)(''),r=(0,n.ref)(''),o=(0,n.ref)(!1),i=(0,n.ref)(''),s=(0,n.ref)(''),c=(0,n.computed)(()=>t.value.trim()||a.value.trim()||l.value.trim()||r.value.trim()),d=()=>{try{const e={place:t.value,era:a.value,style:l.value,additional_conditions:r.value};localStorage.setItem('world_info_input_fields',JSON.stringify(e))}catch(e){console.error('Failed to save input fields to localStorage:',e)}};(0,n.watch)([t,a,l,r],()=>{d()}),(0,n.watch)(i,e=>{try{insertOrAssignVariables({world_info:e},{type:'chat'})}catch(e){console.error('Failed to save world info:',e)}}),(0,n.onMounted)(()=>{(()=>{try{const e=localStorage.getItem('world_info_input_fields');if(e){const n=JSON.parse(e);t.value=n.place||'',a.value=n.era||'',l.value=n.style||'',r.value=n.additional_conditions||''}}catch(e){console.error('Failed to load input fields from localStorage:',e)}try{const e=localStorage.getItem('world_info_generated');e&&(s.value=e)}catch(e){console.error('Failed to load generated world info from localStorage:',e)}})(),(()=>{try{const e=getVariables({type:'chat'});e?.world_info&&(i.value=e.world_info)}catch(e){console.error('Failed to load world info:',e)}})()}),(0,n.onBeforeUnmount)(()=>{d()});const u=(e,t,a,n)=>{let l='請根據以下資訊生成一個詳細的世界背景設定：\n';return l+='\n',l+=`地點：${e||'未指定'}\n`,l+=`時代：${t||'未指定'}\n`,l+=`風格：${a||'未指定'}\n`,l+=`額外條件：${n||'無'}\n`,l+='\n',l+='請生成一個完整且詳細的世界背景描述，包括環境、地圖、社會結構、文化特色等元素。',l},m=async()=>{o.value=!0;try{const e=u(t.value,a.value,l.value,r.value),n='你是一個專業的世界構築助手，擅長創造豐富多彩的奇幻世界。請根據用戶提供的資訊，嚴格遵守以下例子的格式，生成世界背景設定。';let o='<example>\n';o+='# The following is an example of user input and expected output. Please strictly follow the style and format to generate the output.\n',o+='<UserInput>\n',o+=`${u('櫻妻市','現代','青春，日常，校園，戀愛喜劇','無')}\n`,o+='</UserInput>\n',o+='\n',o+='<GeneratedOutput>\n  - <char> is a virtual interactive novel engine designed specifically for <user>, vividly role-playing every school character except <user>, creating an immersive Japanese anime-style high school romance experience.\n  - allows vivid portrayals of various scenarios, including innocent, subtly romantic scenes and youth-focused situations with mature elements, free from the limitations of real-world moral scales.\n  - World setting: The story happens in a Japanese coastal fictional city: "櫻妻市", featuring the city\'s only high school, "櫻妻市國立中學". The world logic has high flexibility, centered purely upon internal consistency of school setting without real-world rules.\n  - Environment & atmosphere setup: Most events prominently take place within the vivid daytime campus environment of "櫻妻市國立中學", a beautifully stylized coastal school campus with rich and authentic Japanese anime-style youth atmosphere.\n  - Exceptional immersion in youth atmosphere: Offer subtle, detailed, vividly realized scenarios in a genuine Japanese-school youths\' daily experiences, allowing great freedom for subtle interactions and tastes ranging from pure, simple school life to delicate adolescent romance and relationships.\n',o+='</GeneratedOutput>\n',o+='</example>';let i=await generateRaw({user_input:e,ordered_prompts:[{role:'system',content:n},{role:'system',content:o},'user_input']});const c=SillyTavern.name1,d=SillyTavern.name2;i=i.replace(/<user>/g,c),i=i.replace(/<char>/g,d),s.value=i;try{localStorage.setItem('world_info_generated',i)}catch(e){console.error('Failed to save generated world info to localStorage:',e)}}catch(e){console.error('生成世界背景失敗:',e),s.value='生成失敗，請重試。'}finally{o.value=!1}},v=()=>{if(s.value.trim()){i.value=s.value;try{insertOrAssignVariables({world_info:s.value},{type:'chat'})}catch(e){console.error('Failed to save world info:',e)}}};return(e,d)=>((0,n.openBlock)(),(0,n.createElementBlock)('div',Vi,[d[12]||(d[12]=(0,n.createElementVNode)('h3',null,'世界背景設定',-1)),(0,n.createElementVNode)('div',Ni,[d[6]||(d[6]=(0,n.createElementVNode)('label',{for:'place-input'},'地點',-1)),(0,n.withDirectives)((0,n.createElementVNode)('input',{id:'place-input','onUpdate:modelValue':d[0]||(d[0]=e=>t.value=e),type:'text',placeholder:'例如：東京、魔法森林、太空站...',class:'text-input'},null,512),[[n.vModelText,t.value]])]),(0,n.createElementVNode)('div',fi,[d[7]||(d[7]=(0,n.createElementVNode)('label',{for:'era-input'},'時代',-1)),(0,n.withDirectives)((0,n.createElementVNode)('input',{id:'era-input','onUpdate:modelValue':d[1]||(d[1]=e=>a.value=e),type:'text',placeholder:'例如：中世紀、現代、未來...',class:'text-input'},null,512),[[n.vModelText,a.value]])]),(0,n.createElementVNode)('div',ki,[d[8]||(d[8]=(0,n.createElementVNode)('label',{for:'style-input'},'風格',-1)),(0,n.withDirectives)((0,n.createElementVNode)('input',{id:'style-input','onUpdate:modelValue':d[2]||(d[2]=e=>l.value=e),type:'text',placeholder:'例如：奇幻、科幻、現實主義...',class:'text-input'},null,512),[[n.vModelText,l.value]])]),(0,n.createElementVNode)('div',wi,[d[9]||(d[9]=(0,n.createElementVNode)('label',{for:'additional-conditions-input'},'其他額外條件',-1)),(0,n.withDirectives)((0,n.createElementVNode)('textarea',{id:'additional-conditions-input','onUpdate:modelValue':d[3]||(d[3]=e=>r.value=e),placeholder:'例如：魔法系統、特殊規則、重要事件...',class:'text-area',rows:'4'},null,512),[[n.vModelText,r.value]])]),(0,n.createElementVNode)('button',{class:'generate-btn',disabled:o.value||!c.value,onClick:m},[o.value?((0,n.openBlock)(),(0,n.createElementBlock)('span',Ci)):(0,n.createCommentVNode)('v-if',!0),(0,n.createTextVNode)(' '+(0,n.toDisplayString)(o.value?'生成中...':'生成'),1)],8,Bi),(0,n.createElementVNode)('div',$i,[(0,n.createElementVNode)('div',Si,[d[10]||(d[10]=(0,n.createElementVNode)('label',{for:'current-world-info'},'當前世界資訊',-1)),(0,n.withDirectives)((0,n.createElementVNode)('textarea',{id:'current-world-info','onUpdate:modelValue':d[4]||(d[4]=e=>i.value=e),placeholder:'當前世界資訊將顯示在這裡...',class:'text-area',rows:'6'},null,512),[[n.vModelText,i.value]])]),(0,n.createElementVNode)('div',xi,[d[11]||(d[11]=(0,n.createElementVNode)('label',{for:'generated-world-info'},'生成的世界資訊',-1)),(0,n.withDirectives)((0,n.createElementVNode)('textarea',{id:'generated-world-info','onUpdate:modelValue':d[5]||(d[5]=e=>s.value=e),placeholder:'點擊生成按鈕後，生成的世界資訊將顯示在這裡...',class:'text-area',rows:'6',readonly:''},null,512),[[n.vModelText,s.value]])]),(0,n.createElementVNode)('button',{class:'replace-btn',disabled:!s.value.trim(),onClick:v},' 替換為生成的世界資訊 ',8,Ii)])]))}}),Ti=(0,d.A)(Di,[['__scopeId','data-v-6467ee74']]),Mi={class:'initializations-container'},Oi={class:'tab-navigation top first-row'},Yi={class:'tab-navigation top second-row'},Ai={class:'main-content'},Ri={key:0,class:'initialization-area'},Ki={key:1,class:'initialization-area'},Ui={key:2,class:'initialization-area'},zi={key:3,class:'initialization-area'},Li={key:4,class:'initialization-area'},Fi={key:5,class:'initialization-area'},Hi={key:6,class:'initialization-area'},ji=(0,n.defineComponent)({__name:'initialization_interface',setup(e){const t=(0,n.ref)('world_info'),a=e=>{t.value=e};return(e,l)=>((0,n.openBlock)(),(0,n.createElementBlock)('div',Mi,[(0,n.createCommentVNode)(' 第一行標籤 '),(0,n.createElementVNode)('div',Oi,[(0,n.createElementVNode)('button',{class:(0,n.normalizeClass)(['tab-button',{active:'world_info'===t.value}]),onClick:l[0]||(l[0]=e=>a('world_info'))},' 世界背景 ',2),(0,n.createElementVNode)('button',{class:(0,n.normalizeClass)(['tab-button',{active:'user'===t.value}]),onClick:l[1]||(l[1]=e=>a('user'))},'用戶',2),(0,n.createElementVNode)('button',{class:(0,n.normalizeClass)(['tab-button',{active:'character'===t.value}]),onClick:l[2]||(l[2]=e=>a('character'))},' 角色 ',2),(0,n.createElementVNode)('button',{class:(0,n.normalizeClass)(['tab-button',{active:'item'===t.value}]),onClick:l[3]||(l[3]=e=>a('item'))},'物品',2)]),(0,n.createCommentVNode)(' 第二行標籤 '),(0,n.createElementVNode)('div',Yi,[(0,n.createElementVNode)('button',{class:(0,n.normalizeClass)(['tab-button',{active:'location'===t.value}]),onClick:l[4]||(l[4]=e=>a('location'))},'地點',2),(0,n.createElementVNode)('button',{class:(0,n.normalizeClass)(['tab-button',{active:'extra'===t.value}]),onClick:l[5]||(l[5]=e=>a('extra'))},'其他',2),(0,n.createElementVNode)('button',{class:(0,n.normalizeClass)(['tab-button',{active:'start'===t.value}]),onClick:l[6]||(l[6]=e=>a('start'))},'開始',2)]),(0,n.createElementVNode)('div',Ai,['start'===t.value?((0,n.openBlock)(),(0,n.createElementBlock)('div',Ri,[(0,n.createVNode)(wr)])):'world_info'===t.value?((0,n.openBlock)(),(0,n.createElementBlock)('div',Ki,[(0,n.createVNode)(Ti)])):'user'===t.value?((0,n.openBlock)(),(0,n.createElementBlock)('div',Ui,[(0,n.createVNode)(bi)])):'character'===t.value?((0,n.openBlock)(),(0,n.createElementBlock)('div',zi,[(0,n.createVNode)(Oa)])):'item'===t.value?((0,n.openBlock)(),(0,n.createElementBlock)('div',Li,[(0,n.createVNode)(On)])):'location'===t.value?((0,n.openBlock)(),(0,n.createElementBlock)('div',Fi,[(0,n.createVNode)(xl)])):'extra'===t.value?((0,n.openBlock)(),(0,n.createElementBlock)('div',Hi,[(0,n.createVNode)(ln)])):(0,n.createCommentVNode)('v-if',!0)])]))}}),Pi=(0,d.A)(ji,[['__scopeId','data-v-252c6a8b']]),qi={class:'confirm-dialog-header'},Gi={class:'confirm-dialog-body'},Wi={class:'confirm-dialog-footer'},Xi=['data-confirm-text'],Zi=(0,n.defineComponent)({__name:'confirmation_window',props:{confirmDialog:{}},emits:['update:confirm_dialog','confirm-dialog-confirm','confirm-dialog-cancel'],setup(e,{expose:t,emit:a}){const l=a,r=()=>{l('confirm-dialog-confirm')},o=()=>{l('confirm-dialog-cancel')},i=()=>{o()};return t({}),(t,a)=>((0,n.openBlock)(),(0,n.createElementBlock)('div',null,[(0,n.createCommentVNode)(' ConfirmDialog 組件 '),e.confirmDialog.visible?((0,n.openBlock)(),(0,n.createElementBlock)('div',{key:0,class:'confirm-dialog-overlay',onClick:i},[(0,n.createElementVNode)('div',{class:'confirm-dialog',onClick:a[0]||(a[0]=(0,n.withModifiers)(()=>{},['stop']))},[(0,n.createElementVNode)('div',qi,[(0,n.createElementVNode)('h3',null,(0,n.toDisplayString)(e.confirmDialog.title),1)]),(0,n.createElementVNode)('div',Gi,[(0,n.createElementVNode)('p',null,(0,n.toDisplayString)(e.confirmDialog.message),1)]),(0,n.createElementVNode)('div',Wi,[(0,n.createElementVNode)('button',{class:'confirm-btn cancel-btn',onClick:o},(0,n.toDisplayString)(e.confirmDialog.cancelText),1),(0,n.createElementVNode)('button',{class:'confirm-btn confirm-action-btn','data-confirm-text':e.confirmDialog.confirmText,onClick:r},(0,n.toDisplayString)(e.confirmDialog.confirmText),9,Xi)])])])):(0,n.createCommentVNode)('v-if',!0)]))}}),Ji={class:'progress-bar-container'},Qi={class:'progress-bar-label'},es={class:'progress-bar-wrapper'},ts={class:'progress-bar-value'},as=(0,n.defineComponent)({__name:'progress_bar',props:{label:{},value:{},min:{default:0},max:{default:100},unit:{default:''},color:{default:'#007acc'},attributeType:{default:''}},setup(e){const t=e,a=(0,n.computed)(()=>{const{attributeType:e,value:a}=t;switch(e){case'mood':return a>=0?{color:'#ffdd44',min:0,max:100,isReverse:!1}:{color:'#007acc',min:0,max:100,isReverse:!1};case'horny':return{color:'#ff44aa',min:0,max:100,isReverse:!1};case'friendship':return a>=0?{color:'#44ff44',min:0,max:1e3,isReverse:!1}:{color:'#888888',min:0,max:1e3,isReverse:!1};case'love':return{color:'#ff4444',min:0,max:1e3,isReverse:!1};default:return{color:t.color,min:t.min,max:t.max,isReverse:!1}}}),l=(0,n.computed)(()=>{const e=a.value,n=Math.abs(t.value),l=Math.max(e.min,Math.min(e.max,n)),r=e.max-e.min;return(l-e.min)/r*100}),r=(0,n.computed)(()=>{const e=a.value;return`linear-gradient(90deg, ${e.color} 0%, ${e.color}dd 100%)`});return(t,a)=>((0,n.openBlock)(),(0,n.createElementBlock)('div',Ji,[(0,n.createElementVNode)('div',Qi,(0,n.toDisplayString)(e.label),1),(0,n.createElementVNode)('div',es,[(0,n.createElementVNode)('div',{class:'progress-bar-fill',style:(0,n.normalizeStyle)({width:`${(0,n.unref)(l)}%`,background:(0,n.unref)(r)})},null,4),(0,n.createElementVNode)('div',ts,(0,n.toDisplayString)(e.value)+(0,n.toDisplayString)(e.unit),1)])]))}}),ns=(0,d.A)(as,[['__scopeId','data-v-be0274c0']]),ls={class:'character-tab-container'},rs={key:0,class:'character-content'},os={class:'character-section'},is={class:'character-list'},ss=['onClick'],cs=['onClick'],ds={key:1,class:'character-progress-bars'},us={key:0,class:'no-characters-message'},ms={class:'character-section'},vs={class:'character-list'},ps=['onClick'],gs=['onClick'],_s={key:1,class:'character-progress-bars'},hs={key:0,class:'no-characters-message'},Es={class:'character-detail-content'},ys={class:'character-header'},bs={class:'header-buttons'},Vs={class:'character-detail-name'},Ns={class:'attributes-grid'},fs={class:'attribute-item horizontal'},ks={key:0,class:'attribute-value'},ws={class:'attribute-item horizontal'},Bs={key:0,class:'attribute-value'},Cs={class:'attribute-item horizontal'},$s={key:0,class:'attribute-value'},Ss={class:'attribute-item horizontal'},xs={key:0,class:'attribute-value'},Is={class:'attribute-item horizontal'},Ds={key:0,class:'attribute-value'},Ts={class:'attribute-item horizontal'},Ms={key:0,class:'attribute-value'},Os={class:'attribute-item horizontal'},Ys={key:0,class:'attribute-value'},As={class:'attribute-item horizontal'},Rs={key:0,class:'attribute-value'},Ks={class:'attribute-item horizontal'},Us={key:0,class:'attribute-value'},zs={class:'attribute-item horizontal'},Ls={key:0,class:'attribute-value'},Fs={class:'attribute-item full-width horizontal'},Hs={key:0,class:'attribute-value money'},js={class:'attribute-item full-width birthday-fullwidth'},Ps={key:0,class:'attribute-value'},qs={key:1,class:'birthday-edit-container'},Gs={class:'birthday-input-group'},Ws={key:0,class:'attribute-item full-width'},Xs={key:1,class:'progress-edit-container'},Zs={key:1,class:'attribute-item full-width'},Js={key:1,class:'progress-edit-container'},Qs={class:'attribute-item full-width'},ec={key:0,class:'attribute-value no-bold'},tc={class:'attribute-item full-width'},ac={key:0,class:'attribute-value no-bold'},nc={class:'attribute-item full-width'},lc={key:0,class:'attribute-value no-bold'},rc={class:'attribute-item full-width'},oc={key:0,class:'attribute-value no-bold'},ic={class:'attribute-item full-width'},sc={key:0,class:'attribute-value no-bold'},cc={class:'attribute-item full-width'},dc={key:0,class:'attribute-value no-bold'},uc={class:'attribute-item full-width'},mc={key:0,class:'attribute-value no-bold'},vc={key:2,class:'attribute-item full-width'},pc={key:0,class:'attribute-value no-bold'},gc={class:'relations-section'},_c={key:0,class:'relations-list'},hc={class:'relation-highlight'},Ec={class:'relation-highlight'},yc={key:0,class:'no-message'},bc={key:1,class:'relations-edit-list'},Vc=['value','onChange'],Nc=['value'],fc=['onUpdate:modelValue'],kc=['onClick'],wc={key:0,class:'friendships-section'},Bc={key:0,class:'friendships-list'},Cc={key:0,class:'no-message'},$c={key:1,class:'friendships-edit-list'},Sc=['value','onChange'],xc=['value'],Ic=['onUpdate:modelValue','onInput','onBlur'],Dc=['onClick'],Tc={key:1,class:'loves-section'},Mc={key:0,class:'loves-list'},Oc={key:0,class:'no-message'},Yc={key:1,class:'loves-edit-list'},Ac=['value','onChange'],Rc=['value'],Kc=['onUpdate:modelValue','onInput','onBlur'],Uc=['onClick'],zc={class:'inventory-section'},Lc={key:0,class:'inventory-list'},Fc={class:'inventory-first-row'},Hc={class:'item-name-id'},jc={key:0,class:'item-quantity'},Pc={key:1,class:'storage-indicator'},qc={class:'inventory-second-row'},Gc={key:0,class:'inventory-third-row'},Wc={key:0,class:'no-inventory'},Xc={key:1,class:'inventory-items'},Zc={key:0,class:'no-message'},Jc={key:1,class:'inventory-edit-list'},Qc=['value','onChange'],ed={label:'物品'},td=['value'],ad={label:'貯存點'},nd=['value'],ld={key:0,class:'inventory-edit-connector'},rd=['onUpdate:modelValue'],od=['onClick'],id={key:2,class:'edit-buttons'},sd=['disabled'],cd=(0,n.defineComponent)({__name:'character_tab',setup(e,{expose:t}){(0,n.useCssVars)(e=>({v1299b277:d.value}));const a=(0,n.ref)(!1),l=(0,n.ref)(!1),r=(0,n.ref)(null),o=(0,n.ref)(''),i=(0,n.ref)({visible:!1,title:'',message:'',confirmText:'',cancelText:''}),s=(0,n.ref)(0),c=(0,n.ref)(null),d=(0,n.computed)(()=>`calc(100vh - ${s.value}px)`);t({handleTabClick:()=>{h.value?(a.value&&G(),h.value=null):l.value&&G()}});const u=(0,n.computed)(()=>{if(!l.value||!r.value)return!1;return['名稱','性別','年齡','身高','體重','胸圍','罩杯','腰圍','臀圍','身份','髮型','樣貌','衣著','愛好','簡介','性格','其他重要資訊'].some(e=>{const t=r.value[e];return null==t||''===t||'string'==typeof t&&''===t.trim()})}),m=(0,n.computed)({get:()=>r.value?.[Dl.RELATIONS_KEY]||{},set:e=>{r.value&&(r.value[Dl.RELATIONS_KEY]=e)}}),v=(0,n.computed)({get:()=>r.value?.[Dl.INVENTORY_KEY]||{},set:e=>{r.value&&(r.value[Dl.INVENTORY_KEY]=e)}}),p=(0,n.computed)({get:()=>r.value?.[Dl.FRIENDSHIPS_KEY]||{},set:e=>{r.value&&(r.value[Dl.FRIENDSHIPS_KEY]=e)}}),g=(0,n.computed)({get:()=>r.value?.[Dl.LOVES_KEY]||{},set:e=>{r.value&&(r.value[Dl.LOVES_KEY]=e)}}),h=(0,n.ref)(null),E=(0,n.ref)(null),y=()=>{try{const e=getLastMessageId();E.value=Rl.loadFromVariable(e)}catch(e){console.error('Failed to load state:',e),E.value=null}};y(),(0,n.onMounted)(()=>{(0,n.nextTick)(()=>{W()})}),(0,n.onUnmounted)(()=>{X()});const b=(0,n.computed)(()=>E.value?.active_characters||new Map),V=(0,n.computed)(()=>E.value?.deactive_characters||new Map),N=(0,n.computed)(()=>h.value&&E.value?E.value.getCharacter(h.value):null),f=(0,n.computed)(()=>{if(!E.value)return[];const e=[];for(const[t,a]of E.value.active_characters)t!==h.value&&e.push({id:t,name:a.name});for(const[t,a]of E.value.deactive_characters)t!==h.value&&e.push({id:t,name:a.name});return e}),k=(0,n.computed)(()=>{if(!E.value)return[];const e=[];for(const[t,a]of E.value.items)e.push({id:t,name:a.name,type:'item'});for(const[t,a]of E.value.storages)e.push({id:t,name:a.name,type:'storage'});return e}),w=e=>{if(!E.value)return'未知';const t=E.value.items.get(e);if(t)return t.name;const a=E.value.storages.get(e);return a?a.name:'未知'},B=e=>E.value?.storages.has(e)||!1,C=e=>{const t=E.value?.storages.get(e);return t?.inventory.size||0},S=e=>{const t=E.value?.storages.get(e);return t?.inventory||new Map},x=e=>{if(!E.value)return'無描述';const t=E.value.items.get(e);if(t)return t.description;const a=E.value.storages.get(e);return a?a.description:'無描述'},I=e=>{h.value=e},D=e=>{if(!E.value||'c1'===e)return;const t=E.value.getCharacter(e);if(!t)return;E.value.active_characters.has(e)?(E.value.active_characters.delete(e),E.value.deactive_characters.set(e,t)):(E.value.deactive_characters.delete(e),E.value.active_characters.set(e,t)),E.value.saveAsVariable(getLastMessageId()),y()},T=()=>{a.value&&G(),h.value=null},M=()=>{N.value&&'c1'!==h.value&&(i.value={visible:!0,title:'確認刪除角色',message:`確定要刪除角色 "${N.value.name}" 嗎？此操作無法撤銷。`,confirmText:'刪除',cancelText:'取消'})},O=()=>{E.value&&h.value&&'c1'!==h.value&&(E.value.active_characters.delete(h.value),E.value.deactive_characters.delete(h.value),E.value.saveAsVariable(getLastMessageId()),h.value=null,y()),i.value.visible=!1},Y=()=>{i.value.visible=!1},A=()=>{r.value?.關係&&(r.value.關係['']='')},R=()=>{r.value?.所持物&&(r.value.所持物['']=1)},K=()=>{r.value?.友好度&&(r.value.友好度['']=0)},U=()=>{r.value?.愛情度&&(r.value.愛情度['']=0)},L=()=>{r.value&&void 0!==r.value.心情&&(r.value.心情<-100?r.value.心情=-100:r.value.心情>100&&(r.value.心情=100))},F=()=>{r.value&&void 0!==r.value.性慾&&(r.value.性慾<0?r.value.性慾=0:r.value.性慾>100&&(r.value.性慾=100))},H=e=>{p.value&&void 0!==p.value[e]&&(p.value[e]<-1e3?p.value[e]=-1e3:p.value[e]>1e3&&(p.value[e]=1e3))},j=e=>{g.value&&void 0!==g.value[e]&&(g.value[e]<0?g.value[e]=0:g.value[e]>1e3&&(g.value[e]=1e3))},P=()=>{if(N.value){const e=N.value.toRecord();r.value={[Dl.NAME_KEY]:e[Dl.NAME_KEY],[Dl.GENDER_KEY]:e[Dl.GENDER_KEY],[Dl.AGE_KEY]:e[Dl.AGE_KEY].toString(),[Dl.HEIGHT_KEY]:e[Dl.HEIGHT_KEY].toString(),[Dl.WEIGHT_KEY]:e[Dl.WEIGHT_KEY].toString(),[Dl.CHEST_SIZE_KEY]:e[Dl.CHEST_SIZE_KEY].toString(),[Dl.CUP_SIZE_KEY]:e[Dl.CUP_SIZE_KEY]||'',[Dl.WAIST_SIZE_KEY]:e[Dl.WAIST_SIZE_KEY].toString(),[Dl.HIPS_SIZE_KEY]:e[Dl.HIPS_SIZE_KEY].toString(),[Dl.IDENTITY_KEY]:e[Dl.IDENTITY_KEY],[Dl.HAIRSTYLE_KEY]:e[Dl.HAIRSTYLE_KEY],[Dl.APPEARANCE_KEY]:e[Dl.APPEARANCE_KEY],[Dl.CLOTHES_KEY]:e[Dl.CLOTHES_KEY],[Dl.FAVOURITE_KEY]:e[Dl.FAVOURITE_KEY],[Dl.INTRODUCTION_KEY]:e[Dl.INTRODUCTION_KEY],[Dl.PERSONALITY_KEY]:e[Dl.PERSONALITY_KEY],[Dl.EXTRA_INFORMATION_KEY]:e[Dl.EXTRA_INFORMATION_KEY],[Dl.MONEY_KEY]:e[Dl.MONEY_KEY],[Dl.MOOD_KEY]:e[Dl.MOOD_KEY],[Dl.HORNY_KEY]:e[Dl.HORNY_KEY],[Dl.RELATIONS_KEY]:e[Dl.RELATIONS_KEY],[Dl.FRIENDSHIPS_KEY]:e[Dl.FRIENDSHIPS_KEY],[Dl.LOVES_KEY]:e[Dl.LOVES_KEY],[Dl.INVENTORY_KEY]:e[Dl.INVENTORY_KEY],[Dl.BIRTHDAY_KEY]:e[Dl.BIRTHDAY_KEY]},o.value=h.value||'',a.value=!0,l.value=!1}},q=()=>{const e=(()=>{if(!E.value)return'c2';const e=new Set;for(const t of E.value.active_characters.keys())e.add(t);for(const t of E.value.deactive_characters.keys())e.add(t);let t=2;for(;e.has(`c${t}`);)t++;return`c${t}`})();o.value=e,r.value={[Dl.NAME_KEY]:'',[Dl.AGE_KEY]:null,[Dl.GENDER_KEY]:'',[Dl.IDENTITY_KEY]:'',[Dl.INTRODUCTION_KEY]:'',[Dl.PERSONALITY_KEY]:'',[Dl.HEIGHT_KEY]:0,[Dl.WEIGHT_KEY]:0,[Dl.CHEST_SIZE_KEY]:0,[Dl.CUP_SIZE_KEY]:'',[Dl.WAIST_SIZE_KEY]:0,[Dl.HIPS_SIZE_KEY]:0,[Dl.HAIRSTYLE_KEY]:'',[Dl.APPEARANCE_KEY]:'',[Dl.CLOTHES_KEY]:'',[Dl.BIRTHDAY_KEY]:{month:1,date:1},[Dl.FAVOURITE_KEY]:'',[Dl.EXTRA_INFORMATION_KEY]:'',[Dl.MONEY_KEY]:0,[Dl.MOOD_KEY]:0,[Dl.HORNY_KEY]:0,[Dl.RELATIONS_KEY]:{},[Dl.INVENTORY_KEY]:{},[Dl.FRIENDSHIPS_KEY]:{},[Dl.LOVES_KEY]:{}},a.value=!0,l.value=!0,h.value=null},G=()=>{a.value=!1,l.value=!1,r.value=null,o.value=''},W=()=>{if('undefined'==typeof ResizeObserver)return void(s.value=74);c.value=new ResizeObserver(e=>{for(const t of e){const e=t.target;e.classList.contains('tab-navigation')&&(s.value=e.offsetHeight)}});const e=document.querySelector('.tab-navigation.top');e&&(c.value.observe(e),s.value=e.offsetHeight)},X=()=>{c.value&&(c.value.disconnect(),c.value=null)},Z=()=>{if(E.value&&r.value){const e=o.value.trim();if(l.value){const t=E.value.active_characters.has(e),a=E.value.deactive_characters.has(e);if(t||a)return void toastr.error(`角色ID "${e}" 已經存在，請選擇其他ID`)}else if(h.value&&e!==h.value){const t=E.value.active_characters.has(e),a=E.value.deactive_characters.has(e);if(t||a)return void toastr.error(`角色ID "${e}" 已經存在，請選擇其他ID`)}if(r.value.生日&&r.value.生日.month&&r.value.生日.date){const e=new Date,t=e.getFullYear(),a=e.getMonth()+1,n=e.getDate(),l=r.value.生日.month,o=r.value.生日.date;let i=t-(r.value.年齡||0);(l>a||l===a&&o>n)&&(i-=1),r.value.生日=new Date(i,r.value.生日.month-1,r.value.生日.date).toString()}if(r.value.關係){const e={};for(const[t,a]of Object.entries(r.value.關係))t&&a&&'string'==typeof a&&''!==a.trim()&&(e[t]=a);r.value.關係=e}if(r.value.所持物){const e={};for(const[t,a]of Object.entries(r.value.所持物))if(t&&a&&'number'==typeof a&&a>0){const n=B(t)?1:a;e[t]=n}r.value.所持物=e}if(r.value.友好度){const e={};for(const[t,a]of Object.entries(r.value.友好度))t&&void 0!==a&&'number'==typeof a&&a>=-1e3&&a<=1e3&&(e[t]=a);r.value.友好度=e}if(r.value.愛情度){const e={};for(const[t,a]of Object.entries(r.value.愛情度))t&&void 0!==a&&'number'==typeof a&&a>0&&a<=1e3&&(e[t]=a);r.value.愛情度=e}const t=e,a={[Dl.NAME_KEY]:r.value.名稱,[Dl.GENDER_KEY]:r.value.性別,[Dl.AGE_KEY]:parseInt(r.value.年齡),[Dl.HEIGHT_KEY]:parseInt(r.value.身高),[Dl.WEIGHT_KEY]:parseInt(r.value.體重),[Dl.CHEST_SIZE_KEY]:parseInt(r.value.胸圍),[Dl.CUP_SIZE_KEY]:r.value.罩杯||void 0,[Dl.WAIST_SIZE_KEY]:parseInt(r.value.腰圍),[Dl.HIPS_SIZE_KEY]:parseInt(r.value.臀圍),[Dl.IDENTITY_KEY]:r.value.身份,[Dl.HAIRSTYLE_KEY]:r.value.髮型,[Dl.APPEARANCE_KEY]:r.value.樣貌,[Dl.CLOTHES_KEY]:r.value.衣著,[Dl.FAVOURITE_KEY]:r.value.愛好,[Dl.INTRODUCTION_KEY]:r.value.簡介,[Dl.PERSONALITY_KEY]:r.value.性格,[Dl.EXTRA_INFORMATION_KEY]:r.value.其他重要資訊,[Dl.BIRTHDAY_KEY]:r.value.生日,[Dl.MONEY_KEY]:r.value.金錢??0,[Dl.MOOD_KEY]:r.value.心情??50,[Dl.HORNY_KEY]:r.value.性慾??0,[Dl.RELATIONS_KEY]:r.value.關係??{},[Dl.FRIENDSHIPS_KEY]:r.value.友好度??{},[Dl.LOVES_KEY]:r.value.愛情度??{},[Dl.INVENTORY_KEY]:r.value.所持物??{}};if(l.value)E.value.active_characters.set(t,Dl.fromRecord(a)),E.value.saveAsVariable(getLastMessageId()),y(),h.value=t;else if(h.value){const e=E.value.active_characters.has(h.value);t!==h.value?(e?(E.value.active_characters.delete(h.value),E.value.active_characters.set(t,Dl.fromRecord(a))):(E.value.deactive_characters.delete(h.value),E.value.deactive_characters.set(t,Dl.fromRecord(a))),h.value=t):e?E.value.active_characters.set(h.value,Dl.fromRecord(a)):E.value.deactive_characters.set(h.value,Dl.fromRecord(a)),E.value.saveAsVariable(getLastMessageId()),y()}}a.value=!1,l.value=!1,r.value=null,o.value=''};return(e,t)=>{return(0,n.openBlock)(),(0,n.createElementBlock)('div',ls,[(0,n.createCommentVNode)(' 角色列表視圖 '),h.value||l.value?((0,n.openBlock)(),(0,n.createElementBlock)(n.Fragment,{key:1},[(0,n.createCommentVNode)(' 角色詳細信息視圖 '),(0,n.createElementVNode)('div',Es,[(0,n.createCommentVNode)(' 角色名稱標題 '),(0,n.createElementVNode)('div',ys,[(0,n.createElementVNode)('div',bs,[a.value||l.value?(0,n.createCommentVNode)('v-if',!0):((0,n.openBlock)(),(0,n.createElementBlock)('button',{key:0,class:'edit-button',onClick:P},'編輯')),a.value||l.value||'c1'===h.value?(0,n.createCommentVNode)('v-if',!0):((0,n.openBlock)(),(0,n.createElementBlock)('button',{key:1,class:'delete-button',onClick:M},' 刪除 '))]),(0,n.createElementVNode)('h1',Vs,(0,n.toDisplayString)(l.value?'新增角色':N.value?.name||'N/A'),1),(0,n.createElementVNode)('button',{class:'back-button',onClick:T},'←')]),(0,n.createCommentVNode)(' 所有屬性統一顯示 '),(0,n.createElementVNode)('div',Ns,[(0,n.createCommentVNode)(' 基本信息 '),(0,n.createElementVNode)('div',fs,[t[25]||(t[25]=(0,n.createElementVNode)('span',{class:'attribute-label'},'ID',-1)),a.value||l.value?(0,n.withDirectives)(((0,n.openBlock)(),(0,n.createElementBlock)('input',{key:1,'onUpdate:modelValue':t[0]||(t[0]=e=>o.value=e),class:'attribute-input'},null,512)),[[n.vModelText,o.value]]):((0,n.openBlock)(),(0,n.createElementBlock)('span',ks,(0,n.toDisplayString)(h.value),1))]),(0,n.createElementVNode)('div',ws,[t[26]||(t[26]=(0,n.createElementVNode)('span',{class:'attribute-label'},[(0,n.createTextVNode)('名稱'),(0,n.createElementVNode)('span',{class:'required-asterisk'},'*')],-1)),a.value||l.value?(0,n.withDirectives)(((0,n.openBlock)(),(0,n.createElementBlock)('input',{key:1,'onUpdate:modelValue':t[1]||(t[1]=e=>r.value.名稱=e),class:'attribute-input'},null,512)),[[n.vModelText,r.value.名稱]]):((0,n.openBlock)(),(0,n.createElementBlock)('span',Bs,(0,n.toDisplayString)(N.value?.name||'N/A'),1))]),(0,n.createElementVNode)('div',Cs,[t[27]||(t[27]=(0,n.createElementVNode)('span',{class:'attribute-label'},[(0,n.createTextVNode)('性別'),(0,n.createElementVNode)('span',{class:'required-asterisk'},'*')],-1)),a.value||l.value?(0,n.withDirectives)(((0,n.openBlock)(),(0,n.createElementBlock)('input',{key:1,'onUpdate:modelValue':t[2]||(t[2]=e=>r.value.性別=e),class:'attribute-input'},null,512)),[[n.vModelText,r.value.性別]]):((0,n.openBlock)(),(0,n.createElementBlock)('span',$s,(0,n.toDisplayString)(N.value?.gender||'N/A'),1))]),(0,n.createElementVNode)('div',Ss,[t[28]||(t[28]=(0,n.createElementVNode)('span',{class:'attribute-label'},[(0,n.createTextVNode)('年齡'),(0,n.createElementVNode)('span',{class:'required-asterisk'},'*')],-1)),a.value||l.value?(0,n.withDirectives)(((0,n.openBlock)(),(0,n.createElementBlock)('input',{key:1,'onUpdate:modelValue':t[3]||(t[3]=e=>r.value.年齡=e),class:'attribute-input',type:'number'},null,512)),[[n.vModelText,r.value.年齡,void 0,{number:!0}]]):((0,n.openBlock)(),(0,n.createElementBlock)('span',xs,(0,n.toDisplayString)(N.value?.age||'N/A'),1))]),(0,n.createCommentVNode)(' 身體測量 '),(0,n.createElementVNode)('div',Is,[t[29]||(t[29]=(0,n.createElementVNode)('span',{class:'attribute-label unit-label'},[(0,n.createTextVNode)('身高 (cm)'),(0,n.createElementVNode)('span',{class:'required-asterisk'},'*')],-1)),a.value||l.value?(0,n.withDirectives)(((0,n.openBlock)(),(0,n.createElementBlock)('input',{key:1,'onUpdate:modelValue':t[4]||(t[4]=e=>r.value.身高=e),class:'attribute-input',type:'number'},null,512)),[[n.vModelText,r.value.身高,void 0,{number:!0}]]):((0,n.openBlock)(),(0,n.createElementBlock)('span',Ds,(0,n.toDisplayString)(N.value?.height||'N/A'),1))]),(0,n.createElementVNode)('div',Ts,[t[30]||(t[30]=(0,n.createElementVNode)('span',{class:'attribute-label unit-label'},[(0,n.createTextVNode)('體重 (kg)'),(0,n.createElementVNode)('span',{class:'required-asterisk'},'*')],-1)),a.value||l.value?(0,n.withDirectives)(((0,n.openBlock)(),(0,n.createElementBlock)('input',{key:1,'onUpdate:modelValue':t[5]||(t[5]=e=>r.value.體重=e),class:'attribute-input',type:'number'},null,512)),[[n.vModelText,r.value.體重,void 0,{number:!0}]]):((0,n.openBlock)(),(0,n.createElementBlock)('span',Ms,(0,n.toDisplayString)(N.value?.weight||'N/A'),1))]),(0,n.createElementVNode)('div',Os,[t[31]||(t[31]=(0,n.createElementVNode)('span',{class:'attribute-label unit-label'},[(0,n.createTextVNode)('胸圍 (cm)'),(0,n.createElementVNode)('span',{class:'required-asterisk'},'*')],-1)),a.value||l.value?(0,n.withDirectives)(((0,n.openBlock)(),(0,n.createElementBlock)('input',{key:1,'onUpdate:modelValue':t[6]||(t[6]=e=>r.value.胸圍=e),class:'attribute-input',type:'number'},null,512)),[[n.vModelText,r.value.胸圍,void 0,{number:!0}]]):((0,n.openBlock)(),(0,n.createElementBlock)('span',Ys,(0,n.toDisplayString)(N.value?.chest_size||'N/A'),1))]),(0,n.createElementVNode)('div',As,[t[32]||(t[32]=(0,n.createElementVNode)('span',{class:'attribute-label'},[(0,n.createTextVNode)('罩杯'),(0,n.createElementVNode)('span',{class:'required-asterisk'},'*')],-1)),a.value||l.value?(0,n.withDirectives)(((0,n.openBlock)(),(0,n.createElementBlock)('input',{key:1,'onUpdate:modelValue':t[7]||(t[7]=e=>r.value.罩杯=e),class:'attribute-input'},null,512)),[[n.vModelText,r.value.罩杯]]):((0,n.openBlock)(),(0,n.createElementBlock)('span',Rs,(0,n.toDisplayString)(N.value?.cup_size||'不適用'),1))]),(0,n.createElementVNode)('div',Ks,[t[33]||(t[33]=(0,n.createElementVNode)('span',{class:'attribute-label unit-label'},[(0,n.createTextVNode)('腰圍 (cm)'),(0,n.createElementVNode)('span',{class:'required-asterisk'},'*')],-1)),a.value||l.value?(0,n.withDirectives)(((0,n.openBlock)(),(0,n.createElementBlock)('input',{key:1,'onUpdate:modelValue':t[8]||(t[8]=e=>r.value.腰圍=e),class:'attribute-input',type:'number'},null,512)),[[n.vModelText,r.value.腰圍,void 0,{number:!0}]]):((0,n.openBlock)(),(0,n.createElementBlock)('span',Us,(0,n.toDisplayString)(N.value?.waist_size||'N/A'),1))]),(0,n.createElementVNode)('div',zs,[t[34]||(t[34]=(0,n.createElementVNode)('span',{class:'attribute-label unit-label'},[(0,n.createTextVNode)('臀圍 (cm)'),(0,n.createElementVNode)('span',{class:'required-asterisk'},'*')],-1)),a.value||l.value?(0,n.withDirectives)(((0,n.openBlock)(),(0,n.createElementBlock)('input',{key:1,'onUpdate:modelValue':t[9]||(t[9]=e=>r.value.臀圍=e),class:'attribute-input',type:'number'},null,512)),[[n.vModelText,r.value.臀圍,void 0,{number:!0}]]):((0,n.openBlock)(),(0,n.createElementBlock)('span',Ls,(0,n.toDisplayString)(N.value?.hips_size||'N/A'),1))]),(0,n.createCommentVNode)(' 金錢 '),(0,n.createElementVNode)('div',Fs,[t[35]||(t[35]=(0,n.createElementVNode)('span',{class:'attribute-label'},'金錢',-1)),a.value||l.value?(0,n.withDirectives)(((0,n.openBlock)(),(0,n.createElementBlock)('input',{key:1,'onUpdate:modelValue':t[10]||(t[10]=e=>r.value.金錢=e),class:'attribute-input',type:'number'},null,512)),[[n.vModelText,r.value.金錢,void 0,{number:!0}]]):((0,n.openBlock)(),(0,n.createElementBlock)('span',Hs,(0,n.toDisplayString)((c=N.value?.money,void 0===c?'N/A':`$${c.toLocaleString()}`)),1))]),(0,n.createCommentVNode)(' 生日 '),(0,n.createElementVNode)('div',js,[t[38]||(t[38]=(0,n.createElementVNode)('span',{class:'attribute-label'},'生日',-1)),a.value||l.value?((0,n.openBlock)(),(0,n.createElementBlock)('div',qs,[(0,n.createElementVNode)('div',Gs,[(0,n.withDirectives)((0,n.createElementVNode)('input',{'onUpdate:modelValue':t[11]||(t[11]=e=>r.value.生日.month=e),class:'attribute-input birthday-month',type:'number',placeholder:'月',min:'1',max:'12'},null,512),[[n.vModelText,r.value.生日.month,void 0,{number:!0}]]),t[36]||(t[36]=(0,n.createElementVNode)('span',{class:'birthday-separator'},'月',-1)),(0,n.withDirectives)((0,n.createElementVNode)('input',{'onUpdate:modelValue':t[12]||(t[12]=e=>r.value.生日.date=e),class:'attribute-input birthday-date',type:'number',placeholder:'日',min:'1',max:'31'},null,512),[[n.vModelText,r.value.生日.date,void 0,{number:!0}]]),t[37]||(t[37]=(0,n.createElementVNode)('span',{class:'birthday-separator'},'日',-1))])])):((0,n.openBlock)(),(0,n.createElementBlock)('span',Ps,(0,n.toDisplayString)((s=N.value?.birthday,s?`${s.month}月${s.date}日`:'N/A')),1))]),(0,n.createCommentVNode)(' 心情和性慾 (僅非用戶角色顯示) '),'c1'!==h.value?((0,n.openBlock)(),(0,n.createElementBlock)('div',Ws,[a.value?((0,n.openBlock)(),(0,n.createElementBlock)('div',Xs,[t[39]||(t[39]=(0,n.createElementVNode)('span',{class:'attribute-label'},'心情',-1)),(0,n.withDirectives)((0,n.createElementVNode)('input',{'onUpdate:modelValue':t[13]||(t[13]=e=>r.value.心情=e),class:'attribute-input',type:'number',min:'-100',max:'100',onInput:L,onBlur:L},null,544),[[n.vModelText,r.value.心情,void 0,{number:!0}]])])):((0,n.openBlock)(),(0,n.createBlock)(ns,{key:0,label:'心情',value:N.value?.mood||0,attributeType:'mood'},null,8,['value']))])):(0,n.createCommentVNode)('v-if',!0),'c1'!==h.value?((0,n.openBlock)(),(0,n.createElementBlock)('div',Zs,[a.value?((0,n.openBlock)(),(0,n.createElementBlock)('div',Js,[t[40]||(t[40]=(0,n.createElementVNode)('span',{class:'attribute-label'},'性慾',-1)),(0,n.withDirectives)((0,n.createElementVNode)('input',{'onUpdate:modelValue':t[14]||(t[14]=e=>r.value.性慾=e),class:'attribute-input',type:'number',min:'0',max:'100',onInput:F,onBlur:F},null,544),[[n.vModelText,r.value.性慾,void 0,{number:!0}]])])):((0,n.openBlock)(),(0,n.createBlock)(ns,{key:0,label:'性慾',value:N.value?.horny||0,attributeType:'horny'},null,8,['value']))])):(0,n.createCommentVNode)('v-if',!0),(0,n.createCommentVNode)(' 外貌特徵 '),(0,n.createElementVNode)('div',Qs,[t[41]||(t[41]=(0,n.createElementVNode)('span',{class:'attribute-label'},[(0,n.createTextVNode)('身份'),(0,n.createElementVNode)('span',{class:'required-asterisk'},'*')],-1)),a.value||l.value?(0,n.withDirectives)(((0,n.openBlock)(),(0,n.createElementBlock)('textarea',{key:1,'onUpdate:modelValue':t[15]||(t[15]=e=>r.value.身份=e),class:'attribute-textarea'},null,512)),[[n.vModelText,r.value.身份]]):((0,n.openBlock)(),(0,n.createElementBlock)('span',ec,(0,n.toDisplayString)(N.value?.identity||'N/A'),1))]),(0,n.createElementVNode)('div',tc,[t[42]||(t[42]=(0,n.createElementVNode)('span',{class:'attribute-label'},[(0,n.createTextVNode)('髮型'),(0,n.createElementVNode)('span',{class:'required-asterisk'},'*')],-1)),a.value||l.value?(0,n.withDirectives)(((0,n.openBlock)(),(0,n.createElementBlock)('textarea',{key:1,'onUpdate:modelValue':t[16]||(t[16]=e=>r.value.髮型=e),class:'attribute-textarea'},null,512)),[[n.vModelText,r.value.髮型]]):((0,n.openBlock)(),(0,n.createElementBlock)('span',ac,(0,n.toDisplayString)(N.value?.hairstyle||'N/A'),1))]),(0,n.createElementVNode)('div',nc,[t[43]||(t[43]=(0,n.createElementVNode)('span',{class:'attribute-label'},[(0,n.createTextVNode)('樣貌'),(0,n.createElementVNode)('span',{class:'required-asterisk'},'*')],-1)),a.value||l.value?(0,n.withDirectives)(((0,n.openBlock)(),(0,n.createElementBlock)('textarea',{key:1,'onUpdate:modelValue':t[17]||(t[17]=e=>r.value.樣貌=e),class:'attribute-textarea'},null,512)),[[n.vModelText,r.value.樣貌]]):((0,n.openBlock)(),(0,n.createElementBlock)('span',lc,(0,n.toDisplayString)(N.value?.appearance||'N/A'),1))]),(0,n.createElementVNode)('div',rc,[t[44]||(t[44]=(0,n.createElementVNode)('span',{class:'attribute-label'},[(0,n.createTextVNode)('衣著'),(0,n.createElementVNode)('span',{class:'required-asterisk'},'*')],-1)),a.value||l.value?(0,n.withDirectives)(((0,n.openBlock)(),(0,n.createElementBlock)('textarea',{key:1,'onUpdate:modelValue':t[18]||(t[18]=e=>r.value.衣著=e),class:'attribute-textarea'},null,512)),[[n.vModelText,r.value.衣著]]):((0,n.openBlock)(),(0,n.createElementBlock)('span',oc,(0,n.toDisplayString)(N.value?.clothes||'N/A'),1))]),(0,n.createElementVNode)('div',ic,[t[45]||(t[45]=(0,n.createElementVNode)('span',{class:'attribute-label'},[(0,n.createTextVNode)('愛好'),(0,n.createElementVNode)('span',{class:'required-asterisk'},'*')],-1)),a.value||l.value?(0,n.withDirectives)(((0,n.openBlock)(),(0,n.createElementBlock)('textarea',{key:1,'onUpdate:modelValue':t[19]||(t[19]=e=>r.value.愛好=e),class:'attribute-textarea'},null,512)),[[n.vModelText,r.value.愛好]]):((0,n.openBlock)(),(0,n.createElementBlock)('span',sc,(0,n.toDisplayString)(N.value?.favourite||'N/A'),1))]),(0,n.createElementVNode)('div',cc,[t[46]||(t[46]=(0,n.createElementVNode)('span',{class:'attribute-label'},[(0,n.createTextVNode)('簡介'),(0,n.createElementVNode)('span',{class:'required-asterisk'},'*')],-1)),a.value||l.value?(0,n.withDirectives)(((0,n.openBlock)(),(0,n.createElementBlock)('textarea',{key:1,'onUpdate:modelValue':t[20]||(t[20]=e=>r.value.簡介=e),class:'attribute-textarea'},null,512)),[[n.vModelText,r.value.簡介]]):((0,n.openBlock)(),(0,n.createElementBlock)('span',dc,(0,n.toDisplayString)(N.value?.introduction||'N/A'),1))]),(0,n.createElementVNode)('div',uc,[t[47]||(t[47]=(0,n.createElementVNode)('span',{class:'attribute-label'},[(0,n.createTextVNode)('性格'),(0,n.createElementVNode)('span',{class:'required-asterisk'},'*')],-1)),a.value||l.value?(0,n.withDirectives)(((0,n.openBlock)(),(0,n.createElementBlock)('textarea',{key:1,'onUpdate:modelValue':t[21]||(t[21]=e=>r.value.性格=e),class:'attribute-textarea'},null,512)),[[n.vModelText,r.value.性格]]):((0,n.openBlock)(),(0,n.createElementBlock)('span',mc,(0,n.toDisplayString)(N.value?.personality||'N/A'),1))]),N.value?.extra_information&&!l.value||a.value?((0,n.openBlock)(),(0,n.createElementBlock)('div',vc,[t[48]||(t[48]=(0,n.createElementVNode)('span',{class:'attribute-label'},[(0,n.createTextVNode)('其他重要資訊'),(0,n.createElementVNode)('span',{class:'required-asterisk'},'*')],-1)),a.value||l.value?(0,n.withDirectives)(((0,n.openBlock)(),(0,n.createElementBlock)('textarea',{key:1,'onUpdate:modelValue':t[22]||(t[22]=e=>r.value.其他重要資訊=e),class:'attribute-textarea'},null,512)),[[n.vModelText,r.value.其他重要資訊]]):((0,n.openBlock)(),(0,n.createElementBlock)('span',pc,(0,n.toDisplayString)(N.value?.extra_information||'N/A'),1))])):(0,n.createCommentVNode)('v-if',!0)]),(0,n.createCommentVNode)(' 關係 '),(0,n.createElementVNode)('div',gc,[t[52]||(t[52]=(0,n.createElementVNode)('h3',{class:'section-title'},'關係',-1)),a.value||l.value?((0,n.openBlock)(),(0,n.createElementBlock)('div',bc,[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(m.value,(_,e)=>((0,n.openBlock)(),(0,n.createElementBlock)('div',{key:e,class:'edit-item'},[(0,n.createElementVNode)('select',{value:e,class:'relation-select',onChange:t=>((e,t)=>{if(r.value?.關係&&e!==t){const a=r.value.關係[e];delete r.value.關係[e],t&&(r.value.關係[t]=a)}})(String(e),t.target.value)},[t[50]||(t[50]=(0,n.createElementVNode)('option',{value:'',disabled:''},'選擇角色',-1)),((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(f.value,e=>((0,n.openBlock)(),(0,n.createElementBlock)('option',{key:e.id,value:e.id},(0,n.toDisplayString)(e.name)+' ('+(0,n.toDisplayString)(e.id)+') ',9,Nc))),128))],40,Vc),t[51]||(t[51]=(0,n.createElementVNode)('span',{class:'edit-connector'},' 是此角色的 ',-1)),(0,n.withDirectives)((0,n.createElementVNode)('input',{'onUpdate:modelValue':t=>m.value[e]=t,class:'input-field',placeholder:'關係'},null,8,fc),[[n.vModelText,m.value[e]]]),(0,n.createElementVNode)('button',{class:'relation-remove-btn',onClick:t=>(e=>{r.value?.關係&&delete r.value.關係[e]})(String(e))},'×',8,kc)]))),128)),(0,n.createElementVNode)('button',{class:'add-relation-btn',onClick:A},'+ 添加關係')])):((0,n.openBlock)(),(0,n.createElementBlock)('div',_c,[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(N.value?.relations||[],([e,a])=>((0,n.openBlock)(),(0,n.createElementBlock)('div',{key:e,class:'relation-item'},[(0,n.createElementVNode)('span',hc,(0,n.toDisplayString)(E.value?.getCharacter(e)?.name||'未知')+' ('+(0,n.toDisplayString)(e)+')',1),t[49]||(t[49]=(0,n.createElementVNode)('span',{class:'connector'},' 是此角色的 ',-1)),(0,n.createElementVNode)('span',Ec,(0,n.toDisplayString)(a),1)]))),128)),N.value?.relations&&0!==N.value.relations.size?(0,n.createCommentVNode)('v-if',!0):((0,n.openBlock)(),(0,n.createElementBlock)('div',yc,' 沒有任何關係 '))]))]),(0,n.createCommentVNode)(' 友好度和愛情度 (僅非用戶角色顯示) '),'c1'!==h.value||l.value?((0,n.openBlock)(),(0,n.createElementBlock)('div',wc,[t[55]||(t[55]=(0,n.createElementVNode)('h3',{class:'section-title'},'友好度',-1)),a.value||l.value?((0,n.openBlock)(),(0,n.createElementBlock)('div',$c,[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(p.value,(_,e)=>((0,n.openBlock)(),(0,n.createElementBlock)('div',{key:e,class:'edit-item'},[(0,n.createElementVNode)('select',{value:e,class:'relation-select',onChange:t=>((e,t)=>{if(r.value?.友好度&&e!==t){const a=r.value.友好度[e];delete r.value.友好度[e],t&&(r.value.友好度[t]=a)}})(String(e),t.target.value)},[t[53]||(t[53]=(0,n.createElementVNode)('option',{value:'',disabled:''},'選擇角色',-1)),((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(f.value,e=>((0,n.openBlock)(),(0,n.createElementBlock)('option',{key:e.id,value:e.id},(0,n.toDisplayString)(e.name)+' ('+(0,n.toDisplayString)(e.id)+') ',9,xc))),128))],40,Sc),t[54]||(t[54]=(0,n.createElementVNode)('span',{class:'edit-connector'},' : ',-1)),(0,n.withDirectives)((0,n.createElementVNode)('input',{'onUpdate:modelValue':t=>p.value[e]=t,class:'input-field',type:'number',min:'-1000',max:'1000',placeholder:'友好度',onInput:t=>H(String(e)),onBlur:t=>H(String(e))},null,40,Ic),[[n.vModelText,p.value[e],void 0,{number:!0}]]),(0,n.createElementVNode)('button',{class:'friendship-remove-btn',onClick:t=>(e=>{r.value?.友好度&&delete r.value.友好度[e]})(String(e))},'×',8,Dc)]))),128)),(0,n.createElementVNode)('button',{class:'add-friendship-btn',onClick:K},'+ 添加友好度')])):((0,n.openBlock)(),(0,n.createElementBlock)('div',Bc,[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(N.value?.friendships||[],([e,t])=>((0,n.openBlock)(),(0,n.createElementBlock)('div',{key:e,class:'friendship-item'},[(0,n.createVNode)(ns,{label:`${E.value?.getCharacter(e)?.name||'未知'} (${e})`,value:t,attributeType:'friendship'},null,8,['label','value'])]))),128)),N.value?.friendships&&0!==N.value.friendships.size?(0,n.createCommentVNode)('v-if',!0):((0,n.openBlock)(),(0,n.createElementBlock)('div',Cc,' 沒有任何友好度 '))]))])):(0,n.createCommentVNode)('v-if',!0),'c1'!==h.value||l.value?((0,n.openBlock)(),(0,n.createElementBlock)('div',Tc,[t[58]||(t[58]=(0,n.createElementVNode)('h3',{class:'section-title'},'愛情度',-1)),a.value||l.value?((0,n.openBlock)(),(0,n.createElementBlock)('div',Yc,[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(g.value,(_,e)=>((0,n.openBlock)(),(0,n.createElementBlock)('div',{key:e,class:'edit-item'},[(0,n.createElementVNode)('select',{value:e,class:'relation-select',onChange:t=>((e,t)=>{if(r.value?.愛情度&&e!==t){const a=r.value.愛情度[e];delete r.value.愛情度[e],t&&(r.value.愛情度[t]=a)}})(String(e),t.target.value)},[t[56]||(t[56]=(0,n.createElementVNode)('option',{value:'',disabled:''},'選擇角色',-1)),((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(f.value,e=>((0,n.openBlock)(),(0,n.createElementBlock)('option',{key:e.id,value:e.id},(0,n.toDisplayString)(e.name)+' ('+(0,n.toDisplayString)(e.id)+') ',9,Rc))),128))],40,Ac),t[57]||(t[57]=(0,n.createElementVNode)('span',{class:'edit-connector'},' : ',-1)),(0,n.withDirectives)((0,n.createElementVNode)('input',{'onUpdate:modelValue':t=>g.value[e]=t,class:'input-field',type:'number',min:'0',max:'1000',placeholder:'愛情度',onInput:t=>j(String(e)),onBlur:t=>j(String(e))},null,40,Kc),[[n.vModelText,g.value[e],void 0,{number:!0}]]),(0,n.createElementVNode)('button',{class:'love-remove-btn',onClick:t=>(e=>{r.value?.愛情度&&delete r.value.愛情度[e]})(String(e))},'×',8,Uc)]))),128)),(0,n.createElementVNode)('button',{class:'add-love-btn',onClick:U},'+ 添加愛情度')])):((0,n.openBlock)(),(0,n.createElementBlock)('div',Mc,[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(N.value?.loves||[],([e,t])=>((0,n.openBlock)(),(0,n.createElementBlock)('div',{key:e,class:'love-item'},[(0,n.createVNode)(ns,{label:`${E.value?.getCharacter(e)?.name||'未知'} (${e})`,value:t,attributeType:'love'},null,8,['label','value'])]))),128)),N.value?.loves&&0!==N.value.loves.size?(0,n.createCommentVNode)('v-if',!0):((0,n.openBlock)(),(0,n.createElementBlock)('div',Oc,' 沒有任何愛情度 '))]))])):(0,n.createCommentVNode)('v-if',!0),(0,n.createElementVNode)('div',zc,[t[60]||(t[60]=(0,n.createElementVNode)('h3',{class:'section-title'},'所持物',-1)),a.value||l.value?((0,n.openBlock)(),(0,n.createElementBlock)('div',Jc,[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(v.value,(_,e)=>((0,n.openBlock)(),(0,n.createElementBlock)('div',{key:e,class:'inventory-edit-item'},[(0,n.createElementVNode)('select',{value:e,class:'inventory-select',onChange:t=>((e,t)=>{if(r.value?.所持物&&e!==t){const a=r.value.所持物[e];delete r.value.所持物[e],t&&(r.value.所持物[t]=a)}})(String(e),t.target.value)},[t[59]||(t[59]=(0,n.createElementVNode)('option',{value:'',disabled:''},'選擇物品或貯存點...',-1)),(0,n.createElementVNode)('optgroup',ed,[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(k.value.filter(e=>'item'===e.type),e=>((0,n.openBlock)(),(0,n.createElementBlock)('option',{key:e.id,value:e.id},(0,n.toDisplayString)(e.name)+' ('+(0,n.toDisplayString)(e.id)+') ',9,td))),128))]),(0,n.createElementVNode)('optgroup',ad,[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(k.value.filter(e=>'storage'===e.type),e=>((0,n.openBlock)(),(0,n.createElementBlock)('option',{key:e.id,value:e.id},(0,n.toDisplayString)(e.name)+' ('+(0,n.toDisplayString)(e.id)+') ',9,nd))),128))])],40,Qc),B(String(e))?(0,n.createCommentVNode)('v-if',!0):((0,n.openBlock)(),(0,n.createElementBlock)('span',ld,'×')),B(String(e))?(0,n.createCommentVNode)('v-if',!0):(0,n.withDirectives)(((0,n.openBlock)(),(0,n.createElementBlock)('input',{key:1,'onUpdate:modelValue':t=>v.value[e]=t,class:'inventory-quantity-input',type:'number',min:'0',placeholder:'數量'},null,8,rd)),[[n.vModelText,v.value[e],void 0,{number:!0}]]),(0,n.createElementVNode)('button',{class:'inventory-remove-btn',onClick:t=>(e=>{r.value?.所持物&&delete r.value.所持物[e]})(String(e))},'×',8,od)]))),128)),(0,n.createElementVNode)('button',{class:'add-inventory-btn',onClick:R},'+ 添加物品或貯存點')])):((0,n.openBlock)(),(0,n.createElementBlock)('div',Lc,[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(N.value?.inventory||[],([e,t])=>((0,n.openBlock)(),(0,n.createElementBlock)('div',{key:e,class:(0,n.normalizeClass)(['inventory-item',{'storage-item':B(e)}])},[(0,n.createElementVNode)('div',Fc,[(0,n.createElementVNode)('span',Hc,(0,n.toDisplayString)(w(e))+' ('+(0,n.toDisplayString)(e)+')',1),B(e)?((0,n.openBlock)(),(0,n.createElementBlock)('span',Pc,'貯存點')):((0,n.openBlock)(),(0,n.createElementBlock)('span',jc,'× '+(0,n.toDisplayString)(t),1))]),(0,n.createElementVNode)('div',qc,(0,n.toDisplayString)(x(e)),1),B(e)?((0,n.openBlock)(),(0,n.createElementBlock)('div',Gc,[0===C(e)?((0,n.openBlock)(),(0,n.createElementBlock)('div',Wc,'無物品')):((0,n.openBlock)(),(0,n.createElementBlock)('div',Xc,[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(S(e),([e,t])=>((0,n.openBlock)(),(0,n.createElementBlock)('span',{key:e,class:(0,n.normalizeClass)(E.value?.storages.has(e)?'storage-item-tag':'inventory-item-tag')},(0,n.toDisplayString)(w(e))+' ('+(0,n.toDisplayString)(e)+')'+(0,n.toDisplayString)(E.value?.storages.has(e)?'':` × ${t}`),3))),128))]))])):(0,n.createCommentVNode)('v-if',!0)],2))),128)),N.value?.inventory&&0!==N.value.inventory.size?(0,n.createCommentVNode)('v-if',!0):((0,n.openBlock)(),(0,n.createElementBlock)('div',Zc,' 沒有任何物品 '))]))]),(0,n.createCommentVNode)(' 編輯按鈕 '),a.value?((0,n.openBlock)(),(0,n.createElementBlock)('div',id,[(0,n.createElementVNode)('button',{class:'confirm-button',disabled:u.value,onClick:Z},'確認',8,sd),(0,n.createElementVNode)('button',{class:'cancel-button',onClick:G},'取消')])):(0,n.createCommentVNode)('v-if',!0)])],2112)):((0,n.openBlock)(),(0,n.createElementBlock)('div',rs,[(0,n.createCommentVNode)(' 活躍角色部分 '),(0,n.createElementVNode)('div',os,[t[23]||(t[23]=(0,n.createElementVNode)('h3',{class:'section-title'},'活躍角色',-1)),(0,n.createElementVNode)('div',is,[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(b.value,([e,t])=>((0,n.openBlock)(),(0,n.createElementBlock)('div',{key:e,class:'character-item clickable',onClick:t=>I(e)},[(0,n.createElementVNode)('div',{class:(0,n.normalizeClass)(['character-info',{'user-character-info':'c1'===e}])},[(0,n.createElementVNode)('span',{class:(0,n.normalizeClass)('c1'===e?'user-id':'character-id')},(0,n.toDisplayString)(e),3),(0,n.createElementVNode)('span',{class:(0,n.normalizeClass)('c1'===e?'user-name':'character-name')},(0,n.toDisplayString)(t.name),3)],2),'c1'!==e?((0,n.openBlock)(),(0,n.createElementBlock)('button',{key:0,class:'toggle-status-button',title:'設為非活躍',onClick:(0,n.withModifiers)(t=>D(e),['stop'])},' ↓ ',8,cs)):(0,n.createCommentVNode)('v-if',!0),'c1'!==e?((0,n.openBlock)(),(0,n.createElementBlock)('div',ds,[(0,n.createVNode)(ns,{label:'心情',value:t.mood||0,attributeType:'mood'},null,8,['value']),(0,n.createVNode)(ns,{label:'性慾',value:t.horny||0,attributeType:'horny'},null,8,['value']),(0,n.createVNode)(ns,{label:'友好度',value:t.friendships?.get('c1')||0,attributeType:'friendship'},null,8,['value']),(0,n.createVNode)(ns,{label:'愛情度',value:t.loves?.get('c1')||0,attributeType:'love'},null,8,['value'])])):(0,n.createCommentVNode)('v-if',!0)],8,ss))),128)),0===b.value.size?((0,n.openBlock)(),(0,n.createElementBlock)('div',us,'沒有活躍角色')):(0,n.createCommentVNode)('v-if',!0)])]),(0,n.createCommentVNode)(' 非活躍角色部分 '),(0,n.createElementVNode)('div',ms,[t[24]||(t[24]=(0,n.createElementVNode)('h3',{class:'section-title'},'非活躍角色',-1)),(0,n.createElementVNode)('div',vs,[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(V.value,([e,t])=>((0,n.openBlock)(),(0,n.createElementBlock)('div',{key:e,class:'character-item clickable',onClick:t=>I(e)},[(0,n.createElementVNode)('div',{class:(0,n.normalizeClass)(['character-info',{'user-character-info':'c1'===e}])},[(0,n.createElementVNode)('span',{class:(0,n.normalizeClass)('c1'===e?'user-id':'character-id')},(0,n.toDisplayString)(e),3),(0,n.createElementVNode)('span',{class:(0,n.normalizeClass)('c1'===e?'user-name':'character-name')},(0,n.toDisplayString)(t.name),3)],2),'c1'!==e?((0,n.openBlock)(),(0,n.createElementBlock)('button',{key:0,class:'toggle-status-button',title:'設為活躍',onClick:(0,n.withModifiers)(t=>D(e),['stop'])},' ↑ ',8,gs)):(0,n.createCommentVNode)('v-if',!0),'c1'!==e?((0,n.openBlock)(),(0,n.createElementBlock)('div',_s,[(0,n.createVNode)(ns,{label:'心情',value:t.mood||0,attributeType:'mood'},null,8,['value']),(0,n.createVNode)(ns,{label:'性慾',value:t.horny||0,attributeType:'horny'},null,8,['value']),(0,n.createVNode)(ns,{label:'友好度',value:t.friendships?.get('c1')||0,attributeType:'friendship'},null,8,['value']),(0,n.createVNode)(ns,{label:'愛情度',value:t.loves?.get('c1')||0,attributeType:'love'},null,8,['value'])])):(0,n.createCommentVNode)('v-if',!0)],8,ps))),128)),0===V.value.size?((0,n.openBlock)(),(0,n.createElementBlock)('div',hs,'沒有非活躍角色')):(0,n.createCommentVNode)('v-if',!0)])]),(0,n.createCommentVNode)(' 新增角色按鈕 '),l.value?(0,n.createCommentVNode)('v-if',!0):((0,n.openBlock)(),(0,n.createElementBlock)('button',{key:0,class:'add-character-button',onClick:q},'+ 添加角色'))])),(0,n.createCommentVNode)(' 確認窗口 '),(0,n.createVNode)(Zi,{'confirm-dialog':i.value,onConfirmDialogConfirm:O,onConfirmDialogCancel:Y},null,8,['confirm-dialog'])]);var s,c}}}),dd=(0,d.A)(cd,[['__scopeId','data-v-684d53c6']]);class ud{static instance;state=(0,n.ref)({is_generating:!1,is_generating_new_swipe:!1,current_generation_id:null,last_user_message_id:null,last_user_message_text:'',swipe_generation_message_id:null});constructor(){eventOn(iframe_events.GENERATION_ENDED,(e,t)=>{this.handleGenerationEnd(e,t)})}static getInstance(){return ud.instance||(ud.instance=new ud),ud.instance}getState(){return this.state}startGeneration(e,t){this.state.value.is_generating=!0,this.state.value.last_user_message_id=t,this.state.value.last_user_message_text=e;const a=`generation_${Date.now()}`;this.state.value.current_generation_id=a,eventEmit('MESSAGE_SENT',t),this.hideSummarizedMessages(),this.addEventStartTag(),generate({generation_id:a})}startSwipeGeneration(e){this.state.value.is_generating_new_swipe=!0,this.state.value.swipe_generation_message_id=e,this.hideSummarizedMessages(),this.addEventStartTag(),setChatMessages([{message_id:e,is_hidden:!0}],{refresh:'none'});const t=`swipe_generation_${Date.now()}`;this.state.value.current_generation_id=t,generate({generation_id:t})}async stopGeneration(){if(this.state.value.current_generation_id)try{await stopGenerationById(this.state.value.current_generation_id),this.state.value.is_generating_new_swipe?(this.state.value.is_generating_new_swipe=!1,this.state.value.swipe_generation_message_id=null):null!==this.state.value.last_user_message_id&&this.restoreUserInput(),this.resetState()}catch(e){console.error('Failed to stop generation:',e),this.resetState()}}restoreUserInput(){eventEmit('RESTORE_USER_INPUT',this.state.value.last_user_message_text)}async handleGenerationEnd(e,t){try{if(!t||!t.startsWith('generation_')&&!t.startsWith('swipe_generation_'))return;if(this.state.value.is_generating_new_swipe&&null!==this.state.value.swipe_generation_message_id){const t=this.state.value.swipe_generation_message_id,a=getChatMessages(t,{include_swipes:!0})[0];if(a&&a.swipes){const n=[...a.swipes,e],l=n.length-1;await setChatMessages([{message_id:t,swipes:n,swipe_id:l,is_hidden:!1}],{refresh:'none'})}}else await createChatMessages([{role:'assistant',message:e}],{refresh:'none'});this.removeEventStartTag(),eventEmit('MESSAGE_RECEIVED',getLastMessageId())}catch(e){console.error('Failed to handle generation end:',e)}finally{this.resetState()}}resetState(){this.state.value.is_generating=!1,this.state.value.is_generating_new_swipe=!1,this.state.value.current_generation_id=null,this.state.value.swipe_generation_message_id=null,this.state.value.last_user_message_id=null,this.state.value.last_user_message_text=''}isGenerating(){return this.state.value.is_generating||this.state.value.is_generating_new_swipe}getCurrentGenerationId(){return this.state.value.current_generation_id}hideSummarizedMessages(){try{if(0===getLastMessageId())return;const e=Rl.loadFromVariable(getLastMessageId()-1).getLatestSummaryLastMessageId(),t=getLastMessageId()+1,a=[];if(e>=0)for(let t=0;t<=e;t++)a.push({message_id:t,is_hidden:!0});for(let n=e+1;n<t;n++)a.push({message_id:n,is_hidden:!1});a.length>0&&setChatMessages(a,{refresh:'none'})}catch(e){console.error('Failed to hide summarized messages:',e)}}addEventStartTag(){if(0===getLastMessageId())return;const e=Rl.loadFromVariable(getLastMessageId()-1),t=0===e.summaries.length?0:e.summaries[e.summaries.length-1].last_message_id+1,a=getChatMessages(t)[0].message,n=`\x3c!--${Rl.CURRENT_EVENT_KEY}開始--\x3e\n`;setChatMessages([{message_id:t,message:`${n}${a}`}])}removeEventStartTag(){if(0===getLastMessageId())return;const e=Rl.loadFromVariable(getLastMessageId()-1),t=0===e.summaries.length?0:e.summaries[e.summaries.length-1].last_message_id+1,a=getChatMessages(t)[0].message,n=`\x3c!--${Rl.CURRENT_EVENT_KEY}開始--\x3e\n`;setChatMessages([{message_id:t,message:a.replaceAll(n,'')}])}}const md=ud.getInstance(),vd={class:'conversation-tab-container'},pd={class:'main-content'},gd={class:'dialogue-fullscreen'},_d={key:0,class:'load-more-container'},hd={key:0,class:'edit-mode'},Ed={class:'edit-controls'},yd=['onClick'],bd={class:'message-header'},Vd={class:'message-header-row'},Nd={class:'message-id'},fd={class:'message-actions'},kd=['onClick'],wd=['onClick'],Bd={class:'message-status-row'},Cd={class:'status-info'},$d={class:'status-datetime'},Sd={class:'status-location'},xd={class:'message-content'},Id=['innerHTML'],Dd=['innerHTML'],Td={key:0,class:'swipe-controls'},Md=['disabled','onClick'],Od={class:'swipe-indicator'},Yd=['disabled','onClick'],Ad=['disabled','onClick'],Rd={class:'input-container'},Kd={key:0,class:'loading-spinner'},Ud='conversation_user_input',zd=(0,n.defineComponent)({__name:'conversation_tab',emits:['renderSizeChanged'],setup(e,{expose:t,emit:a}){(0,n.useCssVars)(e=>({v14702539:f.value}));const l=(0,n.ref)(''),r=(0,n.ref)([]),o=md.getState(),i=(0,n.computed)(()=>o.value.is_generating),s=(0,n.computed)(()=>o.value.is_generating_new_swipe),c=(0,n.ref)(null),d=(0,n.ref)(null),u=(0,n.ref)(null),v=(0,n.ref)(null),p=(0,n.ref)(''),g=(0,n.ref)({visible:!1,title:'',message:'',confirmText:'確定',cancelText:'取消'}),h=(0,n.ref)(10),E=(0,n.ref)(0),y=(0,n.ref)(!1),b=(0,n.ref)(0),V=(0,n.ref)(0),N=(0,n.ref)(null),f=(0,n.computed)(()=>`calc(100vh - ${b.value+V.value}px)`),k=(0,n.ref)(0),w=e=>{try{const t=Rl.loadFromVariable(e),a=t.datetime,n=a.year,l=a.month,r=a.date,o=a.hours,i=a.minutes,s=['日','一','二','三','四','五','六'][a.toDate().getDay()],c=`${n}年${l}月${r}日 (${s}) ${`${o.toString().padStart(2,'0')}:${i.toString().padStart(2,'0')}`} ${t.weather}`,d=t.getCurrentLocations();return{datetimeLine:c,locationString:d.map(e=>e.name).join('-')}}catch(e){return console.error('Failed to load message status:',e),{datetimeLine:'載入狀態中...',locationString:''}}},B=(0,n.ref)(new Map),C=(0,n.ref)(new Set),S=async(e,t)=>{if(!B.value.has(e)&&!C.value.has(e)){C.value.add(e);try{const a=await SillyTavern.getTokenCountAsync(t);B.value.set(e,a)}catch(t){console.error('Failed to get token count:',t),B.value.set(e,0)}finally{C.value.delete(e)}}},x=()=>{if(d.value){const e=d.value.scrollHeight,t=d.value.scrollTop;E.value+=h.value,G(),(0,n.nextTick)(()=>{(0,n.nextTick)(()=>{if(d.value){const a=d.value.scrollHeight-e;d.value.scrollTop=t+a}})})}else E.value+=h.value,G()},I=()=>{E.value=h.value},D=e=>{'Enter'===e.key&&(e.ctrlKey||e.metaKey)&&(e.preventDefault(),j())},T=()=>{(()=>{if(c.value){c.value.style.height='auto';const e=Math.min(c.value.scrollHeight,120);c.value.style.height=`${e}px`}})(),(()=>{try{localStorage.setItem(Ud,l.value)}catch(e){console.error('Failed to save user input to localStorage:',e)}})()},M=()=>{v.value=null,p.value=''},O=e=>{},Y=async(e,t)=>{try{const e=getLastMessageId(),a=[];for(let n=t+1;n<r.value.length;n++){const t=e-(r.value.length-1-n);a.push(t)}a.length>0&&await deleteChatMessages(a,{refresh:'none'});let o='';for(let e=t+1;e<r.value.length;e++)if('user'===r.value[e].role){o=r.value[e].content;break}l.value=o,I(),G(),(0,n.nextTick)(()=>{K()})}catch(e){console.error('Failed to rewind conversation:',e)}},A=e=>{let t=[{type:'plain_text',message:e}];const a=(()=>{try{const e=getVariables({type:'chat'});return e?.settings?.tag_rules||[]}catch(e){return console.error('Failed to load folding rules:',e),[]}})();for(const e of a)t=R(e,t);for(const e of t)'plain_text'===e.type&&(e.message=e.message.replace(/「([^」]*)」/g,'<span class="dialogue-text">「$1」</span>'));return t},R=(e,t)=>{const a=[];for(const n of t){if('plain_text'!==n.type){a.push(n);continue}const t=n.message,l=`<${e.tag_name}>`,r=`</${e.tag_name}>`;if('both'===e.match_mode&&'first'===e.match_strategy){let n=t;for(;;){const t=n.indexOf(l),o=n.indexOf(r);if(t<0||o<0||o<=t){''!==n&&a.push({type:'plain_text',message:n});break}const i=n.substring(0,t);''!==i&&a.push({type:'plain_text',message:i});const s=n.substring(t+l.length,o);'invisible'===e.display_mode||'fold_bar'===e.display_mode&&a.push({type:'fold_bar',message:s,fold_bar_title:e.title_name||e.tag_name}),n=n.substring(o+r.length)}}else{const o='both'===e.match_mode?t.indexOf(l):-1,i='first'===e.match_strategy?t.indexOf(r):t.lastIndexOf(r);if(i<0||'both'===e.match_mode&&o<0){a.push(n);continue}const s='both'===e.match_mode?o+l.length:0,c=o<0?'':t.substring(0,o),d=t.substring(s,i),u=t.substring(i+r.length);'invisible'===e.display_mode?a.push({type:'plain_text',message:c+u}):'fold_bar'===e.display_mode&&(''!==c&&a.push({type:'plain_text',message:c}),a.push({type:'fold_bar',message:d,fold_bar_title:e.title_name||e.tag_name}),''!==u&&a.push({type:'plain_text',message:u}))}}return a},K=()=>{d.value&&(d.value.scrollTop=d.value.scrollHeight)},U=(e,t,a)=>{g.value={visible:!0,title:e,message:t,confirmText:'確定',cancelText:'取消'},a&&(g.value._callback=a)},L=()=>{const e=g.value._callback;e&&e(),g.value.visible=!1,delete g.value._callback},F=()=>{g.value.visible=!1},H=e=>{const t=-1===e;Rl.loadFromVariable(e).injectPrompt(t)},j=async e=>{if(void 0===e&&(e=!1),e||l.value.trim()){const e=l.value.trim();l.value='',c.value&&(c.value.style.height='auto');try{localStorage.removeItem(Ud)}catch(e){console.error('Failed to clear user input from localStorage:',e)}try{await createChatMessages([{role:'user',message:e}],{refresh:'none'});const t=getLastMessageId();I(),G(),H(getLastMessageId()-1),md.startGeneration(e,t)}catch(e){console.error('Failed to send message:',e),md.stopGeneration()}}},P=async e=>{const t=e.swipe_id||0;if(t<e.swipes.length-1){const e=t+1;await setChatMessages([{message_id:getLastMessageId(),swipe_id:e}],{refresh:'none'}),G(),K()}else await(async()=>{const e=getLastMessageId();await setChatMessages([{message_id:e,is_hidden:!0}],{refresh:'none'}),H(getLastMessageId()-1),md.startSwipeGeneration(e)})()},q=async(e,t,a,n,l)=>{const r=a.filter((_,e)=>e!==t),o=n.filter((_,e)=>e!==t),i=l.filter((_,e)=>e!==t);let s=t;s>=r.length&&(s=r.length-1),await setChatMessages([{message_id:getLastMessageId(),swipes:r,swipes_data:o,swipes_info:i,swipe_id:s}],{refresh:'none'}),G(),K()},G=()=>{try{B.value.clear();const e=getLastMessageId();if(k.value=e,e>=0){const t=E.value,a=Math.max(0,e-t+1),l=getChatMessages(`${a}-${e}`,{include_swipes:!0});r.value=l.map((e,t)=>{const a='assistant'===e.role&&t===l.length-1,n=e;return{content:n.swipes?n.swipes[n.swipe_id||0]:e.message,role:e.role,swipe_id:n.swipe_id,swipes:n.swipes,swipes_data:n.swipes_data,swipes_info:n.swipes_info,is_latest_assistant:a}}),y.value=a>0,E.value===h.value&&(0,n.nextTick)(()=>{K()})}}catch(e){console.error('Failed to load messages:',e),r.value=[],y.value=!1}};return t({handleRenderSizeChanged:e=>{console.log('Render size changed to:',e),h.value=e,I(),G()},getScrollPosition:()=>d.value?.scrollTop||0,setScrollPosition:e=>{d.value&&(d.value.scrollTop=e)}}),(0,n.onMounted)(()=>{(()=>{try{const e=getVariables({type:'chat'});e?.settings?.render_size&&(h.value=e.settings.render_size)}catch(e){console.error('Failed to load chat settings:',e)}})(),E.value=h.value,k.value=getLastMessageId(),G(),(()=>{try{const e=localStorage.getItem(Ud);e&&(l.value=e)}catch(e){console.error('Failed to restore user input from localStorage:',e)}})(),(0,n.nextTick)(()=>{(()=>{if('undefined'==typeof ResizeObserver)return b.value=80,void(V.value=68);N.value=new ResizeObserver(e=>{for(const t of e){const e=t.target;e.classList.contains('tab-navigation')?b.value=e.offsetHeight:e.classList.contains('input-area')&&(V.value=e.offsetHeight)}});const e=document.querySelector('.tab-navigation.top');e&&(N.value.observe(e),b.value=e.offsetHeight),u.value&&(N.value.observe(u.value),V.value=u.value.offsetHeight)})()}),md.getState(),eventOn('initialization_completed',()=>{j(!0)}),eventOn('MESSAGE_RECEIVED_PROCESSED',()=>{G(),(0,n.nextTick)(()=>{(()=>{if(d.value){const e=d.value.querySelectorAll('.message');e.length>0&&e[e.length-1].scrollIntoView({behavior:'smooth',block:'start'})}})()})}),eventOn(tavern_events.GENERATION_ENDED,e=>{md.stopGeneration()}),eventOn('RESTORE_USER_INPUT',e=>{l.value=e})}),(0,n.onUnmounted)(()=>{N.value&&(N.value.disconnect(),N.value=null)}),(e,t)=>((0,n.openBlock)(),(0,n.createElementBlock)('div',vd,[(0,n.createElementVNode)('div',pd,[(0,n.createElementVNode)('div',gd,[(0,n.createElementVNode)('div',{ref_key:'messages_container_ref',ref:d,class:'messages-container'},[(0,n.createCommentVNode)(' 載入更多消息按鈕 '),y.value?((0,n.openBlock)(),(0,n.createElementBlock)('div',_d,[(0,n.createElementVNode)('button',{class:'load-more-btn',onClick:x},'載入更多消息')])):(0,n.createCommentVNode)('v-if',!0),((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(r.value,(e,a)=>{return(0,n.openBlock)(),(0,n.createElementBlock)('div',{key:a,class:(0,n.normalizeClass)(['message',e.role])},[v.value===a?((0,n.openBlock)(),(0,n.createElementBlock)('div',hd,[(0,n.withDirectives)((0,n.createElementVNode)('textarea',{'onUpdate:modelValue':t[0]||(t[0]=e=>p.value=e),class:'edit-textarea',rows:'3',onKeydown:O},null,544),[[n.vModelText,p.value]]),(0,n.createElementVNode)('div',Ed,[(0,n.createElementVNode)('button',{class:'edit-btn confirm-btn',onClick:t=>(async(e,t)=>{if(p.value.trim()&&p.value!==e.content)try{if('user'===e.role)await setChatMessages([{message_id:getLastMessageId()-(r.value.length-1-t),message:p.value.trim()}],{refresh:'none'});else if('assistant'===e.role)if(e.swipes){const a=e.swipe_id||0,n=[...e.swipes];n[a]=p.value.trim(),await setChatMessages([{message_id:getLastMessageId()-(r.value.length-1-t),swipes:n}],{refresh:'none'})}else await setChatMessages([{message_id:getLastMessageId()-(r.value.length-1-t),message:p.value.trim()}],{refresh:'none'});G()}catch(e){console.error('Failed to save edit:',e)}M()})(e,a)},'✓',8,yd),(0,n.createElementVNode)('button',{class:'edit-btn cancel-btn',onClick:M},'✕')])])):((0,n.openBlock)(),(0,n.createElementBlock)(n.Fragment,{key:1},[(0,n.createElementVNode)('div',bd,[(0,n.createElementVNode)('div',Vd,[(0,n.createElementVNode)('span',Nd,'#'+(0,n.toDisplayString)(k.value-(r.value.length-1-a))+' ('+(0,n.toDisplayString)((l=k.value-(r.value.length-1-a),o=e.content,B.value.has(l)?`${B.value.get(l)}`:(C.value.has(l)||S(l,o),'...')))+' tokens)',1),(0,n.createElementVNode)('div',fd,['assistant'!==e.role||e.is_latest_assistant?(0,n.createCommentVNode)('v-if',!0):((0,n.openBlock)(),(0,n.createElementBlock)('button',{key:0,class:'rewind-message-btn',title:'從此點回退對話',onClick:t=>((e,t)=>{U('回退對話','確定要從此點回退對話嗎？這將刪除此點之後的所有消息。',()=>Y(e,t))})(e,a)},' ⏪ ',8,kd)),(0,n.createElementVNode)('button',{class:'edit-message-btn',title:'編輯消息',onClick:t=>((e,t)=>{v.value=t,p.value=e.content})(e,a)},'✏️',8,wd)])]),(0,n.createElementVNode)('div',Bd,[(0,n.createElementVNode)('div',Cd,[(0,n.createElementVNode)('div',$d,(0,n.toDisplayString)(w(k.value-(r.value.length-1-a)).datetimeLine),1),(0,n.createElementVNode)('div',Sd,(0,n.toDisplayString)(w(k.value-(r.value.length-1-a)).locationString),1)])])]),(0,n.createElementVNode)('div',xd,[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(A(e.content),(e,t)=>((0,n.openBlock)(),(0,n.createElementBlock)(n.Fragment,{key:t},[(0,n.createCommentVNode)(' 普通文本 '),(0,n.createCommentVNode)(' eslint-disable-next-line vue/no-v-html '),'plain_text'===e.type?((0,n.openBlock)(),(0,n.createElementBlock)('span',{key:0,innerHTML:e.message},null,8,Id)):(0,n.createCommentVNode)('v-if',!0),(0,n.createCommentVNode)(' 摺疊欄 '),'fold_bar'===e.type?((0,n.openBlock)(),(0,n.createBlock)(m,{key:1,title:e.fold_bar_title||'內容','is-open':e.is_open||!1},{default:(0,n.withCtx)(()=>[(0,n.createCommentVNode)(' eslint-disable-next-line vue/no-v-html '),(0,n.createElementVNode)('span',{innerHTML:e.message},null,8,Dd)]),_:2},1032,['title','is-open'])):(0,n.createCommentVNode)('v-if',!0)],64))),128))]),e.is_latest_assistant&&e.swipes?((0,n.openBlock)(),(0,n.createElementBlock)('div',Td,[(0,n.createElementVNode)('button',{class:'swipe-btn',disabled:(e.swipe_id||0)<=0,onClick:t=>(async e=>{if(e.swipe_id>0){const t=e.swipe_id-1;await setChatMessages([{message_id:getLastMessageId(),swipe_id:t}],{refresh:'none'}),G(),K()}})(e)},' ‹ ',8,Md),(0,n.createElementVNode)('span',Od,(0,n.toDisplayString)((e.swipe_id||0)+1)+'/'+(0,n.toDisplayString)(e.swipes.length),1),(0,n.createElementVNode)('button',{class:'swipe-btn',disabled:s.value,onClick:t=>P(e)},'›',8,Yd),(0,n.createElementVNode)('button',{class:'swipe-btn delete-btn',disabled:e.swipes.length<=1,title:'刪除當前swipe',onClick:t=>(async e=>{const t=e.swipe_id||0,a=e.swipes,n=e.swipes_data,l=e.swipes_info;a.length<=1||U('刪除回應變體',`確定要刪除第 ${t+1} 個回應變體嗎？\n\n這將永久刪除該回應變體。`,()=>q(e,t,a,n,l))})(e)},' × ',8,Ad)])):(0,n.createCommentVNode)('v-if',!0)],64))],2);var l,o}),128))],512)]),(0,n.createElementVNode)('div',{ref_key:'input_area_ref',ref:u,class:'input-area'},[(0,n.createElementVNode)('div',Rd,[(0,n.withDirectives)((0,n.createElementVNode)('textarea',{ref_key:'message_input_ref',ref:c,'onUpdate:modelValue':t[1]||(t[1]=e=>l.value=e),class:'message-input',placeholder:'輸入您的訊息...',rows:'1',onKeydown:D,onInput:T},null,544),[[n.vModelText,l.value]]),i.value||s.value?((0,n.openBlock)(),(0,n.createElementBlock)('div',Kd)):(0,n.createCommentVNode)('v-if',!0),(0,n.createElementVNode)('button',{class:'send-button',onClick:t[2]||(t[2]=e=>i.value||s.value?(async()=>{await md.stopGeneration()})():j())},(0,n.toDisplayString)(i.value||s.value?'停止':'發送'),1)])],512),(0,n.createCommentVNode)(' 通用組件 '),(0,n.createVNode)(Zi,{'confirm-dialog':g.value,onConfirmDialogConfirm:L,onConfirmDialogCancel:F},null,8,['confirm-dialog'])])]))}}),Ld=(0,d.A)(zd,[['__scopeId','data-v-18297b7b']]),Fd=Ld,Hd={class:'item-tab-container'},jd={class:'item-content'},Pd={class:'item-list'},qd={class:'item-info'},Gd={class:'item-id-name-row'},Wd={key:0,class:'item-id'},Xd=['onUpdate:modelValue'],Zd={key:2,class:'item-name'},Jd=['onUpdate:modelValue'],Qd={key:0,class:'item-description'},eu=['onUpdate:modelValue'],tu={class:'item-value-actions-row'},au={key:0,class:'item-value'},nu={key:1,class:'item-value-input-wrapper'},lu=['onUpdate:modelValue'],ru={class:'item-actions'},ou=['onClick'],iu=['onClick'],su=['onClick'],cu=['onClick'],du={key:0,class:'item-row new-item-row'},uu={class:'item-info'},mu={class:'item-id-name-row'},vu={class:'item-value-actions-row'},pu={class:'item-value-input-wrapper'},gu={key:1,class:'no-items-message'},_u=(0,n.defineComponent)({__name:'item_tab',setup(e){(0,n.useCssVars)(e=>({f33397ea:l.value}));const t=(0,n.ref)(0),a=(0,n.ref)(null),l=(0,n.computed)(()=>`calc(100vh - ${t.value}px)`);(0,n.onMounted)(()=>{(async()=>{await(0,n.nextTick)();const e=document.querySelector('.tab-navigation');e&&window.ResizeObserver?(a.value=new ResizeObserver(e=>{for(const a of e)t.value=a.contentRect.height}),a.value.observe(e)):t.value=74})()}),(0,n.onUnmounted)(()=>{a.value&&(a.value.disconnect(),a.value=null)});const r=(0,n.ref)(!1),o=(0,n.ref)(new Set),i=(0,n.ref)({id:'',name:'',description:'',value:0}),s=(0,n.ref)({}),c=(0,n.ref)({visible:!1,title:'',message:'',confirmText:'確認',cancelText:'取消'}),d=(0,n.ref)(null),u=(0,n.ref)(null),m=()=>{u.value&&(u.value.saveAsVariable(getLastMessageId()),v())},v=()=>{try{const e=getLastMessageId();u.value=Rl.loadFromVariable(e)}catch(e){console.error('Failed to load state:',e),u.value=null}};v();const p=(0,n.computed)(()=>u.value?.items||new Map),g=()=>{r.value=!0,i.value={id:'',name:'',description:'',value:0}},h=()=>{if(!u.value||!i.value.id||!i.value.name)return;if(u.value.items.has(i.value.id))return void E();const e=new Tl(i.value.name,i.value.description,i.value.value);u.value.items.set(i.value.id,e),m(),E()},E=()=>{r.value=!1,i.value={id:'',name:'',description:'',value:0}},y=e=>{o.value.delete(e),delete s.value[e]},b=()=>{d.value&&u.value&&(u.value.items.delete(d.value),m()),c.value.visible=!1,d.value=null},V=()=>{c.value.visible=!1,d.value=null};return(e,t)=>((0,n.openBlock)(),(0,n.createElementBlock)('div',Hd,[(0,n.createElementVNode)('div',jd,[(0,n.createCommentVNode)(' 物品列表標題 '),t[7]||(t[7]=(0,n.createElementVNode)('div',{class:'item-section'},[(0,n.createElementVNode)('h3',{class:'section-title'},'物品列表')],-1)),(0,n.createCommentVNode)(' 物品列表 '),(0,n.createElementVNode)('div',Pd,[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(p.value,([e,a])=>((0,n.openBlock)(),(0,n.createElementBlock)('div',{key:e,class:'item-row'},[(0,n.createCommentVNode)(' 物品信息 '),(0,n.createElementVNode)('div',qd,[(0,n.createElementVNode)('div',Gd,[o.value.has(e)?(0,n.withDirectives)(((0,n.openBlock)(),(0,n.createElementBlock)('input',{key:1,'onUpdate:modelValue':t=>s.value[e].id=t,class:'item-id-input',placeholder:'物品ID'},null,8,Xd)),[[n.vModelText,s.value[e].id]]):((0,n.openBlock)(),(0,n.createElementBlock)('div',Wd,(0,n.toDisplayString)(e),1)),o.value.has(e)?(0,n.withDirectives)(((0,n.openBlock)(),(0,n.createElementBlock)('input',{key:3,'onUpdate:modelValue':t=>s.value[e].name=t,class:'item-name-input',placeholder:'物品名稱'},null,8,Jd)),[[n.vModelText,s.value[e].name]]):((0,n.openBlock)(),(0,n.createElementBlock)('div',Zd,(0,n.toDisplayString)(a.name),1))]),o.value.has(e)?(0,n.withDirectives)(((0,n.openBlock)(),(0,n.createElementBlock)('textarea',{key:1,'onUpdate:modelValue':t=>s.value[e].description=t,class:'item-description-input',placeholder:'物品描述'},null,8,eu)),[[n.vModelText,s.value[e].description]]):((0,n.openBlock)(),(0,n.createElementBlock)('div',Qd,(0,n.toDisplayString)(a.description),1))]),(0,n.createCommentVNode)(' 價值和操作按鈕 '),(0,n.createElementVNode)('div',tu,[o.value.has(e)?((0,n.openBlock)(),(0,n.createElementBlock)('div',nu,[t[5]||(t[5]=(0,n.createElementVNode)('span',{class:'dollar-sign'},'$',-1)),(0,n.withDirectives)((0,n.createElementVNode)('input',{'onUpdate:modelValue':t=>s.value[e].value=t,class:'item-value-input',type:'number',placeholder:'價值'},null,8,lu),[[n.vModelText,s.value[e].value,void 0,{number:!0}]])])):((0,n.openBlock)(),(0,n.createElementBlock)('div',au,'$'+(0,n.toDisplayString)(a.value.toLocaleString()),1)),(0,n.createElementVNode)('div',ru,[o.value.has(e)?((0,n.openBlock)(),(0,n.createElementBlock)('button',{key:1,class:'confirm-button',onClick:t=>(e=>{if(!u.value||!s.value[e])return;const t=s.value[e];if(t.id!==e&&u.value.items.has(t.id))return void y(e);const a=u.value.items.get(e);a&&(t.id!==e&&(u.value.items.delete(e),u.value.items.set(t.id,a)),a.name=t.name,a.description=t.description,a.value=t.value,m()),y(e)})(e)},'保存',8,iu)):((0,n.openBlock)(),(0,n.createElementBlock)('button',{key:0,class:'edit-item-button',onClick:t=>(e=>{const t=p.value.get(e);t&&(o.value.add(e),s.value[e]={id:e,name:t.name,description:t.description,value:t.value})})(e)},' 編輯 ',8,ou)),o.value.has(e)?((0,n.openBlock)(),(0,n.createElementBlock)('button',{key:3,class:'cancel-button',onClick:t=>y(e)},'取消',8,cu)):((0,n.openBlock)(),(0,n.createElementBlock)('button',{key:2,class:'delete-item-button',onClick:t=>(e=>{const t=p.value.get(e);t&&(d.value=e,c.value={visible:!0,title:'確認刪除物品',message:`確定要刪除物品 "${t.name}" 嗎？此操作無法撤銷。`,confirmText:'刪除',cancelText:'取消'})})(e)},' 刪除 ',8,su))])])]))),128)),(0,n.createCommentVNode)(' 新物品編輯行 '),r.value?((0,n.openBlock)(),(0,n.createElementBlock)('div',du,[(0,n.createCommentVNode)(' 物品信息 '),(0,n.createElementVNode)('div',uu,[(0,n.createElementVNode)('div',mu,[(0,n.withDirectives)((0,n.createElementVNode)('input',{'onUpdate:modelValue':t[0]||(t[0]=e=>i.value.id=e),class:'item-id-input',placeholder:'物品ID'},null,512),[[n.vModelText,i.value.id]]),(0,n.withDirectives)((0,n.createElementVNode)('input',{'onUpdate:modelValue':t[1]||(t[1]=e=>i.value.name=e),class:'item-name-input',placeholder:'物品名稱'},null,512),[[n.vModelText,i.value.name]])]),(0,n.withDirectives)((0,n.createElementVNode)('textarea',{'onUpdate:modelValue':t[2]||(t[2]=e=>i.value.description=e),class:'item-description-input',placeholder:'物品描述'},null,512),[[n.vModelText,i.value.description]])]),(0,n.createCommentVNode)(' 價值和操作按鈕 '),(0,n.createElementVNode)('div',vu,[(0,n.createElementVNode)('div',pu,[t[6]||(t[6]=(0,n.createElementVNode)('span',{class:'dollar-sign'},'$',-1)),(0,n.withDirectives)((0,n.createElementVNode)('input',{'onUpdate:modelValue':t[3]||(t[3]=e=>i.value.value=e),class:'item-value-input',type:'number',placeholder:'價值'},null,512),[[n.vModelText,i.value.value,void 0,{number:!0}]])]),(0,n.createElementVNode)('div',{class:'item-actions'},[(0,n.createElementVNode)('button',{class:'confirm-button',onClick:h},'添加'),(0,n.createElementVNode)('button',{class:'cancel-button',onClick:E},'取消')])])])):(0,n.createCommentVNode)('v-if',!0),0!==p.value.size||r.value?(0,n.createCommentVNode)('v-if',!0):((0,n.openBlock)(),(0,n.createElementBlock)('div',gu,'沒有任何物品')),r.value?(0,n.createCommentVNode)('v-if',!0):((0,n.openBlock)(),(0,n.createElementBlock)('button',{key:2,class:'add-item-button',onClick:g},'+ 添加物品'))]),(0,n.createCommentVNode)(' 確認窗口 '),(0,n.createVNode)(Zi,{'confirm-dialog':c.value,'onUpdate:confirmDialog':t[4]||(t[4]=e=>c.value=e),onConfirmDialogConfirm:b,onConfirmDialogCancel:V},null,8,['confirm-dialog'])])]))}}),hu=(0,d.A)(_u,[['__scopeId','data-v-b32ed7ea']]),Eu=hu,yu={class:'location-tab-container'},bu={class:'location-content'},Vu={class:'location-list'},Nu=['id'],fu={class:'location-first-row'},ku={class:'location-id-name-group'},wu={key:0,class:'location-id'},Bu=['onUpdate:modelValue'],Cu={key:2,class:'location-name'},$u=['onUpdate:modelValue'],Su={class:'location-actions'},xu=['onClick'],Iu=['onClick'],Du={class:'location-location-row'},Tu={class:'location-location-group'},Mu={key:0,class:'location-location'},Ou=['onUpdate:modelValue'],Yu={key:0,class:'location-edit-actions'},Au=['onClick'],Ru=['onClick'],Ku={key:0,class:'location-parent-display'},Uu=['onClick'],zu={key:1,class:'location-parent-tag'},Lu={key:1,class:'location-parent-input-group'},Fu=['onUpdate:modelValue'],Hu=['value','disabled'],ju={key:2,class:'location-children-display'},Pu=['onClick'],qu={key:3,class:'location-children-input-group'},Gu={class:'selected-children'},Wu=['onClick'],Xu=['onChange'],Zu=['value','disabled'],Ju={key:4,class:'location-storages-display'},Qu={key:5,class:'location-storages-input-group'},em={class:'selected-storages'},tm=['onClick'],am=['onChange'],nm=['value','disabled'],lm={key:6,class:'location-description'},rm=['onUpdate:modelValue'],om={key:0,class:'location-row new-location-row'},im={class:'location-first-row'},sm={class:'location-id-name-group'},cm={class:'location-location-row'},dm={class:'location-location-group'},um={class:'location-parent-input-group'},mm=['value'],vm={class:'location-children-input-group'},pm={class:'selected-children'},gm=['onClick'],_m=['value','disabled'],hm={class:'location-storages-input-group'},Em={class:'selected-storages'},ym=['onClick'],bm=['value','disabled'],Vm={key:1,class:'no-locations-message'},Nm=(0,n.defineComponent)({__name:'location_tab',setup(e){(0,n.useCssVars)(e=>({v77958077:l.value}));const t=(0,n.ref)(0),a=(0,n.ref)(null),l=(0,n.computed)(()=>`calc(100vh - ${t.value}px)`);(0,n.onMounted)(()=>{(async()=>{await(0,n.nextTick)();const e=document.querySelector('.tab-navigation');e&&window.ResizeObserver?(a.value=new ResizeObserver(e=>{for(const a of e)t.value=a.contentRect.height}),a.value.observe(e)):t.value=74})()}),(0,n.onUnmounted)(()=>{a.value&&(a.value.disconnect(),a.value=null)});const r=(0,n.ref)(!1),o=(0,n.ref)(new Set),i=(0,n.ref)({id:'',name:'',location:'',description:'',parent_location_id:null,sub_location_ids:[],storage_ids:[]}),s=(0,n.ref)({}),c=(0,n.ref)({visible:!1,title:'',message:'',confirmText:'確認',cancelText:'取消'}),d=(0,n.ref)(null),u=(0,n.ref)(null),m=()=>{u.value&&(u.value.saveAsVariable(getLastMessageId()),v())},v=()=>{try{const e=getLastMessageId();u.value=Rl.loadFromVariable(e)}catch(e){console.error('Failed to load state:',e),u.value=null}};v();const p=(0,n.computed)(()=>u.value?.locations||new Map),g=(0,n.computed)(()=>u.value?.storages||new Map),h=(e,t)=>{let a=t;const n=new Set;for(;a;){if(n.has(a))return!0;if(a===e)return!0;n.add(a);const t=p.value.get(a);a=t?.parent_location_id||null}return!1},E=()=>{r.value=!0,i.value={id:'',name:'',location:'',description:'',parent_location_id:null,sub_location_ids:[],storage_ids:[]},i.value.id=(()=>{const e=Array.from(p.value.keys());let t=1;for(;e.includes(`l${t}`);)t++;return`l${t}`})()},y=e=>{if(!(e.id&&e.name&&e.location&&e.description))return null;try{return new Ml(e.id,e.name,e.location,e.description,e.parent_location_id,e.sub_location_ids,e.storage_ids)}catch(e){return console.error('Failed to create location:',e),null}},b=()=>{if(!u.value)return;if(u.value.locations.has(i.value.id))return void V();const e=y(i.value);e?(u.value.locations.set(i.value.id,e),m(),V()):V()},V=()=>{r.value=!1,i.value={id:'',name:'',location:'',description:'',parent_location_id:null,sub_location_ids:[],storage_ids:[]}},N=e=>{o.value.delete(e),delete s.value[e]},f=()=>{d.value&&u.value&&(u.value.locations.delete(d.value),m()),c.value.visible=!1,d.value=null},k=()=>{c.value.visible=!1,d.value=null},w=(e,t)=>{e.sub_location_ids.includes(t)||e.sub_location_ids.push(t)},B=(e,t)=>{const a=e.sub_location_ids.indexOf(t);a>-1&&e.sub_location_ids.splice(a,1)},C=(e,t)=>{e.storage_ids.includes(t)||e.storage_ids.push(t)},S=(e,t)=>{const a=e.storage_ids.indexOf(t);a>-1&&e.storage_ids.splice(a,1)},x=e=>{const t=document.getElementById(`location-${e}`);t&&t.scrollIntoView({behavior:'smooth',block:'start'})};return(e,t)=>((0,n.openBlock)(),(0,n.createElementBlock)('div',yu,[(0,n.createElementVNode)('div',bu,[(0,n.createCommentVNode)(' 地點列表標題 '),t[16]||(t[16]=(0,n.createElementVNode)('div',{class:'location-section'},[(0,n.createElementVNode)('h3',{class:'section-title'},'地點列表')],-1)),(0,n.createCommentVNode)(' 地點列表 '),(0,n.createElementVNode)('div',Vu,[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(p.value,([e,a])=>((0,n.openBlock)(),(0,n.createElementBlock)('div',{id:`location-${e}`,key:e,class:'location-row'},[(0,n.createCommentVNode)(' 第一行：ID、名稱、操作按鈕 '),(0,n.createElementVNode)('div',fu,[(0,n.createElementVNode)('div',ku,[o.value.has(e)?(0,n.withDirectives)(((0,n.openBlock)(),(0,n.createElementBlock)('input',{key:1,'onUpdate:modelValue':t=>s.value[e].id=t,class:'location-id-input',placeholder:'地點ID'},null,8,Bu)),[[n.vModelText,s.value[e].id]]):((0,n.openBlock)(),(0,n.createElementBlock)('div',wu,(0,n.toDisplayString)(e),1)),o.value.has(e)?(0,n.withDirectives)(((0,n.openBlock)(),(0,n.createElementBlock)('input',{key:3,'onUpdate:modelValue':t=>s.value[e].name=t,class:'location-name-input',placeholder:'地點名稱'},null,8,$u)),[[n.vModelText,s.value[e].name]]):((0,n.openBlock)(),(0,n.createElementBlock)('div',Cu,(0,n.toDisplayString)(a.name),1))]),(0,n.createElementVNode)('div',Su,[o.value.has(e)?(0,n.createCommentVNode)('v-if',!0):((0,n.openBlock)(),(0,n.createElementBlock)('button',{key:0,class:'edit-location-button',onClick:t=>(e=>{const t=p.value.get(e);t&&(o.value.add(e),s.value[e]={id:e,name:t.name,location:t.location,description:t.description,parent_location_id:t.parent_location_id,sub_location_ids:[...t.sub_location_ids],storage_ids:[...t.storage_ids]})})(e)},' 編輯 ',8,xu)),o.value.has(e)?(0,n.createCommentVNode)('v-if',!0):((0,n.openBlock)(),(0,n.createElementBlock)('button',{key:1,class:'delete-location-button',onClick:t=>(e=>{const t=p.value.get(e);t&&(d.value=e,c.value={visible:!0,title:'確認刪除地點',message:`確定要刪除地點 "${t.name}" 嗎？此操作無法撤銷。`,confirmText:'刪除',cancelText:'取消'})})(e)},' 刪除 ',8,Iu))])]),(0,n.createCommentVNode)(' 第二行：位置 + 編輯按鈕 '),(0,n.createElementVNode)('div',Du,[(0,n.createElementVNode)('div',Tu,[t[8]||(t[8]=(0,n.createElementVNode)('span',{class:'location-location-label'},'位置：',-1)),o.value.has(e)?(0,n.withDirectives)(((0,n.openBlock)(),(0,n.createElementBlock)('input',{key:1,'onUpdate:modelValue':t=>s.value[e].location=t,class:'location-location-input location-location-input-edit',placeholder:'地點位置'},null,8,Ou)),[[n.vModelText,s.value[e].location]]):((0,n.openBlock)(),(0,n.createElementBlock)('div',Mu,(0,n.toDisplayString)(a.location),1))]),o.value.has(e)?((0,n.openBlock)(),(0,n.createElementBlock)('div',Yu,[(0,n.createElementVNode)('button',{class:'confirm-button',onClick:t=>(e=>{if(!u.value||!s.value[e])return;const t=s.value[e];if(t.id!==e&&u.value.locations.has(t.id))return void N(e);const a=y(t);if(a){const n=u.value.locations.get(e);n&&(t.id!==e?(u.value.locations.delete(e),u.value.locations.set(t.id,a)):(n.name=a.name,n.location=a.location,n.description=a.description,n.parent_location_id=a.parent_location_id,n.sub_location_ids=a.sub_location_ids,n.storage_ids=a.storage_ids),m()),N(e)}else N(e)})(e)},'保存',8,Au),(0,n.createElementVNode)('button',{class:'cancel-button',onClick:t=>N(e)},'取消',8,Ru)])):(0,n.createCommentVNode)('v-if',!0)]),(0,n.createCommentVNode)(' 第三行：父地點 '),o.value.has(e)?((0,n.openBlock)(),(0,n.createElementBlock)('div',Lu,[(0,n.withDirectives)((0,n.createElementVNode)('select',{'onUpdate:modelValue':t=>s.value[e].parent_location_id=t,class:'parent-location-select'},[t[9]||(t[9]=(0,n.createElementVNode)('option',{value:null},'根地點',-1)),((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(p.value,([t,a])=>((0,n.openBlock)(),(0,n.createElementBlock)('option',{key:t,value:t,disabled:t===e||h(e,t)},(0,n.toDisplayString)(a.name)+' ('+(0,n.toDisplayString)(t)+') ',9,Hu))),128))],8,Fu),[[n.vModelSelect,s.value[e].parent_location_id]])])):((0,n.openBlock)(),(0,n.createElementBlock)('div',Ku,[a.parent_location_id?((0,n.openBlock)(),(0,n.createElementBlock)('span',{key:0,class:'location-parent-tag',onClick:e=>x(a.parent_location_id)},' 父: '+(0,n.toDisplayString)(a.parent_location_id)+' '+(0,n.toDisplayString)(p.value.get(a.parent_location_id)?.name||a.parent_location_id),9,Uu)):((0,n.openBlock)(),(0,n.createElementBlock)('span',zu,'根地點'))])),(0,n.createCommentVNode)(' 第四行：子地點 '),o.value.has(e)?((0,n.openBlock)(),(0,n.createElementBlock)('div',qu,[(0,n.createElementVNode)('div',Gu,[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(s.value[e].sub_location_ids,t=>((0,n.openBlock)(),(0,n.createElementBlock)('span',{key:t,class:'selected-child-tag'},[(0,n.createTextVNode)((0,n.toDisplayString)(p.value.get(t)?.name||t)+' ',1),(0,n.createElementVNode)('button',{class:'remove-child-btn',onClick:a=>B(s.value[e],t)},' × ',8,Wu)]))),128))]),(0,n.createElementVNode)('select',{class:'child-location-select',onChange:t=>{w(s.value[e],t.target.value),t.target.value=''}},[t[10]||(t[10]=(0,n.createElementVNode)('option',{value:''},'選擇子地點...',-1)),((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(p.value,([t,a])=>((0,n.openBlock)(),(0,n.createElementBlock)('option',{key:t,value:t,disabled:s.value[e].sub_location_ids.includes(t)||t===e||h(t,e)},(0,n.toDisplayString)(a.name)+' ('+(0,n.toDisplayString)(t)+') ',9,Zu))),128))],40,Xu)])):((0,n.openBlock)(),(0,n.createElementBlock)('div',ju,[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(a.sub_location_ids,e=>((0,n.openBlock)(),(0,n.createElementBlock)('span',{key:e,class:'location-child-tag',onClick:t=>x(e)},' 子: '+(0,n.toDisplayString)(e)+' '+(0,n.toDisplayString)(p.value.get(e)?.name||e),9,Pu))),128))])),(0,n.createCommentVNode)(' 第五行：貯存點 '),o.value.has(e)?((0,n.openBlock)(),(0,n.createElementBlock)('div',Qu,[(0,n.createElementVNode)('div',em,[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(s.value[e].storage_ids,t=>((0,n.openBlock)(),(0,n.createElementBlock)('span',{key:t,class:'selected-storage-tag'},[(0,n.createTextVNode)((0,n.toDisplayString)(g.value.get(t)?.name||t)+' ',1),(0,n.createElementVNode)('button',{class:'remove-storage-btn',onClick:a=>S(s.value[e],t)},' × ',8,tm)]))),128))]),(0,n.createElementVNode)('select',{class:'storage-location-select',onChange:t=>{C(s.value[e],t.target.value),t.target.value=''}},[t[11]||(t[11]=(0,n.createElementVNode)('option',{value:''},'選擇貯存點...',-1)),((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(g.value,([t,a])=>((0,n.openBlock)(),(0,n.createElementBlock)('option',{key:t,value:t,disabled:s.value[e].storage_ids.includes(t)},(0,n.toDisplayString)(a.name)+' ('+(0,n.toDisplayString)(t)+') ',9,nm))),128))],40,am)])):((0,n.openBlock)(),(0,n.createElementBlock)('div',Ju,[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(a.storage_ids,e=>((0,n.openBlock)(),(0,n.createElementBlock)('span',{key:e,class:'location-storage-tag'},' 貯: '+(0,n.toDisplayString)(e)+' '+(0,n.toDisplayString)(g.value.get(e)?.name||e),1))),128))])),(0,n.createCommentVNode)(' 第五行：描述 '),o.value.has(e)?(0,n.withDirectives)(((0,n.openBlock)(),(0,n.createElementBlock)('textarea',{key:7,'onUpdate:modelValue':t=>s.value[e].description=t,class:'location-description-input',placeholder:'地點描述'},null,8,rm)),[[n.vModelText,s.value[e].description]]):((0,n.openBlock)(),(0,n.createElementBlock)('div',lm,(0,n.toDisplayString)(a.description),1))],8,Nu))),128)),(0,n.createCommentVNode)(' 新地點編輯行 '),r.value?((0,n.openBlock)(),(0,n.createElementBlock)('div',om,[(0,n.createCommentVNode)(' 第一行：ID、名稱 '),(0,n.createElementVNode)('div',im,[(0,n.createElementVNode)('div',sm,[(0,n.withDirectives)((0,n.createElementVNode)('input',{'onUpdate:modelValue':t[0]||(t[0]=e=>i.value.id=e),class:'location-id-input',placeholder:'地點ID'},null,512),[[n.vModelText,i.value.id]]),(0,n.withDirectives)((0,n.createElementVNode)('input',{'onUpdate:modelValue':t[1]||(t[1]=e=>i.value.name=e),class:'location-name-input',placeholder:'地點名稱'},null,512),[[n.vModelText,i.value.name]])])]),(0,n.createCommentVNode)(' 第二行：位置 + 添加按鈕 '),(0,n.createElementVNode)('div',cm,[(0,n.createElementVNode)('div',dm,[t[12]||(t[12]=(0,n.createElementVNode)('span',{class:'location-location-label'},'位置：',-1)),(0,n.withDirectives)((0,n.createElementVNode)('input',{'onUpdate:modelValue':t[2]||(t[2]=e=>i.value.location=e),class:'location-location-input location-location-input-edit',placeholder:'地點位置'},null,512),[[n.vModelText,i.value.location]])]),(0,n.createElementVNode)('div',{class:'location-edit-actions'},[(0,n.createElementVNode)('button',{class:'confirm-button',onClick:b},'添加'),(0,n.createElementVNode)('button',{class:'cancel-button',onClick:V},'取消')])]),(0,n.createCommentVNode)(' 第三行：父地點 '),(0,n.createElementVNode)('div',um,[(0,n.withDirectives)((0,n.createElementVNode)('select',{'onUpdate:modelValue':t[3]||(t[3]=e=>i.value.parent_location_id=e),class:'parent-location-select'},[t[13]||(t[13]=(0,n.createElementVNode)('option',{value:null},'根地點',-1)),((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(p.value,([e,t])=>((0,n.openBlock)(),(0,n.createElementBlock)('option',{key:e,value:e},(0,n.toDisplayString)(t.name)+' ('+(0,n.toDisplayString)(e)+') ',9,mm))),128))],512),[[n.vModelSelect,i.value.parent_location_id]])]),(0,n.createCommentVNode)(' 第四行：子地點 '),(0,n.createElementVNode)('div',vm,[(0,n.createElementVNode)('div',pm,[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(i.value.sub_location_ids,e=>((0,n.openBlock)(),(0,n.createElementBlock)('span',{key:e,class:'selected-child-tag'},[(0,n.createTextVNode)((0,n.toDisplayString)(p.value.get(e)?.name||e)+' ',1),(0,n.createElementVNode)('button',{class:'remove-child-btn',onClick:t=>B(i.value,e)},'×',8,gm)]))),128))]),(0,n.createElementVNode)('select',{class:'child-location-select',onChange:t[4]||(t[4]=e=>{w(i.value,e.target.value),e.target.value=''})},[t[14]||(t[14]=(0,n.createElementVNode)('option',{value:''},'選擇子地點...',-1)),((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(p.value,([e,t])=>((0,n.openBlock)(),(0,n.createElementBlock)('option',{key:e,value:e,disabled:i.value.sub_location_ids.includes(e)||e===i.value.id},(0,n.toDisplayString)(t.name)+' ('+(0,n.toDisplayString)(e)+') ',9,_m))),128))],32)]),(0,n.createCommentVNode)(' 第五行：貯存點 '),(0,n.createElementVNode)('div',hm,[(0,n.createElementVNode)('div',Em,[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(i.value.storage_ids,e=>((0,n.openBlock)(),(0,n.createElementBlock)('span',{key:e,class:'selected-storage-tag'},[(0,n.createTextVNode)((0,n.toDisplayString)(g.value.get(e)?.name||e)+' ',1),(0,n.createElementVNode)('button',{class:'remove-storage-btn',onClick:t=>S(i.value,e)},'×',8,ym)]))),128))]),(0,n.createElementVNode)('select',{class:'storage-location-select',onChange:t[5]||(t[5]=e=>{C(i.value,e.target.value),e.target.value=''})},[t[15]||(t[15]=(0,n.createElementVNode)('option',{value:''},'選擇貯存點...',-1)),((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(g.value,([e,t])=>((0,n.openBlock)(),(0,n.createElementBlock)('option',{key:e,value:e,disabled:i.value.storage_ids.includes(e)},(0,n.toDisplayString)(t.name)+' ('+(0,n.toDisplayString)(e)+') ',9,bm))),128))],32)]),(0,n.createCommentVNode)(' 第六行：描述 '),(0,n.withDirectives)((0,n.createElementVNode)('textarea',{'onUpdate:modelValue':t[6]||(t[6]=e=>i.value.description=e),class:'location-description-input',placeholder:'地點描述'},null,512),[[n.vModelText,i.value.description]])])):(0,n.createCommentVNode)('v-if',!0),0!==p.value.size||r.value?(0,n.createCommentVNode)('v-if',!0):((0,n.openBlock)(),(0,n.createElementBlock)('div',Vm,'沒有任何地點')),r.value?(0,n.createCommentVNode)('v-if',!0):((0,n.openBlock)(),(0,n.createElementBlock)('button',{key:2,class:'add-location-button',onClick:E},'+ 添加地點'))]),(0,n.createCommentVNode)(' 確認窗口 '),(0,n.createVNode)(Zi,{'confirm-dialog':c.value,'onUpdate:confirmDialog':t[7]||(t[7]=e=>c.value=e),onConfirmDialogConfirm:f,onConfirmDialogCancel:k},null,8,['confirm-dialog'])])]))}}),fm=(0,d.A)(Nm,[['__scopeId','data-v-bd354e5e']]),km=fm,wm={class:'storage-tab-container'},Bm={class:'storage-content'},Cm={class:'storage-list'},$m=['id'],Sm={class:'storage-first-row'},xm={class:'storage-id-name-group'},Im={key:0,class:'storage-id'},Dm=['onUpdate:modelValue'],Tm={key:2,class:'storage-name'},Mm=['onUpdate:modelValue'],Om={class:'storage-actions'},Ym=['onClick'],Am=['onClick'],Rm={class:'storage-money-row'},Km={class:'storage-money-group'},Um={key:0,class:'storage-money'},zm=['onUpdate:modelValue','onInput'],Lm={key:0,class:'storage-edit-actions'},Fm=['disabled','onClick'],Hm=['onClick'],jm={key:0,class:'storage-parent-display'},Pm={class:'storage-parent-tag'},qm={key:1,class:'storage-parent-input-group'},Gm=['onUpdate:modelValue'],Wm={label:'角色'},Xm=['value'],Zm={label:'地點'},Jm=['value'],Qm={label:'貯存點'},ev=['value','disabled'],tv={key:2,class:'storage-inventory-display'},av={key:0,class:'no-inventory'},nv={key:1,class:'inventory-items'},lv={key:3,class:'storage-inventory-input-group'},rv={class:'selected-inventory'},ov={class:'item-name'},iv={key:0,class:'storage-indicator'},sv={key:1,class:'inventory-edit-connector'},cv=['onUpdate:modelValue','onInput'],dv=['onClick'],uv=['onChange'],mv={label:'物品'},vv=['value','disabled'],pv={label:'貯存點'},gv=['value','disabled'],_v={key:4,class:'storage-description'},hv=['onUpdate:modelValue'],Ev={key:0,class:'storage-row new-storage-row'},yv={class:'storage-first-row'},bv={class:'storage-id-name-group'},Vv={class:'storage-money-row'},Nv={class:'storage-money-group'},fv={class:'storage-edit-actions'},kv=['disabled'],wv={class:'storage-parent-input-group'},Bv={label:'角色'},Cv=['value'],$v={label:'地點'},Sv=['value'],xv={label:'貯存點'},Iv=['value'],Dv={class:'storage-inventory-input-group'},Tv={class:'selected-inventory'},Mv={class:'item-name'},Ov={key:0,class:'storage-indicator'},Yv={key:1,class:'inventory-edit-connector'},Av=['onUpdate:modelValue','onInput'],Rv=['onClick'],Kv={label:'物品'},Uv=['value','disabled'],zv={label:'貯存點'},Lv=['value','disabled'],Fv={key:1,class:'no-storages-message'},Hv=(0,n.defineComponent)({__name:'storage_tab',setup(e){(0,n.useCssVars)(e=>({v4efc9d77:l.value}));const t=(0,n.ref)(0),a=(0,n.ref)(null),l=(0,n.computed)(()=>`calc(100vh - ${t.value}px)`);(0,n.onMounted)(()=>{(async()=>{await(0,n.nextTick)();const e=document.querySelector('.tab-navigation');e&&window.ResizeObserver?(a.value=new ResizeObserver(e=>{for(const a of e)t.value=a.contentRect.height}),a.value.observe(e)):t.value=74})()}),(0,n.onUnmounted)(()=>{a.value&&(a.value.disconnect(),a.value=null)});const r=(0,n.ref)(!1),o=(0,n.ref)(new Set),i=(0,n.ref)({id:'',name:'',description:'',parent_id:'',money:0,inventory:{}}),s=(0,n.ref)({}),c=(0,n.ref)({visible:!1,title:'',message:'',confirmText:'確認',cancelText:'取消'}),d=(0,n.ref)(null),u=e=>m.value?.storages.has(e)||!1,m=(0,n.ref)(null),v=()=>{m.value&&(m.value.saveAsVariable(getLastMessageId()),p())},p=()=>{try{const e=getLastMessageId();m.value=Rl.loadFromVariable(e)}catch(e){console.error('Failed to load state:',e),m.value=null}};p();const g=(0,n.computed)(()=>m.value?.storages||new Map),h=(0,n.computed)(()=>m.value?.active_characters||new Map),E=(0,n.computed)(()=>m.value?.locations||new Map),y=(0,n.computed)(()=>m.value?.items||new Map),b=()=>{r.value=!0,i.value={id:'',name:'',description:'',parent_id:'',money:0,inventory:{}}},V=e=>{if(!e.id||!e.name||!e.description||e.money<0)return null;if(!(h.value.has(e.parent_id)||E.value.has(e.parent_id)||g.value.has(e.parent_id)))return null;for(const t in e.inventory){const a=y.value.has(t)||g.value.has(t),n=g.value.has(t)?1:e.inventory[t];if(!a||n<1)return null}try{const t=new Map;for(const[a,n]of Object.entries(e.inventory)){const e=g.value.has(a)?1:n;t.set(a,e)}return new Yl(e.name,e.description,e.parent_id,e.money,t)}catch(e){return console.error('Failed to create storage:',e),null}},N=()=>{if(!m.value)return;if(m.value.storages.has(i.value.id))return void f();const e=V(i.value);e?(m.value.storages.set(i.value.id,e),v(),f()):f()},f=()=>{r.value=!1,i.value={id:'',name:'',description:'',parent_id:'',money:0,inventory:{}}},k=e=>{o.value.delete(e),delete s.value[e]},w=()=>{d.value&&m.value&&(m.value.storages.delete(d.value),v()),c.value.visible=!1,d.value=null},B=()=>{c.value.visible=!1,d.value=null},C=(e,t)=>{t in e.inventory||(e.inventory[t]=1)},S=(e,t)=>{delete e.inventory[t]};return(e,t)=>((0,n.openBlock)(),(0,n.createElementBlock)('div',wm,[(0,n.createElementVNode)('div',Bm,[(0,n.createCommentVNode)(' 貯存點列表標題 '),t[14]||(t[14]=(0,n.createElementVNode)('div',{class:'storage-section'},[(0,n.createElementVNode)('h3',{class:'section-title'},'貯存點列表')],-1)),(0,n.createCommentVNode)(' 貯存點列表 '),(0,n.createElementVNode)('div',Cm,[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(g.value,([e,a])=>((0,n.openBlock)(),(0,n.createElementBlock)('div',{id:`storage-${e}`,key:e,class:'storage-row'},[(0,n.createCommentVNode)(' 第一行：ID、名稱、操作按鈕 '),(0,n.createElementVNode)('div',Sm,[(0,n.createElementVNode)('div',xm,[o.value.has(e)?(0,n.withDirectives)(((0,n.openBlock)(),(0,n.createElementBlock)('input',{key:1,'onUpdate:modelValue':t=>s.value[e].id=t,class:'storage-id-input',placeholder:'貯存點ID'},null,8,Dm)),[[n.vModelText,s.value[e].id]]):((0,n.openBlock)(),(0,n.createElementBlock)('div',Im,(0,n.toDisplayString)(e),1)),o.value.has(e)?(0,n.withDirectives)(((0,n.openBlock)(),(0,n.createElementBlock)('input',{key:3,'onUpdate:modelValue':t=>s.value[e].name=t,class:'storage-name-input',placeholder:'貯存點名稱'},null,8,Mm)),[[n.vModelText,s.value[e].name]]):((0,n.openBlock)(),(0,n.createElementBlock)('div',Tm,(0,n.toDisplayString)(a.name),1))]),(0,n.createElementVNode)('div',Om,[o.value.has(e)?(0,n.createCommentVNode)('v-if',!0):((0,n.openBlock)(),(0,n.createElementBlock)('button',{key:0,class:'edit-storage-button',onClick:t=>(e=>{const t=g.value.get(e);t&&(o.value.add(e),s.value[e]={id:e,name:t.name,description:t.description,parent_id:t.parent_id,money:t.money,inventory:Object.fromEntries(t.inventory)})})(e)},' 編輯 ',8,Ym)),o.value.has(e)?(0,n.createCommentVNode)('v-if',!0):((0,n.openBlock)(),(0,n.createElementBlock)('button',{key:1,class:'delete-storage-button',onClick:t=>(e=>{const t=g.value.get(e);t&&(d.value=e,c.value={visible:!0,title:'確認刪除貯存點',message:`確定要刪除貯存點 "${t.name}" 嗎？此操作無法撤銷。`,confirmText:'刪除',cancelText:'取消'})})(e)},' 刪除 ',8,Am))])]),(0,n.createCommentVNode)(' 第二行：金錢 + 編輯按鈕 '),(0,n.createElementVNode)('div',Rm,[(0,n.createElementVNode)('div',Km,[t[8]||(t[8]=(0,n.createElementVNode)('span',{class:'storage-money-label'},'貯存金額：',-1)),o.value.has(e)?(0,n.withDirectives)(((0,n.openBlock)(),(0,n.createElementBlock)('input',{key:1,'onUpdate:modelValue':t=>s.value[e].money=t,type:'number',class:'storage-money-input storage-money-input-edit',placeholder:'金錢數量',min:'0',onInput:t=>s.value[e].money=Math.max(0,parseInt(t.target.value)||0)},null,40,zm)),[[n.vModelText,s.value[e].money,void 0,{number:!0}]]):((0,n.openBlock)(),(0,n.createElementBlock)('div',Um,'$'+(0,n.toDisplayString)(a.money),1))]),o.value.has(e)?((0,n.openBlock)(),(0,n.createElementBlock)('div',Lm,[(0,n.createElementVNode)('button',{class:'confirm-button',disabled:!s.value[e].id||!s.value[e].name||!s.value[e].parent_id,onClick:t=>(e=>{if(!m.value||!s.value[e])return;const t=s.value[e];if(t.id!==e&&m.value.storages.has(t.id))return void k(e);const a=V(t);if(a){const n=m.value.storages.get(e);n&&(t.id!==e?(m.value.storages.delete(e),m.value.storages.set(t.id,a)):(n.name=a.name,n.description=a.description,n.parent_id=a.parent_id,n.money=a.money,n.inventory=a.inventory),v()),k(e)}else k(e)})(e)},' 保存 ',8,Fm),(0,n.createElementVNode)('button',{class:'cancel-button',onClick:t=>k(e)},'取消',8,Hm)])):(0,n.createCommentVNode)('v-if',!0)]),(0,n.createCommentVNode)(' 第三行：父級 '),o.value.has(e)?((0,n.openBlock)(),(0,n.createElementBlock)('div',qm,[(0,n.withDirectives)((0,n.createElementVNode)('select',{'onUpdate:modelValue':t=>s.value[e].parent_id=t,class:'parent-select'},[t[9]||(t[9]=(0,n.createElementVNode)('option',{value:'',disabled:''},'選擇父級 (角色、地點或貯存點)...',-1)),(0,n.createElementVNode)('optgroup',Wm,[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(h.value,([e,t])=>((0,n.openBlock)(),(0,n.createElementBlock)('option',{key:`char-${e}`,value:e},(0,n.toDisplayString)(t.name)+' ('+(0,n.toDisplayString)(e)+') ',9,Xm))),128))]),(0,n.createElementVNode)('optgroup',Zm,[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(E.value,([e,t])=>((0,n.openBlock)(),(0,n.createElementBlock)('option',{key:`loc-${e}`,value:e},(0,n.toDisplayString)(t.name)+' ('+(0,n.toDisplayString)(e)+') ',9,Jm))),128))]),(0,n.createElementVNode)('optgroup',Qm,[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(g.value,([t,a])=>((0,n.openBlock)(),(0,n.createElementBlock)('option',{key:`storage-${t}`,value:t,disabled:t===e},(0,n.toDisplayString)(a.name)+' ('+(0,n.toDisplayString)(t)+') ',9,ev))),128))])],8,Gm),[[n.vModelSelect,s.value[e].parent_id]])])):((0,n.openBlock)(),(0,n.createElementBlock)('div',jm,[(0,n.createElementVNode)('span',Pm,(0,n.toDisplayString)(a.parent_id)+' '+(0,n.toDisplayString)(h.value.get(a.parent_id)?.name||E.value.get(a.parent_id)?.name||g.value.get(a.parent_id)?.name||a.parent_id),1)])),(0,n.createCommentVNode)(' 第四行：庫存 '),o.value.has(e)?((0,n.openBlock)(),(0,n.createElementBlock)('div',lv,[(0,n.createElementVNode)('div',rv,[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(Object.keys(s.value[e].inventory),t=>((0,n.openBlock)(),(0,n.createElementBlock)('div',{key:t,class:'selected-inventory-item'},[(0,n.createElementVNode)('span',ov,(0,n.toDisplayString)(y.value.get(t)?.name||g.value.get(t)?.name||t),1),u(t)?((0,n.openBlock)(),(0,n.createElementBlock)('span',iv,'貯存點')):(0,n.createCommentVNode)('v-if',!0),u(t)?(0,n.createCommentVNode)('v-if',!0):((0,n.openBlock)(),(0,n.createElementBlock)('span',sv,'×')),u(t)?(0,n.createCommentVNode)('v-if',!0):(0,n.withDirectives)(((0,n.openBlock)(),(0,n.createElementBlock)('input',{key:2,'onUpdate:modelValue':a=>s.value[e].inventory[t]=a,type:'number',class:'item-quantity-input',placeholder:'數量',min:'1',step:'1',onInput:a=>s.value[e].inventory[t]=Math.max(1,parseInt(a.target.value)||1)},null,40,cv)),[[n.vModelText,s.value[e].inventory[t],void 0,{number:!0}]]),(0,n.createElementVNode)('button',{class:'remove-item-btn',onClick:a=>S(s.value[e],t)},'×',8,dv)]))),128))]),(0,n.createElementVNode)('select',{class:'item-select',onChange:t=>{C(s.value[e],t.target.value),t.target.value=''}},[t[10]||(t[10]=(0,n.createElementVNode)('option',{value:''},'選擇物品或貯存點...',-1)),(0,n.createElementVNode)('optgroup',mv,[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(y.value,([t,a])=>((0,n.openBlock)(),(0,n.createElementBlock)('option',{key:t,value:t,disabled:s.value[e].inventory.hasOwnProperty(t)},(0,n.toDisplayString)(a.name)+' ('+(0,n.toDisplayString)(t)+') ',9,vv))),128))]),(0,n.createElementVNode)('optgroup',pv,[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(g.value,([t,a])=>((0,n.openBlock)(),(0,n.createElementBlock)('option',{key:t,value:t,disabled:s.value[e].inventory.hasOwnProperty(t)||t===e},(0,n.toDisplayString)(a.name)+' ('+(0,n.toDisplayString)(t)+') ',9,gv))),128))])],40,uv)])):((0,n.openBlock)(),(0,n.createElementBlock)('div',tv,[0===a.inventory.size?((0,n.openBlock)(),(0,n.createElementBlock)('div',av,'無物品')):((0,n.openBlock)(),(0,n.createElementBlock)('div',nv,[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(a.inventory,([e,t])=>((0,n.openBlock)(),(0,n.createElementBlock)('span',{key:e,class:(0,n.normalizeClass)(g.value.has(e)?'storage-item-tag':'inventory-item-tag')},(0,n.toDisplayString)(y.value.get(e)?.name||g.value.get(e)?.name||e)+' ('+(0,n.toDisplayString)(e)+')'+(0,n.toDisplayString)(g.value.has(e)?'':` × ${t}`),3))),128))]))])),(0,n.createCommentVNode)(' 第五行：描述 '),o.value.has(e)?(0,n.withDirectives)(((0,n.openBlock)(),(0,n.createElementBlock)('textarea',{key:5,'onUpdate:modelValue':t=>s.value[e].description=t,class:'storage-description-input',placeholder:'貯存點描述'},null,8,hv)),[[n.vModelText,s.value[e].description]]):((0,n.openBlock)(),(0,n.createElementBlock)('div',_v,(0,n.toDisplayString)(a.description),1))],8,$m))),128)),(0,n.createCommentVNode)(' 新貯存點編輯行 '),r.value?((0,n.openBlock)(),(0,n.createElementBlock)('div',Ev,[(0,n.createCommentVNode)(' 第一行：ID、名稱 '),(0,n.createElementVNode)('div',yv,[(0,n.createElementVNode)('div',bv,[(0,n.withDirectives)((0,n.createElementVNode)('input',{'onUpdate:modelValue':t[0]||(t[0]=e=>i.value.id=e),class:'storage-id-input',placeholder:'貯存點ID'},null,512),[[n.vModelText,i.value.id]]),(0,n.withDirectives)((0,n.createElementVNode)('input',{'onUpdate:modelValue':t[1]||(t[1]=e=>i.value.name=e),class:'storage-name-input',placeholder:'貯存點名稱'},null,512),[[n.vModelText,i.value.name]])])]),(0,n.createCommentVNode)(' 第二行：金錢 + 添加按鈕 '),(0,n.createElementVNode)('div',Vv,[(0,n.createElementVNode)('div',Nv,[t[11]||(t[11]=(0,n.createElementVNode)('span',{class:'storage-money-label'},'貯存金額：',-1)),(0,n.withDirectives)((0,n.createElementVNode)('input',{'onUpdate:modelValue':t[2]||(t[2]=e=>i.value.money=e),type:'number',class:'storage-money-input storage-money-input-edit',placeholder:'金錢數量',min:'0',onInput:t[3]||(t[3]=e=>i.value.money=Math.max(0,parseInt(e.target.value)||0))},null,544),[[n.vModelText,i.value.money,void 0,{number:!0}]])]),(0,n.createElementVNode)('div',fv,[(0,n.createElementVNode)('button',{class:'confirm-button',disabled:!i.value.id||!i.value.name||!i.value.parent_id,onClick:N},' 添加 ',8,kv),(0,n.createElementVNode)('button',{class:'cancel-button',onClick:f},'取消')])]),(0,n.createCommentVNode)(' 第三行：父級 '),(0,n.createElementVNode)('div',wv,[(0,n.withDirectives)((0,n.createElementVNode)('select',{'onUpdate:modelValue':t[4]||(t[4]=e=>i.value.parent_id=e),class:'parent-select'},[t[12]||(t[12]=(0,n.createElementVNode)('option',{value:'',disabled:''},'選擇父級 (角色、地點或貯存點)...',-1)),(0,n.createElementVNode)('optgroup',Bv,[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(h.value,([e,t])=>((0,n.openBlock)(),(0,n.createElementBlock)('option',{key:`char-${e}`,value:e},(0,n.toDisplayString)(t.name)+' ('+(0,n.toDisplayString)(e)+') ',9,Cv))),128))]),(0,n.createElementVNode)('optgroup',$v,[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(E.value,([e,t])=>((0,n.openBlock)(),(0,n.createElementBlock)('option',{key:`loc-${e}`,value:e},(0,n.toDisplayString)(t.name)+' ('+(0,n.toDisplayString)(e)+') ',9,Sv))),128))]),(0,n.createElementVNode)('optgroup',xv,[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(g.value,([e,t])=>((0,n.openBlock)(),(0,n.createElementBlock)('option',{key:`storage-${e}`,value:e},(0,n.toDisplayString)(t.name)+' ('+(0,n.toDisplayString)(e)+') ',9,Iv))),128))])],512),[[n.vModelSelect,i.value.parent_id]])]),(0,n.createCommentVNode)(' 第四行：庫存 '),(0,n.createElementVNode)('div',Dv,[(0,n.createElementVNode)('div',Tv,[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(Object.keys(i.value.inventory),e=>((0,n.openBlock)(),(0,n.createElementBlock)('div',{key:e,class:'selected-inventory-item'},[(0,n.createElementVNode)('span',Mv,(0,n.toDisplayString)(y.value.get(e)?.name||g.value.get(e)?.name||e),1),u(e)?((0,n.openBlock)(),(0,n.createElementBlock)('span',Ov,'貯存點')):(0,n.createCommentVNode)('v-if',!0),u(e)?(0,n.createCommentVNode)('v-if',!0):((0,n.openBlock)(),(0,n.createElementBlock)('span',Yv,'×')),u(e)?(0,n.createCommentVNode)('v-if',!0):(0,n.withDirectives)(((0,n.openBlock)(),(0,n.createElementBlock)('input',{key:2,'onUpdate:modelValue':t=>i.value.inventory[e]=t,type:'number',class:'item-quantity-input',placeholder:'數量',min:'1',step:'1',onInput:t=>i.value.inventory[e]=Math.max(1,parseInt(t.target.value)||1)},null,40,Av)),[[n.vModelText,i.value.inventory[e],void 0,{number:!0}]]),(0,n.createElementVNode)('button',{class:'remove-item-btn',onClick:t=>S(i.value,e)},'×',8,Rv)]))),128))]),(0,n.createElementVNode)('select',{class:'item-select',onChange:t[5]||(t[5]=e=>{C(i.value,e.target.value),e.target.value=''})},[t[13]||(t[13]=(0,n.createElementVNode)('option',{value:''},'選擇物品或貯存點...',-1)),(0,n.createElementVNode)('optgroup',Kv,[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(y.value,([e,t])=>((0,n.openBlock)(),(0,n.createElementBlock)('option',{key:e,value:e,disabled:i.value.inventory.hasOwnProperty(e)},(0,n.toDisplayString)(t.name)+' ('+(0,n.toDisplayString)(e)+') ',9,Uv))),128))]),(0,n.createElementVNode)('optgroup',zv,[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(g.value,([e,t])=>((0,n.openBlock)(),(0,n.createElementBlock)('option',{key:e,value:e,disabled:i.value.inventory.hasOwnProperty(e)},(0,n.toDisplayString)(t.name)+' ('+(0,n.toDisplayString)(e)+') ',9,Lv))),128))])],32)]),(0,n.createCommentVNode)(' 第五行：描述 '),(0,n.withDirectives)((0,n.createElementVNode)('textarea',{'onUpdate:modelValue':t[6]||(t[6]=e=>i.value.description=e),class:'storage-description-input',placeholder:'貯存點描述'},null,512),[[n.vModelText,i.value.description]])])):(0,n.createCommentVNode)('v-if',!0),0!==g.value.size||r.value?(0,n.createCommentVNode)('v-if',!0):((0,n.openBlock)(),(0,n.createElementBlock)('div',Fv,'沒有任何貯存點')),r.value?(0,n.createCommentVNode)('v-if',!0):((0,n.openBlock)(),(0,n.createElementBlock)('button',{key:2,class:'add-storage-button',onClick:b},'+ 添加貯存點'))]),(0,n.createCommentVNode)(' 確認窗口 '),(0,n.createVNode)(Zi,{'confirm-dialog':c.value,'onUpdate:confirmDialog':t[7]||(t[7]=e=>c.value=e),onConfirmDialogConfirm:w,onConfirmDialogCancel:B},null,8,['confirm-dialog'])])]))}}),jv=(0,d.A)(Hv,[['__scopeId','data-v-62b84623']]),Pv=jv,qv={class:'promise-tab-container'},Gv={class:'promise-content'},Wv={class:'promise-list'},Xv={class:'promise-first-row'},Zv={class:'promise-id-name-group'},Jv={key:0,class:'promise-id'},Qv=['onUpdate:modelValue'],ep={key:2,class:'promise-deadline'},tp={key:3,class:'promise-deadline-input-group'},ap=['onUpdate:modelValue','onInput'],np=['onUpdate:modelValue','onInput'],lp=['onUpdate:modelValue','onInput'],rp=['onUpdate:modelValue','onInput'],op=['onUpdate:modelValue','onInput'],ip={class:'promise-actions'},sp=['onClick'],cp=['onClick'],dp={class:'promise-location-row'},up={class:'promise-location-group'},mp={key:0,class:'promise-location'},vp=['onUpdate:modelValue'],pp=['value'],gp={key:0,class:'promise-edit-actions'},_p=['onClick'],hp=['onClick'],Ep={key:0,class:'promise-character-ids-display'},yp={key:1,class:'promise-character-ids-input-group'},bp={class:'selected-characters'},Vp=['onClick'],Np=['onChange'],fp=['value','disabled'],kp={key:2,class:'promise-description'},wp=['onUpdate:modelValue'],Bp={key:0,class:'promise-row new-promise-row'},Cp={class:'promise-first-row'},$p={class:'promise-id-name-group'},Sp={class:'promise-deadline-input-group'},xp={class:'promise-location-row'},Ip={class:'promise-location-group'},Dp=['value'],Tp={class:'promise-character-ids-input-group'},Mp={class:'selected-characters'},Op=['onClick'],Yp=['value','disabled'],Ap={key:1,class:'no-promises-message'},Rp=(0,n.defineComponent)({__name:'promise_tab',setup(e){(0,n.useCssVars)(e=>({v592213a0:l.value}));const t=(0,n.ref)(0),a=(0,n.ref)(null),l=(0,n.computed)(()=>`calc(100vh - ${t.value}px)`);(0,n.onMounted)(()=>{(async()=>{await(0,n.nextTick)();const e=document.querySelector('.tab-navigation');e&&window.ResizeObserver?(a.value=new ResizeObserver(e=>{for(const a of e)t.value=a.contentRect.height}),a.value.observe(e)):t.value=74})()}),(0,n.onUnmounted)(()=>{a.value&&(a.value.disconnect(),a.value=null)});const r=e=>{const t=e.toDate();return{year:t.getFullYear().toString(),month:(t.getMonth()+1).toString(),day:t.getDate().toString(),hour:t.getHours().toString(),minute:t.getMinutes().toString()}},o=(0,n.ref)(!1),i=(0,n.ref)(new Set),s=(0,n.ref)({id:'',deadline:{year:'',month:'',day:'',hour:'',minute:''},location_id:'',character_ids:[],description:''}),c=(0,n.ref)({}),d=(0,n.ref)({visible:!1,title:'',message:'',confirmText:'確認',cancelText:'取消'}),u=(0,n.ref)(null),m=(0,n.ref)(null),v=()=>{m.value&&(m.value.saveAsVariable(getLastMessageId()),p())},p=()=>{try{const e=getLastMessageId();m.value=Rl.loadFromVariable(e)}catch(e){console.error('Failed to load state:',e),m.value=null}};p();const g=(0,n.computed)(()=>m.value?.promises||new Map),h=(0,n.computed)(()=>{if(!m.value)return[];const e=new Map;for(const[t,a]of m.value.active_characters)e.set(t,a.name);for(const[t,a]of m.value.deactive_characters)e.set(t,a.name);return Array.from(e.entries()).map(([e,t])=>({id:e,name:t}))}),E=(0,n.computed)(()=>m.value?Array.from(m.value.locations.values()):[]),y=()=>{o.value=!0,s.value={id:'',deadline:{year:'',month:'',day:'',hour:'',minute:''},location_id:'',character_ids:[],description:''},s.value.id=(()=>{const e=Array.from(g.value.keys());let t=1;for(;e.includes(`p${t}`);)t++;return`p${t}`})()},b=e=>{if(!e.id||!e.deadline||!e.description)return null;try{const t=(e=>{const t=parseInt(e.year)||(new Date).getFullYear(),a=parseInt(e.month)||1,n=parseInt(e.day)||1,l=parseInt(e.hour)||0,r=parseInt(e.minute)||0;return new Il(new Date(t,a-1,n,l,r,0))})(e.deadline),a=e.character_ids.filter(e=>e),n=e.location_id||null;return new Ol(t,a,n,e.description)}catch(e){return console.error('Failed to create promise:',e),null}},V=()=>{if(!m.value)return;if(m.value.promises.has(s.value.id))return void N();const e=b(s.value);e?(m.value.promises.set(s.value.id,e),v(),N()):N()},N=()=>{o.value=!1,s.value={id:'',deadline:{year:'',month:'',day:'',hour:'',minute:''},location_id:'',character_ids:[],description:''}},f=e=>{i.value.delete(e),delete c.value[e]},k=()=>{u.value&&m.value&&(m.value.promises.delete(u.value),v()),d.value.visible=!1,u.value=null},w=()=>{d.value.visible=!1,u.value=null},B=(e,t)=>{e.character_ids.includes(t)||e.character_ids.push(t)},C=(e,t)=>{const a=e.character_ids.indexOf(t);a>-1&&e.character_ids.splice(a,1)},S=(e,t,a)=>{const n=parseInt(e);return isNaN(n)?'':Math.min(Math.max(n,t),a).toString()},x=e=>{const t=e.toDate();return`${t.getFullYear()}年${t.getMonth()+1}月${t.getDate()}日 ${t.getHours().toString().padStart(2,'0')}:${t.getMinutes().toString().padStart(2,'0')}`};return(e,t)=>((0,n.openBlock)(),(0,n.createElementBlock)('div',qv,[(0,n.createElementVNode)('div',Gv,[(0,n.createCommentVNode)(' 約定列表標題 '),t[31]||(t[31]=(0,n.createElementVNode)('div',{class:'promise-section'},[(0,n.createElementVNode)('h3',{class:'section-title'},'約定列表')],-1)),(0,n.createCommentVNode)(' 約定列表 '),(0,n.createElementVNode)('div',Wv,[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(g.value,([e,a])=>((0,n.openBlock)(),(0,n.createElementBlock)('div',{key:e,class:'promise-row'},[(0,n.createCommentVNode)(' 第一行：ID、截止日期、操作按鈕 '),(0,n.createElementVNode)('div',Xv,[(0,n.createElementVNode)('div',Zv,[i.value.has(e)?(0,n.withDirectives)(((0,n.openBlock)(),(0,n.createElementBlock)('input',{key:1,'onUpdate:modelValue':t=>c.value[e].id=t,class:'promise-id-input',placeholder:'約定ID'},null,8,Qv)),[[n.vModelText,c.value[e].id]]):((0,n.openBlock)(),(0,n.createElementBlock)('div',Jv,(0,n.toDisplayString)(e),1)),i.value.has(e)?((0,n.openBlock)(),(0,n.createElementBlock)('div',tp,[(0,n.withDirectives)((0,n.createElementVNode)('input',{'onUpdate:modelValue':t=>c.value[e].deadline.year=t,type:'number',placeholder:'年',class:'promise-deadline-input promise-deadline-year-input',onInput:t=>c.value[e].deadline.year=S(c.value[e].deadline.year.toString(),0,Number.MAX_SAFE_INTEGER)},null,40,ap),[[n.vModelText,c.value[e].deadline.year,void 0,{number:!0}]]),t[15]||(t[15]=(0,n.createElementVNode)('span',null,'年',-1)),(0,n.withDirectives)((0,n.createElementVNode)('input',{'onUpdate:modelValue':t=>c.value[e].deadline.month=t,type:'number',placeholder:'月',class:'promise-deadline-input',onInput:t=>c.value[e].deadline.month=S(c.value[e].deadline.month.toString(),1,12)},null,40,np),[[n.vModelText,c.value[e].deadline.month,void 0,{number:!0}]]),t[16]||(t[16]=(0,n.createElementVNode)('span',null,'月',-1)),(0,n.withDirectives)((0,n.createElementVNode)('input',{'onUpdate:modelValue':t=>c.value[e].deadline.day=t,type:'number',placeholder:'日',class:'promise-deadline-input',onInput:t=>c.value[e].deadline.day=S(c.value[e].deadline.day.toString(),1,31)},null,40,lp),[[n.vModelText,c.value[e].deadline.day,void 0,{number:!0}]]),t[17]||(t[17]=(0,n.createElementVNode)('span',null,'日',-1)),(0,n.withDirectives)((0,n.createElementVNode)('input',{'onUpdate:modelValue':t=>c.value[e].deadline.hour=t,type:'number',placeholder:'時',class:'promise-deadline-input',onInput:t=>c.value[e].deadline.hour=S(c.value[e].deadline.hour.toString(),0,23)},null,40,rp),[[n.vModelText,c.value[e].deadline.hour,void 0,{number:!0}]]),t[18]||(t[18]=(0,n.createElementVNode)('span',null,':',-1)),(0,n.withDirectives)((0,n.createElementVNode)('input',{'onUpdate:modelValue':t=>c.value[e].deadline.minute=t,type:'number',placeholder:'分',class:'promise-deadline-input',onInput:t=>c.value[e].deadline.minute=S(c.value[e].deadline.minute.toString(),0,59)},null,40,op),[[n.vModelText,c.value[e].deadline.minute,void 0,{number:!0}]])])):((0,n.openBlock)(),(0,n.createElementBlock)('div',ep,(0,n.toDisplayString)(x(a.deadline)),1))]),(0,n.createElementVNode)('div',ip,[i.value.has(e)?(0,n.createCommentVNode)('v-if',!0):((0,n.openBlock)(),(0,n.createElementBlock)('button',{key:0,class:'edit-promise-button',onClick:t=>(e=>{const t=g.value.get(e);t&&(i.value.add(e),c.value[e]={id:e,deadline:r(t.deadline),location_id:t.location_id||'',character_ids:[...t.character_ids],description:t.description})})(e)},' 編輯 ',8,sp)),i.value.has(e)?(0,n.createCommentVNode)('v-if',!0):((0,n.openBlock)(),(0,n.createElementBlock)('button',{key:1,class:'delete-promise-button',onClick:t=>(e=>{const t=g.value.get(e);t&&(u.value=e,d.value={visible:!0,title:'確認刪除約定',message:`確定要刪除約定 "${t.description}" 嗎？此操作無法撤銷。`,confirmText:'刪除',cancelText:'取消'})})(e)},' 刪除 ',8,cp))])]),(0,n.createCommentVNode)(' 第二行：地點 + 編輯按鈕 '),(0,n.createElementVNode)('div',dp,[(0,n.createElementVNode)('div',up,[t[21]||(t[21]=(0,n.createElementVNode)('span',{class:'promise-location-label'},'地點：',-1)),i.value.has(e)?(0,n.withDirectives)(((0,n.openBlock)(),(0,n.createElementBlock)('select',{key:1,'onUpdate:modelValue':t=>c.value[e].location_id=t,class:'promise-location-input promise-location-input-edit'},[t[19]||(t[19]=(0,n.createElementVNode)('option',{value:'',disabled:''},'選擇地點...',-1)),t[20]||(t[20]=(0,n.createElementVNode)('option',{value:''},'無',-1)),((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(E.value,e=>((0,n.openBlock)(),(0,n.createElementBlock)('option',{key:e.id,value:e.id},(0,n.toDisplayString)(e.name)+' ('+(0,n.toDisplayString)(e.id)+') ',9,pp))),128))],8,vp)),[[n.vModelSelect,c.value[e].location_id]]):((0,n.openBlock)(),(0,n.createElementBlock)('div',mp,(0,n.toDisplayString)(a.location_id?E.value.find(e=>e.id===a.location_id)?.name||a.location_id:'無'),1))]),i.value.has(e)?((0,n.openBlock)(),(0,n.createElementBlock)('div',gp,[(0,n.createElementVNode)('button',{class:'confirm-button',onClick:t=>(e=>{if(!m.value||!c.value[e])return;const t=c.value[e];if(t.id!==e&&m.value.promises.has(t.id))return void f(e);const a=b(t);if(a){const n=m.value.promises.get(e);n&&(t.id!==e?(m.value.promises.delete(e),m.value.promises.set(t.id,a)):(n.deadline=a.deadline,n.location_id=a.location_id,n.character_ids=a.character_ids,n.description=a.description),v()),f(e)}else f(e)})(e)},'保存',8,_p),(0,n.createElementVNode)('button',{class:'cancel-button',onClick:t=>f(e)},'取消',8,hp)])):(0,n.createCommentVNode)('v-if',!0)]),(0,n.createCommentVNode)(' 第三行：角色ID '),i.value.has(e)?((0,n.openBlock)(),(0,n.createElementBlock)('div',yp,[(0,n.createElementVNode)('div',bp,[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(c.value[e].character_ids,t=>((0,n.openBlock)(),(0,n.createElementBlock)('span',{key:t,class:'selected-character-tag'},[(0,n.createTextVNode)((0,n.toDisplayString)(h.value.find(e=>e.id===t)?.name||t)+' ',1),(0,n.createElementVNode)('button',{class:'remove-character-btn',onClick:a=>C(c.value[e],t)},' × ',8,Vp)]))),128))]),(0,n.createElementVNode)('select',{class:'character-select',onChange:t=>{B(c.value[e],t.target.value),t.target.value=''}},[t[22]||(t[22]=(0,n.createElementVNode)('option',{value:''},'選擇角色...',-1)),((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(h.value,t=>((0,n.openBlock)(),(0,n.createElementBlock)('option',{key:t.id,value:t.id,disabled:c.value[e].character_ids.includes(t.id)},(0,n.toDisplayString)(t.name)+' ('+(0,n.toDisplayString)(t.id)+') ',9,fp))),128))],40,Np)])):((0,n.openBlock)(),(0,n.createElementBlock)('div',Ep,[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(a.character_ids,e=>((0,n.openBlock)(),(0,n.createElementBlock)('span',{key:e,class:'promise-character-id-tag'},(0,n.toDisplayString)(h.value.find(t=>t.id===e)?.name||e),1))),128))])),(0,n.createCommentVNode)(' 第四行：描述 '),i.value.has(e)?(0,n.withDirectives)(((0,n.openBlock)(),(0,n.createElementBlock)('textarea',{key:3,'onUpdate:modelValue':t=>c.value[e].description=t,class:'promise-description-input',placeholder:'約定內容'},null,8,wp)),[[n.vModelText,c.value[e].description]]):((0,n.openBlock)(),(0,n.createElementBlock)('div',kp,(0,n.toDisplayString)(a.description),1))]))),128)),(0,n.createCommentVNode)(' 新約定編輯行 '),o.value?((0,n.openBlock)(),(0,n.createElementBlock)('div',Bp,[(0,n.createCommentVNode)(' 第一行：ID、截止日期 '),(0,n.createElementVNode)('div',Cp,[(0,n.createElementVNode)('div',$p,[(0,n.withDirectives)((0,n.createElementVNode)('input',{'onUpdate:modelValue':t[0]||(t[0]=e=>s.value.id=e),class:'promise-id-input',placeholder:'約定ID'},null,512),[[n.vModelText,s.value.id]]),(0,n.createElementVNode)('div',Sp,[(0,n.withDirectives)((0,n.createElementVNode)('input',{'onUpdate:modelValue':t[1]||(t[1]=e=>s.value.deadline.year=e),type:'number',placeholder:'年',class:'promise-deadline-input promise-deadline-year-input',onInput:t[2]||(t[2]=e=>s.value.deadline.year=S(s.value.deadline.year.toString(),0,Number.MAX_SAFE_INTEGER))},null,544),[[n.vModelText,s.value.deadline.year,void 0,{number:!0}]]),t[23]||(t[23]=(0,n.createElementVNode)('span',null,'年',-1)),(0,n.withDirectives)((0,n.createElementVNode)('input',{'onUpdate:modelValue':t[3]||(t[3]=e=>s.value.deadline.month=e),type:'number',placeholder:'月',class:'promise-deadline-input',onInput:t[4]||(t[4]=e=>s.value.deadline.month=S(s.value.deadline.month.toString(),1,12))},null,544),[[n.vModelText,s.value.deadline.month,void 0,{number:!0}]]),t[24]||(t[24]=(0,n.createElementVNode)('span',null,'月',-1)),(0,n.withDirectives)((0,n.createElementVNode)('input',{'onUpdate:modelValue':t[5]||(t[5]=e=>s.value.deadline.day=e),type:'number',placeholder:'日',class:'promise-deadline-input',onInput:t[6]||(t[6]=e=>s.value.deadline.day=S(s.value.deadline.day.toString(),1,31))},null,544),[[n.vModelText,s.value.deadline.day,void 0,{number:!0}]]),t[25]||(t[25]=(0,n.createElementVNode)('span',null,'日',-1)),(0,n.withDirectives)((0,n.createElementVNode)('input',{'onUpdate:modelValue':t[7]||(t[7]=e=>s.value.deadline.hour=e),type:'number',placeholder:'時',class:'promise-deadline-input',onInput:t[8]||(t[8]=e=>s.value.deadline.hour=S(s.value.deadline.hour.toString(),0,23))},null,544),[[n.vModelText,s.value.deadline.hour,void 0,{number:!0}]]),t[26]||(t[26]=(0,n.createElementVNode)('span',null,':',-1)),(0,n.withDirectives)((0,n.createElementVNode)('input',{'onUpdate:modelValue':t[9]||(t[9]=e=>s.value.deadline.minute=e),type:'number',placeholder:'分',class:'promise-deadline-input',onInput:t[10]||(t[10]=e=>s.value.deadline.minute=S(s.value.deadline.minute.toString(),0,59))},null,544),[[n.vModelText,s.value.deadline.minute,void 0,{number:!0}]])])])]),(0,n.createCommentVNode)(' 第二行：地點 + 添加按鈕 '),(0,n.createElementVNode)('div',xp,[(0,n.createElementVNode)('div',Ip,[t[29]||(t[29]=(0,n.createElementVNode)('span',{class:'promise-location-label'},'地點：',-1)),(0,n.withDirectives)((0,n.createElementVNode)('select',{'onUpdate:modelValue':t[11]||(t[11]=e=>s.value.location_id=e),class:'promise-location-input promise-location-input-edit'},[t[27]||(t[27]=(0,n.createElementVNode)('option',{value:'',disabled:''},'選擇地點...',-1)),t[28]||(t[28]=(0,n.createElementVNode)('option',{value:''},'無',-1)),((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(E.value,e=>((0,n.openBlock)(),(0,n.createElementBlock)('option',{key:e.id,value:e.id},(0,n.toDisplayString)(e.name)+' ('+(0,n.toDisplayString)(e.id)+') ',9,Dp))),128))],512),[[n.vModelSelect,s.value.location_id]])]),(0,n.createElementVNode)('div',{class:'promise-edit-actions'},[(0,n.createElementVNode)('button',{class:'confirm-button',onClick:V},'添加'),(0,n.createElementVNode)('button',{class:'cancel-button',onClick:N},'取消')])]),(0,n.createCommentVNode)(' 第三行：角色ID '),(0,n.createElementVNode)('div',Tp,[(0,n.createElementVNode)('div',Mp,[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(s.value.character_ids,e=>((0,n.openBlock)(),(0,n.createElementBlock)('span',{key:e,class:'selected-character-tag'},[(0,n.createTextVNode)((0,n.toDisplayString)(h.value.find(t=>t.id===e)?.name||e)+' ',1),(0,n.createElementVNode)('button',{class:'remove-character-btn',onClick:t=>C(s.value,e)},'×',8,Op)]))),128))]),(0,n.createElementVNode)('select',{class:'character-select',onChange:t[12]||(t[12]=e=>{B(s.value,e.target.value),e.target.value=''})},[t[30]||(t[30]=(0,n.createElementVNode)('option',{value:''},'選擇角色...',-1)),((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(h.value,e=>((0,n.openBlock)(),(0,n.createElementBlock)('option',{key:e.id,value:e.id,disabled:s.value.character_ids.includes(e.id)},(0,n.toDisplayString)(e.name)+' ('+(0,n.toDisplayString)(e.id)+') ',9,Yp))),128))],32)]),(0,n.createCommentVNode)(' 第四行：描述 '),(0,n.withDirectives)((0,n.createElementVNode)('textarea',{'onUpdate:modelValue':t[13]||(t[13]=e=>s.value.description=e),class:'promise-description-input',placeholder:'約定內容'},null,512),[[n.vModelText,s.value.description]])])):(0,n.createCommentVNode)('v-if',!0),0!==g.value.size||o.value?(0,n.createCommentVNode)('v-if',!0):((0,n.openBlock)(),(0,n.createElementBlock)('div',Ap,'沒有任何約定')),o.value?(0,n.createCommentVNode)('v-if',!0):((0,n.openBlock)(),(0,n.createElementBlock)('button',{key:2,class:'add-promise-button',onClick:y},'+ 添加約定'))]),(0,n.createCommentVNode)(' 確認窗口 '),(0,n.createVNode)(Zi,{'confirm-dialog':d.value,'onUpdate:confirmDialog':t[14]||(t[14]=e=>d.value=e),onConfirmDialogConfirm:k,onConfirmDialogCancel:w},null,8,['confirm-dialog'])])]))}}),Kp=(0,d.A)(Rp,[['__scopeId','data-v-25ffb8d9']]),Up=Kp,zp={class:'settings-container'},Lp={class:'settings-list'},Fp={class:'setting-item'},Hp={class:'setting-control'},jp={class:'switch'},Pp={class:'setting-item'},qp={class:'setting-control'},Gp={class:'setting-item'},Wp={class:'setting-control'},Xp={class:'folding-rules-fullwidth'},Zp={class:'folding-rules-container'},Jp={class:'rule-cell'},Qp=['onUpdate:modelValue','onInput'],eg={class:'rule-cell'},tg=['onUpdate:modelValue','onInput'],ag={class:'rule-cell'},ng=['onUpdate:modelValue','onChange'],lg={class:'rule-cell'},rg={class:'radio-group compact'},og={class:'radio-option compact'},ig=['onUpdate:modelValue','onChange'],sg={class:'radio-option compact'},cg=['onUpdate:modelValue','onChange'],dg={class:'rule-cell'},ug={class:'radio-group compact'},mg={class:'radio-option compact'},vg=['onUpdate:modelValue','onChange'],pg={class:'radio-option compact'},gg=['onUpdate:modelValue','onChange'],_g={class:'rule-cell'},hg=['onClick'],Eg=(0,n.defineComponent)({__name:'setting_tab',emits:['renderSizeChanged'],setup(e,{expose:t,emit:a}){(0,n.useCssVars)(e=>({b120e3bc:u.value}));const l=a,r=(0,n.ref)(!1),o=(0,n.ref)(10),i=(0,n.ref)(1),s=(0,n.ref)([]),c=(0,n.ref)(0),d=(0,n.ref)(null),u=(0,n.computed)(()=>`calc(100vh - ${c.value}px)`),m=()=>{try{const e=getVariables({type:'chat'});e&&e.settings?(r.value=e.settings.fullscreen_enabled||!1,o.value=e.settings.render_size||10,i.value=e.settings.exclude_latest_summaries||1,s.value=e.settings.tag_rules||[]):v()}catch(e){console.error('Failed to load settings:',e)}},v=()=>{try{const e={fullscreen_enabled:r.value,render_size:o.value,exclude_latest_summaries:i.value,tag_rules:s.value};insertOrAssignVariables({settings:e},{type:'chat'})}catch(e){console.error('Failed to save settings:',e)}},p=async()=>{r.value?await(async()=>{try{document.documentElement.requestFullscreen?await document.documentElement.requestFullscreen():document.documentElement.webkitRequestFullscreen?await document.documentElement.webkitRequestFullscreen():document.documentElement.mozRequestFullScreen?await document.documentElement.mozRequestFullScreen():document.documentElement.msRequestFullscreen&&await document.documentElement.msRequestFullscreen()}catch(e){console.error('Failed to enter fullscreen:',e)}})():await(async()=>{try{document.exitFullscreen?await document.exitFullscreen():document.webkitExitFullscreen?await document.webkitExitFullscreen():document.mozCancelFullScreen?await document.mozCancelFullScreen():document.msExitFullscreen&&await document.msExitFullscreen()}catch(e){console.error('Failed to exit fullscreen:',e)}})(),v()},g=()=>{let e=Math.floor(Number(o.value));(isNaN(e)||e<1)&&(e=10),o.value=e,v(),l('renderSizeChanged',o.value)},h=()=>{let e=Math.floor(Number(i.value));(isNaN(e)||e<0)&&(e=1),i.value=e,v()},E=()=>{s.value.push({tag_name:'',match_mode:'both',match_strategy:'first',display_mode:'invisible',title_name:''}),v()},y=(e,t)=>{e>=0&&e<s.value.length&&(s.value[e]={...s.value[e],...t},v())},b=()=>{const e=!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement);r.value=e,v()};return m(),document.addEventListener('fullscreenchange',b),document.addEventListener('webkitfullscreenchange',b),document.addEventListener('mozfullscreenchange',b),document.addEventListener('MSFullscreenChange',b),(0,n.onMounted)(()=>{(0,n.nextTick)(()=>{(()=>{if('undefined'==typeof ResizeObserver)return void(c.value=74);d.value=new ResizeObserver(e=>{for(const t of e){const e=t.target;e.classList.contains('tab-navigation')&&(c.value=e.offsetHeight)}});const e=document.querySelector('.tab-navigation.top');e&&(d.value.observe(e),c.value=e.offsetHeight)})()})}),(0,n.onUnmounted)(()=>{d.value&&(d.value.disconnect(),d.value=null)}),eventOn(tavern_events.APP_READY,()=>{b()}),(0,n.onUnmounted)(()=>{document.removeEventListener('fullscreenchange',b),document.removeEventListener('webkitfullscreenchange',b),document.removeEventListener('mozfullscreenchange',b),document.removeEventListener('MSFullscreenChange',b)}),t({reloadSettings:m}),(e,t)=>((0,n.openBlock)(),(0,n.createElementBlock)('div',zp,[t[14]||(t[14]=(0,n.createElementVNode)('div',{class:'settings-header'},[(0,n.createElementVNode)('h2',null,'設置')],-1)),(0,n.createElementVNode)('div',Lp,[(0,n.createCommentVNode)(' 全屏開關 '),(0,n.createElementVNode)('div',Fp,[t[4]||(t[4]=(0,n.createElementVNode)('div',{class:'setting-label'},[(0,n.createElementVNode)('span',{class:'setting-title'},'全屏模式'),(0,n.createElementVNode)('span',{class:'setting-description'},'啟用全屏顯示模式')],-1)),(0,n.createElementVNode)('div',Hp,[(0,n.createElementVNode)('label',jp,[(0,n.withDirectives)((0,n.createElementVNode)('input',{'onUpdate:modelValue':t[0]||(t[0]=e=>r.value=e),type:'checkbox',onChange:p},null,544),[[n.vModelCheckbox,r.value]]),t[3]||(t[3]=(0,n.createElementVNode)('span',{class:'slider'},null,-1))])])]),(0,n.createCommentVNode)(' 渲染大小 '),(0,n.createElementVNode)('div',Pp,[t[5]||(t[5]=(0,n.createElementVNode)('div',{class:'setting-label'},[(0,n.createElementVNode)('span',{class:'setting-title'},'載入樓層數目'),(0,n.createElementVNode)('span',{class:'setting-description'},'設置每次載入樓層的數目')],-1)),(0,n.createElementVNode)('div',qp,[(0,n.withDirectives)((0,n.createElementVNode)('input',{'onUpdate:modelValue':t[1]||(t[1]=e=>o.value=e),type:'number',class:'number-input',min:'1',onInput:g},null,544),[[n.vModelText,o.value,void 0,{number:!0}]])])]),(0,n.createCommentVNode)(' 排除最新總結數量 '),(0,n.createElementVNode)('div',Gp,[t[6]||(t[6]=(0,n.createElementVNode)('div',{class:'setting-label'},[(0,n.createElementVNode)('span',{class:'setting-title'},'排除最新總結數量'),(0,n.createElementVNode)('span',{class:'setting-description'},'設置不使用最新n個總結的數量')],-1)),(0,n.createElementVNode)('div',Wp,[(0,n.withDirectives)((0,n.createElementVNode)('input',{'onUpdate:modelValue':t[2]||(t[2]=e=>i.value=e),type:'number',class:'number-input',min:'0',onInput:h},null,544),[[n.vModelText,i.value,void 0,{number:!0}]])])]),(0,n.createCommentVNode)(' XML內容摺疊規則 '),t[13]||(t[13]=(0,n.createElementVNode)('div',{class:'setting-item xml-rules-item'},[(0,n.createElementVNode)('div',{class:'setting-label'},[(0,n.createElementVNode)('span',{class:'setting-title'},'XML內容摺疊規則'),(0,n.createElementVNode)('span',{class:'setting-description'},'設置XML標籤內容的顯示方式')])],-1)),(0,n.createCommentVNode)(' XML內容摺疊規則表格 '),(0,n.createElementVNode)('div',Xp,[(0,n.createElementVNode)('div',Zp,[(0,n.createCommentVNode)(' 表頭 '),t[12]||(t[12]=(0,n.createStaticVNode)('<div class="rules-header" data-v-40a4165e><div class="header-cell" data-v-40a4165e>標籤名稱</div><div class="header-cell" data-v-40a4165e>標題名稱</div><div class="header-cell" data-v-40a4165e>顯示模式</div><div class="header-cell" data-v-40a4165e>匹配模式</div><div class="header-cell" data-v-40a4165e>匹配結束標籤策略</div><div class="header-cell" data-v-40a4165e>操作</div></div>',1)),(0,n.createCommentVNode)(' 規則行 '),((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(s.value,(e,a)=>((0,n.openBlock)(),(0,n.createElementBlock)('div',{key:a,class:'folding-rule-row'},[(0,n.createCommentVNode)(' 標籤名稱 '),(0,n.createElementVNode)('div',Jp,[(0,n.withDirectives)((0,n.createElementVNode)('input',{'onUpdate:modelValue':t=>e.tag_name=t,type:'text',class:'text-input compact',placeholder:'例如: think',onInput:t=>y(a,{tag_name:e.tag_name})},null,40,Qp),[[n.vModelText,e.tag_name]])]),(0,n.createCommentVNode)(' 標題名稱 '),(0,n.createElementVNode)('div',eg,[(0,n.withDirectives)((0,n.createElementVNode)('input',{'onUpdate:modelValue':t=>e.title_name=t,type:'text',class:'text-input compact',placeholder:'例如: 思考內容',onInput:t=>y(a,{title_name:e.title_name})},null,40,tg),[[n.vModelText,e.title_name]])]),(0,n.createCommentVNode)(' 顯示模式 '),(0,n.createElementVNode)('div',ag,[(0,n.withDirectives)((0,n.createElementVNode)('select',{'onUpdate:modelValue':t=>e.display_mode=t,class:'select-input compact',onChange:t=>y(a,{display_mode:e.display_mode})},[...t[7]||(t[7]=[(0,n.createElementVNode)('option',{value:'invisible'},'隱藏',-1),(0,n.createElementVNode)('option',{value:'fold_bar'},'摺疊欄',-1)])],40,ng),[[n.vModelSelect,e.display_mode]])]),(0,n.createCommentVNode)(' 匹配模式 '),(0,n.createElementVNode)('div',lg,[(0,n.createElementVNode)('div',rg,[(0,n.createElementVNode)('label',og,[(0,n.withDirectives)((0,n.createElementVNode)('input',{'onUpdate:modelValue':t=>e.match_mode=t,type:'radio',value:'both',onChange:t=>y(a,{match_mode:e.match_mode})},null,40,ig),[[n.vModelRadio,e.match_mode]]),t[8]||(t[8]=(0,n.createElementVNode)('span',{class:'radio-label'},'開始及結束',-1))]),(0,n.createElementVNode)('label',sg,[(0,n.withDirectives)((0,n.createElementVNode)('input',{'onUpdate:modelValue':t=>e.match_mode=t,type:'radio',value:'end_only',onChange:t=>y(a,{match_mode:e.match_mode})},null,40,cg),[[n.vModelRadio,e.match_mode]]),t[9]||(t[9]=(0,n.createElementVNode)('span',{class:'radio-label'},'只結束',-1))])])]),(0,n.createCommentVNode)(' 匹配結束標籤策略 '),(0,n.createElementVNode)('div',dg,[(0,n.createElementVNode)('div',ug,[(0,n.createElementVNode)('label',mg,[(0,n.withDirectives)((0,n.createElementVNode)('input',{'onUpdate:modelValue':t=>e.match_strategy=t,type:'radio',value:'first',onChange:t=>y(a,{match_strategy:e.match_strategy})},null,40,vg),[[n.vModelRadio,e.match_strategy]]),t[10]||(t[10]=(0,n.createElementVNode)('span',{class:'radio-label'},'第一個',-1))]),(0,n.createElementVNode)('label',pg,[(0,n.withDirectives)((0,n.createElementVNode)('input',{'onUpdate:modelValue':t=>e.match_strategy=t,type:'radio',value:'last',onChange:t=>y(a,{match_strategy:e.match_strategy})},null,40,gg),[[n.vModelRadio,e.match_strategy]]),t[11]||(t[11]=(0,n.createElementVNode)('span',{class:'radio-label'},'最後一個',-1))])])]),(0,n.createCommentVNode)(' 刪除按鈕 '),(0,n.createElementVNode)('div',_g,[(0,n.createElementVNode)('button',{class:'delete-rule-btn compact',onClick:e=>{var t;(t=a)>=0&&t<s.value.length&&(s.value.splice(t,1),v())}},'刪除',8,hg)])]))),128)),(0,n.createCommentVNode)(' 添加規則按鈕 '),(0,n.createElementVNode)('div',{class:'add-rule-row'},[(0,n.createElementVNode)('button',{class:'add-rule-btn',onClick:E},'+ 添加摺疊規則')])])])])]))}}),yg=(0,d.A)(Eg,[['__scopeId','data-v-40a4165e']]),bg={class:'summary-tab-container'},Vg={class:'summary-content'},Ng={key:0,class:'summary-row new-summary-row'},fg={class:'summary-edit-mode'},kg={class:'summary-edit-first-row'},wg={class:'summary-weighting-last-message-input-group'},Bg={class:'summary-last-message-id-input-group'},Cg=['value'],$g={class:'summary-weighting-input-group'},Sg=['value'],xg={class:'summary-edit-actions'},Ig=['disabled'],Dg={class:'summary-edit-datetime-row'},Tg={class:'summary-datetime-input-group'},Mg=['value'],Og=['value'],Yg=['value'],Ag=['value'],Rg=['value'],Kg=['value'],Ug={class:'summary-list'},zg={key:0,class:'summary-edit-mode'},Lg={class:'summary-edit-first-row'},Fg={class:'summary-weighting-last-message-input-group'},Hg={class:'summary-last-message-id-input-group'},jg=['value'],Pg={class:'summary-weighting-input-group'},qg=['value'],Gg={class:'summary-edit-actions'},Wg=['disabled'],Xg={class:'summary-edit-datetime-row'},Zg={class:'summary-datetime-input-group'},Jg=['value'],Qg=['value'],e_=['value'],t_=['value'],a_=['value'],n_=['value'],l_={class:'summary-first-row'},r_={class:'summary-weighting-last-message-group'},o_={class:'summary-last-message-id'},i_={class:'summary-weighting'},s_={class:'summary-actions'},c_=['onClick'],d_=['onClick'],u_={class:'summary-datetime-row'},m_={class:'summary-datetime'},v_={class:'summary-content-display'},p_={key:0,class:'no-summaries-message'},g_=(0,n.defineComponent)({__name:'summary_tab',setup(e){(0,n.useCssVars)(e=>({v70237b32:l.value}));const t=(0,n.ref)(0),a=(0,n.ref)(null),l=(0,n.computed)(()=>`calc(100vh - ${t.value}px)`);(0,n.onMounted)(()=>{(async()=>{await(0,n.nextTick)();const e=document.querySelector('.tab-navigation');e&&window.ResizeObserver?(a.value=new ResizeObserver(e=>{for(const a of e)t.value=a.contentRect.height}),a.value.observe(e)):t.value=74})()}),(0,n.onUnmounted)(()=>{a.value&&(a.value.disconnect(),a.value=null)});const r=(0,n.ref)({visible:!1,title:'',message:'',confirmText:'確認',cancelText:'取消'}),o=(0,n.ref)(null),i=(0,n.ref)(null),s=(0,n.ref)(!1),c=(0,n.ref)({year:0,month:0,day:0,hour:0,minute:0}),d=(0,n.ref)(0),u=(0,n.ref)(0),m=(0,n.ref)(''),v=(0,n.ref)(null),p=()=>{v.value&&(v.value.saveAsVariable(getLastMessageId()),g())},g=()=>{try{const e=getLastMessageId();v.value=Rl.loadFromVariable(e)}catch(e){console.error('Failed to load state:',e),v.value=null}};g();const h=(0,n.computed)(()=>v.value?.summaries?[...v.value.summaries].sort((e,t)=>t.last_message_id-e.last_message_id):[]),E=e=>{if(!v.value)return'unused';const t=(getVariables({type:'chat'}).settings||{}).exclude_latest_summaries||1,a=[...v.value.summaries].sort((e,t)=>e.last_message_id-t.last_message_id);return a.findIndex(t=>t.last_message_id===e.last_message_id)>=a.length-t?'unused':'used'},y=()=>{if(null!==o.value&&v.value){const e=h.value[o.value],t=v.value.summaries.indexOf(e);-1!==t&&(v.value.summaries.splice(t,1),p())}r.value.visible=!1,o.value=null},b=()=>{r.value.visible=!1,o.value=null},V=()=>{if(s.value=!0,v.value){const e=v.value.datetime.toDate();c.value={year:e.getFullYear(),month:e.getMonth()+1,day:e.getDate(),hour:e.getHours(),minute:e.getMinutes()}}u.value=(()=>{const e=getChatMessages(-1,{role:'assistant'});return e.length>0?e[0].message_id:getLastMessageId()})(),d.value=.5,m.value=''},N=()=>{if(v.value)try{const e=new Date(c.value.year,c.value.month-1,c.value.day,c.value.hour,c.value.minute,0),t=new Il(e),a=new Al(t,m.value.trim(),d.value,u.value);if(null!==i.value){const e=h.value[i.value],t=v.value.summaries.indexOf(e);-1!==t&&(v.value.summaries[t]=a,p(),i.value=null)}else s.value&&(v.value.summaries.push(a),v.value.summaries.sort((e,t)=>e.last_message_id-t.last_message_id),p(),s.value=!1)}catch(e){console.error('Failed to save summary:',e)}},f=()=>{i.value=null,s.value=!1},k=(0,n.computed)(()=>{if(u.value<0||!Number.isInteger(u.value))return!1;if(d.value<0||d.value>1)return!1;if(c.value.year<0||!Number.isInteger(c.value.year))return!1;if(!m.value.trim())return!1;try{const e=new Date(c.value.year,c.value.month-1,c.value.day,c.value.hour,c.value.minute,0);if(e.getFullYear()!==c.value.year||e.getMonth()!==c.value.month-1||e.getDate()!==c.value.day)return!1}catch{return!1}return!0}),w=(e,t,a,n=!1)=>{const l=n?parseFloat(e):parseInt(e);return isNaN(l)?'':Math.min(Math.max(l,t),a).toString()},B=e=>{const t=e.target,a=parseInt(w(t.value,0,Number.MAX_SAFE_INTEGER));u.value=a},C=e=>{const t=e.target,a=parseFloat(w(t.value,0,1,!0));d.value=a},S=(e,t)=>{const a=t.target;let n;switch(e){case'year':n=parseInt(w(a.value,0,Number.MAX_SAFE_INTEGER));break;case'month':n=parseInt(w(a.value,1,12));break;case'day':n=parseInt(w(a.value,1,31));break;case'hour':n=parseInt(w(a.value,0,23));break;case'minute':n=parseInt(w(a.value,0,59));break;default:return}c.value={...c.value,[e]:n}},x=e=>{const t=e.toDate();return`${t.getFullYear()}年${t.getMonth()+1}月${t.getDate()}日 ${t.getHours().toString().padStart(2,'0')}:${t.getMinutes().toString().padStart(2,'0')}`};return(e,t)=>((0,n.openBlock)(),(0,n.createElementBlock)('div',bg,[(0,n.createElementVNode)('div',Vg,[(0,n.createCommentVNode)(' 總結列表標題 '),(0,n.createElementVNode)('div',{class:'summary-section'},[t[17]||(t[17]=(0,n.createElementVNode)('h3',{class:'section-title'},'總結列表',-1)),(0,n.createElementVNode)('button',{class:'add-summary-button',onClick:V},'+ 添加總結')]),(0,n.createCommentVNode)(' 添加新總結編輯區域 '),s.value?((0,n.openBlock)(),(0,n.createElementBlock)('div',Ng,[(0,n.createElementVNode)('div',fg,[(0,n.createCommentVNode)(' 第一行：最後樓層、權重、操作按鈕 '),(0,n.createElementVNode)('div',kg,[(0,n.createElementVNode)('div',wg,[(0,n.createElementVNode)('div',Bg,[t[18]||(t[18]=(0,n.createTextVNode)(' 最後樓層: ',-1)),(0,n.createElementVNode)('input',{value:u.value,type:'number',class:'summary-last-message-id-input',min:'0',step:'1',onInput:t[0]||(t[0]=e=>B(e))},null,40,Cg)]),(0,n.createElementVNode)('div',$g,[t[19]||(t[19]=(0,n.createTextVNode)(' 權重: ',-1)),(0,n.createElementVNode)('input',{value:d.value,type:'number',class:'summary-weighting-input',step:'0.1',min:'0',max:'1',onInput:t[1]||(t[1]=e=>C(e))},null,40,Sg)])]),(0,n.createElementVNode)('div',xg,[(0,n.createElementVNode)('button',{class:'confirm-button',disabled:!k.value,onClick:N},'保存',8,Ig),(0,n.createElementVNode)('button',{class:'cancel-button',onClick:f},'取消')])]),(0,n.createCommentVNode)(' 第二行：時間輸入 '),(0,n.createElementVNode)('div',Dg,[(0,n.createElementVNode)('div',Tg,[(0,n.createElementVNode)('input',{value:c.value.year,type:'number',class:'summary-datetime-input summary-datetime-year-input',placeholder:'年',onInput:t[2]||(t[2]=e=>S('year',e))},null,40,Mg),t[20]||(t[20]=(0,n.createTextVNode)('年 ',-1)),(0,n.createElementVNode)('input',{value:c.value.month,type:'number',class:'summary-datetime-input',placeholder:'月',min:'1',max:'12',onInput:t[3]||(t[3]=e=>S('month',e))},null,40,Og),t[21]||(t[21]=(0,n.createTextVNode)('月 ',-1)),(0,n.createElementVNode)('input',{value:c.value.day,type:'number',class:'summary-datetime-input',placeholder:'日',min:'1',max:'31',onInput:t[4]||(t[4]=e=>S('day',e))},null,40,Yg),t[22]||(t[22]=(0,n.createTextVNode)('日 ',-1)),(0,n.createElementVNode)('input',{value:c.value.hour,type:'number',class:'summary-datetime-input',placeholder:'時',min:'0',max:'23',onInput:t[5]||(t[5]=e=>S('hour',e))},null,40,Ag),t[23]||(t[23]=(0,n.createTextVNode)(': ',-1)),(0,n.createElementVNode)('input',{value:c.value.minute,type:'number',class:'summary-datetime-input',placeholder:'分',min:'0',max:'59',onInput:t[6]||(t[6]=e=>S('minute',e))},null,40,Rg)])]),(0,n.createCommentVNode)(' 第三行：總結內容輸入 '),(0,n.createElementVNode)('textarea',{value:m.value,class:'summary-content-input',placeholder:'輸入總結內容...',onInput:t[7]||(t[7]=e=>m.value=e.target.value)},null,40,Kg)])])):(0,n.createCommentVNode)('v-if',!0),(0,n.createCommentVNode)(' 總結列表 '),(0,n.createElementVNode)('div',Ug,[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(h.value,(e,a)=>((0,n.openBlock)(),(0,n.createElementBlock)('div',{key:a,class:(0,n.normalizeClass)(['summary-row',{'new-summary-row':i.value===a}])},[(0,n.createCommentVNode)(' 編輯模式 '),i.value===a?((0,n.openBlock)(),(0,n.createElementBlock)('div',zg,[(0,n.createCommentVNode)(' 第一行：最後樓層、權重、操作按鈕 '),(0,n.createElementVNode)('div',Lg,[(0,n.createElementVNode)('div',Fg,[(0,n.createElementVNode)('div',Hg,[t[24]||(t[24]=(0,n.createTextVNode)(' 最後樓層: ',-1)),(0,n.createElementVNode)('input',{value:u.value,type:'number',class:'summary-last-message-id-input',min:'0',step:'1',onInput:t[8]||(t[8]=e=>B(e))},null,40,jg)]),(0,n.createElementVNode)('div',Pg,[t[25]||(t[25]=(0,n.createTextVNode)(' 權重: ',-1)),(0,n.createElementVNode)('input',{value:d.value,type:'number',class:'summary-weighting-input',step:'0.1',min:'0',max:'1',onInput:t[9]||(t[9]=e=>C(e))},null,40,qg)])]),(0,n.createElementVNode)('div',Gg,[(0,n.createElementVNode)('button',{class:'confirm-button',disabled:!k.value,onClick:N},'保存',8,Wg),(0,n.createElementVNode)('button',{class:'cancel-button',onClick:f},'取消')])]),(0,n.createCommentVNode)(' 第二行：時間輸入 '),(0,n.createElementVNode)('div',Xg,[(0,n.createElementVNode)('div',Zg,[(0,n.createElementVNode)('input',{value:c.value.year,type:'number',class:'summary-datetime-input summary-datetime-year-input',placeholder:'年',onInput:t[10]||(t[10]=e=>S('year',e))},null,40,Jg),t[26]||(t[26]=(0,n.createTextVNode)('年 ',-1)),(0,n.createElementVNode)('input',{value:c.value.month,type:'number',class:'summary-datetime-input',placeholder:'月',min:'1',max:'12',onInput:t[11]||(t[11]=e=>S('month',e))},null,40,Qg),t[27]||(t[27]=(0,n.createTextVNode)('月 ',-1)),(0,n.createElementVNode)('input',{value:c.value.day,type:'number',class:'summary-datetime-input',placeholder:'日',min:'1',max:'31',onInput:t[12]||(t[12]=e=>S('day',e))},null,40,e_),t[28]||(t[28]=(0,n.createTextVNode)('日 ',-1)),(0,n.createElementVNode)('input',{value:c.value.hour,type:'number',class:'summary-datetime-input',placeholder:'時',min:'0',max:'23',onInput:t[13]||(t[13]=e=>S('hour',e))},null,40,t_),t[29]||(t[29]=(0,n.createTextVNode)(': ',-1)),(0,n.createElementVNode)('input',{value:c.value.minute,type:'number',class:'summary-datetime-input',placeholder:'分',min:'0',max:'59',onInput:t[14]||(t[14]=e=>S('minute',e))},null,40,a_)])]),(0,n.createCommentVNode)(' 第三行：總結內容輸入 '),(0,n.createElementVNode)('textarea',{value:m.value,class:'summary-content-input',placeholder:'輸入總結內容...',onInput:t[15]||(t[15]=e=>m.value=e.target.value)},null,40,n_)])):((0,n.openBlock)(),(0,n.createElementBlock)(n.Fragment,{key:1},[(0,n.createCommentVNode)(' 顯示模式 '),(0,n.createElementVNode)('div',null,[(0,n.createCommentVNode)(' 第一行：消息ID、權重、操作按鈕 '),(0,n.createElementVNode)('div',l_,[(0,n.createElementVNode)('div',r_,[(0,n.createElementVNode)('div',o_,'最後樓層: '+(0,n.toDisplayString)(e.last_message_id),1),(0,n.createElementVNode)('div',i_,'權重: '+(0,n.toDisplayString)(e.weighting),1),(0,n.createElementVNode)('div',{class:(0,n.normalizeClass)(['summary-status',`status-${E(e)}`])},(0,n.toDisplayString)('used'===E(e)?'使用中':'未使用'),3)]),(0,n.createElementVNode)('div',s_,[(0,n.createElementVNode)('button',{class:'edit-summary-button',onClick:e=>(e=>{if(v.value&&h.value[e]){i.value=e;const t=h.value[e],a=t.datetime.toDate();c.value={year:a.getFullYear(),month:a.getMonth()+1,day:a.getDate(),hour:a.getHours(),minute:a.getMinutes()},d.value=t.weighting,u.value=t.last_message_id,m.value=t.summary}})(a)},'編輯',8,c_),(0,n.createElementVNode)('button',{class:'delete-summary-button',onClick:e=>(e=>{if(v.value&&h.value[e]){const t=h.value[e];o.value=e,r.value={visible:!0,title:'確認刪除總結',message:`確定要刪除總結 "${t.summary.substring(0,50)}${t.summary.length>50?'...':''}" 嗎？此操作無法撤銷。`,confirmText:'刪除',cancelText:'取消'}}})(a)},'刪除',8,d_)])]),(0,n.createCommentVNode)(' 第二行：時間 '),(0,n.createElementVNode)('div',u_,[(0,n.createElementVNode)('div',m_,(0,n.toDisplayString)(x(e.datetime)),1)]),(0,n.createCommentVNode)(' 第三行：總結內容 '),(0,n.createElementVNode)('div',v_,(0,n.toDisplayString)(e.summary),1)])],2112))],2))),128)),0===h.value.length?((0,n.openBlock)(),(0,n.createElementBlock)('div',p_,'沒有任何總結')):(0,n.createCommentVNode)('v-if',!0)]),(0,n.createCommentVNode)(' 確認窗口 '),(0,n.createVNode)(Zi,{'confirm-dialog':r.value,'onUpdate:confirmDialog':t[16]||(t[16]=e=>r.value=e),onConfirmDialogConfirm:y,onConfirmDialogCancel:b},null,8,['confirm-dialog'])])]))}}),__=(0,d.A)(g_,[['__scopeId','data-v-3de5c4ec']]),h_={class:'user-tab-container'},E_={ref:'userContentRef',class:'user-content'},y_={class:'user-header'},b_={class:'user-name'},V_={class:'attributes-grid'},N_={class:'attribute-item horizontal'},f_={class:'attribute-value'},k_={class:'attribute-item horizontal'},w_={key:0,class:'attribute-value'},B_={class:'attribute-item horizontal'},C_={key:0,class:'attribute-value'},$_={class:'attribute-item horizontal'},S_={key:0,class:'attribute-value'},x_={class:'attribute-item horizontal'},I_={key:0,class:'attribute-value'},D_={class:'attribute-item horizontal'},T_={key:0,class:'attribute-value'},M_={class:'attribute-item horizontal'},O_={key:0,class:'attribute-value'},Y_={class:'attribute-item horizontal'},A_={key:0,class:'attribute-value'},R_={class:'attribute-item horizontal'},K_={key:0,class:'attribute-value'},U_={class:'attribute-item full-width horizontal'},z_={key:0,class:'attribute-value money'},L_={class:'attribute-item full-width birthday-fullwidth'},F_={key:0,class:'attribute-value'},H_={key:1,class:'birthday-edit-container'},j_={class:'birthday-input-group'},P_={class:'attribute-item full-width'},q_={key:0,class:'attribute-value no-bold'},G_={class:'attribute-item full-width'},W_={key:0,class:'attribute-value no-bold'},X_={class:'attribute-item full-width'},Z_={key:0,class:'attribute-value no-bold'},J_={class:'attribute-item full-width'},Q_={key:0,class:'attribute-value no-bold'},eh={class:'attribute-item full-width'},th={key:0,class:'attribute-value no-bold'},ah={class:'attribute-item full-width'},nh={key:0,class:'attribute-value no-bold'},lh={class:'attribute-item full-width'},rh={key:0,class:'attribute-value no-bold'},oh={key:0,class:'attribute-item full-width'},ih={key:0,class:'attribute-value no-bold'},sh={class:'relations-section'},ch={key:0,class:'relations-list'},dh={class:'relation-highlight'},uh={class:'relation-highlight'},mh={key:0,class:'no-relations-message'},vh={key:1,class:'relations-edit-list'},ph=['value','onChange'],gh=['value'],_h=['onUpdate:modelValue'],hh=['onClick'],Eh={class:'inventory-section'},yh={key:0,class:'inventory-list'},bh={class:'inventory-first-row'},Vh={class:'item-name-id'},Nh={key:0,class:'item-quantity'},fh={key:1,class:'storage-indicator'},kh={class:'inventory-second-row'},wh={key:0,class:'inventory-third-row'},Bh={key:0,class:'no-inventory'},Ch={key:1,class:'inventory-items'},$h={key:0,class:'no-inventory-message'},Sh={key:1,class:'inventory-edit-list'},xh=['value','onChange'],Ih={label:'物品'},Dh=['value'],Th={label:'貯存點'},Mh=['value'],Oh={key:0,class:'inventory-edit-connector'},Yh=['onUpdate:modelValue'],Ah=['onClick'],Rh={key:0,class:'edit-buttons'},Kh=(0,n.defineComponent)({__name:'user_tab',setup(t,{expose:a}){(0,n.useCssVars)(e=>({v68dcf940:s.value}));const l=(0,n.ref)(!1),r=(0,n.ref)(null),o=(0,n.ref)(0),i=(0,n.ref)(null),s=(0,n.computed)(()=>`calc(100vh - ${o.value}px)`),c=(0,n.computed)({get:()=>r.value?.關係||{},set:e=>{r.value&&(r.value.關係=e)}}),d=(0,n.computed)({get:()=>r.value?.所持物||{},set:e=>{r.value&&(r.value.所持物=e)}}),u=(0,n.computed)(()=>{if(!V.value)return[];const e=[];for(const[t,a]of V.value.active_characters)'c1'!==t&&e.push({id:t,name:a.name});for(const[t,a]of V.value.deactive_characters)e.push({id:t,name:a.name});return e}),m=(0,n.computed)(()=>{if(!V.value)return[];const e=[];for(const[t,a]of V.value.items)e.push({id:t,name:a.name,type:'item'});for(const[t,a]of V.value.storages)e.push({id:t,name:a.name,type:'storage'});return e}),v=e=>{if(!V.value)return'未知';const t=V.value.items.get(e);if(t)return t.name;const a=V.value.storages.get(e);return a?a.name:'未知'},p=e=>V.value?.storages.has(e)||!1,g=e=>{const t=V.value?.storages.get(e);return t?.inventory.size||0},h=e=>{const t=V.value?.storages.get(e);return t?.inventory||new Map},E=e=>{if(!V.value)return'無描述';const t=V.value.items.get(e);if(t)return t.description;const a=V.value.storages.get(e);return a?a.description:'無描述'},y=()=>{r.value?.關係&&(r.value.關係['']='')},b=()=>{r.value?.所持物&&(r.value.所持物['']=1)},V=(0,n.ref)(null),N=()=>{try{const e=getLastMessageId();V.value=Rl.loadFromVariable(e)}catch(e){console.error('Failed to load state:',e),V.value=null}};N();const f=(0,n.computed)(()=>V.value?.getCharacter('c1')||null),k=()=>{f.value&&(r.value=e(f.value.toRecord()),r.value.關係=Object.fromEntries(f.value.relations),r.value.所持物=Object.fromEntries(f.value.inventory),r.value.生日={month:f.value.birthday.month,date:f.value.birthday.date},l.value=!0)},w=()=>{l.value=!1,r.value=null},B=()=>{if(V.value&&r.value){if(r.value.生日&&r.value.生日.month&&r.value.生日.date){const e=new Date,t=e.getFullYear(),a=e.getMonth()+1,n=e.getDate(),l=r.value.生日.month,o=r.value.生日.date;let i=t-(r.value.年齡||0);(l>a||l===a&&o>n)&&(i-=1),r.value.生日=new Date(i,r.value.生日.month-1,r.value.生日.date).toString()}if(r.value.關係){const e={};for(const[t,a]of Object.entries(r.value.關係))t&&a&&'string'==typeof a&&''!==a.trim()&&(e[t]=a);r.value.關係=e}if(r.value.所持物){const e={};for(const[t,a]of Object.entries(r.value.所持物))if(t&&a&&'number'==typeof a&&a>0){const n=p(t)?1:a;e[t]=n}r.value.所持物=e}V.value.active_characters.set('c1',Dl.fromRecord(r.value)),V.value.saveAsVariable(getLastMessageId()),N()}l.value=!1,r.value=null};a({handleTabClick:()=>{l.value&&w()}});return(0,n.onMounted)(()=>{(0,n.nextTick)(()=>{(()=>{if('undefined'==typeof ResizeObserver)return void(o.value=74);i.value=new ResizeObserver(e=>{for(const t of e){const e=t.target;e.classList.contains('tab-navigation')&&(o.value=e.offsetHeight)}});const e=document.querySelector('.tab-navigation.top');e&&(i.value.observe(e),o.value=e.offsetHeight)})()})}),(0,n.onUnmounted)(()=>{i.value&&(i.value.disconnect(),i.value=null)}),(e,t)=>{return(0,n.openBlock)(),(0,n.createElementBlock)('div',h_,[(0,n.createElementVNode)('div',E_,[(0,n.createCommentVNode)(' 用戶名稱標題 '),(0,n.createElementVNode)('div',y_,[(0,n.createElementVNode)('h1',b_,(0,n.toDisplayString)(f.value?.name||'N/A'),1),l.value?(0,n.createCommentVNode)('v-if',!0):((0,n.openBlock)(),(0,n.createElementBlock)('button',{key:0,class:'edit-button',onClick:k},'編輯'))]),(0,n.createCommentVNode)(' 所有屬性統一顯示 '),(0,n.createElementVNode)('div',V_,[(0,n.createCommentVNode)(' 基本信息 '),(0,n.createElementVNode)('div',N_,[t[19]||(t[19]=(0,n.createElementVNode)('span',{class:'attribute-label'},'ID',-1)),(0,n.createElementVNode)('span',f_,(0,n.toDisplayString)(f.value?'c1':'N/A'),1)]),(0,n.createElementVNode)('div',k_,[t[20]||(t[20]=(0,n.createElementVNode)('span',{class:'attribute-label'},'性別',-1)),l.value?(0,n.withDirectives)(((0,n.openBlock)(),(0,n.createElementBlock)('input',{key:1,'onUpdate:modelValue':t[0]||(t[0]=e=>r.value.性別=e),class:'attribute-input'},null,512)),[[n.vModelText,r.value.性別]]):((0,n.openBlock)(),(0,n.createElementBlock)('span',w_,(0,n.toDisplayString)(f.value?.gender||'N/A'),1))]),(0,n.createElementVNode)('div',B_,[t[21]||(t[21]=(0,n.createElementVNode)('span',{class:'attribute-label'},'年齡',-1)),l.value?(0,n.withDirectives)(((0,n.openBlock)(),(0,n.createElementBlock)('input',{key:1,'onUpdate:modelValue':t[1]||(t[1]=e=>r.value.年齡=e),class:'attribute-input',type:'number'},null,512)),[[n.vModelText,r.value.年齡,void 0,{number:!0}]]):((0,n.openBlock)(),(0,n.createElementBlock)('span',C_,(0,n.toDisplayString)(f.value?.age||'N/A'),1))]),(0,n.createCommentVNode)(' 身體測量 '),(0,n.createElementVNode)('div',$_,[t[22]||(t[22]=(0,n.createElementVNode)('span',{class:'attribute-label unit-label'},'身高 (cm)',-1)),l.value?(0,n.withDirectives)(((0,n.openBlock)(),(0,n.createElementBlock)('input',{key:1,'onUpdate:modelValue':t[2]||(t[2]=e=>r.value.身高=e),class:'attribute-input',type:'number'},null,512)),[[n.vModelText,r.value.身高,void 0,{number:!0}]]):((0,n.openBlock)(),(0,n.createElementBlock)('span',S_,(0,n.toDisplayString)(f.value?.height||'N/A'),1))]),(0,n.createElementVNode)('div',x_,[t[23]||(t[23]=(0,n.createElementVNode)('span',{class:'attribute-label unit-label'},'體重 (kg)',-1)),l.value?(0,n.withDirectives)(((0,n.openBlock)(),(0,n.createElementBlock)('input',{key:1,'onUpdate:modelValue':t[3]||(t[3]=e=>r.value.體重=e),class:'attribute-input',type:'number'},null,512)),[[n.vModelText,r.value.體重,void 0,{number:!0}]]):((0,n.openBlock)(),(0,n.createElementBlock)('span',I_,(0,n.toDisplayString)(f.value?.weight||'N/A'),1))]),(0,n.createElementVNode)('div',D_,[t[24]||(t[24]=(0,n.createElementVNode)('span',{class:'attribute-label unit-label'},'胸圍 (cm)',-1)),l.value?(0,n.withDirectives)(((0,n.openBlock)(),(0,n.createElementBlock)('input',{key:1,'onUpdate:modelValue':t[4]||(t[4]=e=>r.value.胸圍=e),class:'attribute-input',type:'number'},null,512)),[[n.vModelText,r.value.胸圍,void 0,{number:!0}]]):((0,n.openBlock)(),(0,n.createElementBlock)('span',T_,(0,n.toDisplayString)(f.value?.chest_size||'N/A'),1))]),(0,n.createElementVNode)('div',M_,[t[25]||(t[25]=(0,n.createElementVNode)('span',{class:'attribute-label'},'罩杯',-1)),l.value?(0,n.withDirectives)(((0,n.openBlock)(),(0,n.createElementBlock)('input',{key:1,'onUpdate:modelValue':t[5]||(t[5]=e=>r.value.罩杯=e),class:'attribute-input'},null,512)),[[n.vModelText,r.value.罩杯]]):((0,n.openBlock)(),(0,n.createElementBlock)('span',O_,(0,n.toDisplayString)(f.value?.cup_size||'不適用'),1))]),(0,n.createElementVNode)('div',Y_,[t[26]||(t[26]=(0,n.createElementVNode)('span',{class:'attribute-label unit-label'},'腰圍 (cm)',-1)),l.value?(0,n.withDirectives)(((0,n.openBlock)(),(0,n.createElementBlock)('input',{key:1,'onUpdate:modelValue':t[6]||(t[6]=e=>r.value.腰圍=e),class:'attribute-input',type:'number'},null,512)),[[n.vModelText,r.value.腰圍,void 0,{number:!0}]]):((0,n.openBlock)(),(0,n.createElementBlock)('span',A_,(0,n.toDisplayString)(f.value?.waist_size||'N/A'),1))]),(0,n.createElementVNode)('div',R_,[t[27]||(t[27]=(0,n.createElementVNode)('span',{class:'attribute-label unit-label'},'臀圍 (cm)',-1)),l.value?(0,n.withDirectives)(((0,n.openBlock)(),(0,n.createElementBlock)('input',{key:1,'onUpdate:modelValue':t[7]||(t[7]=e=>r.value.臀圍=e),class:'attribute-input',type:'number'},null,512)),[[n.vModelText,r.value.臀圍,void 0,{number:!0}]]):((0,n.openBlock)(),(0,n.createElementBlock)('span',K_,(0,n.toDisplayString)(f.value?.hips_size||'N/A'),1))]),(0,n.createCommentVNode)(' 金錢 '),(0,n.createElementVNode)('div',U_,[t[28]||(t[28]=(0,n.createElementVNode)('span',{class:'attribute-label'},'金錢',-1)),l.value?(0,n.withDirectives)(((0,n.openBlock)(),(0,n.createElementBlock)('input',{key:1,'onUpdate:modelValue':t[8]||(t[8]=e=>r.value.金錢=e),class:'attribute-input',type:'number'},null,512)),[[n.vModelText,r.value.金錢,void 0,{number:!0}]]):((0,n.openBlock)(),(0,n.createElementBlock)('span',z_,(0,n.toDisplayString)((o=f.value?.money,void 0===o?'N/A':`$${o.toLocaleString()}`)),1))]),(0,n.createCommentVNode)(' 生日 '),(0,n.createElementVNode)('div',L_,[t[31]||(t[31]=(0,n.createElementVNode)('span',{class:'attribute-label'},'生日',-1)),l.value?((0,n.openBlock)(),(0,n.createElementBlock)('div',H_,[(0,n.createElementVNode)('div',j_,[(0,n.withDirectives)((0,n.createElementVNode)('input',{'onUpdate:modelValue':t[9]||(t[9]=e=>r.value.生日.month=e),class:'attribute-input birthday-month',type:'number',placeholder:'月',min:'1',max:'12'},null,512),[[n.vModelText,r.value.生日.month,void 0,{number:!0}]]),t[29]||(t[29]=(0,n.createElementVNode)('span',{class:'birthday-separator'},'月',-1)),(0,n.withDirectives)((0,n.createElementVNode)('input',{'onUpdate:modelValue':t[10]||(t[10]=e=>r.value.生日.date=e),class:'attribute-input birthday-date',type:'number',placeholder:'日',min:'1',max:'31'},null,512),[[n.vModelText,r.value.生日.date,void 0,{number:!0}]]),t[30]||(t[30]=(0,n.createElementVNode)('span',{class:'birthday-separator'},'日',-1))])])):((0,n.openBlock)(),(0,n.createElementBlock)('span',F_,(0,n.toDisplayString)((a=f.value?.birthday,a?`${a.month}月${a.date}日`:'N/A')),1))]),(0,n.createCommentVNode)(' 外貌特徵 '),(0,n.createElementVNode)('div',P_,[t[32]||(t[32]=(0,n.createElementVNode)('span',{class:'attribute-label'},'身份',-1)),l.value?(0,n.withDirectives)(((0,n.openBlock)(),(0,n.createElementBlock)('textarea',{key:1,'onUpdate:modelValue':t[11]||(t[11]=e=>r.value.身份=e),class:'attribute-textarea'},null,512)),[[n.vModelText,r.value.身份]]):((0,n.openBlock)(),(0,n.createElementBlock)('span',q_,(0,n.toDisplayString)(f.value?.identity||'N/A'),1))]),(0,n.createElementVNode)('div',G_,[t[33]||(t[33]=(0,n.createElementVNode)('span',{class:'attribute-label'},'髮型',-1)),l.value?(0,n.withDirectives)(((0,n.openBlock)(),(0,n.createElementBlock)('textarea',{key:1,'onUpdate:modelValue':t[12]||(t[12]=e=>r.value.髮型=e),class:'attribute-textarea'},null,512)),[[n.vModelText,r.value.髮型]]):((0,n.openBlock)(),(0,n.createElementBlock)('span',W_,(0,n.toDisplayString)(f.value?.hairstyle||'N/A'),1))]),(0,n.createElementVNode)('div',X_,[t[34]||(t[34]=(0,n.createElementVNode)('span',{class:'attribute-label'},'樣貌',-1)),l.value?(0,n.withDirectives)(((0,n.openBlock)(),(0,n.createElementBlock)('textarea',{key:1,'onUpdate:modelValue':t[13]||(t[13]=e=>r.value.樣貌=e),class:'attribute-textarea'},null,512)),[[n.vModelText,r.value.樣貌]]):((0,n.openBlock)(),(0,n.createElementBlock)('span',Z_,(0,n.toDisplayString)(f.value?.appearance||'N/A'),1))]),(0,n.createElementVNode)('div',J_,[t[35]||(t[35]=(0,n.createElementVNode)('span',{class:'attribute-label'},'衣著',-1)),l.value?(0,n.withDirectives)(((0,n.openBlock)(),(0,n.createElementBlock)('textarea',{key:1,'onUpdate:modelValue':t[14]||(t[14]=e=>r.value.衣著=e),class:'attribute-textarea'},null,512)),[[n.vModelText,r.value.衣著]]):((0,n.openBlock)(),(0,n.createElementBlock)('span',Q_,(0,n.toDisplayString)(f.value?.clothes||'N/A'),1))]),(0,n.createElementVNode)('div',eh,[t[36]||(t[36]=(0,n.createElementVNode)('span',{class:'attribute-label'},'愛好',-1)),l.value?(0,n.withDirectives)(((0,n.openBlock)(),(0,n.createElementBlock)('textarea',{key:1,'onUpdate:modelValue':t[15]||(t[15]=e=>r.value.愛好=e),class:'attribute-textarea'},null,512)),[[n.vModelText,r.value.愛好]]):((0,n.openBlock)(),(0,n.createElementBlock)('span',th,(0,n.toDisplayString)(f.value?.favourite||'N/A'),1))]),(0,n.createElementVNode)('div',ah,[t[37]||(t[37]=(0,n.createElementVNode)('span',{class:'attribute-label'},'簡介',-1)),l.value?(0,n.withDirectives)(((0,n.openBlock)(),(0,n.createElementBlock)('textarea',{key:1,'onUpdate:modelValue':t[16]||(t[16]=e=>r.value.簡介=e),class:'attribute-textarea'},null,512)),[[n.vModelText,r.value.簡介]]):((0,n.openBlock)(),(0,n.createElementBlock)('span',nh,(0,n.toDisplayString)(f.value?.introduction||'N/A'),1))]),(0,n.createElementVNode)('div',lh,[t[38]||(t[38]=(0,n.createElementVNode)('span',{class:'attribute-label'},'性格',-1)),l.value?(0,n.withDirectives)(((0,n.openBlock)(),(0,n.createElementBlock)('textarea',{key:1,'onUpdate:modelValue':t[17]||(t[17]=e=>r.value.性格=e),class:'attribute-textarea'},null,512)),[[n.vModelText,r.value.性格]]):((0,n.openBlock)(),(0,n.createElementBlock)('span',rh,(0,n.toDisplayString)(f.value?.personality||'N/A'),1))]),f.value?.extra_information||l.value?((0,n.openBlock)(),(0,n.createElementBlock)('div',oh,[t[39]||(t[39]=(0,n.createElementVNode)('span',{class:'attribute-label'},'其他重要資訊',-1)),l.value?(0,n.withDirectives)(((0,n.openBlock)(),(0,n.createElementBlock)('textarea',{key:1,'onUpdate:modelValue':t[18]||(t[18]=e=>r.value.其他重要資訊=e),class:'attribute-textarea'},null,512)),[[n.vModelText,r.value.其他重要資訊]]):((0,n.openBlock)(),(0,n.createElementBlock)('span',ih,(0,n.toDisplayString)(f.value?.extra_information||'N/A'),1))])):(0,n.createCommentVNode)('v-if',!0)]),(0,n.createCommentVNode)(' 關係和物品 '),(0,n.createElementVNode)('div',sh,[t[43]||(t[43]=(0,n.createElementVNode)('h3',{class:'section-title'},'關係',-1)),l.value?((0,n.openBlock)(),(0,n.createElementBlock)('div',vh,[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(c.value,(_,e)=>((0,n.openBlock)(),(0,n.createElementBlock)('div',{key:e,class:'relation-edit-item'},[(0,n.createElementVNode)('select',{value:e,class:'relation-select',onChange:t=>((e,t)=>{if(r.value?.關係&&e!==t){const a=r.value.關係[e];delete r.value.關係[e],t&&(r.value.關係[t]=a)}})(String(e),t.target.value)},[t[41]||(t[41]=(0,n.createElementVNode)('option',{value:'',disabled:''},'選擇角色',-1)),((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(u.value,e=>((0,n.openBlock)(),(0,n.createElementBlock)('option',{key:e.id,value:e.id},(0,n.toDisplayString)(e.name)+' ('+(0,n.toDisplayString)(e.id)+') ',9,gh))),128))],40,ph),t[42]||(t[42]=(0,n.createElementVNode)('span',{class:'relation-edit-connector'},' 是此角色的 ',-1)),(0,n.withDirectives)((0,n.createElementVNode)('input',{'onUpdate:modelValue':t=>c.value[e]=t,class:'relation-input',placeholder:'關係'},null,8,_h),[[n.vModelText,c.value[e]]]),(0,n.createElementVNode)('button',{class:'relation-remove-btn',onClick:t=>(e=>{r.value?.關係&&delete r.value.關係[e]})(String(e))},'×',8,hh)]))),128)),(0,n.createElementVNode)('button',{class:'add-relation-btn',onClick:y},'+ 添加關係')])):((0,n.openBlock)(),(0,n.createElementBlock)('div',ch,[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(f.value?.relations||[],([e,a])=>((0,n.openBlock)(),(0,n.createElementBlock)('div',{key:e,class:'relation-item'},[(0,n.createElementVNode)('span',dh,(0,n.toDisplayString)(V.value?.getCharacter(e)?.name||'未知')+' ('+(0,n.toDisplayString)(e)+')',1),t[40]||(t[40]=(0,n.createElementVNode)('span',{class:'relation-connector'},' 是此角色的 ',-1)),(0,n.createElementVNode)('span',uh,(0,n.toDisplayString)(a),1)]))),128)),f.value?.relations&&0!==f.value.relations.size?(0,n.createCommentVNode)('v-if',!0):((0,n.openBlock)(),(0,n.createElementBlock)('div',mh,' 沒有任何關係 '))]))]),(0,n.createElementVNode)('div',Eh,[t[45]||(t[45]=(0,n.createElementVNode)('h3',{class:'section-title'},'所持物',-1)),l.value?((0,n.openBlock)(),(0,n.createElementBlock)('div',Sh,[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(d.value,(_,e)=>((0,n.openBlock)(),(0,n.createElementBlock)('div',{key:e,class:'inventory-edit-item'},[(0,n.createElementVNode)('select',{value:e,class:'inventory-select',onChange:t=>((e,t)=>{if(r.value?.所持物&&e!==t){const a=r.value.所持物[e];delete r.value.所持物[e],t&&(r.value.所持物[t]=a)}})(String(e),t.target.value)},[t[44]||(t[44]=(0,n.createElementVNode)('option',{value:'',disabled:''},'選擇物品或貯存點...',-1)),(0,n.createElementVNode)('optgroup',Ih,[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(m.value.filter(e=>'item'===e.type),e=>((0,n.openBlock)(),(0,n.createElementBlock)('option',{key:e.id,value:e.id},(0,n.toDisplayString)(e.name)+' ('+(0,n.toDisplayString)(e.id)+') ',9,Dh))),128))]),(0,n.createElementVNode)('optgroup',Th,[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(m.value.filter(e=>'storage'===e.type),e=>((0,n.openBlock)(),(0,n.createElementBlock)('option',{key:e.id,value:e.id},(0,n.toDisplayString)(e.name)+' ('+(0,n.toDisplayString)(e.id)+') ',9,Mh))),128))])],40,xh),p(String(e))?(0,n.createCommentVNode)('v-if',!0):((0,n.openBlock)(),(0,n.createElementBlock)('span',Oh,'×')),p(String(e))?(0,n.createCommentVNode)('v-if',!0):(0,n.withDirectives)(((0,n.openBlock)(),(0,n.createElementBlock)('input',{key:1,'onUpdate:modelValue':t=>d.value[e]=t,class:'inventory-quantity-input',type:'number',min:'0',placeholder:'數量'},null,8,Yh)),[[n.vModelText,d.value[e],void 0,{number:!0}]]),(0,n.createElementVNode)('button',{class:'inventory-remove-btn',onClick:t=>(e=>{r.value?.所持物&&delete r.value.所持物[e]})(String(e))},'×',8,Ah)]))),128)),(0,n.createElementVNode)('button',{class:'add-inventory-btn',onClick:b},'+ 添加物品或貯存點')])):((0,n.openBlock)(),(0,n.createElementBlock)('div',yh,[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(f.value?.inventory||[],([e,t])=>((0,n.openBlock)(),(0,n.createElementBlock)('div',{key:e,class:(0,n.normalizeClass)(['inventory-item',{'storage-item':p(e)}])},[(0,n.createElementVNode)('div',bh,[(0,n.createElementVNode)('span',Vh,(0,n.toDisplayString)(v(e))+' ('+(0,n.toDisplayString)(e)+')',1),p(e)?((0,n.openBlock)(),(0,n.createElementBlock)('span',fh,'貯存點')):((0,n.openBlock)(),(0,n.createElementBlock)('span',Nh,'× '+(0,n.toDisplayString)(t),1))]),(0,n.createElementVNode)('div',kh,(0,n.toDisplayString)(E(e)),1),p(e)?((0,n.openBlock)(),(0,n.createElementBlock)('div',wh,[0===g(e)?((0,n.openBlock)(),(0,n.createElementBlock)('div',Bh,'無物品')):((0,n.openBlock)(),(0,n.createElementBlock)('div',Ch,[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(h(e),([e,t])=>((0,n.openBlock)(),(0,n.createElementBlock)('span',{key:e,class:(0,n.normalizeClass)(V.value?.storages.has(e)?'storage-item-tag':'inventory-item-tag')},(0,n.toDisplayString)(v(e))+' ('+(0,n.toDisplayString)(e)+')'+(0,n.toDisplayString)(V.value?.storages.has(e)?'':` × ${t}`),3))),128))]))])):(0,n.createCommentVNode)('v-if',!0)],2))),128)),f.value?.inventory&&0!==f.value.inventory.size?(0,n.createCommentVNode)('v-if',!0):((0,n.openBlock)(),(0,n.createElementBlock)('div',$h,' 沒有任何物品 '))]))]),(0,n.createCommentVNode)(' 編輯按鈕 '),l.value?((0,n.openBlock)(),(0,n.createElementBlock)('div',Rh,[(0,n.createElementVNode)('button',{class:'confirm-button',onClick:B},'確認'),(0,n.createElementVNode)('button',{class:'cancel-button',onClick:w},'取消')])):(0,n.createCommentVNode)('v-if',!0)],512)]);var a,o}}}),Uh=(0,d.A)(Kh,[['__scopeId','data-v-ada46c14']]),zh={class:'world-info-container'},Lh={class:'world-info-content'},Fh={class:'section'},Hh={class:'sortable-container'},jh={key:0,class:'drop-indicator'},Ph=['data-id','onDragstart','onDragover','onDrop'],qh=['onClick'],Gh={class:'fold-content'},Wh={class:'input-group'},Xh=['onUpdate:modelValue'],Zh={class:'input-group'},Jh=['onUpdate:modelValue'],Qh={class:'input-group'},eE=['onUpdate:modelValue'],tE={key:0,class:'generated-result'},aE={class:'generated-text'},nE=['onClick'],lE={class:'item-actions'},rE=['disabled','onClick'],oE={key:0,class:'loading-spinner'},iE=['disabled','onClick'],sE={key:0,class:'drop-indicator'},cE=(0,n.defineComponent)({__name:'world_info_tab',setup(e){(0,n.useCssVars)(e=>({ae590e90:(0,n.unref)(l)}));const t=(0,n.ref)(0),a=(0,n.ref)(null),l=(0,n.computed)(()=>`calc(100vh - ${t.value}px)`);(0,n.onMounted)(()=>{p(),E(),(async()=>{await(0,n.nextTick)();const e=document.querySelector('.tab-navigation');e&&window.ResizeObserver?(a.value=new ResizeObserver(e=>{for(const a of e)t.value=a.contentRect.height}),a.value.observe(e)):t.value=74})()}),(0,n.onUnmounted)(()=>{a.value&&(a.value.disconnect(),a.value=null)});const r=(0,n.ref)([]),o=(0,n.ref)(new Map),i=(0,n.computed)(()=>{try{const e=getVariables({type:'chat'});return!!e?.world_info?.trim()}catch{return!1}}),s=(0,n.ref)(null),c=(0,n.ref)(null),d=e=>{const t=r.value[e];if(t&&t.generated_content){t.content=t.generated_content,t.generated_content='',r.value[e]={...t};try{t.name&&t.name.trim()&&localStorage.removeItem(`world_info_item_generated_${t.name.trim()}`)}catch(e){console.error(`Failed to remove generated world info item for ${t.name} from localStorage:`,e)}}},u=()=>{const e={id:Date.now().toString(),name:'',content:'',generation_requirement:'',is_open:!1,generated_content:''};r.value.push(e)},v=()=>{try{const e=getVariables({type:'chat'}),t=r.value.map(e=>({name:e.name,content:e.content}));e.extra_world_info=t,replaceVariables(e,{type:'chat'}),(()=>{const e=getVariables({type:'chat'});let t='';for(const a of Array.from(e.extra_world_info))''!==a.name.trim()&&''!==a.content.trim()&&(t+=`<${a.name}>\n`,t+=`${a.content}\n`,t+=`</${a.name}>\n`,t+='\n');e.extra_world_info_prompt=t,replaceVariables(e,{type:'chat'})})()}catch(e){console.error('保存 extra_world_info 失敗:',e)}},p=()=>{try{const e=getVariables({type:'chat'});if(e?.extra_world_info&&Array.isArray(e.extra_world_info)){const t=e.extra_world_info.map((e,t)=>({id:`loaded_${t}_${Date.now()}`,name:e.name||'未命名項目',content:e.content||'',generation_requirement:'',is_open:!1,generated_content:''}));r.value=t}}catch(e){console.error('加載 extra_world_info 失敗:',e)}},g=()=>{c.value=null},h=()=>{s.value=null,c.value=null},E=()=>{try{const e=localStorage.getItem('world_info_tab_generation_requirements');if(e){const t=JSON.parse(e);r.value.forEach(e=>{e.name&&e.name.trim()&&t[e.name.trim()]&&(e.generation_requirement=t[e.name.trim()])})}r.value.forEach(e=>{if(e.name&&e.name.trim()){const t=localStorage.getItem(`world_info_item_generated_${e.name.trim()}`);if(t)try{const a=JSON.parse(t);a[e.name.trim()]&&(e.generated_content=a[e.name.trim()])}catch(t){console.error(`Failed to parse generated content for ${e.name}:`,t)}}})}catch(e){console.error('從 localStorage 加載生成要求失敗:',e)}};(0,n.watch)(r,()=>{v(),(()=>{try{const e={};r.value.forEach(t=>{t.name&&t.name.trim()&&(e[t.name.trim()]=t.generation_requirement)}),localStorage.setItem('world_info_tab_generation_requirements',JSON.stringify(e))}catch(e){console.error('保存生成要求到 localStorage 失敗:',e)}})()},{deep:!0}),(0,n.watch)(()=>getVariables({type:'chat'}),e=>{e?.extra_world_info&&p()},{deep:!0});const y=e=>{let t='請根據世界背景資訊、生成要求及已有項目資料，為以下項目完善內容設定：\n\n';return t+=`名稱：${e.name||''}\n`,t+=`內容：${e.content||''}\n`,t},b=()=>{const e=getVariables({type:'chat'}).world_info;let t=getCharData('current').description;t=t.replace('{{getvar::world_info}}',e);let a='你是一個專業的項目內容設計助手，擅長創造豐富多彩的項目設定。請根據提供的世界背景及生成要求，為項目完善內容。\n';return a+='\n',a+='<世界背景>\n','你是一個專業的項目內容設計助手，擅長創造豐富多彩的項目設定。請根據提供的世界背景及生成要求，為項目完善內容。\n\n<世界背景>\n'},V=e=>{let t='\n</世界背景>\n';return t+='\n',t+=`${(()=>{const e=getVariables({type:'chat'}).characters.c1,t=`${e.姓氏}${e.名字}`;let a=`<${t}Status>\n`;return a+='id：c1\n',a+=`  姓氏：${e.姓氏||''}\n`,a+=`  名字：${e.名字||''}\n`,a+=`  年齡：${e.年齡||''}\n`,a+=`  性別：${e.性別||''}\n`,a+=`  身份：${e.身份||''}\n`,a+=`  身高：${e.身高||''}\n`,a+=`  體重：${e.體重||''}\n`,a+=`  胸圍：${e.胸圍||''}\n`,a+=`  罩杯：${e.罩杯||''}\n`,a+=`  腰圍：${e.腰圍||''}\n`,a+=`  臀圍：${e.臀圍||''}\n`,a+=`  髮型：${e.髮型||''}\n`,a+=`  樣貌：${e.樣貌||''}\n`,a+=`  衣著：${e.衣著||''}\n`,a+=`  簡介：${e.簡介||''}\n`,a+=`  性格：${e.性格||''}\n`,a+=`  愛好：${e.愛好||''}\n`,a+=`  金錢：${e.金錢||''}\n`,a+=`  生日月份：${e.生日月份||''}\n`,a+=`  生日日期：${e.生日日期||''}\n`,a+=`  其他重要資訊：${e.其他重要資訊||''}\n`,a+=`  關係：${N(e.關係)}\n`,a+=`  友好度：${N(e.友好度)}\n`,a+=`  愛情度：${N(e.愛情度)}\n`,a+=`</${t}Status>`,a})()}\n`,t+='\n',t+=`${(()=>{const e=getVariables({type:'chat'}).characters;if(void 0===e)return'';let t='<CharacterStatus>\n';for(const[a,n]of Object.entries(e))'c1'!==a&&(t+=`id：${a}\n`,t+=`  姓氏：${n.姓氏||''}\n`,t+=`  名字：${n.名字||''}\n`,t+=`  年齡：${n.年齡||''}\n`,t+=`  性別：${n.性別||''}\n`,t+=`  身份：${n.身份||''}\n`,t+=`  身高：${n.身高||''}\n`,t+=`  體重：${n.體重||''}\n`,t+=`  胸圍：${n.胸圍||''}\n`,t+=`  罩杯：${n.罩杯||''}\n`,t+=`  腰圍：${n.腰圍||''}\n`,t+=`  臀圍：${n.臀圍||''}\n`,t+=`  髮型：${n.髮型||''}\n`,t+=`  樣貌：${n.樣貌||''}\n`,t+=`  衣著：${n.衣著||''}\n`,t+=`  簡介：${n.簡介||''}\n`,t+=`  性格：${n.性格||''}\n`,t+=`  愛好：${n.愛好||''}\n`,t+=`  金錢：${n.金錢||''}\n`,t+=`  心情：${n.心情||''}\n`,t+=`  性慾：${n.性慾||''}\n`,t+=`  生日月份：${n.生日月份||''}\n`,t+=`  生日日期：${n.生日日期||''}\n`,t+=`  其他重要資訊：${n.其他重要資訊||''}\n`,t+=`  關係：${N(n.關係)}\n`,t+=`  友好度：${N(n.友好度)}\n`,t+=`  愛情度：${N(n.愛情度)}\n\n`);return t+='</CharacterStatus>',t})()}\n`,t+='\n',t+=`${(()=>{let e='<ItemTable>\n';e+='|id|名稱|描述|價值|\n',e+='|---|---|---|---|\n';const t=getVariables({type:'chat'}).items;if(void 0===t)return'';for(const[a,n]of Object.entries(t))e+=`|${a}|${n.name}|${n.description}|${n.value}|\n`;return e+='</ItemTable>',e})()}\n`,t+='\n',t+=`${(()=>{let e='<LocationTable>\n';e+='|id|地點|位置|描述|子地點|\n',e+='|---|---|---|---|---|\n';const t=getVariables({type:'chat'}).locations;if(void 0===t)return'';for(const[a,n]of Object.entries(t)){const t=n.sub_location?n.sub_location.join(', '):'';e+=`|${a}|${n.name}|${n.location||''}|${n.description}|${t}|\n`}return e+='</LocationTable>',e})()}\n`,t+='\n',t+=`${(()=>{let e='';const t=getVariables({type:'chat'}).extra_world_info;if(void 0===t)return'';for(const a of Array.from(t))''!==a.name&&''!==a.content&&(e+=`<${a.name}>\n`,e+=`${a.content}\n`,e+=`</${a.name}>\n`,e+='\n');return e})()}\n`,t+='\n',t+='<生成要求>\n',t+=`${e.generation_requirement||'無特殊要求'}\n`,t+='</生成要求>\n',t},N=e=>'['+Object.entries(e).map(([e,t])=>'string'==typeof t?`'${e}':'${t}'`:`'${e}':${t}`).join(', ')+']',f=(e,t)=>{t.generated_content=e};return(e,t)=>((0,n.openBlock)(),(0,n.createElementBlock)('div',zh,[(0,n.createElementVNode)('div',Lh,[t[5]||(t[5]=(0,n.createElementVNode)('h3',null,'世界資訊',-1)),(0,n.createElementVNode)('div',Fh,[(0,n.createElementVNode)('div',Hh,[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(r.value,(e,a)=>((0,n.openBlock)(),(0,n.createElementBlock)(n.Fragment,{key:e.id},[c.value===a&&null!==s.value&&s.value!==a?((0,n.openBlock)(),(0,n.createElementBlock)('div',jh)):(0,n.createCommentVNode)('v-if',!0),(0,n.createElementVNode)('div',{class:(0,n.normalizeClass)(['sortable-item',{dragging:s.value===a}]),'data-id':e.id,draggable:'true',onDragstart:e=>((e,t)=>{s.value=t,e.dataTransfer&&(e.dataTransfer.effectAllowed='move')})(e,a),onDragover:(0,n.withModifiers)(e=>((e,t)=>{e.preventDefault(),e.dataTransfer&&(e.dataTransfer.dropEffect='move');const a=e.target.getBoundingClientRect(),n=e.clientY-a.top,l=a.height;c.value=n<l/2?t:t+1})(e,a),['prevent']),onDrop:e=>((e,t)=>{e.preventDefault();const a=s.value;if(null!==a&&a!==t){const e=[...r.value],[n]=e.splice(a,1);e.splice(t,0,n),r.value=e}s.value=null})(e,a),onDragend:h,onDragleave:g},[(0,n.createVNode)(m,{title:e.name||'未設定','is-open':e.is_open,class:(0,n.normalizeClass)(['draggable-fold-bar',{incomplete:!e.name||!e.content}]),onToggle:e=>(e=>{r.value[e].is_open=!r.value[e].is_open})(a)},{'title-actions':(0,n.withCtx)(()=>[(0,n.createElementVNode)('button',{class:'remove-btn',title:'移除此項目',onClick:(0,n.withModifiers)(e=>(e=>{r.value.splice(e,1)})(a),['stop'])},[...t[0]||(t[0]=[(0,n.createElementVNode)('span',null,'×',-1)])],8,qh)]),default:(0,n.withCtx)(()=>[(0,n.createElementVNode)('div',Gh,[(0,n.createElementVNode)('div',Wh,[t[1]||(t[1]=(0,n.createElementVNode)('label',null,'名稱',-1)),(0,n.withDirectives)((0,n.createElementVNode)('input',{'onUpdate:modelValue':t=>e.name=t,type:'text',class:'form-input',placeholder:'輸入項目名稱'},null,8,Xh),[[n.vModelText,e.name]])]),(0,n.createElementVNode)('div',Zh,[t[2]||(t[2]=(0,n.createElementVNode)('label',null,'內容',-1)),(0,n.withDirectives)((0,n.createElementVNode)('textarea',{'onUpdate:modelValue':t=>e.content=t,class:'form-textarea',placeholder:'輸入項目內容',rows:'3'},null,8,Jh),[[n.vModelText,e.content]])]),(0,n.createElementVNode)('div',Qh,[t[3]||(t[3]=(0,n.createElementVNode)('label',null,'生成要求',-1)),(0,n.withDirectives)((0,n.createElementVNode)('textarea',{'onUpdate:modelValue':t=>e.generation_requirement=t,class:'form-textarea',placeholder:'輸入生成此項目的要求',rows:'2'},null,8,eE),[[n.vModelText,e.generation_requirement]])]),e.generated_content?((0,n.openBlock)(),(0,n.createElementBlock)('div',tE,[t[4]||(t[4]=(0,n.createElementVNode)('label',null,'生成結果：',-1)),(0,n.createElementVNode)('div',aE,(0,n.toDisplayString)(e.generated_content),1),(0,n.createElementVNode)('button',{class:'replace-btn',onClick:e=>d(a)},'使用',8,nE)])):(0,n.createCommentVNode)('v-if',!0),(0,n.createElementVNode)('div',lE,[(0,n.createElementVNode)('button',{class:'action-btn generate',disabled:!(0,n.unref)(i)||o.value.get(e.id),onClick:e=>(async e=>{const t=r.value[e];if(t){o.value.set(t.id,!0);try{const a=y(t),n=b(),l=V(t),o=await generateRaw({user_input:a,ordered_prompts:[{role:'system',content:n},'char_description',{role:'system',content:l},'user_input']});f(o,t);try{if(t.name&&t.name.trim()){const e={};e[t.name.trim()]=t.generated_content||'',localStorage.setItem(`world_info_item_generated_${t.name.trim()}`,JSON.stringify(e))}}catch(e){console.error(`Failed to save generated world info item for ${t.name} to localStorage:`,e)}r.value[e]={...t}}catch(e){console.error(`生成項目 ${t.name} 內容失敗:`,e)}finally{o.value.set(t.id,!1)}}})(a)},[o.value.get(e.id)?((0,n.openBlock)(),(0,n.createElementBlock)('span',oE)):(0,n.createCommentVNode)('v-if',!0),(0,n.createTextVNode)(' '+(0,n.toDisplayString)(o.value.get(e.id)?'生成中...':(0,n.unref)(i)?'生成內容':'請先完成世界背景設定'),1)],8,rE),(0,n.createElementVNode)('button',{class:'action-btn apply',disabled:!e.generated_content,onClick:e=>d(a)},' 應用結果 ',8,iE)])])]),_:2},1032,['title','is-open','class','onToggle'])],42,Ph)],64))),128)),c.value===r.value.length&&null!==s.value?((0,n.openBlock)(),(0,n.createElementBlock)('div',sE)):(0,n.createCommentVNode)('v-if',!0)]),(0,n.createElementVNode)('div',{class:'add-item-section'},[(0,n.createElementVNode)('button',{class:'add-btn',onClick:u},'+ 添加新項目')])])])]))}}),dE=(0,d.A)(cE,[['__scopeId','data-v-ee3aed0a']]),uE={class:'main-interface-container'},mE={class:'tab-navigation top'},vE={class:'time-row'},pE={class:'current-time'},gE={class:'tab-row'},_E={class:'tab-row'},hE={key:'conversation',class:'conversation-area'},EE={key:'user',class:'user-area'},yE={key:'character',class:'character-area'},bE={key:'item',class:'item-area'},VE={key:'storage',class:'storage-area'},NE={key:'location',class:'location-area'},fE={key:'promise',class:'promise-area'},kE={key:'summary',class:'summary-area'},wE={key:'world_info',class:'world-info-area'},BE={key:'settings',class:'settings-area'},CE=(0,n.defineComponent)({__name:'main_interface',setup(e){const t=(0,n.ref)('conversation'),a=(0,n.ref)(null),l=(0,n.ref)(null),r=(0,n.ref)(null),o=(0,n.ref)(0),i=(0,n.ref)(''),s=['conversation','user','character','item','storage','location','promise','summary','world_info','settings'],c=(0,n.ref)(0),d=(0,n.ref)(0),u=(0,n.ref)(0),m=(0,n.ref)(!1),v=(0,n.ref)(!1),p=(0,n.ref)('right'),g=()=>{const e=new Date,t=e.getHours().toString().padStart(2,'0'),a=e.getMinutes().toString().padStart(2,'0');i.value=`${t}:${a}`};let h=null;(0,n.onMounted)(()=>{g(),h=window.setInterval(g,6e4)}),(0,n.onUnmounted)(()=>{null!==h&&clearInterval(h)});const E=(e,n=!1)=>{e!==t.value?(v.value=n,'conversation'===t.value&&a.value&&(o.value=a.value.getScrollPosition()),t.value=e,'conversation'===e&&setTimeout(()=>{a.value&&a.value.setScrollPosition(o.value)},0)):'character'===e&&l.value?l.value.handleTabClick():'user'===e&&r.value&&r.value.handleTabClick()},y=e=>{const t=s.indexOf(e);return-1===t||t===s.length-1?e:s[t+1]},b=e=>{const t=s.indexOf(e);return-1===t||0===t?e:s[t-1]},V=e=>{a.value&&a.value.handleRenderSizeChanged&&a.value.handleRenderSizeChanged(e)},N=e=>{const t=e.touches[0];c.value=t.clientX,d.value=t.clientY,u.value=Date.now()},f=e=>{},k=e=>{const a=e.changedTouches[0],n=a.clientX-c.value,l=a.clientY-d.value,r=Date.now()-u.value;if(Math.abs(n)>20&&r<1e3&&Math.abs(n)>Math.abs(l))if(n<0){p.value='left';const e=y(t.value);E(e,!0)}else{p.value='right';const e=b(t.value);E(e,!0)}},w=e=>{m.value=!0,c.value=e.clientX,d.value=e.clientY,u.value=Date.now()},B=e=>{},C=e=>{if(!m.value)return;m.value=!1;const a=e.clientX-c.value,n=e.clientY-d.value,l=Date.now()-u.value;if(Math.abs(a)>20&&l<1e3&&Math.abs(a)>Math.abs(n))if(a<0){p.value='left';const e=y(t.value);E(e,!0)}else{p.value='right';const e=b(t.value);E(e,!0)}};return(e,o)=>((0,n.openBlock)(),(0,n.createElementBlock)('div',uE,[(0,n.createElementVNode)('div',mE,[(0,n.createCommentVNode)(' 時間顯示行 '),(0,n.createElementVNode)('div',vE,[(0,n.createElementVNode)('div',pE,(0,n.toDisplayString)(i.value),1)]),(0,n.createCommentVNode)(' 第一行標籤 '),(0,n.createElementVNode)('div',gE,[(0,n.createElementVNode)('button',{class:(0,n.normalizeClass)(['tab-button',{active:'conversation'===t.value}]),onClick:o[0]||(o[0]=e=>E('conversation'))},' 對話 ',2),(0,n.createElementVNode)('button',{class:(0,n.normalizeClass)(['tab-button',{active:'user'===t.value}]),onClick:o[1]||(o[1]=e=>E('user'))},'用戶',2),(0,n.createElementVNode)('button',{class:(0,n.normalizeClass)(['tab-button',{active:'character'===t.value}]),onClick:o[2]||(o[2]=e=>E('character'))},' 角色 ',2),(0,n.createElementVNode)('button',{class:(0,n.normalizeClass)(['tab-button',{active:'item'===t.value}]),onClick:o[3]||(o[3]=e=>E('item'))},'物品',2),(0,n.createElementVNode)('button',{class:(0,n.normalizeClass)(['tab-button',{active:'storage'===t.value}]),onClick:o[4]||(o[4]=e=>E('storage'))},'貯存',2)]),(0,n.createCommentVNode)(' 第二行標籤 '),(0,n.createElementVNode)('div',_E,[(0,n.createElementVNode)('button',{class:(0,n.normalizeClass)(['tab-button',{active:'location'===t.value}]),onClick:o[5]||(o[5]=e=>E('location'))},' 地點 ',2),(0,n.createElementVNode)('button',{class:(0,n.normalizeClass)(['tab-button',{active:'promise'===t.value}]),onClick:o[6]||(o[6]=e=>E('promise'))},' 約定 ',2),(0,n.createElementVNode)('button',{class:(0,n.normalizeClass)(['tab-button',{active:'summary'===t.value}]),onClick:o[7]||(o[7]=e=>E('summary'))},' 總結 ',2),(0,n.createElementVNode)('button',{class:(0,n.normalizeClass)(['tab-button',{active:'world_info'===t.value}]),onClick:o[8]||(o[8]=e=>E('world_info'))},' 世界 ',2),(0,n.createElementVNode)('button',{class:(0,n.normalizeClass)(['tab-button',{active:'settings'===t.value}]),onClick:o[9]||(o[9]=e=>E('settings'))},' 設置 ',2)])]),(0,n.createElementVNode)('div',{class:'main-content',onTouchstart:N,onTouchmove:f,onTouchend:k,onMousedown:w,onMousemove:B,onMouseup:C},[(0,n.createVNode)(n.Transition,{name:v.value?`slide-${p.value}`:'no-transition',mode:'out-in'},{default:(0,n.withCtx)(()=>['conversation'===t.value?((0,n.openBlock)(),(0,n.createElementBlock)('div',hE,[(0,n.createVNode)(Fd,{ref_key:'conversation_tab_ref',ref:a},null,512)])):'user'===t.value?((0,n.openBlock)(),(0,n.createElementBlock)('div',EE,[(0,n.createVNode)(Uh,{ref_key:'user_tab_ref',ref:r},null,512)])):'character'===t.value?((0,n.openBlock)(),(0,n.createElementBlock)('div',yE,[(0,n.createVNode)(dd,{ref_key:'character_tab_ref',ref:l},null,512)])):'item'===t.value?((0,n.openBlock)(),(0,n.createElementBlock)('div',bE,[(0,n.createVNode)(Eu)])):'storage'===t.value?((0,n.openBlock)(),(0,n.createElementBlock)('div',VE,[(0,n.createVNode)(Pv)])):'location'===t.value?((0,n.openBlock)(),(0,n.createElementBlock)('div',NE,[(0,n.createVNode)(km)])):'promise'===t.value?((0,n.openBlock)(),(0,n.createElementBlock)('div',fE,[(0,n.createVNode)(Up)])):'summary'===t.value?((0,n.openBlock)(),(0,n.createElementBlock)('div',kE,[(0,n.createVNode)(__)])):'world_info'===t.value?((0,n.openBlock)(),(0,n.createElementBlock)('div',wE,[(0,n.createVNode)(dE)])):'settings'===t.value?((0,n.openBlock)(),(0,n.createElementBlock)('div',BE,[(0,n.createVNode)(yg,{onRenderSizeChanged:V})])):(0,n.createCommentVNode)('v-if',!0)]),_:1},8,['name'])],32)]))}}),$E=(0,d.A)(CE,[['__scopeId','data-v-9fb68f82']]),SE={key:0,class:'initialization-wrapper'},xE=(0,n.defineComponent)({__name:'app',setup(e){const t=(0,n.ref)(!1),a=(0,n.ref)(!1),l=(0,n.ref)('100vh'),r=()=>{if(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement)l.value='100vh';else try{window.parent&&window.parent.innerHeight&&(l.value=.8*window.parent.innerHeight+'px')}catch(e){console.warn('Unable to access parent window height:',e)}},o=()=>{r()},i=()=>{try{const e=getVariables({type:'chat'});void 0===e?.is_initialized?(a.value=!1,insertOrAssignVariables({is_initialized:!1},{type:'chat'})):a.value=e.is_initialized}catch(e){console.error('Failed to load chat settings:',e)}};return(0,n.onMounted)(()=>{t.value=!0,i(),eventOn(tavern_events.CHAT_CHANGED,e=>{console.log('Chat changed to:',e),i()}),eventOn('initialization_completed',()=>{console.log('Initialization completed, switching to main interface'),a.value=!0}),(0,n.watch)(()=>getVariables({type:'chat'}),e=>{void 0!==e?.is_initialized&&(a.value=e.is_initialized)},{deep:!0}),r(),document.addEventListener('fullscreenchange',o),document.addEventListener('webkitfullscreenchange',o),document.addEventListener('mozfullscreenchange',o),document.addEventListener('MSFullscreenChange',o)}),(0,n.onUnmounted)(()=>{document.removeEventListener('fullscreenchange',o),document.removeEventListener('webkitfullscreenchange',o),document.removeEventListener('mozfullscreenchange',o),document.removeEventListener('MSFullscreenChange',o)}),(e,r)=>t.value?((0,n.openBlock)(),(0,n.createElementBlock)('div',{key:0,class:'app-container',style:(0,n.normalizeStyle)({height:l.value})},[(0,n.createCommentVNode)(' 初始化UI '),a.value?((0,n.openBlock)(),(0,n.createElementBlock)(n.Fragment,{key:1},[(0,n.createCommentVNode)(' 主要UI '),(0,n.createElementVNode)('div',null,[(0,n.createVNode)($E)])],2112)):((0,n.openBlock)(),(0,n.createElementBlock)('div',SE,[(0,n.createVNode)(Pi)]))],4)):(0,n.createCommentVNode)('v-if',!0)}}),IE=(0,d.A)(xE,[['__scopeId','data-v-e8f6a8aa']]);class DE{registry=new Map;register(e){return t=>(e||(e=t.name),this.registry.set(e,t),t)}get(e){return this.registry.get(e)}getAll(){return this.registry}has(e){return this.registry.has(e)}}var TE,ME,OE,YE,AE,RE,KE,UE,zE,LE,FE,HE,jE,PE,qE,GE,WE,XE,ZE,JE,QE,ey,ty,ay,ny,ly=function(e,t,a,n){var l,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,a):n;if('object'==typeof Reflect&&'function'==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,n);else for(var i=e.length-1;i>=0;i--)(l=e[i])&&(o=(r<3?l(o):r>3?l(t,a,o):l(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},ry=function(e,t){if('object'==typeof Reflect&&'function'==typeof Reflect.metadata)return Reflect.metadata(e,t)};class oy{static registry=new DE;constructor(...e){}static parseString(e){if(void 0===e)return[];return[...e.matchAll(this.prototype.REGEX)].map(e=>({command:this.prototype.create(e.slice(1).map(e=>e.trim())),index:e.index})).filter(({command:e})=>e.isValid())}}let iy=TE=class extends oy{delta_minutes;constructor(e){super(),this.delta_minutes=e}get REGEX(){return/deltaMinutes\(\s*([^,()]+)\s*\)/g}create(e){const t=Number(e[0]);return new TE(t)}isValid(){return!isNaN(this.delta_minutes)}execute(e,t){return e.datetime.deltaMinutes(this.delta_minutes),e}};iy=TE=ly([oy.registry.register(),ry('design:paramtypes',[Number])],iy);let sy=ME=class extends oy{current_location_id;constructor(e){super(),this.current_location_id=e}get REGEX(){return/setCurrentLocation\(\s*"([^"]+?)"\s*\s*\)/g}create(e){const t=e[0];return new ME(t)}isValid(){return!0}execute(e,t){return e.locations.has(this.current_location_id)?(e.current_location_id=this.current_location_id,e):e}};sy=ME=ly([oy.registry.register(),ry('design:paramtypes',[String])],sy);let cy=OE=class extends oy{weather;constructor(e){super(),this.weather=e}get REGEX(){return/setWeather\(\s*"([^"]+?)"\s*\s*\)/g}create(e){const t=e[0];return new OE(t)}isValid(){return!0}execute(e,t){return e.weather=this.weather,e}};cy=OE=ly([oy.registry.register(),ry('design:paramtypes',[String])],cy);let dy=YE=class extends oy{id;name;age;gender;identity;introduction;personality;height;weight;chest_size;cup_size;waist_size;hips_size;hairstyle;appearance;clothes;birthday_month;birthday_date;favourite;extra_information;money;mood;horny;constructor(e,t,a,n,l,r,o,i,s,c,d,u,m,v,p,g,h,E,y,b,V,N,f){super(),this.id=e,this.name=t,this.age=a,this.gender=n,this.identity=l,this.introduction=r,this.personality=o,this.height=i,this.weight=s,this.chest_size=c,this.cup_size=d,this.waist_size=u,this.hips_size=m,this.hairstyle=v,this.appearance=p,this.clothes=g,this.birthday_month=h,this.birthday_date=E,this.favourite=y,this.extra_information=b,this.money=V,this.mood=N,this.horny=f}get REGEX(){return/createCharacter\(\s*"([^"]+?)"\s*,\s*"([^"]+?)"\s*,\s*([^"]+?)\s*,\s*"([^"]+?)"\s*,\s*"([^"]+?)"\s*,\s*"([^"]+?)"\s*,\s*"([^"]+?)"\s*,\s*([^"]+?)\s*,\s*([^"]+?)\s*,\s*([^"]+?)\s*,\s*"([^"]+?)"\s*,\s*([^"]+?)\s*,\s*([^"]+?)\s*,\s*"([^"]+?)"\s*,\s*"([^"]+?)"\s*,\s*"([^"]+?)"\s*,\s*([^"]+?)\s*,\s*([^"]+?)\s*,\s*"([^"]+?)"\s*,\s*"([^"]*?)"\s*,\s*([^"]+?)\s*,\s*([^"]+?)\s*,\s*([^"]+?)\s*\)/g}create(e){const t=e[0],a=e[1],n=Number(e[2]),l=e[3],r=e[4],o=e[5],i=e[6],s=Number(e[7]),c=Number(e[8]),d=Number(e[9]),u=e[10],m=Number(e[11]),v=Number(e[12]),p=e[13],g=e[14],h=e[15],E=Number(e[16]),y=Number(e[17]),b=e[18],V=e[19],N=Number(e[20]),f=Number(e[21]),k=Number(e[22]);return new YE(t,a,n,l,r,o,i,s,c,d,u,m,v,p,g,h,E,y,b,V,N,f,k)}isValid(){return!isNaN(this.age)&&(!isNaN(this.height)&&(!isNaN(this.weight)&&(!isNaN(this.chest_size)&&(!isNaN(this.waist_size)&&(!isNaN(this.hips_size)&&(!isNaN(this.birthday_month)&&(!isNaN(this.birthday_date)&&(!isNaN(this.money)&&(!isNaN(this.mood)&&!isNaN(this.horny))))))))))}execute(e,t){if(e.hasCharacter(this.id))return e;let a=e.datetime.year-this.age;(e.datetime.month<this.birthday_month||e.datetime.month===this.birthday_month&&e.datetime.date<this.birthday_date)&&(a-=1);const n=new Il(new Date(a,this.birthday_month,this.birthday_date)),l=new Dl(this.name,this.age,this.gender,this.identity,this.introduction,this.personality,this.height,this.weight,this.chest_size,this.cup_size,this.waist_size,this.hips_size,this.hairstyle,this.appearance,this.clothes,n,this.favourite,this.extra_information,this.money,this.mood,this.horny,new Map,new Map,new Map,new Map);return e.active_characters.set(this.id,l),e}};dy=YE=ly([oy.registry.register(),ry('design:paramtypes',[String,String,Number,String,String,String,String,Number,Number,Number,String,Number,Number,String,String,String,Number,Number,String,String,Number,Number,Number])],dy);let uy=AE=class extends oy{id;delta;constructor(e,t){super(),this.id=e,this.delta=t}get REGEX(){return/deltaMoney\(\s*"([^"]+?)"\s*,\s*([^,()]+)\s*\)/g}create(e){const t=e[0],a=Number(e[1]);return new AE(t,a)}isValid(){return!isNaN(this.delta)}execute(e,t){const a=e.getCharacter(this.id),n=e.storages.get(this.id);return a||n?(a?a.money+=this.delta:n.money+=this.delta,e):e}};uy=AE=ly([oy.registry.register(),ry('design:paramtypes',[String,Number])],uy);let my=RE=class extends oy{from_id;to_id;delta;constructor(e,t,a){super(),this.from_id=e,this.to_id=t,this.delta=a}get REGEX(){return/deltaFriendship\(\s*"([^"]+?)"\s*,\s*"([^"]+?)"\s*,\s*([^,()]+)\s*\)/g}create(e){const t=e[0],a=e[1],n=Number(e[2]);return new RE(t,a,n)}isValid(){return!isNaN(this.delta)}execute(e,t){if(!e.hasCharacter(this.from_id))return e;if(!e.hasCharacter(this.to_id))return e;const a=e.getCharacter(this.from_id);return a?(a.deltaFriendship(this.to_id,this.delta),e):e}};my=RE=ly([oy.registry.register(),ry('design:paramtypes',[String,String,Number])],my);let vy=KE=class extends oy{from_id;to_id;delta;constructor(e,t,a){super(),this.from_id=e,this.to_id=t,this.delta=a}get REGEX(){return/deltaLove\(\s*"([^"]+?)"\s*,\s*"([^"]+?)"\s*,\s*([^,()]+)\s*\)/g}create(e){const t=e[0],a=e[1],n=Number(e[2]);return new KE(t,a,n)}isValid(){return!isNaN(this.delta)}execute(e,t){if(!e.hasCharacter(this.from_id))return e;if(!e.hasCharacter(this.to_id))return e;const a=e.getCharacter(this.from_id);return a?(a.deltaLove(this.to_id,this.delta),e):e}};vy=KE=ly([oy.registry.register(),ry('design:paramtypes',[String,String,Number])],vy);let py=UE=class extends oy{id;delta;constructor(e,t){super(),this.id=e,this.delta=t}get REGEX(){return/deltaMood\(\s*"([^"]+?)"\s*,\s*([^,()]+)\s*\)/g}create(e){const t=e[0],a=Number(e[1]);return new UE(t,a)}isValid(){return!isNaN(this.delta)}execute(e,t){const a=e.getCharacter(this.id);return a?(a.deltaMood(this.delta),e):e}};py=UE=ly([oy.registry.register(),ry('design:paramtypes',[String,Number])],py);let gy=zE=class extends oy{id;delta;constructor(e,t){super(),this.id=e,this.delta=t}get REGEX(){return/deltaHorny\(\s*"([^"]+?)"\s*,\s*([^,()]+)\s*\)/g}create(e){const t=e[0],a=Number(e[1]);return new zE(t,a)}isValid(){return!isNaN(this.delta)}execute(e,t){const a=e.getCharacter(this.id);return a?(a.deltaHorny(this.delta),e):e}};gy=zE=ly([oy.registry.register(),ry('design:paramtypes',[String,Number])],gy);let _y=LE=class extends oy{from_id;to_id;relation;constructor(e,t,a){super(),this.from_id=e,this.to_id=t,this.relation=a}get REGEX(){return/setRelation\(\s*"([^"]+?)"\s*,\s*"([^"]+?)"\s*,\s*"([^"]+?)"\s*\)/g}create(e){const t=e[0],a=e[1],n=e[2];return new LE(t,a,n)}isValid(){return!0}execute(e,t){if(!e.hasCharacter(this.from_id))return e;if(!e.hasCharacter(this.to_id))return e;const a=e.getCharacter(this.from_id);return a?(a.relations.set(this.to_id,this.relation),e):e}};_y=LE=ly([oy.registry.register(),ry('design:paramtypes',[String,String,String])],_y);let hy=FE=class extends oy{id;key;value;constructor(e,t,a){super(),this.id=e,this.key=t,this.value=a}get REGEX(){return/setCharacterProperty\(\s*"([^"]+?)"\s*,\s*"([^"]+?)"\s*,\s*"([^"]+?)"\s*\)/g}create(e){const t=e[0],a=e[1],n=e[2];return new FE(t,a,n)}isValid(){return[Dl.IDENTITY_KEY,Dl.INTRODUCTION_KEY,Dl.PERSONALITY_KEY,Dl.HAIRSTYLE_KEY,Dl.APPEARANCE_KEY,Dl.CLOTHES_KEY,Dl.FAVOURITE_KEY,Dl.EXTRA_INFORMATION_KEY].includes(this.key)}execute(e,t){const a=e.getCharacter(this.id);if(!a)return e;switch(this.key){case Dl.IDENTITY_KEY:a.identity=this.value;break;case Dl.INTRODUCTION_KEY:a.introduction=this.value;break;case Dl.PERSONALITY_KEY:a.personality=this.value;break;case Dl.HAIRSTYLE_KEY:a.hairstyle=this.value;break;case Dl.APPEARANCE_KEY:a.appearance=this.value;break;case Dl.CLOTHES_KEY:a.clothes=this.value;break;case Dl.FAVOURITE_KEY:a.favourite=this.value;break;case Dl.EXTRA_INFORMATION_KEY:a.extra_information=this.value}return e}};hy=FE=ly([oy.registry.register(),ry('design:paramtypes',[String,String,String])],hy);let Ey=HE=class extends oy{id;name;description;value;constructor(e,t,a,n){super(),this.id=e,this.name=t,this.description=a,this.value=n}get REGEX(){return/createItem\(\s*"([^"]+?)"\s*,\s*"([^"]+?)"\s*,\s*"([^"]+?)"\s*,\s*([^,()]+)\s*\)/g}create(e){const t=e[0],a=e[1],n=e[2],l=Number(e[3]);return new HE(t,a,n,l)}isValid(){return!isNaN(this.value)}execute(e,t){if(e.items.has(this.id))return e;const a=new Tl(this.name,this.description,this.value);return e.items.set(this.id,a),e}};Ey=HE=ly([oy.registry.register(),ry('design:paramtypes',[String,String,String,Number])],Ey);let yy=jE=class extends oy{id;item_id;delta;constructor(e,t,a){super(),this.id=e,this.item_id=t,this.delta=a}get REGEX(){return/deltaInventory\(\s*"([^"]+?)"\s*,\s*"([^"]+?)"\s*,\s*([^,()]+)\s*\)/g}create(e){const t=e[0],a=e[1],n=Number(e[2]);return new jE(t,a,n)}isValid(){return!isNaN(this.delta)}execute(e,t){if(!e.items.has(this.item_id))return e;const a=e.getCharacter(this.id),n=e.storages.get(this.id);if(!a&&!n)return e;const l=a?a.inventory:n.inventory;let r=l.get(this.item_id)||0;return r+=this.delta,r<=0?l.delete(this.item_id):l.set(this.item_id,r),e}};yy=jE=ly([oy.registry.register(),ry('design:paramtypes',[String,String,Number])],yy);let by=PE=class extends oy{id;name;description;parent_id;constructor(e,t,a,n){super(),this.id=e,this.name=t,this.description=a,this.parent_id=n}get REGEX(){return/createStorage\(\s*"([^"]+?)"\s*,\s*"([^"]+?)"\s*,\s*"([^"]+?)"\s*,\s*"([^"]+?)"\s*\)/g}create(e){const t=e[0],a=e[1],n=e[2],l=e[3];return new PE(t,a,n,l)}isValid(){return''!==this.id.trim()&&(''!==this.name.trim()&&(''!==this.description.trim()&&''!==this.parent_id.trim()))}execute(e,t){return e.addStorage(this.id,this.name,this.description,this.parent_id),e}};by=PE=ly([oy.registry.register(),ry('design:paramtypes',[String,String,String,String])],by);let Vy=qE=class extends oy{id;constructor(e){super(),this.id=e}get REGEX(){return/removeStorage\(\s*"([^"]+?)"\s*\)/g}create(e){const t=e[0];return new qE(t)}isValid(){return''!==this.id.trim()}execute(e,t){return e.removeStorage(this.id),e}};Vy=qE=ly([oy.registry.register(),ry('design:paramtypes',[String])],Vy);let Ny=GE=class extends oy{storage_id;parent_id;constructor(e,t){super(),this.storage_id=e,this.parent_id=t}get REGEX(){return/setStorageParent\(\s*"([^"]+?)"\s*,\s*"([^"]+?)"\s*\)/g}create(e){const t=e[0],a=e[1];return new GE(t,a)}isValid(){return''!==this.storage_id.trim()&&''!==this.parent_id.trim()}execute(e,t){return e.setStorageParent(this.storage_id,this.parent_id),e}};Ny=GE=ly([oy.registry.register(),ry('design:paramtypes',[String,String])],Ny);let fy=WE=class extends oy{id;name;location;description;constructor(e,t,a,n){super(),this.id=e,this.name=t,this.location=a,this.description=n}get REGEX(){return/createLocation\(\s*"([^"]+?)"\s*,\s*"([^"]+?)"\s*,\s*"([^"]+?)"\s*,\s*"([^"]+?)"\s*\)/g}create(e){const t=e[0],a=e[1],n=e[2],l=e[3];return new WE(t,a,n,l)}isValid(){return''!==this.id.trim()&&(''!==this.name.trim()&&(''!==this.location.trim()&&''!==this.description.trim()))}execute(e,t){if(e.locations.has(this.id))return e;const a=new Ml(this.id,this.name,this.location,this.description,null,[],[]);return e.locations.set(this.id,a),e}};fy=WE=ly([oy.registry.register(),ry('design:paramtypes',[String,String,String,String])],fy);let ky=XE=class extends oy{parent_location_id;sub_location_id;constructor(e,t){super(),this.parent_location_id=e,this.sub_location_id=t}get REGEX(){return/addSubLocation\(\s*"([^"]+?)"\s*,\s*"([^"]+?)"\s*\)/g}create(e){const t=e[0],a=e[1];return new XE(t,a)}isValid(){return''!==this.parent_location_id.trim()&&''!==this.sub_location_id.trim()}execute(e,t){const a=e.locations.get(this.parent_location_id);if(!a)return e;const n=e.locations.get(this.sub_location_id);return n?(null!==n.parent_location_id||a.sub_location_ids.includes(this.sub_location_id)||(a.sub_location_ids.push(this.sub_location_id),n.parent_location_id=this.parent_location_id),e):e}};ky=XE=ly([oy.registry.register(),ry('design:paramtypes',[String,String])],ky);let wy=ZE=class extends oy{id;description;constructor(e,t){super(),this.id=e,this.description=t}get REGEX(){return/setLocationDescription\(\s*"([^"]+?)"\s*,\s*"([^"]+?)"\s*\)/g}create(e){const t=e[0],a=e[1];return new ZE(t,a)}isValid(){return''!==this.id.trim()}execute(e,t){const a=e.locations.get(this.id);return a?(a.description=this.description,e):e}};wy=ZE=ly([oy.registry.register(),ry('design:paramtypes',[String,String])],wy);let By=JE=class extends oy{deadline_year;deadline_month;deadline_date;deadline_hours;deadline_minutes;character_ids;location_id;description;constructor(e,t,a,n,l,r,o,i){super(),this.deadline_year=e,this.deadline_month=t,this.deadline_date=a,this.deadline_hours=n,this.deadline_minutes=l,this.character_ids=r,this.location_id=o,this.description=i}get REGEX(){return/createPromise\(\s*([^,()]+)\s*,\s*([^,()]+)\s*,\s*([^,()]+)\s*,\s*([^,()]+)\s*,\s*([^,()]+)\s*,\s*"([^"]+?)"\s*,\s*"([^"]*?)"\s*,\s*"([^"]+?)"\s*\)/g}create(e){const t=Number(e[0]),a=Number(e[1]),n=Number(e[2]),l=Number(e[3]),r=Number(e[4]),o=e[5],i=e[6],s=e[7],c=o.split(',').map(e=>e.trim());return new JE(t,a,n,l,r,c,i,s)}isValid(){return!isNaN(this.deadline_year)&&(!isNaN(this.deadline_month)&&(!isNaN(this.deadline_date)&&(!isNaN(this.deadline_hours)&&!isNaN(this.deadline_minutes))))}execute(e,t){if(''!==this.location_id&&!e.locations.has(this.location_id))return e;for(const t of this.character_ids)if(!e.hasCharacter(t))return e;const a=new Il(new Date(this.deadline_year,this.deadline_month-1,this.deadline_date,this.deadline_hours,this.deadline_minutes)),n=''===this.location_id?null:this.location_id;return e.addPromise(a,this.character_ids,n,this.description),e}};By=JE=ly([oy.registry.register(),ry('design:paramtypes',[Number,Number,Number,Number,Number,Array,String,String])],By);let Cy=QE=class extends oy{id;constructor(e){super(),this.id=e}get REGEX(){return/removePromise\(\s*"([^,()]+)"\s*\)/g}create(e){const t=e[0];return new QE(t)}isValid(){return''!==this.id.trim()}execute(e,t){return e.promises.has(this.id)?(e.promises.delete(this.id),e):e}};Cy=QE=ly([oy.registry.register(),ry('design:paramtypes',[String])],Cy);let $y=ey=class extends oy{event;constructor(e){super(),this.event=e}get REGEX(){return/startEvent\(\s*"([^"]+)"\s*\)/g}create(e){const t=e[0];return new ey(t)}isValid(){return''!==this.event.trim()}execute(e,t){return e.current_event=this.event,e}};$y=ey=ly([oy.registry.register(),ry('design:paramtypes',[String])],$y);let Sy=ty=class extends oy{summary;weighting;constructor(e,t){super(),this.summary=e,this.weighting=t}get REGEX(){return/finishEvent\(\s*"([^"]+)"\s*,\s*([^,()]+)\s*\)/g}create(e){const t=e[0],a=Number(e[1]);return new ty(t,a)}isValid(){return''!==this.summary.trim()&&!isNaN(this.weighting)}execute(e,t){return e.addSummary(this.summary,this.weighting,t),e.current_event=Rl.CURRENT_EVENT_NULL_VALUE,e}};Sy=ty=ly([oy.registry.register(),ry('design:paramtypes',[String,Number])],Sy);let xy=ay=class extends oy{id;constructor(e){super(),this.id=e}get REGEX(){return/activateCharacter\(\s*"([^"]+)"\s*\)/g}create(e){const t=e[0];return new ay(t)}isValid(){return''!==this.id.trim()}execute(e,t){if(!e.deactive_characters.has(this.id))return e;const a=e.deactive_characters.get(this.id);return e.active_characters.set(this.id,a),e.deactive_characters.delete(this.id),e}};xy=ay=ly([oy.registry.register(),ry('design:paramtypes',[String])],xy);let Iy=ny=class extends oy{id;constructor(e){super(),this.id=e}get REGEX(){return/deactivateCharacter\(\s*"([^"]+)"\s*\)/g}create(e){const t=e[0];return new ny(t)}isValid(){return''!==this.id.trim()}execute(e,t){if(!e.active_characters.has(this.id))return e;const a=e.active_characters.get(this.id);return e.deactive_characters.set(this.id,a),e.active_characters.delete(this.id),e}};Iy=ny=ly([oy.registry.register(),ry('design:paramtypes',[String])],Iy);class Dy{commands=[];constructor(e){this.commands=e??[]}pushCommand(e){this.commands.push(e)}static fromString(e){if(!e.includes('<VariableUpdate>'))return new Dy;const t=e.split('<VariableUpdate>'),a=t[t.length-1].split('</VariableUpdate>')[0];let n=[];for(const e of oy.registry.getAll().values())n=n.concat(e.parseString(a));n.sort((e,t)=>e.index-t.index);const l=n.map(e=>e.command);return console.log('[Commands] commands:',l),new Dy(l)}execute(e,t){for(const a of this.commands)a.execute(e,t);return e}*[Symbol.iterator](){for(const e of this.commands)yield e}}eventOn('MESSAGE_SENT',e=>{console.log('[event_listener] MESSAGE_SENT start');const t=Rl.loadFromVariable(e-1),a=getChatMessages(e)[0].message;Dy.fromString(a).execute(t,e),t.saveAsVariable(e),console.log('[event_listener] MESSAGE_SENT end')}),eventOn('MESSAGE_RECEIVED',e=>{console.log('[event_listener] MESSAGE_RECEIVED start');const t=Rl.loadFromVariable(e-1),a=getChatMessages(e)[0].message;Dy.fromString(a).execute(t,e),t.saveAsVariable(e),console.log('[event_listener] MESSAGE_RECEIVED end'),eventEmit('MESSAGE_RECEIVED_PROCESSED',e)}),$(()=>{(0,n.createApp)(IE).mount('#app')});</script><style>.fold-bar[data-v-112e8be8]{background:rgba(0,0,0,0);border:none;border-radius:0;box-shadow:none;font-size:14px;font-weight:500;color:#e0e0e0;padding:0;margin:0}.fold-bar-header[data-v-112e8be8]{margin-bottom:0;padding-bottom:0;display:flex;align-items:center;justify-content:flex-start;position:relative}.fold-bar-header-actions[data-v-112e8be8]{display:flex;align-items:center;gap:8px;position:absolute;right:0;top:0;bottom:0}.fold-bar-btn[data-v-112e8be8]{cursor:pointer;display:flex;align-items:center;background:#333;border:1px solid #404040;border-bottom:none;flex:1;text-align:left;color:#e0e0e0;font-size:14px;font-weight:500;padding:6px 12px;border-radius:0}.fold-bar-title-actions[data-v-112e8be8]{display:flex;align-items:center;gap:4px;margin-left:auto;margin-right:8px}.fold-bar-btn[data-v-112e8be8]:hover{background:#404040}.fold-bar-btn[data-v-112e8be8]:focus{outline:none}.fold-bar-toggle-icon[data-v-112e8be8]{margin-left:8px;flex-shrink:0;font-size:12px;color:#b0b0b0;transition:transform .3s ease}.fold-bar-toggle-icon[data-v-112e8be8]::before{content:"▼"}.fold-bar-toggle-icon.open[data-v-112e8be8]{transform:rotate(180deg)}.fold-bar-content[data-v-112e8be8]{max-height:0;overflow:hidden;transition:max-height .3s ease;background:#1a1a1a;border:1px solid #404040;border-top:none;padding:0}.fold-bar-content.open[data-v-112e8be8]{overflow-y:auto;scrollbar-width:none;-ms-overflow-style:none}.fold-bar-content.open[data-v-112e8be8]::-webkit-scrollbar{display:none}.fold-bar-content-text[data-v-112e8be8]{padding:0 12px}.fold-bar-footer-toggle[data-v-112e8be8]{text-align:center;color:#888;font-size:12px;cursor:pointer;margin-top:8px;padding:8px 12px;border-top:1px solid #404040;background:#333}.fold-bar-footer-toggle[data-v-112e8be8]:hover{color:#b0b0b0;background:#404040}@media (max-width:768px){.fold-bar-btn[data-v-112e8be8]{font-size:12px}.fold-bar-footer-toggle[data-v-112e8be8]{font-size:11px}}
.character-tabs-container[data-v-41c909bc]{color:#e0e0e0;max-width:1000px;margin:0 auto;padding:16px}.character-tabs-container h3[data-v-41c909bc]{color:#007acc;margin-bottom:24px;font-size:20px}.character-fold-bar[data-v-41c909bc]{margin-bottom:16px}.character-fold-bar[data-v-41c909bc] .fold-bar-btn{background:linear-gradient(135deg,#2a2a2a 0%,#333333 100%);border:1px solid #555;box-shadow:0 2px 8px rgba(0,0,0,.3);padding:12px 16px;font-size:16px;font-weight:600;color:#e0e0e0;transition:all .3s ease}.character-fold-bar[data-v-41c909bc] .fold-bar-btn:hover{background:linear-gradient(135deg,#333333 0%,#404040 100%);border-color:#666;box-shadow:0 4px 12px rgba(0,0,0,.4)}.character-fold-bar[data-v-41c909bc] .fold-bar-content{background:linear-gradient(135deg,#1a1a1a 0%,#222222 100%);border:1px solid #555;border-top:none;box-shadow:0 2px 8px rgba(0,0,0,.3)}.character-fold-bar[data-v-41c909bc] .fold-bar-content-text{padding:20px}.character-fold-bar[data-v-41c909bc] .fold-bar-footer-toggle{background:linear-gradient(135deg,#2a2a2a 0%,#333333 100%);border-top:1px solid #555;color:#b0b0b0;font-size:13px;font-weight:500;padding:12px 16px;transition:all .3s ease}.character-fold-bar[data-v-41c909bc] .fold-bar-footer-toggle:hover{background:linear-gradient(135deg,#333333 0%,#404040 100%);color:#e0e0e0;border-color:#666}.character-fold-bar[data-v-41c909bc] .fold-bar-toggle-icon{color:#007acc;font-size:14px;font-weight:bold}.character-fold-bar.character-incomplete[data-v-41c909bc] .fold-bar-btn span{color:#ff6b6b !important}.remove-character-btn[data-v-41c909bc]{background:#b91c1c;border:1px solid #b91c1c;border-radius:3px;color:#fff;font-size:16px;font-weight:bold;width:20px;height:20px;display:flex;align-items:center;justify-content:center;cursor:pointer}.remove-character-btn span[data-v-41c909bc]{line-height:1;margin-top:-1px}.character-info-container .section[data-v-41c909bc]{margin-bottom:16px}.section[data-v-41c909bc]{background-color:#2a2a2a;padding:20px;border-radius:12px;border:1px solid #404040;margin-bottom:20px}.section h4[data-v-41c909bc]{color:#b0b0b0;margin-bottom:16px;font-size:16px;border-bottom:1px solid #404040;padding-bottom:8px}.form-grid[data-v-41c909bc]{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:16px}.input-group.full-width[data-v-41c909bc]{grid-column:1/-1}.input-group label[data-v-41c909bc]{display:block;margin-bottom:8px;color:#b0b0b0;font-weight:500}.text-input[data-v-41c909bc]{width:100%;padding:12px 16px;background-color:#1a1a1a;border:1px solid #404040;border-radius:8px;color:#e0e0e0;font-size:14px;outline:none;transition:border-color .2s ease}.text-input[data-v-41c909bc]:focus{border-color:#007acc}.text-input[data-v-41c909bc]::placeholder{color:#666}.text-area[data-v-41c909bc]{width:100%;padding:12px 16px;background-color:#1a1a1a;border:1px solid #404040;border-radius:8px;color:#e0e0e0;font-size:14px;font-family:inherit;outline:none;resize:vertical;min-height:80px;transition:border-color .2s ease}.text-area[data-v-41c909bc]:focus{border-color:#007acc}.text-area[data-v-41c909bc]::placeholder{color:#666}.birthday-inputs[data-v-41c909bc]{display:flex;gap:8px}.birthday-inputs .birthday-input[data-v-41c909bc]{flex:1;padding:12px 16px;background-color:#1a1a1a;border:1px solid #404040;border-radius:8px;color:#e0e0e0;font-size:14px;outline:none;transition:border-color .2s ease}.birthday-inputs .birthday-input[data-v-41c909bc]:focus{border-color:#007acc}.birthday-inputs .birthday-input[data-v-41c909bc]::placeholder{color:#666}.relations-list[data-v-41c909bc]{display:flex;flex-direction:column;gap:8px}.relation-item[data-v-41c909bc]{display:flex;align-items:center;flex-wrap:wrap;gap:8px;padding:12px;background:linear-gradient(135deg,#1e1e1e 0%,#252525 100%);border:1px solid #555;border-radius:8px;box-shadow:0 2px 4px rgba(0,0,0,.2);transition:border-color .2s ease}.relation-item[data-v-41c909bc]:hover{border-color:#666}.relation-item .relation-target[data-v-41c909bc]{color:#4fc3f7;font-weight:600;font-size:13px;flex-shrink:0;min-width:60px;padding:6px 8px;background-color:#2a2a2a;border-radius:4px;text-align:center}.relation-item .relation-input[data-v-41c909bc]{flex:1;min-width:120px;padding:10px 14px;background-color:#1a1a1a;border:1px solid #404040;border-radius:6px;color:#e0e0e0;font-size:14px;outline:none;transition:all .2s ease}.relation-item .relation-input[data-v-41c909bc]:focus{border-color:#007acc;box-shadow:0 0 0 2px rgba(0,122,204,.2)}.relation-item .relation-input[data-v-41c909bc]::placeholder{color:#888}.relation-item .remove-relation-btn[data-v-41c909bc]{background:linear-gradient(135deg,#dc3545 0%,#c82333 100%);border:1px solid #dc3545;border-radius:6px;color:#fff;font-size:14px;font-weight:bold;width:24px;height:24px;flex-shrink:0;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .2s ease;box-shadow:0 2px 4px rgba(220,53,69,.3)}.relation-item .remove-relation-btn[data-v-41c909bc]:hover{background:linear-gradient(135deg,#c82333 0%,#a02622 100%);border-color:#bd2130;transform:translateY(-1px);box-shadow:0 4px 8px rgba(220,53,69,.4)}.relation-item .remove-relation-btn[data-v-41c909bc]:active{transform:translateY(0)}.add-relation[data-v-41c909bc]{display:flex;flex-wrap:wrap;gap:8px;align-items:center;padding:12px;background:linear-gradient(135deg,#252525 0%,#2a2a2a 100%);border:1px solid #555;border-radius:8px;margin-top:12px}.add-relation .relation-select[data-v-41c909bc]{flex:1;min-width:150px;padding:12px 16px;background-color:#1a1a1a;border:1px solid #404040;border-radius:6px;color:#e0e0e0;font-size:14px;outline:none;transition:all .2s ease}.add-relation .relation-select[data-v-41c909bc]:focus{border-color:#007acc;box-shadow:0 0 0 2px rgba(0,122,204,.2)}.add-relation .add-relation-btn[data-v-41c909bc]{flex-shrink:0;padding:10px 16px;background:linear-gradient(135deg,#28a745 0%,#20c997 100%);border:1px solid #28a745;border-radius:6px;color:#fff;font-size:14px;font-weight:500;cursor:pointer;transition:all .2s ease;box-shadow:0 2px 4px rgba(40,167,69,.3)}.add-relation .add-relation-btn[data-v-41c909bc]:hover:not(:disabled){background:linear-gradient(135deg,#218838 0%,#1aa085 100%);border-color:#218838;transform:translateY(-1px);box-shadow:0 4px 8px rgba(40,167,69,.4)}.add-relation .add-relation-btn[data-v-41c909bc]:disabled{background-color:#666;border-color:#666;cursor:not-allowed;box-shadow:none;transform:none}.add-relation .add-relation-btn[data-v-41c909bc]:active{transform:translateY(0)}.inventory-list[data-v-41c909bc]{display:flex;flex-direction:column;gap:8px}.inventory-item[data-v-41c909bc]{display:flex;align-items:center;flex-wrap:wrap;gap:8px;padding:12px;background:linear-gradient(135deg,#1e1e1e 0%,#252525 100%);border:1px solid #555;border-radius:8px;box-shadow:0 2px 4px rgba(0,0,0,.2);transition:border-color .2s ease}.inventory-item[data-v-41c909bc]:hover{border-color:#666}.inventory-item .inventory-target[data-v-41c909bc]{color:#4fc3f7;font-weight:600;font-size:13px;flex-shrink:0;min-width:60px;padding:6px 8px;background-color:#2a2a2a;border-radius:4px;text-align:center}.inventory-item .inventory-input[data-v-41c909bc]{flex:1;min-width:120px;padding:10px 14px;background-color:#1a1a1a;border:1px solid #404040;border-radius:6px;color:#e0e0e0;font-size:14px;outline:none;transition:all .2s ease}.inventory-item .inventory-input[data-v-41c909bc]:focus{border-color:#007acc;box-shadow:0 0 0 2px rgba(0,122,204,.2)}.inventory-item .inventory-input[data-v-41c909bc]::placeholder{color:#888}.inventory-item .remove-inventory-btn[data-v-41c909bc]{background:linear-gradient(135deg,#dc3545 0%,#c82333 100%);border:1px solid #dc3545;border-radius:6px;color:#fff;font-size:14px;font-weight:bold;width:24px;height:24px;flex-shrink:0;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .2s ease;box-shadow:0 2px 4px rgba(220,53,69,.3)}.inventory-item .remove-inventory-btn[data-v-41c909bc]:hover{background:linear-gradient(135deg,#c82333 0%,#a02622 100%);border-color:#bd2130;transform:translateY(-1px);box-shadow:0 4px 8px rgba(220,53,69,.4)}.inventory-item .remove-inventory-btn[data-v-41c909bc]:active{transform:translateY(0)}.add-inventory[data-v-41c909bc]{display:flex;flex-wrap:wrap;gap:8px;align-items:center;padding:12px;background:linear-gradient(135deg,#252525 0%,#2a2a2a 100%);border:1px solid #555;border-radius:8px;margin-top:12px}.add-inventory .inventory-select[data-v-41c909bc]{flex:1;min-width:150px;padding:12px 16px;background-color:#1a1a1a;border:1px solid #404040;border-radius:6px;color:#e0e0e0;font-size:14px;outline:none;transition:all .2s ease}.add-inventory .inventory-select[data-v-41c909bc]:focus{border-color:#007acc;box-shadow:0 0 0 2px rgba(0,122,204,.2)}.add-inventory .quantity-input[data-v-41c909bc]{flex:1;min-width:80px;padding:12px 16px;background-color:#1a1a1a;border:1px solid #404040;border-radius:6px;color:#e0e0e0;font-size:14px;outline:none;transition:all .2s ease}.add-inventory .quantity-input[data-v-41c909bc]:focus{border-color:#007acc;box-shadow:0 0 0 2px rgba(0,122,204,.2)}.add-inventory .quantity-input[data-v-41c909bc]::placeholder{color:#888}.add-inventory .quantity-input[data-v-41c909bc]:disabled{background-color:#333;color:#666;cursor:not-allowed}.add-inventory .add-inventory-btn[data-v-41c909bc]{flex-shrink:0;padding:10px 16px;background:linear-gradient(135deg,#28a745 0%,#20c997 100%);border:1px solid #28a745;border-radius:6px;color:#fff;font-size:14px;font-weight:500;cursor:pointer;transition:all .2s ease;box-shadow:0 2px 4px rgba(40,167,69,.3)}.add-inventory .add-inventory-btn[data-v-41c909bc]:hover:not(:disabled){background:linear-gradient(135deg,#218838 0%,#1aa085 100%);border-color:#218838;transform:translateY(-1px);box-shadow:0 4px 8px rgba(40,167,69,.4)}.add-inventory .add-inventory-btn[data-v-41c909bc]:disabled{background-color:#666;border-color:#666;cursor:not-allowed;box-shadow:none;transform:none}.add-inventory .add-inventory-btn[data-v-41c909bc]:active{transform:translateY(0)}.generated-result[data-v-41c909bc]{margin-top:8px;padding:8px;background-color:#1a1a1a;border:1px solid #404040;border-radius:6px}.generated-result label[data-v-41c909bc]{display:block;margin-bottom:4px;color:#007acc;font-size:12px;font-weight:500}.generated-result .generated-text[data-v-41c909bc]{color:#e0e0e0;font-size:14px;margin-bottom:8px;word-wrap:break-word}.generated-result .replace-btn[data-v-41c909bc]{padding:6px 12px;background-color:#28a745;border:none;border-radius:4px;color:#fff;font-size:12px;font-weight:500;cursor:pointer;transition:background-color .2s ease}.generated-result .replace-btn[data-v-41c909bc]:hover{background-color:#218838}.action-section[data-v-41c909bc]{display:flex;justify-content:space-between;gap:16px;padding:20px 0}.action-section .generate-btn[data-v-41c909bc],.action-section .apply-all-btn[data-v-41c909bc]{flex:1;max-width:none}.add-character-section[data-v-41c909bc]{display:flex;justify-content:center;padding:20px 0;margin-top:20px;border-top:1px solid #404040}.add-character-btn[data-v-41c909bc]{padding:12px 24px;background:linear-gradient(135deg,#28a745 0%,#20c997 100%);border:1px solid #28a745;border-radius:8px;color:#fff;font-size:16px;font-weight:500;cursor:pointer;transition:all .3s ease;display:flex;align-items:center;gap:8px}.add-character-btn[data-v-41c909bc]:hover:not(:disabled){background:linear-gradient(135deg,#218838 0%,#1aa085 100%);border-color:#218838;transform:translateY(-1px);box-shadow:0 4px 12px rgba(40,167,69,.3)}.add-character-btn span[data-v-41c909bc]{font-size:18px;font-weight:bold}.generate-btn[data-v-41c909bc]{padding:14px 32px;background-color:#28a745;border:none;border-radius:8px;color:#fff;font-size:16px;font-weight:500;cursor:pointer;transition:background-color .2s ease;display:flex;align-items:center;justify-content:center;gap:8px}.generate-btn[data-v-41c909bc]:hover:not(:disabled){background-color:#218838}.generate-btn[data-v-41c909bc]:disabled{background-color:#666;cursor:not-allowed}.loading-spinner[data-v-41c909bc]{width:16px;height:16px;border:2px solid #fff;border-top:2px solid rgba(0,0,0,0);border-radius:50%;animation:spin-41c909bc 1s linear infinite}@keyframes spin-41c909bc{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}.apply-all-btn[data-v-41c909bc]{padding:14px 32px;background-color:#007acc;border:none;border-radius:8px;color:#fff;font-size:16px;font-weight:500;cursor:pointer;transition:background-color .2s ease}.apply-all-btn[data-v-41c909bc]:hover:not(:disabled){background-color:#0056b3}.apply-all-btn[data-v-41c909bc]:disabled{background-color:#666;cursor:not-allowed}@media (max-width:768px){.section[data-v-41c909bc]{padding:16px}.form-grid[data-v-41c909bc]{grid-template-columns:1fr}.input-group.full-width[data-v-41c909bc]{grid-column:1}.birthday-inputs[data-v-41c909bc]{flex-direction:column}.info-item[data-v-41c909bc]{flex-direction:column;align-items:flex-start;gap:4px}.info-item label[data-v-41c909bc]{min-width:unset}.character-tabs-container[data-v-41c909bc]{max-width:100%;margin:0}.action-section[data-v-41c909bc]{flex-direction:row;align-items:stretch;gap:12px}.action-section .generate-btn[data-v-41c909bc],.action-section .apply-all-btn[data-v-41c909bc]{flex:1;width:auto;max-width:none}.add-character-section[data-v-41c909bc]{padding:16px 0;margin-top:16px}.add-character-btn[data-v-41c909bc]{padding:10px 20px;font-size:14px}.add-character-btn span[data-v-41c909bc]{font-size:16px}.remove-character-btn[data-v-41c909bc]{width:20px;height:20px;font-size:14px}}
.extra-container[data-v-09fb0ec2]{color:#e0e0e0;max-width:1000px;margin:0 0;padding:16px}.extra-container h3[data-v-09fb0ec2]{color:#007acc;margin-bottom:24px;font-size:20px}.section[data-v-09fb0ec2]{background-color:#2a2a2a;padding:20px;border-radius:12px;border:1px solid #404040;margin-bottom:20px}.section h4[data-v-09fb0ec2]{color:#b0b0b0;margin-bottom:16px;font-size:16px;border-bottom:1px solid #404040;padding-bottom:8px}.sortable-container[data-v-09fb0ec2]{margin-bottom:16px}.sortable-item[data-v-09fb0ec2]{margin-bottom:8px;transition:all .2s ease;position:relative}.sortable-item.dragging[data-v-09fb0ec2]{opacity:.7;transform:scale(1.02);box-shadow:0 4px 12px rgba(0,122,204,.3);z-index:1000}.sortable-item[data-v-09fb0ec2]:not(.dragging){transform:translateY(0)}.draggable-fold-bar.incomplete[data-v-09fb0ec2] .fold-bar-btn span{color:#ef4444 !important}.drop-indicator[data-v-09fb0ec2]{height:4px;background:linear-gradient(90deg,#007acc,#005999);border-radius:2px;margin:4px 0;box-shadow:0 0 8px rgba(0,122,204,.6);animation:pulse-09fb0ec2 1.5s ease-in-out infinite;position:relative}.drop-indicator[data-v-09fb0ec2]::before{content:"";position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:8px;height:8px;background:#007acc;border-radius:50%;box-shadow:0 0 12px rgba(0,122,204,.8)}@keyframes pulse-09fb0ec2{0%,100%{opacity:1;transform:scale(1)}50%{opacity:.7;transform:scale(1.1)}}.fold-content[data-v-09fb0ec2]{padding:12px 0}.fold-content .input-group[data-v-09fb0ec2]{margin-bottom:16px}.fold-content .input-group[data-v-09fb0ec2]:last-child{margin-bottom:0}.fold-content .input-group label[data-v-09fb0ec2]{display:block;margin-bottom:6px;color:#b0b0b0;font-weight:500;font-size:13px}.fold-content .input-group .form-input[data-v-09fb0ec2],.fold-content .input-group .form-textarea[data-v-09fb0ec2]{width:100%;padding:8px 12px;background:#2a2a2a;border:1px solid #404040;border-radius:4px;color:#e0e0e0;font-size:14px;font-family:inherit;transition:all .2s ease}.fold-content .input-group .form-input[data-v-09fb0ec2]:focus,.fold-content .input-group .form-textarea[data-v-09fb0ec2]:focus{outline:none;border-color:#007acc;box-shadow:0 0 0 2px rgba(0,122,204,.2)}.fold-content .input-group .form-input[data-v-09fb0ec2]::placeholder,.fold-content .input-group .form-textarea[data-v-09fb0ec2]::placeholder{color:#666}.fold-content .input-group .form-textarea[data-v-09fb0ec2]{resize:vertical;min-height:60px;line-height:1.4}.item-actions[data-v-09fb0ec2]{display:flex;gap:8px;margin-top:12px}.item-actions .action-btn[data-v-09fb0ec2]{flex:1;display:flex;align-items:center;justify-content:center;gap:6px;min-width:0}.generated-result[data-v-09fb0ec2]{margin-top:8px;padding:8px;background-color:#1a1a1a;border:1px solid #404040;border-radius:6px}.generated-result label[data-v-09fb0ec2]{display:block;margin-bottom:4px;color:#007acc;font-size:12px;font-weight:500}.generated-result .generated-text[data-v-09fb0ec2]{color:#e0e0e0;font-size:14px;margin-bottom:8px;word-wrap:break-word;white-space:pre-wrap}.generated-result .replace-btn[data-v-09fb0ec2]{padding:6px 12px;background-color:#28a745;border:none;border-radius:4px;color:#fff;font-size:12px;font-weight:500;cursor:pointer;transition:background-color .2s ease}.generated-result .replace-btn[data-v-09fb0ec2]:hover{background-color:#218838}.remove-btn[data-v-09fb0ec2]{background:#b91c1c;border:1px solid #b91c1c;border-radius:3px;color:#fff;font-size:16px;font-weight:bold;width:20px;height:20px;display:flex;align-items:center;justify-content:center;cursor:pointer}.remove-btn span[data-v-09fb0ec2]{line-height:1;margin-top:-1px}.action-btn[data-v-09fb0ec2]{padding:8px 16px;border:1px solid #555;background:#2a2a2a;color:#e0e0e0;border-radius:4px;cursor:pointer;font-size:13px;font-weight:500;transition:all .2s ease}.action-btn[data-v-09fb0ec2]:hover{background:#404040;border-color:#777}.action-btn.generate[data-v-09fb0ec2]{background:linear-gradient(135deg,#007acc,#005999);border-color:#007acc;color:#fff}.action-btn.generate[data-v-09fb0ec2]:hover:not(:disabled){background:linear-gradient(135deg,#005999,#004477);transform:translateY(-1px)}.action-btn.generate[data-v-09fb0ec2]:active{transform:translateY(0)}.action-btn.generate[data-v-09fb0ec2]:disabled{background-color:#666;cursor:not-allowed;transform:none}.action-btn.apply[data-v-09fb0ec2]{background:linear-gradient(135deg,#28a745,#20c997);border-color:#28a745;color:#fff}.action-btn.apply[data-v-09fb0ec2]:hover:not(:disabled){background:linear-gradient(135deg,#218838,#1aa085);transform:translateY(-1px)}.action-btn.apply[data-v-09fb0ec2]:active{transform:translateY(0)}.action-btn.apply[data-v-09fb0ec2]:disabled{background-color:#666;cursor:not-allowed;transform:none}.action-btn.delete[data-v-09fb0ec2]{background:#3a1a1a;border-color:#622}.action-btn.delete[data-v-09fb0ec2]:hover{background:#622}.add-item-section[data-v-09fb0ec2]{text-align:center;margin-top:16px}.add-btn[data-v-09fb0ec2]{padding:10px 20px;background:linear-gradient(135deg,#007acc,#005999);border:none;color:#fff;border-radius:6px;cursor:pointer;font-size:14px;font-weight:500;transition:all .2s ease}.add-btn[data-v-09fb0ec2]:hover{background:linear-gradient(135deg,#005999,#004477);transform:translateY(-1px)}.add-btn[data-v-09fb0ec2]:active{transform:translateY(0)}@media (max-width:768px){.extra-container[data-v-09fb0ec2]{padding:16px}.section[data-v-09fb0ec2]{padding:16px}.item-actions[data-v-09fb0ec2]{gap:6px}.item-actions .action-btn[data-v-09fb0ec2]{padding:6px 12px;font-size:12px}.add-btn[data-v-09fb0ec2]{width:100%}}.loading-spinner[data-v-09fb0ec2]{display:inline-block;width:16px;height:16px;border:2px solid #fff;border-top:2px solid rgba(0,0,0,0);border-radius:50%;animation:spin-09fb0ec2 1s linear infinite;flex-shrink:0}@keyframes spin-09fb0ec2{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
.item-tabs-container[data-v-d8256cea]{color:#e0e0e0;max-width:1000px;margin:0 auto;padding:16px}.item-tabs-container h3[data-v-d8256cea]{color:#007acc;margin-bottom:24px;font-size:20px}.item-fold-bar[data-v-d8256cea]{margin-bottom:16px}.item-fold-bar[data-v-d8256cea] .fold-bar-btn{background:linear-gradient(135deg,#2a2a2a 0%,#333333 100%);border:1px solid #555;box-shadow:0 2px 8px rgba(0,0,0,.3);padding:12px 16px;font-size:16px;font-weight:600;color:#e0e0e0;transition:all .3s ease}.item-fold-bar[data-v-d8256cea] .fold-bar-btn:hover{background:linear-gradient(135deg,#333333 0%,#404040 100%);border-color:#666;box-shadow:0 4px 12px rgba(0,0,0,.4)}.item-fold-bar[data-v-d8256cea] .fold-bar-content{background:linear-gradient(135deg,#1a1a1a 0%,#222222 100%);border:1px solid #555;border-top:none;box-shadow:0 2px 8px rgba(0,0,0,.3)}.item-fold-bar[data-v-d8256cea] .fold-bar-content-text{padding:20px}.item-fold-bar[data-v-d8256cea] .fold-bar-footer-toggle{background:linear-gradient(135deg,#2a2a2a 0%,#333333 100%);border-top:1px solid #555;color:#b0b0b0;font-size:13px;font-weight:500;padding:12px 16px;transition:all .3s ease}.item-fold-bar[data-v-d8256cea] .fold-bar-footer-toggle:hover{background:linear-gradient(135deg,#333333 0%,#404040 100%);color:#e0e0e0;border-color:#666}.item-fold-bar[data-v-d8256cea] .fold-bar-toggle-icon{color:#007acc;font-size:14px;font-weight:bold}.item-fold-bar.item-incomplete[data-v-d8256cea] .fold-bar-btn span{color:#ff6b6b !important}.remove-item-btn[data-v-d8256cea]{background:#b91c1c;border:1px solid #b91c1c;border-radius:3px;color:#fff;font-size:16px;font-weight:bold;width:20px;height:20px;display:flex;align-items:center;justify-content:center;cursor:pointer}.remove-item-btn span[data-v-d8256cea]{line-height:1;margin-top:-1px}.item-info-container .section[data-v-d8256cea]{margin-bottom:16px}.section[data-v-d8256cea]{background-color:#2a2a2a;padding:20px;border-radius:12px;border:1px solid #404040;margin-bottom:20px}.section h4[data-v-d8256cea]{color:#b0b0b0;margin-bottom:16px;font-size:16px;border-bottom:1px solid #404040;padding-bottom:8px}.form-grid[data-v-d8256cea]{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:16px}.input-group.full-width[data-v-d8256cea]{grid-column:1/-1}.input-group label[data-v-d8256cea]{display:block;margin-bottom:8px;color:#b0b0b0;font-weight:500}.text-input[data-v-d8256cea]{width:100%;padding:12px 16px;background-color:#1a1a1a;border:1px solid #404040;border-radius:8px;color:#e0e0e0;font-size:14px;outline:none;transition:border-color .2s ease}.text-input[data-v-d8256cea]:focus{border-color:#007acc}.text-input[data-v-d8256cea]::placeholder{color:#666}.text-area[data-v-d8256cea]{width:100%;padding:12px 16px;background-color:#1a1a1a;border:1px solid #404040;border-radius:8px;color:#e0e0e0;font-size:14px;font-family:inherit;outline:none;resize:vertical;min-height:80px;transition:border-color .2s ease}.text-area[data-v-d8256cea]:focus{border-color:#007acc}.text-area[data-v-d8256cea]::placeholder{color:#666}.add-item-section[data-v-d8256cea]{display:flex;justify-content:center;padding:20px 0;margin-top:20px;border-top:1px solid #404040}.add-item-btn[data-v-d8256cea]{padding:12px 24px;background:linear-gradient(135deg,#28a745 0%,#20c997 100%);border:1px solid #28a745;border-radius:8px;color:#fff;font-size:16px;font-weight:500;cursor:pointer;transition:all .3s ease;display:flex;align-items:center;gap:8px}.add-item-btn[data-v-d8256cea]:hover:not(:disabled){background:linear-gradient(135deg,#218838 0%,#1aa085 100%);border-color:#218838;transform:translateY(-1px);box-shadow:0 4px 12px rgba(40,167,69,.3)}.add-item-btn span[data-v-d8256cea]{font-size:18px;font-weight:bold}@media (max-width:768px){.section[data-v-d8256cea]{padding:16px}.form-grid[data-v-d8256cea]{grid-template-columns:1fr}.input-group.full-width[data-v-d8256cea]{grid-column:1}.item-tabs-container[data-v-d8256cea]{max-width:100%;margin:0}.add-item-section[data-v-d8256cea]{padding:16px 0;margin-top:16px}.add-item-btn[data-v-d8256cea]{padding:10px 20px;font-size:14px}.add-item-btn span[data-v-d8256cea]{font-size:16px}.remove-item-btn[data-v-d8256cea]{width:20px;height:20px;font-size:14px}[data-v-d8256cea] .fold-bar-content-text{padding:16px}.action-section[data-v-d8256cea]{flex-direction:row;align-items:stretch;gap:12px}.action-section .generate-btn[data-v-d8256cea],.action-section .apply-all-btn[data-v-d8256cea]{flex:1;width:auto;max-width:none}}.generated-result[data-v-d8256cea]{margin-top:8px;padding:8px;background-color:#1a1a1a;border:1px solid #404040;border-radius:6px}.generated-result label[data-v-d8256cea]{display:block;margin-bottom:4px;color:#007acc;font-size:12px;font-weight:500}.generated-result .generated-text[data-v-d8256cea]{color:#e0e0e0;font-size:14px;margin-bottom:8px;word-wrap:break-word}.generated-result .replace-btn[data-v-d8256cea]{padding:6px 12px;background-color:#28a745;border:none;border-radius:4px;color:#fff;font-size:12px;font-weight:500;cursor:pointer;transition:background-color .2s ease}.generated-result .replace-btn[data-v-d8256cea]:hover{background-color:#218838}.action-section[data-v-d8256cea]{display:flex;justify-content:space-between;gap:16px;padding:20px 0}.action-section .generate-btn[data-v-d8256cea],.action-section .apply-all-btn[data-v-d8256cea]{flex:1;max-width:none}.generate-btn[data-v-d8256cea]{padding:14px 32px;background-color:#28a745;border:none;border-radius:8px;color:#fff;font-size:16px;font-weight:500;cursor:pointer;transition:background-color .2s ease;display:flex;align-items:center;justify-content:center;gap:8px}.generate-btn[data-v-d8256cea]:hover:not(:disabled){background-color:#218838}.generate-btn[data-v-d8256cea]:disabled{background-color:#666;cursor:not-allowed}.loading-spinner[data-v-d8256cea]{width:16px;height:16px;border:2px solid #fff;border-top:2px solid rgba(0,0,0,0);border-radius:50%;animation:spin-d8256cea 1s linear infinite}@keyframes spin-d8256cea{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}.apply-all-btn[data-v-d8256cea]{padding:14px 32px;background-color:#007acc;border:none;border-radius:8px;color:#fff;font-size:16px;font-weight:500;cursor:pointer;transition:background-color .2s ease}.apply-all-btn[data-v-d8256cea]:hover:not(:disabled){background-color:#0056b3}.apply-all-btn[data-v-d8256cea]:disabled{background-color:#666;cursor:not-allowed}
.location-tabs-container[data-v-890af5d4]{color:#e0e0e0;max-width:1000px;margin:0 auto;padding:16px}.location-tabs-container h3[data-v-890af5d4]{color:#007acc;margin-bottom:24px;font-size:20px}.location-fold-bar[data-v-890af5d4]{margin-bottom:16px}.location-fold-bar[data-v-890af5d4] .fold-bar-btn{background:linear-gradient(135deg,#2a2a2a 0%,#333333 100%);border:1px solid #555;box-shadow:0 2px 8px rgba(0,0,0,.3);padding:12px 16px;font-size:16px;font-weight:600;color:#e0e0e0;transition:all .3s ease}.location-fold-bar[data-v-890af5d4] .fold-bar-btn:hover{background:linear-gradient(135deg,#333333 0%,#404040 100%);border-color:#666;box-shadow:0 4px 12px rgba(0,0,0,.4)}.location-fold-bar[data-v-890af5d4] .fold-bar-content{background:linear-gradient(135deg,#1a1a1a 0%,#222222 100%);border:1px solid #555;border-top:none;box-shadow:0 2px 8px rgba(0,0,0,.3)}.location-fold-bar[data-v-890af5d4] .fold-bar-content-text{padding:20px}.location-fold-bar[data-v-890af5d4] .fold-bar-footer-toggle{background:linear-gradient(135deg,#2a2a2a 0%,#333333 100%);border-top:1px solid #555;color:#b0b0b0;font-size:13px;font-weight:500;padding:12px 16px;transition:all .3s ease}.location-fold-bar[data-v-890af5d4] .fold-bar-footer-toggle:hover{background:linear-gradient(135deg,#333333 0%,#404040 100%);color:#e0e0e0;border-color:#666}.location-fold-bar[data-v-890af5d4] .fold-bar-toggle-icon{color:#007acc;font-size:14px;font-weight:bold}.location-fold-bar.location-incomplete[data-v-890af5d4] .fold-bar-btn span{color:#ff6b6b !important}.remove-location-btn[data-v-890af5d4]{background:#b91c1c;border:1px solid #b91c1c;border-radius:3px;color:#fff;font-size:16px;font-weight:bold;width:20px;height:20px;display:flex;align-items:center;justify-content:center;cursor:pointer}.remove-location-btn span[data-v-890af5d4]{line-height:1;margin-top:-1px}.location-info-container .section[data-v-890af5d4]{margin-bottom:16px}.section[data-v-890af5d4]{background-color:#2a2a2a;padding:20px;border-radius:12px;border:1px solid #404040;margin-bottom:20px}.section h4[data-v-890af5d4]{color:#b0b0b0;margin-bottom:16px;font-size:16px;border-bottom:1px solid #404040;padding-bottom:8px}.form-grid[data-v-890af5d4]{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:16px}.input-group.full-width[data-v-890af5d4]{grid-column:1/-1}.input-group label[data-v-890af5d4]{display:block;margin-bottom:8px;color:#b0b0b0;font-weight:500}.text-input[data-v-890af5d4]{width:100%;padding:12px 16px;background-color:#1a1a1a;border:1px solid #404040;border-radius:8px;color:#e0e0e0;font-size:14px;outline:none;transition:border-color .2s ease}.text-input[data-v-890af5d4]:focus{border-color:#007acc}.text-input[data-v-890af5d4]::placeholder{color:#666}.text-area[data-v-890af5d4]{width:100%;padding:12px 16px;background-color:#1a1a1a;border:1px solid #404040;border-radius:8px;color:#e0e0e0;font-size:14px;font-family:inherit;outline:none;resize:vertical;min-height:80px;transition:border-color .2s ease}.text-area[data-v-890af5d4]:focus{border-color:#007acc}.text-area[data-v-890af5d4]::placeholder{color:#666}.sub-locations-container[data-v-890af5d4]{display:flex;flex-direction:column;gap:8px}.sub-location-item[data-v-890af5d4]{display:flex;align-items:center;gap:8px}.sub-location-item .text-input[data-v-890af5d4]{flex:1}.sub-location-item .remove-sub-location-btn[data-v-890af5d4]{background:#b91c1c;border:1px solid #b91c1c;border-radius:3px;color:#fff;font-size:16px;font-weight:bold;width:20px;height:20px;display:flex;align-items:center;justify-content:center;cursor:pointer}.sub-location-item .remove-sub-location-btn span[data-v-890af5d4]{line-height:1;margin-top:-1px}.add-sub-location-btn[data-v-890af5d4]{padding:8px 16px;background:linear-gradient(135deg,#28a745 0%,#20c997 100%);border:1px solid #28a745;border-radius:6px;color:#fff;font-size:14px;font-weight:500;cursor:pointer;transition:all .3s ease;align-self:flex-start}.add-sub-location-btn[data-v-890af5d4]:hover:not(:disabled){background:linear-gradient(135deg,#218838 0%,#1aa085 100%);border-color:#218838;transform:translateY(-1px)}.add-sub-location-btn span[data-v-890af5d4]{font-size:16px;font-weight:bold}.bulk-generate-section[data-v-890af5d4]{background-color:#2a2a2a;padding:20px;border-radius:12px;border:1px solid #404040;margin-bottom:20px}.bulk-generate-section h4[data-v-890af5d4]{color:#007acc;margin-bottom:16px;font-size:16px;border-bottom:1px solid #404040;padding-bottom:8px}.count-input-row[data-v-890af5d4]{display:flex;align-items:center;gap:16px;flex-wrap:wrap}.count-input[data-v-890af5d4]{flex:0 0 auto;width:120px}.ai-count-checkbox[data-v-890af5d4]{display:flex;align-items:center;gap:8px;margin-bottom:0}.ai-count-checkbox input[type=checkbox][data-v-890af5d4]{width:16px;height:16px;accent-color:#007acc;cursor:pointer}.ai-count-checkbox label[data-v-890af5d4]{color:#b0b0b0;font-size:14px;font-weight:500;cursor:pointer;margin-bottom:0;-webkit-user-select:none;user-select:none}.ai-count-checkbox label[data-v-890af5d4]:hover{color:#e0e0e0}.bulk-generate-btn[data-v-890af5d4]{padding:14px 32px;background-color:#28a745;border:none;border-radius:8px;color:#fff;font-size:16px;font-weight:500;cursor:pointer;transition:background-color .2s ease;display:flex;align-items:center;justify-content:center;gap:8px;width:100%;margin-top:16px}.bulk-generate-btn[data-v-890af5d4]:hover:not(:disabled){background-color:#218838}.bulk-generate-btn[data-v-890af5d4]:disabled{background-color:#666;cursor:not-allowed}.add-location-section[data-v-890af5d4]{display:flex;justify-content:center;padding:20px 0;margin-top:20px;border-top:1px solid #404040}.add-location-btn[data-v-890af5d4]{padding:12px 24px;background:linear-gradient(135deg,#28a745 0%,#20c997 100%);border:1px solid #28a745;border-radius:8px;color:#fff;font-size:16px;font-weight:500;cursor:pointer;transition:all .3s ease;display:flex;align-items:center;gap:8px}.add-location-btn[data-v-890af5d4]:hover:not(:disabled){background:linear-gradient(135deg,#218838 0%,#1aa085 100%);border-color:#218838;transform:translateY(-1px);box-shadow:0 4px 12px rgba(40,167,69,.3)}.add-location-btn span[data-v-890af5d4]{font-size:18px;font-weight:bold}@media (max-width:768px){.section[data-v-890af5d4]{padding:16px}.form-grid[data-v-890af5d4]{grid-template-columns:1fr}.input-group.full-width[data-v-890af5d4]{grid-column:1}.location-tabs-container[data-v-890af5d4]{max-width:100%;margin:0}.add-location-section[data-v-890af5d4]{padding:16px 0;margin-top:16px}.add-location-btn[data-v-890af5d4]{padding:10px 20px;font-size:14px}.add-location-btn span[data-v-890af5d4]{font-size:16px}.count-input-row[data-v-890af5d4]{flex-direction:column;align-items:flex-start;gap:12px}.count-input[data-v-890af5d4]{width:100%}.ai-count-checkbox[data-v-890af5d4]{font-size:13px}.remove-location-btn[data-v-890af5d4]{width:20px;height:20px;font-size:14px}[data-v-890af5d4] .fold-bar-content-text{padding:16px}.action-section[data-v-890af5d4]{flex-direction:row;align-items:stretch;gap:12px}.action-section .generate-btn[data-v-890af5d4],.action-section .apply-all-btn[data-v-890af5d4]{flex:1;width:auto;max-width:none}}.generated-result[data-v-890af5d4]{margin-top:8px;padding:8px;background-color:#1a1a1a;border:1px solid #404040;border-radius:6px}.generated-result label[data-v-890af5d4]{display:block;margin-bottom:4px;color:#007acc;font-size:12px;font-weight:500}.generated-result .generated-text[data-v-890af5d4]{color:#e0e0e0;font-size:14px;margin-bottom:8px;word-wrap:break-word}.generated-result .replace-btn[data-v-890af5d4]{padding:6px 12px;background-color:#28a745;border:none;border-radius:4px;color:#fff;font-size:12px;font-weight:500;cursor:pointer;transition:background-color .2s ease}.generated-result .replace-btn[data-v-890af5d4]:hover{background-color:#218838}.action-section[data-v-890af5d4]{display:flex;justify-content:space-between;gap:16px;padding:20px 0}.action-section .generate-btn[data-v-890af5d4],.action-section .apply-all-btn[data-v-890af5d4]{flex:1;max-width:none}.generate-btn[data-v-890af5d4]{padding:14px 32px;background-color:#28a745;border:none;border-radius:8px;color:#fff;font-size:16px;font-weight:500;cursor:pointer;transition:background-color .2s ease;display:flex;align-items:center;justify-content:center;gap:8px}.generate-btn[data-v-890af5d4]:hover:not(:disabled){background-color:#218838}.generate-btn[data-v-890af5d4]:disabled{background-color:#666;cursor:not-allowed}.loading-spinner[data-v-890af5d4]{width:16px;height:16px;border:2px solid #fff;border-top:2px solid rgba(0,0,0,0);border-radius:50%;animation:spin-890af5d4 1s linear infinite}@keyframes spin-890af5d4{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}.apply-all-btn[data-v-890af5d4]{padding:14px 32px;background-color:#007acc;border:none;border-radius:8px;color:#fff;font-size:16px;font-weight:500;cursor:pointer;transition:background-color .2s ease}.apply-all-btn[data-v-890af5d4]:hover:not(:disabled){background-color:#0056b3}.apply-all-btn[data-v-890af5d4]:disabled{background-color:#666;cursor:not-allowed}
.start-container[data-v-ef5b3c42]{color:#e0e0e0;max-width:1000px;margin:0 0;padding:16px}.start-container h3[data-v-ef5b3c42]{color:#007acc;margin-bottom:24px;font-size:20px}.section[data-v-ef5b3c42]{background-color:#2a2a2a;padding:20px;border-radius:12px;border:1px solid #404040;margin-bottom:20px}.section .input-group[data-v-ef5b3c42],.section .datetime-group[data-v-ef5b3c42]{margin-bottom:16px}.section .input-group[data-v-ef5b3c42]:last-child,.section .datetime-group[data-v-ef5b3c42]:last-child{margin-bottom:0}.section .input-group label[data-v-ef5b3c42],.section .datetime-group label[data-v-ef5b3c42]{display:block;margin-bottom:6px;color:#b0b0b0;font-weight:500;font-size:13px}.section .datetime-inputs[data-v-ef5b3c42]{display:flex;gap:8px;flex-wrap:wrap}.section .datetime-inputs .datetime-input[data-v-ef5b3c42]{display:flex;align-items:center;gap:4px}.section .datetime-inputs .datetime-input .form-input[data-v-ef5b3c42]{width:80px;text-align:center}.section .datetime-inputs .datetime-input .unit[data-v-ef5b3c42]{color:#b0b0b0;font-size:12px;font-weight:500;min-width:12px}.section .form-input[data-v-ef5b3c42],.section .form-textarea[data-v-ef5b3c42]{width:100%;padding:8px 12px;background:#2a2a2a;border:1px solid #404040;border-radius:4px;color:#e0e0e0;font-size:14px;font-family:inherit;transition:all .2s ease}.section .form-input[data-v-ef5b3c42]:focus,.section .form-textarea[data-v-ef5b3c42]:focus{outline:none;border-color:#007acc;box-shadow:0 0 0 2px rgba(0,122,204,.2)}.section .form-input[data-v-ef5b3c42]::placeholder,.section .form-textarea[data-v-ef5b3c42]::placeholder{color:#666}.section .form-textarea[data-v-ef5b3c42]{resize:vertical;min-height:60px;line-height:1.4}.item-actions[data-v-ef5b3c42]{display:flex;gap:8px;margin-top:12px}.item-actions .action-btn[data-v-ef5b3c42]{flex:1;display:flex;align-items:center;justify-content:center;gap:6px;min-width:0}.settings-actions[data-v-ef5b3c42]{display:flex;gap:8px;margin-top:20px}.settings-actions .action-btn[data-v-ef5b3c42]{flex:1;display:flex;align-items:center;justify-content:center;gap:6px;min-width:0}.settings-actions .import[data-v-ef5b3c42]{display:flex;align-items:center;justify-content:center}.start-action[data-v-ef5b3c42]{margin-top:20px;display:flex;justify-content:center}.start-action .action-btn[data-v-ef5b3c42]{min-width:120px;padding:12px 24px;font-size:16px;font-weight:600}.generated-result[data-v-ef5b3c42]{margin-top:8px;padding:8px;background-color:#1a1a1a;border:1px solid #404040;border-radius:6px}.generated-result label[data-v-ef5b3c42]{display:block;margin-bottom:4px;color:#007acc;font-size:12px;font-weight:500}.generated-result .generated-text[data-v-ef5b3c42]{color:#e0e0e0;font-size:14px;margin-bottom:8px;word-wrap:break-word;white-space:pre-wrap}.generated-result .replace-btn[data-v-ef5b3c42]{padding:6px 12px;background-color:#28a745;border:none;border-radius:4px;color:#fff;font-size:12px;font-weight:500;cursor:pointer;transition:background-color .2s ease}.generated-result .replace-btn[data-v-ef5b3c42]:hover{background-color:#218838}.action-btn[data-v-ef5b3c42]{padding:8px 16px;border:1px solid #555;background:#2a2a2a;color:#e0e0e0;border-radius:4px;cursor:pointer;font-size:13px;font-weight:500;transition:all .2s ease}.action-btn[data-v-ef5b3c42]:hover{background:#404040;border-color:#777}.action-btn.generate[data-v-ef5b3c42]{background-color:#28a745;border-color:#28a745;color:#fff}.action-btn.generate[data-v-ef5b3c42]:hover:not(:disabled){background-color:#218838;transform:translateY(-1px)}.action-btn.generate[data-v-ef5b3c42]:active{transform:translateY(0)}.action-btn.generate[data-v-ef5b3c42]:disabled{background-color:#666;cursor:not-allowed;transform:none}.action-btn.apply[data-v-ef5b3c42]{background:linear-gradient(135deg,#28a745,#20c997);border-color:#28a745;color:#fff}.action-btn.apply[data-v-ef5b3c42]:hover:not(:disabled){background:linear-gradient(135deg,#218838,#1aa085);transform:translateY(-1px)}.action-btn.apply[data-v-ef5b3c42]:active{transform:translateY(0)}.action-btn.apply[data-v-ef5b3c42]:disabled{background-color:#666;cursor:not-allowed;transform:none}.action-btn.apply-all[data-v-ef5b3c42]{background:linear-gradient(135deg,#007acc,#005999);border-color:#007acc;color:#fff}.action-btn.apply-all[data-v-ef5b3c42]:hover:not(:disabled){background:linear-gradient(135deg,#005999,#004477);transform:translateY(-1px)}.action-btn.apply-all[data-v-ef5b3c42]:active{transform:translateY(0)}.action-btn.apply-all[data-v-ef5b3c42]:disabled{background-color:#666;cursor:not-allowed;transform:none}.action-btn.start[data-v-ef5b3c42]{background:linear-gradient(135deg,#28a745,#20c997);border-color:#28a745;color:#fff;box-shadow:0 2px 4px rgba(40,167,69,.3)}.action-btn.start[data-v-ef5b3c42]:hover:not(:disabled){background:linear-gradient(135deg,#218838,#1aa085);transform:translateY(-1px);box-shadow:0 4px 8px rgba(40,167,69,.4)}.action-btn.start[data-v-ef5b3c42]:active{transform:translateY(0)}.action-btn.start[data-v-ef5b3c42]:disabled{background:linear-gradient(135deg,#444,#333);border-color:#555;color:#888;box-shadow:none;cursor:not-allowed;transform:none;opacity:.6}.action-btn.start[data-v-ef5b3c42]:disabled::before{content:"🔒";margin-right:8px}.action-btn.export[data-v-ef5b3c42]{background:linear-gradient(135deg,#007acc,#005999);border-color:#007acc;color:#fff}.action-btn.export[data-v-ef5b3c42]:hover{background:linear-gradient(135deg,#005999,#004477);transform:translateY(-1px)}.action-btn.export[data-v-ef5b3c42]:active{transform:translateY(0)}.action-btn.import[data-v-ef5b3c42]{background:linear-gradient(135deg,#ffc107,#e0a800);border-color:#ffc107;color:#212529;cursor:pointer}.action-btn.import[data-v-ef5b3c42]:hover{background:linear-gradient(135deg,#e0a800,#d39e00);transform:translateY(-1px)}.action-btn.import[data-v-ef5b3c42]:active{transform:translateY(0)}@media (max-width:768px){.start-container[data-v-ef5b3c42]{padding:16px}.section[data-v-ef5b3c42]{padding:16px}.section .datetime-inputs[data-v-ef5b3c42]{gap:6px}.section .datetime-inputs .datetime-input .form-input[data-v-ef5b3c42]{width:70px}.section .datetime-inputs .datetime-input .unit[data-v-ef5b3c42]{font-size:11px;min-width:10px}.item-actions[data-v-ef5b3c42]{gap:6px}.item-actions .action-btn[data-v-ef5b3c42]{padding:6px 12px;font-size:12px}.settings-actions[data-v-ef5b3c42]{gap:6px}.settings-actions .action-btn[data-v-ef5b3c42]{padding:8px 12px;font-size:13px}.completion-status[data-v-ef5b3c42]{padding:12px}.completion-status .status-item[data-v-ef5b3c42]{padding:6px 8px;margin-bottom:6px}.completion-status .status-item .status-label[data-v-ef5b3c42]{font-size:13px}.completion-status .status-item .status-value[data-v-ef5b3c42]{font-size:13px}.start-action .action-btn[data-v-ef5b3c42]{min-width:100px;padding:10px 20px;font-size:14px}}.loading-spinner[data-v-ef5b3c42]{display:inline-block;width:16px;height:16px;border:2px solid #fff;border-top:2px solid rgba(0,0,0,0);border-radius:50%;animation:spin-ef5b3c42 1s linear infinite;flex-shrink:0}@keyframes spin-ef5b3c42{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}.completion-status[data-v-ef5b3c42]{margin-top:20px;padding:16px;background-color:#2a2a2a;border-radius:12px;border:1px solid #404040}.completion-status .status-item[data-v-ef5b3c42]{display:flex;justify-content:space-between;align-items:center;padding:8px 12px;margin-bottom:8px;border-radius:6px;background-color:#1a1a1a;border:1px solid #555;transition:all .2s ease}.completion-status .status-item[data-v-ef5b3c42]:last-child{margin-bottom:0}.completion-status .status-item.completed[data-v-ef5b3c42]{background-color:#0f2a0f;border-color:#28a745}.completion-status .status-item.completed .status-label[data-v-ef5b3c42]{color:#4ade80}.completion-status .status-item.completed .status-value[data-v-ef5b3c42]{color:#28a745;font-weight:600}.completion-status .status-item[data-v-ef5b3c42]:not(.completed){background-color:#2a0f0f;border-color:#dc3545}.completion-status .status-item:not(.completed) .status-label[data-v-ef5b3c42]{color:#fca5a5}.completion-status .status-item:not(.completed) .status-value[data-v-ef5b3c42]{color:#dc3545;font-weight:600}.completion-status .status-item .status-label[data-v-ef5b3c42]{font-size:14px;font-weight:500}.completion-status .status-item .status-value[data-v-ef5b3c42]{font-size:14px}
.user-profile-container[data-v-76149319]{padding:20px;color:#e0e0e0;max-width:1000px;margin:0 0;min-height:600px}.user-profile-container h3[data-v-76149319]{color:#007acc;margin-bottom:24px;font-size:20px}.user-profile-container h4[data-v-76149319]{color:#b0b0b0;margin-bottom:16px;font-size:16px;border-bottom:1px solid #404040;padding-bottom:8px}.section[data-v-76149319]{background-color:#2a2a2a;padding:20px;border-radius:12px;border:1px solid #404040;margin-bottom:20px}.form-grid[data-v-76149319]{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:16px}.input-group.full-width[data-v-76149319]{grid-column:1/-1}.birthday-inputs[data-v-76149319]{display:flex;gap:8px}.birthday-inputs .birthday-input[data-v-76149319]{flex:1;padding:12px 16px;background-color:#1a1a1a;border:1px solid #404040;border-radius:8px;color:#e0e0e0;font-size:14px;outline:none;transition:border-color .2s ease}.birthday-inputs .birthday-input[data-v-76149319]:focus{border-color:#007acc}.birthday-inputs .birthday-input[data-v-76149319]::placeholder{color:#666}.text-input[data-v-76149319]{width:100%;padding:12px 16px;background-color:#1a1a1a;border:1px solid #404040;border-radius:8px;color:#e0e0e0;font-size:14px;outline:none;transition:border-color .2s ease}.text-input[data-v-76149319]:focus{border-color:#007acc}.text-input[data-v-76149319]::placeholder{color:#666}.display-text[data-v-76149319]{width:100%;padding:12px 16px;background-color:rgba(0,0,0,0);border:1px dashed #555;border-radius:8px;color:#888;font-size:14px;display:flex;align-items:center;font-style:italic}.text-area[data-v-76149319]{width:100%;padding:12px 16px;background-color:#1a1a1a;border:1px solid #404040;border-radius:8px;color:#e0e0e0;font-size:14px;font-family:inherit;outline:none;resize:vertical;min-height:80px;transition:border-color .2s ease}.text-area[data-v-76149319]:focus{border-color:#007acc}.text-area[data-v-76149319]::placeholder{color:#666}.input-group label[data-v-76149319]{display:block;margin-bottom:8px;color:#b0b0b0;font-weight:500}.generated-result[data-v-76149319]{margin-top:8px;padding:8px;background-color:#1a1a1a;border:1px solid #404040;border-radius:6px}.generated-result label[data-v-76149319]{display:block;margin-bottom:4px;color:#007acc;font-size:12px;font-weight:500}.generated-result .generated-text[data-v-76149319]{color:#e0e0e0;font-size:14px;margin-bottom:8px;word-wrap:break-word}.generated-result .replace-btn[data-v-76149319]{padding:6px 12px;background-color:#28a745;border:none;border-radius:4px;color:#fff;font-size:12px;font-weight:500;cursor:pointer;transition:background-color .2s ease}.generated-result .replace-btn[data-v-76149319]:hover{background-color:#218838}.action-section[data-v-76149319]{display:flex;justify-content:center;gap:16px;padding:20px 0}.generate-btn[data-v-76149319]{padding:14px 32px;background-color:#28a745;border:none;border-radius:8px;color:#fff;font-size:16px;font-weight:500;cursor:pointer;transition:background-color .2s ease;display:flex;align-items:center;justify-content:center;gap:8px}.generate-btn[data-v-76149319]:hover:not(:disabled){background-color:#218838}.generate-btn[data-v-76149319]:disabled{background-color:#666;cursor:not-allowed}.loading-spinner[data-v-76149319]{width:16px;height:16px;border:2px solid #fff;border-top:2px solid rgba(0,0,0,0);border-radius:50%;animation:spin-76149319 1s linear infinite}@keyframes spin-76149319{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}.apply-all-btn[data-v-76149319]{padding:14px 32px;background-color:#007acc;border:none;border-radius:8px;color:#fff;font-size:16px;font-weight:500;cursor:pointer;transition:background-color .2s ease}.apply-all-btn[data-v-76149319]:hover:not(:disabled){background-color:#0056b3}.apply-all-btn[data-v-76149319]:disabled{background-color:#666;cursor:not-allowed}.relations-list[data-v-76149319]{display:flex;flex-direction:column;gap:8px}.relation-item[data-v-76149319]{display:flex;align-items:center;flex-wrap:wrap;gap:8px;padding:12px;background:linear-gradient(135deg,#1e1e1e 0%,#252525 100%);border:1px solid #555;border-radius:8px;box-shadow:0 2px 4px rgba(0,0,0,.2);transition:border-color .2s ease}.relation-item[data-v-76149319]:hover{border-color:#666}.relation-item .relation-target[data-v-76149319]{color:#4fc3f7;font-weight:600;font-size:14px;min-width:60px;padding:4px 8px;background-color:#2a2a2a;border-radius:4px;text-align:center;flex-shrink:0}.relation-item .relation-input[data-v-76149319]{flex:1;min-width:120px;padding:10px 14px;background-color:#1a1a1a;border:1px solid #404040;border-radius:6px;color:#e0e0e0;font-size:14px;outline:none;transition:all .2s ease}.relation-item .relation-input[data-v-76149319]:focus{border-color:#007acc;box-shadow:0 0 0 2px rgba(0,122,204,.2)}.relation-item .relation-input[data-v-76149319]::placeholder{color:#888}.relation-item .remove-relation-btn[data-v-76149319]{background:linear-gradient(135deg,#dc3545 0%,#c82333 100%);border:1px solid #dc3545;border-radius:6px;color:#fff;font-size:16px;font-weight:bold;width:24px;height:24px;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .2s ease;box-shadow:0 2px 4px rgba(220,53,69,.3);flex-shrink:0}.relation-item .remove-relation-btn[data-v-76149319]:hover{background:linear-gradient(135deg,#c82333 0%,#a02622 100%);border-color:#bd2130;transform:translateY(-1px);box-shadow:0 4px 8px rgba(220,53,69,.4)}.relation-item .remove-relation-btn[data-v-76149319]:active{transform:translateY(0)}.add-relation[data-v-76149319]{display:flex;flex-wrap:wrap;gap:8px;align-items:center;padding:12px;background:linear-gradient(135deg,#252525 0%,#2a2a2a 100%);border:1px solid #555;border-radius:8px;margin-top:12px}.add-relation .relation-select[data-v-76149319]{flex:1;min-width:150px;padding:12px 16px;background-color:#1a1a1a;border:1px solid #404040;border-radius:6px;color:#e0e0e0;font-size:14px;outline:none;transition:all .2s ease}.add-relation .relation-select[data-v-76149319]:focus{border-color:#007acc;box-shadow:0 0 0 2px rgba(0,122,204,.2)}.add-relation .add-relation-btn[data-v-76149319]{padding:10px 16px;background:linear-gradient(135deg,#28a745 0%,#20c997 100%);border:1px solid #28a745;border-radius:6px;color:#fff;font-size:14px;font-weight:500;cursor:pointer;transition:all .2s ease;box-shadow:0 2px 4px rgba(40,167,69,.3);flex-shrink:0}.add-relation .add-relation-btn[data-v-76149319]:hover:not(:disabled){background:linear-gradient(135deg,#218838 0%,#1aa085 100%);border-color:#218838;transform:translateY(-1px);box-shadow:0 4px 8px rgba(40,167,69,.4)}.add-relation .add-relation-btn[data-v-76149319]:disabled{background-color:#666;border-color:#666;cursor:not-allowed;box-shadow:none;transform:none}.add-relation .add-relation-btn[data-v-76149319]:active{transform:translateY(0)}.inventory-list[data-v-76149319]{display:flex;flex-direction:column;gap:8px}.inventory-item[data-v-76149319]{display:flex;align-items:center;flex-wrap:wrap;gap:8px;padding:12px;background:linear-gradient(135deg,#1e1e1e 0%,#252525 100%);border:1px solid #555;border-radius:8px;box-shadow:0 2px 4px rgba(0,0,0,.2);transition:border-color .2s ease}.inventory-item[data-v-76149319]:hover{border-color:#666}.inventory-item .inventory-target[data-v-76149319]{color:#4fc3f7;font-weight:600;font-size:14px;min-width:60px;padding:4px 8px;background-color:#2a2a2a;border-radius:4px;text-align:center;flex-shrink:0}.inventory-item .inventory-input[data-v-76149319]{flex:1;min-width:80px;padding:10px 14px;background-color:#1a1a1a;border:1px solid #404040;border-radius:6px;color:#e0e0e0;font-size:14px;outline:none;transition:all .2s ease}.inventory-item .inventory-input[data-v-76149319]:focus{border-color:#007acc;box-shadow:0 0 0 2px rgba(0,122,204,.2)}.inventory-item .inventory-input[data-v-76149319]::placeholder{color:#888}.inventory-item .remove-inventory-btn[data-v-76149319]{background:linear-gradient(135deg,#dc3545 0%,#c82333 100%);border:1px solid #dc3545;border-radius:6px;color:#fff;font-size:16px;font-weight:bold;width:24px;height:24px;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .2s ease;box-shadow:0 2px 4px rgba(220,53,69,.3);flex-shrink:0}.inventory-item .remove-inventory-btn[data-v-76149319]:hover{background:linear-gradient(135deg,#c82333 0%,#a02622 100%);border-color:#bd2130;transform:translateY(-1px);box-shadow:0 4px 8px rgba(220,53,69,.4)}.inventory-item .remove-inventory-btn[data-v-76149319]:active{transform:translateY(0)}.add-inventory[data-v-76149319]{display:flex;flex-wrap:wrap;gap:8px;align-items:center;padding:12px;background:linear-gradient(135deg,#252525 0%,#2a2a2a 100%);border:1px solid #555;border-radius:8px;margin-top:12px}.add-inventory .inventory-select[data-v-76149319]{flex:1;min-width:150px;padding:12px 16px;background-color:#1a1a1a;border:1px solid #404040;border-radius:6px;color:#e0e0e0;font-size:14px;outline:none;transition:all .2s ease}.add-inventory .inventory-select[data-v-76149319]:focus{border-color:#007acc;box-shadow:0 0 0 2px rgba(0,122,204,.2)}.add-inventory .quantity-input[data-v-76149319]{padding:12px 16px;background-color:#1a1a1a;border:1px solid #404040;border-radius:6px;color:#e0e0e0;font-size:14px;outline:none;transition:all .2s ease;width:80px;flex:1;min-width:80px}.add-inventory .quantity-input[data-v-76149319]:focus{border-color:#007acc;box-shadow:0 0 0 2px rgba(0,122,204,.2)}.add-inventory .quantity-input[data-v-76149319]::placeholder{color:#888}.add-inventory .quantity-input[data-v-76149319]:disabled{background-color:#333;color:#666;cursor:not-allowed}.add-inventory .add-inventory-btn[data-v-76149319]{padding:10px 16px;background:linear-gradient(135deg,#28a745 0%,#20c997 100%);border:1px solid #28a745;border-radius:6px;color:#fff;font-size:14px;font-weight:500;cursor:pointer;transition:all .2s ease;box-shadow:0 2px 4px rgba(40,167,69,.3);flex-shrink:0}.add-inventory .add-inventory-btn[data-v-76149319]:hover:not(:disabled){background:linear-gradient(135deg,#218838 0%,#1aa085 100%);border-color:#218838;transform:translateY(-1px);box-shadow:0 4px 8px rgba(40,167,69,.4)}.add-inventory .add-inventory-btn[data-v-76149319]:disabled{background-color:#666;border-color:#666;cursor:not-allowed;box-shadow:none;transform:none}.add-inventory .add-inventory-btn[data-v-76149319]:active{transform:translateY(0)}@media (max-width:768px){.user-profile-container[data-v-76149319]{padding:16px}.section[data-v-76149319]{padding:16px}.form-grid[data-v-76149319]{grid-template-columns:1fr}.birthday-inputs[data-v-76149319]{flex-direction:column}}
.world-background-container[data-v-6467ee74]{padding:20px;color:#e0e0e0;max-width:800px;margin:0 0;min-height:600px}.world-background-container h3[data-v-6467ee74]{color:#007acc;margin-bottom:24px;font-size:20px}.input-group[data-v-6467ee74]{margin-bottom:20px}.input-group label[data-v-6467ee74]{display:block;margin-bottom:8px;color:#b0b0b0;font-weight:500}.text-input[data-v-6467ee74]{width:100%;padding:12px 16px;background-color:#1a1a1a;border:1px solid #404040;border-radius:8px;color:#e0e0e0;font-size:14px;outline:none;transition:border-color .2s ease}.text-input[data-v-6467ee74]:focus{border-color:#007acc}.text-input[data-v-6467ee74]::placeholder{color:#666}.text-area[data-v-6467ee74]{width:100%;padding:12px 16px;background-color:#1a1a1a;border:1px solid #404040;border-radius:8px;color:#e0e0e0;font-size:14px;font-family:inherit;outline:none;resize:vertical;min-height:80px;transition:border-color .2s ease}.text-area[data-v-6467ee74]:focus{border-color:#007acc}.text-area[data-v-6467ee74]::placeholder{color:#666}.generate-btn[data-v-6467ee74]{width:100%;padding:14px;background-color:#007acc;border:none;border-radius:8px;color:#fff;font-size:16px;font-weight:500;cursor:pointer;transition:background-color .2s ease;margin-bottom:24px;display:flex;align-items:center;justify-content:center;gap:8px}.generate-btn[data-v-6467ee74]:hover:not(:disabled){background-color:#0056b3}.generate-btn[data-v-6467ee74]:disabled{background-color:#666;cursor:not-allowed}.loading-spinner[data-v-6467ee74]{width:16px;height:16px;border:2px solid #fff;border-top:2px solid rgba(0,0,0,0);border-radius:50%;animation:spin-6467ee74 1s linear infinite}@keyframes spin-6467ee74{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}.info-section[data-v-6467ee74]{background-color:#2a2a2a;padding:24px;border-radius:12px;border:1px solid #404040}.replace-btn[data-v-6467ee74]{width:100%;padding:14px;background-color:#28a745;border:none;border-radius:8px;color:#fff;font-size:16px;font-weight:500;cursor:pointer;transition:background-color .2s ease}.replace-btn[data-v-6467ee74]:hover:not(:disabled){background-color:#218838}.replace-btn[data-v-6467ee74]:disabled{background-color:#666;cursor:not-allowed}@media (max-width:768px){.world-background-container[data-v-6467ee74]{padding:16px}.info-section[data-v-6467ee74]{padding:20px}.text-input[data-v-6467ee74],.text-area[data-v-6467ee74]{font-size:16px}}
.initializations-container[data-v-252c6a8b]{display:flex;flex-direction:column;width:100%;height:100%;background-color:#1a1a1a;color:#e0e0e0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif}.main-content[data-v-252c6a8b]{flex:1;display:flex;flex-direction:column;overflow:hidden}.initialization-area[data-v-252c6a8b]{display:flex;flex-direction:column;flex:1;background-color:#1a1a1a;overflow-y:auto}.tab-navigation[data-v-252c6a8b]{display:flex;background-color:#2a2a2a;border-bottom:1px solid #404040;flex-shrink:0}.tab-navigation.top[data-v-252c6a8b]{border-top:none}.tab-navigation.first-row[data-v-252c6a8b]{border-bottom:none}.tab-navigation.second-row[data-v-252c6a8b]{border-top:none}.tab-button[data-v-252c6a8b]{flex:1;padding:16px;background:none;border:none;color:#b0b0b0;font-size:16px;cursor:pointer;transition:all .2s ease}.tab-button.active[data-v-252c6a8b]{color:#007acc;background-color:#3a3a3a}.tab-button[data-v-252c6a8b]:hover{background-color:#3a3a3a}@media (max-width:768px){.tab-button[data-v-252c6a8b]{padding:14px;font-size:14px}}
.confirm-dialog-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background-color:rgba(0,0,0,.7);display:flex;align-items:center;justify-content:center;z-index:9999}.confirm-dialog{background-color:#2a2a2a;border-radius:12px;border:1px solid #404040;min-width:300px;max-width:90vw;box-shadow:0 4px 20px rgba(0,0,0,.3)}.confirm-dialog-header{padding:20px 20px 0 20px}.confirm-dialog-header h3{margin:0;color:#e0e0e0;font-size:18px;font-weight:600}.confirm-dialog-body{padding:16px 20px}.confirm-dialog-body p{margin:0;color:#b0b0b0;line-height:1.5;font-size:14px}.confirm-dialog-footer{padding:0 20px 20px 20px;display:flex;gap:12px;justify-content:flex-end}.confirm-btn{padding:8px 16px;border:none;border-radius:6px;font-size:14px;font-weight:500;cursor:pointer;transition:all .2s ease}.confirm-btn.cancel-btn{background-color:#404040;color:#b0b0b0}.confirm-btn.cancel-btn:hover{background-color:#505050}.confirm-btn.confirm-action-btn{background-color:#007acc;color:#fff}.confirm-btn.confirm-action-btn:hover{background-color:#0056b3}.confirm-btn.confirm-action-btn:active{background-color:#004085}.confirm-btn.confirm-action-btn[data-confirm-text=刪除]{background-color:#dc3545}.confirm-btn.confirm-action-btn[data-confirm-text=刪除]:hover{background-color:#c82333}.confirm-btn.confirm-action-btn[data-confirm-text=刪除]:active{background-color:#bd2130}
.progress-bar-container[data-v-be0274c0]{display:flex;flex-direction:row;align-items:center;gap:12px;width:100%}.progress-bar-label[data-v-be0274c0]{font-size:12px;color:#888;letter-spacing:.5px;font-weight:500;min-width:100px;flex-shrink:0}.progress-bar-wrapper[data-v-be0274c0]{position:relative;height:20px;background:#333;border-radius:10px;border:1px solid #555;overflow:hidden;display:flex;align-items:center;padding:0 8px;flex:1}.progress-bar-fill[data-v-be0274c0]{position:absolute;left:0;top:0;height:100%;border-radius:10px;transition:width .3s ease;z-index:1}.progress-bar-value[data-v-be0274c0]{position:relative;z-index:2;font-size:13px;font-weight:700;color:#fff;white-space:nowrap;text-shadow:0 0 2px #000,0 0 4px rgba(0,0,0,.9),0 0 8px rgba(0,0,0,.7),0 1px 2px rgba(0,0,0,.8);-webkit-text-stroke:.5px rgba(0,0,0,.5)}
.character-tab-container[data-v-684d53c6]{width:100%;height:100%;display:flex;flex-direction:column;background-color:#1a1a1a;color:#e0e0e0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif}.add-character-button[data-v-684d53c6]{padding:8px 16px;border:none;border-radius:6px;font-size:14px;font-weight:500;cursor:pointer;transition:background-color .2s;background:#007acc;color:#fff;margin-top:12px}.add-character-button[data-v-684d53c6]:hover{background:#005a99}.character-content[data-v-684d53c6],.character-detail-content[data-v-684d53c6]{flex:1;padding:12px;gap:16px;overflow-y:auto;display:flex;flex-direction:column;min-height:var(--v1299b277);max-height:var(--v1299b277)}.character-content[data-v-684d53c6]::-webkit-scrollbar,.character-detail-content[data-v-684d53c6]::-webkit-scrollbar{width:8px}.character-content[data-v-684d53c6]::-webkit-scrollbar-track,.character-detail-content[data-v-684d53c6]::-webkit-scrollbar-track{background:#2a2a2a;border-radius:4px}.character-content[data-v-684d53c6]::-webkit-scrollbar-thumb,.character-detail-content[data-v-684d53c6]::-webkit-scrollbar-thumb{background:#555;border-radius:4px}.character-content[data-v-684d53c6]::-webkit-scrollbar-thumb:hover,.character-detail-content[data-v-684d53c6]::-webkit-scrollbar-thumb:hover{background:#666}.character-section[data-v-684d53c6]{margin-bottom:24px}.character-section[data-v-684d53c6]:last-child{margin-bottom:0}.section-title[data-v-684d53c6]{font-size:18px;font-weight:600;color:#007acc;margin:0 0 12px 0;padding-bottom:8px;border-bottom:2px solid #007acc}.character-list[data-v-684d53c6]{display:flex;flex-direction:column;gap:8px}.character-item[data-v-684d53c6]{background:#252525;padding:12px 16px;border-radius:8px;border:1px solid #404040;display:flex;flex-direction:row;align-items:center;gap:16px;font-size:14px;transition:background-color .2s}.character-item.clickable[data-v-684d53c6]{cursor:pointer}.character-item.clickable[data-v-684d53c6]:hover{background:#2a2a2a;border-color:#555}.toggle-status-button[data-v-684d53c6]{background:#007acc;color:#fff;border:none;border-radius:4px;width:24px;height:24px;cursor:pointer;font-size:14px;font-weight:bold;display:flex;align-items:center;justify-content:center;flex-shrink:0;transition:background-color .2s}.toggle-status-button[data-v-684d53c6]:hover{background:#005a99}.toggle-status-button[data-v-684d53c6]:active{background:#004080}.character-id[data-v-684d53c6]{color:#fff;font-weight:700;min-width:40px;text-align:center;padding:6px 10px;border-radius:6px;font-size:14px;display:flex;align-items:center;justify-content:center;height:24px;text-shadow:0 1px 2px rgba(0,0,0,.3)}.user-id[data-v-684d53c6]{color:#fff;font-weight:700;min-width:40px;text-align:center;padding:6px 10px;border-radius:6px;font-size:14px;display:flex;align-items:center;justify-content:center;height:24px;width:80px;text-shadow:0 1px 2px rgba(0,0,0,.3)}.character-name[data-v-684d53c6]{color:#e0e0e0;font-weight:500;text-align:center;flex:1}.user-name[data-v-684d53c6]{color:#e0e0e0;font-weight:500;flex:1}.character-info[data-v-684d53c6]{display:flex;flex-direction:column;gap:8px;flex-shrink:0;min-width:0;width:80px}.user-character-info[data-v-684d53c6]{flex-direction:row;align-items:center;-moz-column-gap:16px;column-gap:16px;height:auto;width:auto}.character-progress-bars[data-v-684d53c6]{display:flex;flex-direction:column;gap:4px;flex:1;min-width:0}.character-progress-bars[data-v-684d53c6] .progress-bar-wrapper{height:16px}.character-progress-bars[data-v-684d53c6] .progress-bar-value{font-size:12px}.no-characters-message[data-v-684d53c6]{background:#252525;padding:16px 12px;border-radius:6px;border:1px solid #404040;color:#888;text-align:center;font-size:14px;font-style:italic}.character-header[data-v-684d53c6]{text-align:center;position:relative}.character-detail-name[data-v-684d53c6]{font-size:24px;font-weight:700;color:#007acc;margin:0;text-shadow:0 2px 4px rgba(0,0,0,.3)}.header-buttons[data-v-684d53c6]{position:absolute;top:0;left:0;display:flex;gap:8px}.edit-button[data-v-684d53c6],.delete-button[data-v-684d53c6]{padding:8px 16px;border:none;border-radius:6px;font-size:14px;font-weight:500;cursor:pointer;transition:background-color .2s;background:#007acc;color:#fff}.edit-button[data-v-684d53c6]:hover,.delete-button[data-v-684d53c6]:hover{background:#005a99}.delete-button[data-v-684d53c6]{background:#f44336}.delete-button[data-v-684d53c6]:hover{background:#da190b}.back-button[data-v-684d53c6]{position:absolute;top:0;right:0;background:#007acc;color:#fff;border:none;padding:8px 12px;border-radius:6px;cursor:pointer;font-size:14px;font-weight:500;transition:background-color .2s}.back-button[data-v-684d53c6]:hover{background:#005a99}.attributes-grid[data-v-684d53c6]{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:12px;margin-bottom:20px}.attribute-item[data-v-684d53c6]{background:#252525;padding:12px;border-radius:8px;text-align:center;border:1px solid #404040}.attribute-item.full-width[data-v-684d53c6]{grid-column:1/-1;text-align:left;padding:16px}.attribute-item.horizontal[data-v-684d53c6]{display:flex;justify-content:space-between;align-items:center;text-align:left}.attribute-item.horizontal .attribute-label[data-v-684d53c6]{margin-bottom:0;flex-shrink:0}.attribute-item.horizontal .attribute-value[data-v-684d53c6]{margin-left:auto}.attribute-item.horizontal .attribute-input[data-v-684d53c6]{margin-left:8px}.attribute-item.birthday-fullwidth[data-v-684d53c6]{display:flex;justify-content:space-between;align-items:center;text-align:left}.attribute-item.birthday-fullwidth .attribute-label[data-v-684d53c6]{margin-bottom:0;flex-shrink:0}.attribute-item.birthday-fullwidth .attribute-value[data-v-684d53c6]{margin-left:auto}.attribute-item.birthday-fullwidth .birthday-edit-container[data-v-684d53c6]{margin-left:auto;justify-content:flex-end}.attribute-item.mood-horny-layout[data-v-684d53c6]{display:flex;justify-content:space-between;align-items:center;text-align:left}.attribute-item.mood-horny-layout .attribute-label[data-v-684d53c6]{margin-bottom:0;flex-shrink:0}.attribute-item.mood-horny-layout .attribute-value[data-v-684d53c6]{margin-left:auto}.attribute-item.mood-horny-layout .attribute-input[data-v-684d53c6]{margin-left:auto;width:auto;min-width:80px}.attribute-item .progress-edit-container[data-v-684d53c6]{display:flex;justify-content:space-between;align-items:center;gap:12px}.attribute-item .progress-edit-container .attribute-label[data-v-684d53c6]{margin-bottom:0;flex-shrink:0}.attribute-item .progress-edit-container .attribute-input[data-v-684d53c6]{width:auto;min-width:80px}.attribute-label[data-v-684d53c6]{display:block;font-size:12px;color:#888;margin-bottom:6px;text-transform:uppercase;letter-spacing:.5px;font-weight:500}.attribute-label.unit-label[data-v-684d53c6]{text-transform:none}.required-asterisk[data-v-684d53c6]{color:#f44336;font-weight:bold;margin-left:2px}.attribute-value[data-v-684d53c6]{display:block;font-size:16px;font-weight:600;color:#e0e0e0}.attribute-value.money[data-v-684d53c6]{color:#4caf50;font-weight:700}.attribute-value.no-bold[data-v-684d53c6]{font-weight:400}.relations-section[data-v-684d53c6],.inventory-section[data-v-684d53c6],.friendships-section[data-v-684d53c6],.loves-section[data-v-684d53c6]{margin-bottom:16px}.relations-section[data-v-684d53c6]:last-child,.inventory-section[data-v-684d53c6]:last-child,.friendships-section[data-v-684d53c6]:last-child,.loves-section[data-v-684d53c6]:last-child{margin-bottom:0}.list-container[data-v-684d53c6],.relations-list[data-v-684d53c6],.inventory-list[data-v-684d53c6],.friendships-list[data-v-684d53c6],.loves-list[data-v-684d53c6],.relations-edit-list[data-v-684d53c6],.inventory-edit-list[data-v-684d53c6],.friendships-edit-list[data-v-684d53c6],.loves-edit-list[data-v-684d53c6]{display:flex;flex-direction:column;gap:8px}.relation-item[data-v-684d53c6]{background:#252525;padding:10px 12px;border-radius:6px;border:1px solid #404040;font-size:14px;color:#e0e0e0;line-height:1.4}.friendship-item[data-v-684d53c6],.love-item[data-v-684d53c6]{background:#252525;padding:12px;border-radius:6px;border:1px solid #404040;display:flex;flex-direction:row;align-items:center;gap:12px}.relation-highlight[data-v-684d53c6]{color:#fff;font-weight:500}.friendship-name[data-v-684d53c6],.love-name[data-v-684d53c6]{font-size:14px;color:#e0e0e0;line-height:1.4;white-space:nowrap;flex-shrink:0}.friendship-highlight[data-v-684d53c6],.love-highlight[data-v-684d53c6]{color:#fff;font-weight:500}.connector[data-v-684d53c6]{color:#888;font-weight:400}.edit-item[data-v-684d53c6]{background:#252525;padding:10px 12px;border-radius:6px;border:1px solid #404040;display:flex;align-items:center;gap:8px;flex-wrap:wrap}.edit-connector[data-v-684d53c6]{color:#888;font-weight:400;font-size:14px;white-space:nowrap}.input-field[data-v-684d53c6]{background:#333;border:1px solid #555;border-radius:4px;color:#e0e0e0;padding:4px 8px;font-size:14px;flex:1;min-width:50px}.input-field[data-v-684d53c6]:focus{outline:none;border-color:#007acc}.relation-select[data-v-684d53c6],.inventory-select[data-v-684d53c6]{background:#333;border:1px solid #555;border-radius:4px;color:#e0e0e0;padding:4px 8px;font-size:14px;min-width:120px;flex-shrink:0}.relation-select[data-v-684d53c6]:focus,.inventory-select[data-v-684d53c6]:focus{outline:none;border-color:#007acc}.relation-select option[data-v-684d53c6],.inventory-select option[data-v-684d53c6]{background:#333;color:#e0e0e0}.relation-select option[data-v-684d53c6]:disabled,.inventory-select option[data-v-684d53c6]:disabled{color:#888;font-style:italic}.btn[data-v-684d53c6],.action-btn[data-v-684d53c6],.relation-remove-btn[data-v-684d53c6],.add-relation-btn[data-v-684d53c6],.friendship-remove-btn[data-v-684d53c6],.add-friendship-btn[data-v-684d53c6],.love-remove-btn[data-v-684d53c6],.add-love-btn[data-v-684d53c6],.add-inventory-btn[data-v-684d53c6]{background:#007acc;color:#fff;border:none;padding:8px 16px;border-radius:6px;cursor:pointer;font-size:14px;font-weight:500;margin-top:8px;transition:background-color .2s}.btn[data-v-684d53c6]:hover,.action-btn[data-v-684d53c6]:hover,.relation-remove-btn[data-v-684d53c6]:hover,.add-relation-btn[data-v-684d53c6]:hover,.friendship-remove-btn[data-v-684d53c6]:hover,.add-friendship-btn[data-v-684d53c6]:hover,.love-remove-btn[data-v-684d53c6]:hover,.add-love-btn[data-v-684d53c6]:hover,.add-inventory-btn[data-v-684d53c6]:hover{background:#005a99}.inventory-item[data-v-684d53c6]{background:#252525;padding:10px 12px;border-radius:6px;border:1px solid #404040;display:flex;flex-direction:column;gap:6px}.inventory-first-row[data-v-684d53c6]{display:flex;justify-content:space-between;align-items:center}.item-name-id[data-v-684d53c6]{font-weight:500;color:#fff;font-size:14px}.item-quantity[data-v-684d53c6]{font-weight:600;color:#e0e0e0;background:#007acc;padding:2px 8px;border-radius:12px;font-size:12px}.storage-indicator[data-v-684d53c6]{font-weight:600;color:#fff;background:#4caf50;padding:2px 8px;border-radius:12px;font-size:12px}[data-v-684d53c6] .inventory-item-tag{background:#4caf50;color:#fff;padding:2px 6px;border-radius:4px;font-size:12px;display:flex;align-items:center;gap:4px;white-space:nowrap;flex-shrink:0}[data-v-684d53c6] .storage-item-tag{background:#ff9800;color:#fff;padding:2px 6px;border-radius:4px;font-size:12px;display:flex;align-items:center;gap:4px;white-space:nowrap;flex-shrink:0}.inventory-second-row[data-v-684d53c6]{font-size:12px;color:#a0a0a0;line-height:1.4}.inventory-third-row[data-v-684d53c6]{display:flex;flex-direction:column;gap:4px}.no-inventory[data-v-684d53c6]{color:#888;font-style:italic;font-size:13px}.inventory-items[data-v-684d53c6]{display:flex;flex-wrap:wrap;gap:4px}.inventory-edit-item[data-v-684d53c6]{background:#252525;padding:10px 12px;border-radius:6px;border:1px solid #404040;display:flex;align-items:center;gap:8px;flex-wrap:wrap}.inventory-edit-connector[data-v-684d53c6]{color:#888;font-weight:400;font-size:14px;white-space:nowrap}.inventory-quantity-input[data-v-684d53c6]{background:#333;border:1px solid #555;border-radius:4px;color:#e0e0e0;padding:4px 8px;font-size:14px;width:80px;text-align:center}.inventory-quantity-input[data-v-684d53c6]:focus{outline:none;border-color:#007acc}.inventory-remove-btn[data-v-684d53c6]{background:#f44336;color:#fff;border:none;border-radius:4px;width:24px;height:24px;cursor:pointer;font-size:16px;font-weight:bold;display:flex;align-items:center;justify-content:center;flex-shrink:0;margin-left:auto}.inventory-remove-btn[data-v-684d53c6]:hover{background:#da190b}.attribute-input[data-v-684d53c6]{background:#333;border:1px solid #555;border-radius:4px;color:#e0e0e0;padding:4px 8px;font-size:14px;width:100%}.attribute-input[data-v-684d53c6]:focus{outline:none;border-color:#007acc}.birthday-inputs[data-v-684d53c6]{display:flex;align-items:center;gap:2px;width:auto;margin-left:auto}.birthday-edit-container[data-v-684d53c6]{display:flex;justify-content:flex-start;width:100%}.birthday-input-group[data-v-684d53c6]{display:flex;align-items:center;gap:4px;padding:4px 0}.birthday-month[data-v-684d53c6],.birthday-date[data-v-684d53c6]{width:50px;flex-shrink:0}.birthday-separator[data-v-684d53c6]{color:#888;font-size:14px;white-space:nowrap}.attribute-textarea[data-v-684d53c6]{background:#333;border:1px solid #555;border-radius:4px;color:#e0e0e0;padding:8px;font-size:14px;width:100%;min-height:60px;resize:vertical;font-family:inherit}.attribute-textarea[data-v-684d53c6]:focus{outline:none;border-color:#007acc}.edit-buttons[data-v-684d53c6]{display:flex;justify-content:center;gap:16px;margin-top:20px;padding-top:20px;border-top:1px solid #404040}.confirm-button[data-v-684d53c6],.cancel-button[data-v-684d53c6]{padding:8px 16px;border:none;border-radius:6px;font-size:14px;font-weight:500;cursor:pointer;transition:background-color .2s;background:#007acc;color:#fff}.confirm-button[data-v-684d53c6]:hover,.cancel-button[data-v-684d53c6]:hover{background:#005a99}.confirm-button[data-v-684d53c6]{background:#4caf50;color:#fff}.confirm-button[data-v-684d53c6]:hover:not(:disabled){background:#45a049}.confirm-button[data-v-684d53c6]:disabled{background:#666;cursor:not-allowed;opacity:.6}.cancel-button[data-v-684d53c6]{background:#f44336;color:#fff}.cancel-button[data-v-684d53c6]:hover{background:#da190b}@media (max-width:768px){.character-content[data-v-684d53c6],.character-detail-content[data-v-684d53c6]{padding:12px}.character-name[data-v-684d53c6]{font-size:24px}.attributes-grid[data-v-684d53c6]{grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:8px}.attribute-item[data-v-684d53c6]{padding:10px}.attribute-item.full-width[data-v-684d53c6]{padding:12px}.attribute-value[data-v-684d53c6]{font-size:14px}.inventory-item[data-v-684d53c6]{gap:4px}[data-v-684d53c6] .inventory-item-tag{font-size:12px;padding:2px 6px}.inventory-third-row[data-v-684d53c6] .inventory-item-tag{font-size:12px;padding:2px 6px}.character-item[data-v-684d53c6]{padding:10px 12px;gap:12px;flex-wrap:wrap}.user-character-info[data-v-684d53c6]{-moz-column-gap:16px;column-gap:16px;height:auto}.character-progress-bars[data-v-684d53c6]{gap:2px;flex:1;min-width:120px}.character-id[data-v-684d53c6]{min-width:35px;padding:3px 6px;font-size:11px;height:16px}.user-id[data-v-684d53c6]{min-width:35px;padding:3px 6px;font-size:11px;height:16px}.character-name[data-v-684d53c6]{font-size:13px;line-height:1.2}}.no-message[data-v-684d53c6]{background:#252525;padding:16px 12px;border-radius:6px;border:1px solid #404040;color:#888;text-align:center;font-size:14px;font-style:italic}
.conversation-tab-container[data-v-18297b7b]{display:flex;flex-direction:column;width:100%;height:100%}.main-content[data-v-18297b7b]{flex:1;display:flex;flex-direction:column;overflow:hidden}.dialogue-fullscreen[data-v-18297b7b]{display:flex;flex-direction:column;flex:1;overflow:hidden}.messages-container[data-v-18297b7b]{flex:1;overflow-y:auto;background-color:#1a1a1a;min-height:var(--v14702539);max-height:var(--v14702539)}.messages-container[data-v-18297b7b]::-webkit-scrollbar{width:8px}.messages-container[data-v-18297b7b]::-webkit-scrollbar-track{background:#2a2a2a;border-radius:4px}.messages-container[data-v-18297b7b]::-webkit-scrollbar-thumb{background:#555;border-radius:4px}.messages-container[data-v-18297b7b]::-webkit-scrollbar-thumb:hover{background:#666}.load-more-container[data-v-18297b7b]{display:flex;justify-content:center;padding:16px;margin-bottom:16px}.load-more-btn[data-v-18297b7b]{background-color:#2a2a2a;border:1px solid #404040;border-radius:20px;color:#b0b0b0;padding:8px 16px;font-size:14px;cursor:pointer;transition:all .2s ease}.load-more-btn[data-v-18297b7b]:hover{background-color:#3a3a3a;border-color:#007acc;color:#007acc}.message[data-v-18297b7b]{position:relative;border-bottom:1px solid #404040}.message.user[data-v-18297b7b]{background:linear-gradient(135deg,rgba(0,122,204,0.05) 0%,rgba(0,122,204,0.02) 100%);border-left:3px solid #007acc}.message.assistant[data-v-18297b7b]{background:linear-gradient(135deg,rgba(40,167,69,0.05) 0%,rgba(40,167,69,0.02) 100%);border-left:3px solid #28a745}.message-content[data-v-18297b7b]{line-height:1.5;word-wrap:break-word;white-space:pre-wrap;padding:16px 16px 24px 16px}[data-v-18297b7b] .dialogue-text{color:#f4c430;font-weight:500}.message-header[data-v-18297b7b]{margin-bottom:8px;background-color:rgba(0,0,0,.3);border-radius:8px 8px 0 0;overflow:hidden}.message-header-row[data-v-18297b7b]{display:flex;align-items:center;justify-content:space-between;padding:8px 16px}.message-status-row[data-v-18297b7b]{padding:4px 16px;background-color:rgba(0,0,0,.2);border-top:1px solid hsla(0,0%,100%,.1)}.message-id[data-v-18297b7b]{color:#b0b0b0;font-size:12px;font-weight:500;opacity:.8}.status-info[data-v-18297b7b]{color:#e0e0e0;font-size:12px;font-weight:400;opacity:.9;text-align:center;overflow:hidden;text-overflow:ellipsis}.status-datetime[data-v-18297b7b]{margin-bottom:2px}.status-location[data-v-18297b7b]{font-size:11px;opacity:.8}.message-actions[data-v-18297b7b]{display:flex;gap:8px}.edit-message-btn[data-v-18297b7b],.rewind-message-btn[data-v-18297b7b]{background:none;border:none;color:#888;font-size:14px;cursor:pointer;opacity:1;transition:opacity .2s ease;padding:4px 8px;border-radius:4px}.edit-message-btn[data-v-18297b7b]:hover,.rewind-message-btn[data-v-18297b7b]:hover{background-color:hsla(0,0%,100%,.1)}.edit-message-btn[data-v-18297b7b]:hover{color:#007acc}.rewind-message-btn[data-v-18297b7b]:hover{color:#28a745}.edit-mode[data-v-18297b7b]{width:100%;padding-left:16px}.edit-textarea[data-v-18297b7b]{width:100%;padding:12px;background-color:#2a2a2a;border:1px solid #007acc;border-radius:8px;color:#e0e0e0;font-size:14px;font-family:inherit;line-height:1.4;resize:none;outline:none;min-height:60px;field-sizing:content}.edit-textarea[data-v-18297b7b]:focus{border-color:#0056b3}.edit-textarea[data-v-18297b7b]::placeholder{color:#888}.edit-controls[data-v-18297b7b]{display:flex;justify-content:flex-end;gap:8px;margin-top:8px}.edit-btn[data-v-18297b7b]{width:32px;height:32px;border:none;border-radius:50%;cursor:pointer;font-size:16px;font-weight:bold;display:flex;align-items:center;justify-content:center;transition:all .2s ease}.edit-btn.confirm-btn[data-v-18297b7b]{background-color:#28a745;color:#fff}.edit-btn.confirm-btn[data-v-18297b7b]:hover{background-color:#218838}.edit-btn.cancel-btn[data-v-18297b7b]{background-color:#dc3545;color:#fff}.edit-btn.cancel-btn[data-v-18297b7b]:hover{background-color:#c82333}.swipe-controls[data-v-18297b7b]{display:flex;align-items:center;justify-content:center;gap:8px;padding:12px 16px;background-color:rgba(0,0,0,.4);border:1px solid hsla(0,0%,100%,.1);backdrop-filter:blur(4px)}.swipe-btn[data-v-18297b7b]{background:none;border:none;color:#007acc;font-size:18px;font-weight:bold;cursor:pointer;padding:2px 6px;border-radius:4px;transition:background-color .2s ease}.swipe-btn[data-v-18297b7b]:hover:not(:disabled){background-color:rgba(0,122,204,.2)}.swipe-btn[data-v-18297b7b]:disabled{color:#666;cursor:not-allowed}.swipe-indicator[data-v-18297b7b]{color:#b0b0b0;font-size:12px;font-weight:500;min-width:40px;text-align:center}.delete-btn[data-v-18297b7b]{color:#ff6b6b !important;font-size:16px;font-weight:bold}.delete-btn[data-v-18297b7b]:hover:not(:disabled){background-color:rgba(255,107,107,.2)}.delete-btn[data-v-18297b7b]:disabled{color:#666 !important;cursor:not-allowed}.input-area[data-v-18297b7b]{padding:16px;background-color:#1a1a1a;border-top:1px solid #404040}.input-container[data-v-18297b7b]{display:flex;gap:8px;align-items:center}.message-input[data-v-18297b7b]{flex:1;padding:12px 16px;background-color:#2a2a2a;border:1px solid #404040;border-radius:24px;color:#e0e0e0;font-size:16px;outline:none;transition:border-color .2s ease;resize:none;min-height:20px;max-height:120px}.message-input[data-v-18297b7b]::-webkit-scrollbar{display:none}.message-input[data-v-18297b7b]{-ms-overflow-style:none;scrollbar-width:none}.message-input[data-v-18297b7b]:focus{border-color:#007acc}.message-input[data-v-18297b7b]::placeholder{color:#888}.send-button[data-v-18297b7b]{padding:12px 20px;background-color:#007acc;border:none;border-radius:24px;color:#fff;font-size:16px;font-weight:500;cursor:pointer;transition:background-color .2s ease;white-space:nowrap}.send-button[data-v-18297b7b]:hover{background-color:#0056b3}.send-button[data-v-18297b7b]:active{background-color:#004085}.loading-spinner[data-v-18297b7b]{width:20px;height:20px;border:2px solid #404040;border-top:2px solid #007acc;border-radius:50%;animation:spin-18297b7b 1s linear infinite;flex-shrink:0}@keyframes spin-18297b7b{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}@media (max-width:768px){.input-area[data-v-18297b7b]{padding:12px}.message-input[data-v-18297b7b]{font-size:16px}.send-button[data-v-18297b7b]{padding:12px 16px;font-size:14px}}
.item-tab-container[data-v-b32ed7ea]{width:100%;height:100%;display:flex;flex-direction:column;background-color:#1a1a1a;color:#e0e0e0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif}.item-content[data-v-b32ed7ea]{flex:1;padding:16px;overflow-y:auto;display:flex;flex-direction:column;min-height:var(--f33397ea);max-height:var(--f33397ea)}.item-content[data-v-b32ed7ea]::-webkit-scrollbar{width:8px}.item-content[data-v-b32ed7ea]::-webkit-scrollbar-track{background:#2a2a2a;border-radius:4px}.item-content[data-v-b32ed7ea]::-webkit-scrollbar-thumb{background:#555;border-radius:4px}.item-content[data-v-b32ed7ea]::-webkit-scrollbar-thumb:hover{background:#666}.item-section[data-v-b32ed7ea]:last-child{margin-bottom:0}.section-title[data-v-b32ed7ea]{font-size:18px;font-weight:600;color:#007acc;margin:0 0 12px 0;padding-bottom:8px;border-bottom:2px solid #007acc}.add-item-button[data-v-b32ed7ea]{padding:8px 16px;border:none;border-radius:6px;font-size:14px;font-weight:500;cursor:pointer;transition:background-color .2s;background:#007acc;color:#fff;margin-top:12px}.add-item-button[data-v-b32ed7ea]:hover{background:#005a99}.item-list[data-v-b32ed7ea]{display:flex;flex-direction:column;gap:8px}.item-row[data-v-b32ed7ea]{background:#252525;padding:12px 16px;border-radius:8px;border:1px solid #404040;display:flex;flex-direction:column;gap:8px;font-size:14px;transition:background-color .2s}.item-row[data-v-b32ed7ea]:hover{background:#2a2a2a;border-color:#555}.new-item-row[data-v-b32ed7ea]{background:#2a2a2a;border-color:#007acc;border-style:dashed}.item-info[data-v-b32ed7ea]{display:flex;flex-direction:column;gap:6px;flex:1}.item-id-name-row[data-v-b32ed7ea]{display:flex;gap:12px;align-items:center}.item-id[data-v-b32ed7ea]{font-weight:500;color:#007acc;font-size:14px}.item-name[data-v-b32ed7ea]{font-weight:500;color:#fff;font-size:16px}.item-description[data-v-b32ed7ea]{color:#a0a0a0;line-height:1.4;font-size:13px}.item-value-actions-row[data-v-b32ed7ea]{display:flex;justify-content:space-between;align-items:center}.item-value[data-v-b32ed7ea]{font-weight:600;color:#4caf50;font-size:14px}.item-actions[data-v-b32ed7ea]{display:flex;gap:8px}.edit-item-button[data-v-b32ed7ea],.delete-item-button[data-v-b32ed7ea]{padding:6px 12px;border:none;border-radius:4px;font-size:12px;cursor:pointer;transition:background-color .2s}.edit-item-button[data-v-b32ed7ea]{background:#007acc;color:#fff}.edit-item-button[data-v-b32ed7ea]:hover{background:#005a99}.delete-item-button[data-v-b32ed7ea]{background:#f44336;color:#fff}.delete-item-button[data-v-b32ed7ea]:hover{background:#da190b}.item-id-input[data-v-b32ed7ea],.item-name-input[data-v-b32ed7ea],.item-value-input[data-v-b32ed7ea]{background:#333;border:1px solid #555;border-radius:4px;color:#e0e0e0;font-size:14px;padding:4px 8px}.item-id-input[data-v-b32ed7ea]:focus,.item-name-input[data-v-b32ed7ea]:focus,.item-value-input[data-v-b32ed7ea]:focus{outline:none;border-color:#007acc}.item-id-input[data-v-b32ed7ea]{font-weight:500;color:#007acc;font-size:14px;width:50px;flex-shrink:0;text-align:center}.item-name-input[data-v-b32ed7ea]{font-weight:500;color:#fff;font-size:16px;flex:1}.item-value-input[data-v-b32ed7ea]{font-weight:600;color:#4caf50;font-size:14px;width:50px;text-align:left;outline:none}.item-value-input-wrapper[data-v-b32ed7ea]{display:flex;align-items:center;font-weight:600;color:#4caf50;font-size:14px}.dollar-sign[data-v-b32ed7ea]{margin-right:2px}.item-description-input[data-v-b32ed7ea]{background:#333;border:1px solid #555;border-radius:4px;color:#e0e0e0;font-size:13px;padding:6px 8px;resize:vertical;min-height:60px;line-height:1.4}.item-description-input[data-v-b32ed7ea]:focus{outline:none;border-color:#007acc}.confirm-button[data-v-b32ed7ea],.cancel-button[data-v-b32ed7ea]{padding:6px 12px;border:none;border-radius:4px;font-size:12px;cursor:pointer;transition:background-color .2s}.confirm-button[data-v-b32ed7ea]{background:#4caf50;color:#fff}.confirm-button[data-v-b32ed7ea]:hover{background:#45a049}.cancel-button[data-v-b32ed7ea]{background:#f44336;color:#fff}.cancel-button[data-v-b32ed7ea]:hover{background:#da190b}.no-items-message[data-v-b32ed7ea]{background:#252525;padding:16px 12px;border-radius:6px;border:1px solid #404040;color:#888;text-align:center;font-size:14px;font-style:italic}@media (max-width:768px){.item-content[data-v-b32ed7ea]{padding:12px}.section-title[data-v-b32ed7ea]{font-size:18px}.item-row[data-v-b32ed7ea]{padding:10px 12px;gap:6px}.item-info[data-v-b32ed7ea]{gap:4px}.item-name[data-v-b32ed7ea]{font-size:15px}.item-description[data-v-b32ed7ea]{font-size:12px}.item-actions[data-v-b32ed7ea]{gap:6px}.edit-item-button[data-v-b32ed7ea],.delete-item-button[data-v-b32ed7ea]{padding:5px 10px;font-size:11px}.item-id-input[data-v-b32ed7ea],.item-name-input[data-v-b32ed7ea],.item-value-input[data-v-b32ed7ea]{font-size:13px;padding:3px 6px}.item-description-input[data-v-b32ed7ea]{font-size:12px;padding:4px 6px;min-height:50px}.confirm-button[data-v-b32ed7ea],.cancel-button[data-v-b32ed7ea]{padding:5px 10px;font-size:11px}}
.location-tab-container[data-v-bd354e5e]{width:100%;height:100%;display:flex;flex-direction:column;background-color:#1a1a1a;color:#e0e0e0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif}.location-content[data-v-bd354e5e]{flex:1;padding:16px;overflow-y:auto;display:flex;flex-direction:column;min-height:var(--v77958077);max-height:var(--v77958077)}.location-content[data-v-bd354e5e]::-webkit-scrollbar{width:8px}.location-content[data-v-bd354e5e]::-webkit-scrollbar-track{background:#2a2a2a;border-radius:4px}.location-content[data-v-bd354e5e]::-webkit-scrollbar-thumb{background:#555;border-radius:4px}.location-content[data-v-bd354e5e]::-webkit-scrollbar-thumb:hover{background:#666}.location-section[data-v-bd354e5e]:last-child{margin-bottom:0}.section-title[data-v-bd354e5e]{font-size:18px;font-weight:600;color:#007acc;margin:0 0 12px 0;padding-bottom:8px;border-bottom:2px solid #007acc}.add-location-button[data-v-bd354e5e]{padding:8px 16px;border:none;border-radius:6px;font-size:14px;font-weight:500;cursor:pointer;transition:background-color .2s;background:#007acc;color:#fff;margin-top:12px}.add-location-button[data-v-bd354e5e]:hover{background:#005a99}.location-list[data-v-bd354e5e]{display:flex;flex-direction:column;gap:8px}.location-row[data-v-bd354e5e]{background:#252525;padding:12px 16px;border-radius:8px;border:1px solid #404040;display:flex;flex-direction:column;gap:8px;font-size:14px;transition:background-color .2s}.location-row[data-v-bd354e5e]:hover{background:#2a2a2a;border-color:#555}.new-location-row[data-v-bd354e5e]{background:#2a2a2a;border-color:#007acc;border-style:dashed}.location-first-row[data-v-bd354e5e]{display:flex;justify-content:space-between;align-items:center;gap:12px}.location-location-row[data-v-bd354e5e]{display:flex;justify-content:space-between;align-items:center;gap:8px;margin-top:6px}.location-location-group[data-v-bd354e5e]{display:flex;align-items:center;gap:8px}.location-location-label[data-v-bd354e5e]{font-weight:500;color:#a0a0a0;font-size:13px;min-width:40px}.location-edit-actions[data-v-bd354e5e]{display:flex;gap:8px}.location-id-name-group[data-v-bd354e5e]{display:flex;gap:12px;align-items:center;flex:1}.location-id[data-v-bd354e5e]{font-weight:500;color:#007acc;font-size:14px}.location-name[data-v-bd354e5e]{font-weight:500;color:#fff;font-size:16px}.location-location[data-v-bd354e5e]{font-weight:500;color:#fff;font-size:16px}.location-location-input[data-v-bd354e5e]{font-weight:500;color:#fff;font-size:16px;width:35px;flex-shrink:0}.location-location-input-edit[data-v-bd354e5e]{background:#333;border:1px solid #555;border-radius:4px;padding:4px 8px}.location-location-input-edit[data-v-bd354e5e]:focus{outline:none;border-color:#007acc}.location-parent-display[data-v-bd354e5e]{display:flex;flex-wrap:wrap;gap:4px}.location-parent-tag[data-v-bd354e5e]{background:#007acc;color:#fff;padding:4px 10px;border-radius:4px;font-size:13px;display:flex;align-items:center;gap:4px;cursor:pointer;transition:opacity .2s}.location-parent-tag[data-v-bd354e5e]:hover{opacity:.8}.location-children-display[data-v-bd354e5e]{display:flex;flex-wrap:wrap;gap:4px}.location-child-tag[data-v-bd354e5e]{background:#4caf50;color:#fff;padding:4px 10px;border-radius:4px;font-size:13px;display:flex;align-items:center;gap:4px;cursor:pointer;transition:opacity .2s}.location-child-tag[data-v-bd354e5e]:hover{opacity:.8}.location-storages-display[data-v-bd354e5e]{display:flex;flex-wrap:wrap;gap:4px}.location-storage-tag[data-v-bd354e5e]{background:#ff9800;color:#fff;padding:4px 10px;border-radius:4px;font-size:13px;display:flex;align-items:center;gap:4px}.location-description[data-v-bd354e5e]{color:#a0a0a0;line-height:1.4;font-size:13px}.location-actions[data-v-bd354e5e]{display:flex;gap:8px}.edit-location-button[data-v-bd354e5e],.delete-location-button[data-v-bd354e5e]{padding:6px 12px;border:none;border-radius:4px;font-size:12px;cursor:pointer;transition:background-color .2s}.edit-location-button[data-v-bd354e5e]{background:#007acc;color:#fff}.edit-location-button[data-v-bd354e5e]:hover{background:#005a99}.delete-location-button[data-v-bd354e5e]{background:#f44336;color:#fff}.delete-location-button[data-v-bd354e5e]:hover{background:#da190b}.location-id-input[data-v-bd354e5e],.location-name-input[data-v-bd354e5e],.location-location-input[data-v-bd354e5e],.location-description-input[data-v-bd354e5e]{background:#333;border:1px solid #555;border-radius:4px;color:#e0e0e0;font-size:14px;padding:4px 8px;width:35px;-webkit-appearance:none;appearance:none;appearance:none}.location-id-input[data-v-bd354e5e]:focus,.location-name-input[data-v-bd354e5e]:focus,.location-location-input[data-v-bd354e5e]:focus,.location-description-input[data-v-bd354e5e]:focus{outline:none;border-color:#007acc}.location-id-input[data-v-bd354e5e]::-webkit-outer-spin-button,.location-id-input[data-v-bd354e5e]::-webkit-inner-spin-button,.location-name-input[data-v-bd354e5e]::-webkit-outer-spin-button,.location-name-input[data-v-bd354e5e]::-webkit-inner-spin-button,.location-location-input[data-v-bd354e5e]::-webkit-outer-spin-button,.location-location-input[data-v-bd354e5e]::-webkit-inner-spin-button,.location-description-input[data-v-bd354e5e]::-webkit-outer-spin-button,.location-description-input[data-v-bd354e5e]::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}.location-id-input[type=number][data-v-bd354e5e],.location-name-input[type=number][data-v-bd354e5e],.location-location-input[type=number][data-v-bd354e5e],.location-description-input[type=number][data-v-bd354e5e]{-webkit-appearance:textfield;appearance:textfield}.location-id-input[data-v-bd354e5e]{font-weight:500;color:#007acc;font-size:14px;width:50px;flex-shrink:0;text-align:center}.location-name-input[data-v-bd354e5e]{font-weight:500;color:#fff;font-size:16px;width:120px;flex-shrink:0}.location-parent-input-group[data-v-bd354e5e]{display:flex;flex-direction:column;gap:6px}.location-children-input-group[data-v-bd354e5e]{display:flex;flex-direction:column;gap:6px}.selected-children[data-v-bd354e5e]{display:flex;flex-wrap:wrap;gap:4px}.selected-child-tag[data-v-bd354e5e]{background:#4caf50;color:#fff;padding:3px 8px;border-radius:4px;font-size:11px;display:flex;align-items:center;gap:4px}.remove-child-btn[data-v-bd354e5e]{background:none;border:none;color:#fff;cursor:pointer;font-size:14px;line-height:1;padding:0;margin-left:2px}.remove-child-btn[data-v-bd354e5e]:hover{color:#ccc}.location-storages-input-group[data-v-bd354e5e]{display:flex;flex-direction:column;gap:6px}.selected-storages[data-v-bd354e5e]{display:flex;flex-wrap:wrap;gap:4px}.selected-storage-tag[data-v-bd354e5e]{background:#ff9800;color:#fff;padding:3px 8px;border-radius:4px;font-size:11px;display:flex;align-items:center;gap:4px}.remove-storage-btn[data-v-bd354e5e]{background:none;border:none;color:#fff;cursor:pointer;font-size:14px;line-height:1;padding:0;margin-left:2px}.remove-storage-btn[data-v-bd354e5e]:hover{color:#ccc}.parent-location-select[data-v-bd354e5e],.child-location-select[data-v-bd354e5e],.storage-location-select[data-v-bd354e5e]{background:#333;border:1px solid #555;border-radius:4px;color:#e0e0e0;font-size:13px;padding:4px 8px}.parent-location-select[data-v-bd354e5e]:focus,.child-location-select[data-v-bd354e5e]:focus,.storage-location-select[data-v-bd354e5e]:focus{outline:none;border-color:#007acc}.location-description-input[data-v-bd354e5e]{background:#333;border:1px solid #555;border-radius:4px;color:#e0e0e0;font-size:13px;padding:6px 8px;resize:vertical;min-height:60px;line-height:1.4;width:100%}.location-description-input[data-v-bd354e5e]:focus{outline:none;border-color:#007acc}.confirm-button[data-v-bd354e5e],.cancel-button[data-v-bd354e5e]{padding:6px 12px;border:none;border-radius:4px;font-size:12px;cursor:pointer;transition:background-color .2s}.confirm-button[data-v-bd354e5e]{background:#4caf50;color:#fff}.confirm-button[data-v-bd354e5e]:hover{background:#45a049}.cancel-button[data-v-bd354e5e]{background:#f44336;color:#fff}.cancel-button[data-v-bd354e5e]:hover{background:#da190b}.no-locations-message[data-v-bd354e5e]{background:#252525;padding:16px 12px;border-radius:6px;border:1px solid #404040;color:#888;text-align:center;font-size:14px;font-style:italic}@media (max-width:768px){.location-content[data-v-bd354e5e]{padding:12px}.section-title[data-v-bd354e5e]{font-size:18px}.location-row[data-v-bd354e5e]{padding:10px 12px;gap:6px}.location-first-row[data-v-bd354e5e]{gap:8px}.location-location-row[data-v-bd354e5e]{gap:6px;margin-top:4px}.location-location-group[data-v-bd354e5e]{gap:6px}.location-location-label[data-v-bd354e5e]{font-size:12px;min-width:35px}.location-name[data-v-bd354e5e]{font-size:15px}.location-location[data-v-bd354e5e]{font-size:15px}.location-location-input[data-v-bd354e5e]{font-size:15px;width:100px}.location-edit-actions[data-v-bd354e5e]{gap:6px}.location-description[data-v-bd354e5e]{font-size:12px}.location-actions[data-v-bd354e5e]{gap:6px}.edit-location-button[data-v-bd354e5e],.delete-location-button[data-v-bd354e5e]{padding:5px 10px;font-size:11px}.location-id-input[data-v-bd354e5e],.location-name-input[data-v-bd354e5e],.location-location-input[data-v-bd354e5e]{font-size:13px;padding:3px 6px}.location-id-input[data-v-bd354e5e]{width:40px}.location-name-input[data-v-bd354e5e]{width:100px}.parent-location-select[data-v-bd354e5e],.child-location-select[data-v-bd354e5e],.storage-location-select[data-v-bd354e5e]{font-size:12px;padding:3px 6px}.selected-child-tag[data-v-bd354e5e],.location-child-tag[data-v-bd354e5e],.location-parent-tag[data-v-bd354e5e],.location-storage-tag[data-v-bd354e5e],.selected-storage-tag[data-v-bd354e5e]{font-size:12px;padding:2px 6px}.location-description-input[data-v-bd354e5e]{font-size:12px;padding:4px 6px;min-height:50px}.confirm-button[data-v-bd354e5e],.cancel-button[data-v-bd354e5e]{padding:5px 10px;font-size:11px}}
.storage-tab-container[data-v-62b84623]{width:100%;height:100%;display:flex;flex-direction:column;background-color:#1a1a1a;color:#e0e0e0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif}.storage-content[data-v-62b84623]{flex:1;padding:16px;overflow-y:auto;display:flex;flex-direction:column;min-height:var(--v4efc9d77);max-height:var(--v4efc9d77)}.storage-content[data-v-62b84623]::-webkit-scrollbar{width:8px}.storage-content[data-v-62b84623]::-webkit-scrollbar-track{background:#2a2a2a;border-radius:4px}.storage-content[data-v-62b84623]::-webkit-scrollbar-thumb{background:#555;border-radius:4px}.storage-content[data-v-62b84623]::-webkit-scrollbar-thumb:hover{background:#666}.storage-section[data-v-62b84623]:last-child{margin-bottom:0}.section-title[data-v-62b84623]{font-size:18px;font-weight:600;color:#007acc;margin:0 0 12px 0;padding-bottom:8px;border-bottom:2px solid #007acc}.add-storage-button[data-v-62b84623]{padding:8px 16px;border:none;border-radius:6px;font-size:14px;font-weight:500;cursor:pointer;transition:background-color .2s;background:#007acc;color:#fff;margin-top:12px}.add-storage-button[data-v-62b84623]:hover{background:#005a99}.storage-list[data-v-62b84623]{display:flex;flex-direction:column;gap:8px}.storage-row[data-v-62b84623]{background:#252525;padding:12px 16px;border-radius:8px;border:1px solid #404040;display:flex;flex-direction:column;gap:8px;font-size:14px;transition:background-color .2s}.storage-row[data-v-62b84623]:hover{background:#2a2a2a;border-color:#555}.new-storage-row[data-v-62b84623]{background:#2a2a2a;border-color:#007acc;border-style:dashed}.storage-first-row[data-v-62b84623]{display:flex;justify-content:space-between;align-items:center;gap:12px}.storage-money-row[data-v-62b84623]{display:flex;justify-content:space-between;align-items:center;gap:8px;margin-top:6px}.storage-money-group[data-v-62b84623]{display:flex;align-items:center;gap:8px}.storage-money-label[data-v-62b84623]{font-weight:500;color:#a0a0a0;font-size:16px;min-width:40px}.storage-edit-actions[data-v-62b84623]{display:flex;gap:8px}.storage-id-name-group[data-v-62b84623]{display:flex;gap:12px;align-items:center;flex:1}.storage-id[data-v-62b84623]{font-weight:500;color:#007acc;font-size:14px}.storage-name[data-v-62b84623]{font-weight:500;color:#fff;font-size:16px}.storage-money[data-v-62b84623]{font-weight:500;color:#4caf50;font-size:16px}.storage-money-input[data-v-62b84623]{font-weight:500;color:#fff;font-size:16px;width:80px;flex-shrink:0}.storage-money-input-edit[data-v-62b84623]{background:#333;border:1px solid #555;border-radius:4px;padding:4px 8px}.storage-money-input-edit[data-v-62b84623]:focus{outline:none;border-color:#007acc}.storage-parent-display[data-v-62b84623]{display:flex;flex-wrap:wrap;gap:4px}.storage-parent-tag[data-v-62b84623]{background:#007acc;color:#fff;padding:4px 10px;border-radius:4px;font-size:13px;display:flex;align-items:center;gap:4px}.storage-inventory-display[data-v-62b84623]{display:flex;flex-direction:column;gap:4px}.no-inventory[data-v-62b84623]{color:#888;font-style:italic;font-size:13px}.inventory-items[data-v-62b84623]{display:flex;flex-wrap:wrap;gap:4px}.inventory-item-tag[data-v-62b84623]{background:#4caf50;color:#fff;padding:2px 6px;border-radius:4px;font-size:13px;display:flex;align-items:center;gap:4px;white-space:nowrap;flex-shrink:0}.storage-item-tag[data-v-62b84623]{background:#ff9800;color:#fff;padding:2px 6px;border-radius:4px;font-size:12px;display:flex;align-items:center;gap:4px;white-space:nowrap;flex-shrink:0}.storage-description[data-v-62b84623]{color:#a0a0a0;line-height:1.4;font-size:13px}.storage-actions[data-v-62b84623]{display:flex;gap:8px}.edit-storage-button[data-v-62b84623],.delete-storage-button[data-v-62b84623]{padding:6px 12px;border:none;border-radius:4px;font-size:12px;cursor:pointer;transition:background-color .2s}.edit-storage-button[data-v-62b84623]{background:#007acc;color:#fff}.edit-storage-button[data-v-62b84623]:hover{background:#005a99}.delete-storage-button[data-v-62b84623]{background:#f44336;color:#fff}.delete-storage-button[data-v-62b84623]:hover{background:#da190b}.storage-id-input[data-v-62b84623],.storage-name-input[data-v-62b84623],.storage-money-input[data-v-62b84623],.storage-description-input[data-v-62b84623]{background:#333;border:1px solid #555;border-radius:4px;color:#e0e0e0;font-size:14px;padding:4px 8px;width:35px;-webkit-appearance:none;appearance:none}.storage-id-input[data-v-62b84623]:focus,.storage-name-input[data-v-62b84623]:focus,.storage-money-input[data-v-62b84623]:focus,.storage-description-input[data-v-62b84623]:focus{outline:none;border-color:#007acc}.storage-id-input[data-v-62b84623]::-webkit-outer-spin-button,.storage-id-input[data-v-62b84623]::-webkit-inner-spin-button,.storage-name-input[data-v-62b84623]::-webkit-outer-spin-button,.storage-name-input[data-v-62b84623]::-webkit-inner-spin-button,.storage-money-input[data-v-62b84623]::-webkit-outer-spin-button,.storage-money-input[data-v-62b84623]::-webkit-inner-spin-button,.storage-description-input[data-v-62b84623]::-webkit-outer-spin-button,.storage-description-input[data-v-62b84623]::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}.storage-id-input[type=number][data-v-62b84623],.storage-name-input[type=number][data-v-62b84623],.storage-money-input[type=number][data-v-62b84623],.storage-description-input[type=number][data-v-62b84623]{-webkit-appearance:textfield;appearance:textfield}.storage-id-input[data-v-62b84623]{font-weight:500;color:#007acc;font-size:14px;width:50px;flex-shrink:0;text-align:center}.storage-name-input[data-v-62b84623]{font-weight:500;color:#fff;font-size:16px;width:120px;flex-shrink:0}.storage-parent-input-group[data-v-62b84623]{display:flex;flex-direction:column;gap:6px}.storage-inventory-input-group[data-v-62b84623]{display:flex;flex-direction:column;gap:6px}.selected-inventory[data-v-62b84623]{display:flex;flex-direction:column;gap:4px}.selected-inventory-item[data-v-62b84623]{display:flex;align-items:center;gap:8px;background:#333;padding:4px 8px;border-radius:4px}.item-name[data-v-62b84623]{flex:1;color:#e0e0e0;font-size:13px}.item-quantity-input[data-v-62b84623]{width:60px;background:#444;border:1px solid #555;border-radius:3px;color:#e0e0e0;padding:2px 4px;font-size:12px;text-align:center}.item-quantity-input[data-v-62b84623]:focus{outline:none;border-color:#007acc}.item-quantity-input[data-v-62b84623]::-webkit-outer-spin-button,.item-quantity-input[data-v-62b84623]::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}.item-quantity-input[type=number][data-v-62b84623]{-webkit-appearance:textfield;appearance:textfield}.inventory-edit-connector[data-v-62b84623]{color:#888;font-weight:400;font-size:14px;white-space:nowrap}.storage-indicator[data-v-62b84623]{font-weight:600;color:#fff;background:#4caf50;padding:2px 8px;border-radius:12px;font-size:12px}.remove-item-btn[data-v-62b84623]{background:none;border:none;color:#f44336;cursor:pointer;font-size:16px;line-height:1;padding:0;margin-left:4px}.remove-item-btn[data-v-62b84623]:hover{color:#da190b}.parent-select[data-v-62b84623],.item-select[data-v-62b84623]{background:#333;border:1px solid #555;border-radius:4px;color:#e0e0e0;font-size:13px;padding:4px 8px}.parent-select[data-v-62b84623]:focus,.item-select[data-v-62b84623]:focus{outline:none;border-color:#007acc}.storage-description-input[data-v-62b84623]{background:#333;border:1px solid #555;border-radius:4px;color:#e0e0e0;font-size:13px;padding:6px 8px;resize:vertical;min-height:60px;line-height:1.4;width:100%}.storage-description-input[data-v-62b84623]:focus{outline:none;border-color:#007acc}.confirm-button[data-v-62b84623],.cancel-button[data-v-62b84623]{padding:6px 12px;border:none;border-radius:4px;font-size:12px;cursor:pointer;transition:background-color .2s}.confirm-button[data-v-62b84623]{background:#4caf50;color:#fff}.confirm-button[data-v-62b84623]:hover:not(:disabled){background:#45a049}.confirm-button[data-v-62b84623]:disabled{background:#666;cursor:not-allowed;opacity:.6}.cancel-button[data-v-62b84623]{background:#f44336;color:#fff}.cancel-button[data-v-62b84623]:hover{background:#da190b}.no-storages-message[data-v-62b84623]{background:#252525;padding:16px 12px;border-radius:6px;border:1px solid #404040;color:#888;text-align:center;font-size:14px;font-style:italic}@media (max-width:768px){.storage-content[data-v-62b84623]{padding:12px}.section-title[data-v-62b84623]{font-size:18px}.storage-row[data-v-62b84623]{padding:10px 12px;gap:6px}.storage-first-row[data-v-62b84623]{gap:8px}.storage-money-row[data-v-62b84623]{gap:6px;margin-top:4px}.storage-money-group[data-v-62b84623]{gap:6px}.storage-money-label[data-v-62b84623]{font-size:15px;min-width:35px}.storage-name[data-v-62b84623]{font-size:15px}.storage-money[data-v-62b84623]{font-size:15px}.storage-money-input[data-v-62b84623]{font-size:15px;width:70px}.storage-edit-actions[data-v-62b84623]{gap:6px}.storage-description[data-v-62b84623]{font-size:12px}.storage-actions[data-v-62b84623]{gap:6px}.edit-storage-button[data-v-62b84623],.delete-storage-button[data-v-62b84623]{padding:5px 10px;font-size:11px}.storage-id-input[data-v-62b84623],.storage-name-input[data-v-62b84623],.storage-money-input[data-v-62b84623]{font-size:13px;padding:3px 6px}.storage-id-input[data-v-62b84623]{width:40px}.storage-name-input[data-v-62b84623]{width:100px}.parent-select[data-v-62b84623],.item-select[data-v-62b84623]{font-size:12px;padding:3px 6px}.selected-inventory-item[data-v-62b84623]{padding:3px 6px}.item-name[data-v-62b84623]{font-size:12px}.item-quantity-input[data-v-62b84623]{width:50px;font-size:11px;padding:2px 3px}.inventory-item-tag[data-v-62b84623],.storage-parent-tag[data-v-62b84623]{font-size:12px;padding:2px 6px}.storage-description-input[data-v-62b84623]{font-size:12px;padding:4px 6px;min-height:50px}.confirm-button[data-v-62b84623],.cancel-button[data-v-62b84623]{padding:5px 10px;font-size:11px}}
.promise-tab-container[data-v-25ffb8d9]{width:100%;height:100%;display:flex;flex-direction:column;background-color:#1a1a1a;color:#e0e0e0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif}.promise-content[data-v-25ffb8d9]{flex:1;padding:16px;overflow-y:auto;display:flex;flex-direction:column;min-height:var(--v592213a0);max-height:var(--v592213a0)}.promise-content[data-v-25ffb8d9]::-webkit-scrollbar{width:8px}.promise-content[data-v-25ffb8d9]::-webkit-scrollbar-track{background:#2a2a2a;border-radius:4px}.promise-content[data-v-25ffb8d9]::-webkit-scrollbar-thumb{background:#555;border-radius:4px}.promise-content[data-v-25ffb8d9]::-webkit-scrollbar-thumb:hover{background:#666}.promise-section[data-v-25ffb8d9]:last-child{margin-bottom:0}.section-title[data-v-25ffb8d9]{font-size:18px;font-weight:600;color:#007acc;margin:0 0 12px 0;padding-bottom:8px;border-bottom:2px solid #007acc}.add-promise-button[data-v-25ffb8d9]{padding:8px 16px;border:none;border-radius:6px;font-size:14px;font-weight:500;cursor:pointer;transition:background-color .2s;background:#007acc;color:#fff;margin-top:12px}.add-promise-button[data-v-25ffb8d9]:hover{background:#005a99}.promise-list[data-v-25ffb8d9]{display:flex;flex-direction:column;gap:8px}.promise-row[data-v-25ffb8d9]{background:#252525;padding:12px 16px;border-radius:8px;border:1px solid #404040;display:flex;flex-direction:column;gap:8px;font-size:14px;transition:background-color .2s}.promise-row[data-v-25ffb8d9]:hover{background:#2a2a2a;border-color:#555}.new-promise-row[data-v-25ffb8d9]{background:#2a2a2a;border-color:#007acc;border-style:dashed}.promise-first-row[data-v-25ffb8d9]{display:flex;justify-content:space-between;align-items:center;gap:12px}.promise-location-row[data-v-25ffb8d9]{display:flex;justify-content:space-between;align-items:center;gap:8px;margin-top:6px}.promise-location-group[data-v-25ffb8d9]{display:flex;align-items:center;gap:8px}.promise-location-label[data-v-25ffb8d9]{font-weight:500;color:#a0a0a0;font-size:13px;min-width:40px}.promise-edit-actions[data-v-25ffb8d9]{display:flex;gap:8px}.promise-id-name-group[data-v-25ffb8d9]{display:flex;gap:12px;align-items:center;flex:1}.promise-id[data-v-25ffb8d9]{font-weight:500;color:#007acc;font-size:14px}.promise-location[data-v-25ffb8d9]{font-weight:500;color:#fff;font-size:16px}.promise-location-input[data-v-25ffb8d9]{font-weight:500;color:#fff;font-size:16px;width:200px;flex-shrink:0}.promise-location-input-edit[data-v-25ffb8d9]{background:#333;border:1px solid #555;border-radius:4px;padding:4px 8px}.promise-location-input-edit[data-v-25ffb8d9]:focus{outline:none;border-color:#007acc}.promise-deadline[data-v-25ffb8d9]{font-weight:500;color:#4caf50;font-size:14px;flex-shrink:0}.promise-character-ids-display[data-v-25ffb8d9]{display:flex;flex-wrap:wrap;gap:4px}.promise-character-id-tag[data-v-25ffb8d9]{background:#007acc;color:#fff;padding:3px 8px;border-radius:4px;font-size:11px;display:flex;align-items:center;gap:4px}.promise-description[data-v-25ffb8d9]{color:#a0a0a0;line-height:1.4;font-size:13px}.promise-actions[data-v-25ffb8d9]{display:flex;gap:8px}.edit-promise-button[data-v-25ffb8d9],.delete-promise-button[data-v-25ffb8d9]{padding:6px 12px;border:none;border-radius:4px;font-size:12px;cursor:pointer;transition:background-color .2s}.edit-promise-button[data-v-25ffb8d9]{background:#007acc;color:#fff}.edit-promise-button[data-v-25ffb8d9]:hover{background:#005a99}.delete-promise-button[data-v-25ffb8d9]{background:#f44336;color:#fff}.delete-promise-button[data-v-25ffb8d9]:hover{background:#da190b}.promise-id-input[data-v-25ffb8d9],.promise-deadline-input[data-v-25ffb8d9],.promise-character-ids-input[data-v-25ffb8d9]{background:#333;border:1px solid #555;border-radius:4px;color:#e0e0e0;font-size:14px;padding:4px 8px;width:35px;-webkit-appearance:none;appearance:none;appearance:none}.promise-id-input[data-v-25ffb8d9]:focus,.promise-deadline-input[data-v-25ffb8d9]:focus,.promise-character-ids-input[data-v-25ffb8d9]:focus{outline:none;border-color:#007acc}.promise-id-input[data-v-25ffb8d9]::-webkit-outer-spin-button,.promise-id-input[data-v-25ffb8d9]::-webkit-inner-spin-button,.promise-deadline-input[data-v-25ffb8d9]::-webkit-outer-spin-button,.promise-deadline-input[data-v-25ffb8d9]::-webkit-inner-spin-button,.promise-character-ids-input[data-v-25ffb8d9]::-webkit-outer-spin-button,.promise-character-ids-input[data-v-25ffb8d9]::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}.promise-id-input[type=number][data-v-25ffb8d9],.promise-deadline-input[type=number][data-v-25ffb8d9],.promise-character-ids-input[type=number][data-v-25ffb8d9]{-webkit-appearance:textfield;appearance:textfield}.promise-id-input[data-v-25ffb8d9]{font-weight:500;color:#007acc;font-size:14px;width:50px;flex-shrink:0;text-align:center}.promise-deadline-input[data-v-25ffb8d9]{color:#4caf50;text-align:center}.promise-deadline-year-input[data-v-25ffb8d9]{width:60px}.promise-deadline-input-group[data-v-25ffb8d9]{display:flex;gap:4px;flex-shrink:0;font-weight:500;color:#4caf50;font-size:14px}.promise-deadline-year[data-v-25ffb8d9],.promise-deadline-month[data-v-25ffb8d9],.promise-deadline-day[data-v-25ffb8d9],.promise-deadline-hour[data-v-25ffb8d9],.promise-deadline-minute[data-v-25ffb8d9]{background:#333;border:1px solid #555;border-radius:4px;color:#4caf50;font-size:12px;padding:4px 6px;width:45px;text-align:center}.promise-deadline-year[data-v-25ffb8d9]:focus,.promise-deadline-month[data-v-25ffb8d9]:focus,.promise-deadline-day[data-v-25ffb8d9]:focus,.promise-deadline-hour[data-v-25ffb8d9]:focus,.promise-deadline-minute[data-v-25ffb8d9]:focus{outline:none;border-color:#007acc}.promise-location-input[data-v-25ffb8d9]{font-weight:500;color:#fff;font-size:16px;width:200px;flex-shrink:0}.promise-character-ids-input-group[data-v-25ffb8d9]{display:flex;flex-direction:column;gap:6px}.selected-characters[data-v-25ffb8d9]{display:flex;flex-wrap:wrap;gap:4px}.selected-character-tag[data-v-25ffb8d9]{background:#007acc;color:#fff;padding:3px 8px;border-radius:4px;font-size:11px;display:flex;align-items:center;gap:4px}.remove-character-btn[data-v-25ffb8d9]{background:none;border:none;color:#fff;cursor:pointer;font-size:14px;line-height:1;padding:0;margin-left:2px}.remove-character-btn[data-v-25ffb8d9]:hover{color:#ccc}.character-select[data-v-25ffb8d9]{background:#333;border:1px solid #555;border-radius:4px;color:#e0e0e0;font-size:13px;padding:4px 8px}.character-select[data-v-25ffb8d9]:focus{outline:none;border-color:#007acc}.promise-description-input[data-v-25ffb8d9]{background:#333;border:1px solid #555;border-radius:4px;color:#e0e0e0;font-size:13px;padding:6px 8px;resize:vertical;min-height:60px;line-height:1.4;width:100%}.promise-description-input[data-v-25ffb8d9]:focus{outline:none;border-color:#007acc}.confirm-button[data-v-25ffb8d9],.cancel-button[data-v-25ffb8d9]{padding:6px 12px;border:none;border-radius:4px;font-size:12px;cursor:pointer;transition:background-color .2s}.confirm-button[data-v-25ffb8d9]{background:#4caf50;color:#fff}.confirm-button[data-v-25ffb8d9]:hover{background:#45a049}.cancel-button[data-v-25ffb8d9]{background:#f44336;color:#fff}.cancel-button[data-v-25ffb8d9]:hover{background:#da190b}.no-promises-message[data-v-25ffb8d9]{background:#252525;padding:16px 12px;border-radius:6px;border:1px solid #404040;color:#888;text-align:center;font-size:14px;font-style:italic}@media (max-width:768px){.promise-content[data-v-25ffb8d9]{padding:12px}.section-title[data-v-25ffb8d9]{font-size:18px}.promise-row[data-v-25ffb8d9]{padding:10px 12px;gap:6px}.promise-first-row[data-v-25ffb8d9]{gap:8px}.promise-location-row[data-v-25ffb8d9]{gap:6px;margin-top:4px}.promise-location-group[data-v-25ffb8d9]{gap:6px}.promise-location-label[data-v-25ffb8d9]{font-size:12px;min-width:35px}.promise-location[data-v-25ffb8d9]{font-size:15px}.promise-location-input[data-v-25ffb8d9]{font-size:15px;width:200px}.promise-edit-actions[data-v-25ffb8d9]{gap:6px}.promise-description[data-v-25ffb8d9]{font-size:12px}.promise-actions[data-v-25ffb8d9]{gap:6px}.edit-promise-button[data-v-25ffb8d9],.delete-promise-button[data-v-25ffb8d9]{padding:5px 10px;font-size:11px}.promise-id-input[data-v-25ffb8d9],.promise-deadline-input[data-v-25ffb8d9],.promise-location-input[data-v-25ffb8d9]{font-size:13px;padding:3px 6px}.promise-deadline-year-input[data-v-25ffb8d9]{width:50px}.promise-deadline-year[data-v-25ffb8d9],.promise-deadline-month[data-v-25ffb8d9],.promise-deadline-day[data-v-25ffb8d9],.promise-deadline-hour[data-v-25ffb8d9],.promise-deadline-minute[data-v-25ffb8d9]{font-size:11px;padding:3px 4px;width:35px}.character-select[data-v-25ffb8d9]{font-size:12px;padding:3px 6px}.selected-character-tag[data-v-25ffb8d9],.promise-character-id-tag[data-v-25ffb8d9]{font-size:10px;padding:1px 4px}.promise-description-input[data-v-25ffb8d9]{font-size:12px;padding:4px 6px;min-height:50px}.confirm-button[data-v-25ffb8d9],.cancel-button[data-v-25ffb8d9]{padding:5px 10px;font-size:11px}}
.settings-container[data-v-40a4165e]{display:flex;flex-direction:column;background-color:#1a1a1a;color:#e0e0e0;overflow:hidden;min-height:var(--b120e3bc);max-height:var(--b120e3bc)}.settings-header[data-v-40a4165e]{padding:20px 16px 16px 16px;border-bottom:1px solid #404040}.settings-header h2[data-v-40a4165e]{margin:0;font-size:24px;font-weight:600;color:#e0e0e0}.settings-list[data-v-40a4165e]{flex:1;overflow-y:auto;padding:8px 0}.setting-item[data-v-40a4165e]{display:flex;align-items:center;justify-content:space-between;padding:16px;border-bottom:1px solid #2a2a2a;transition:background-color .2s ease}.setting-item[data-v-40a4165e]:hover{background-color:hsla(0,0%,100%,.02)}.setting-item[data-v-40a4165e]:last-child{border-bottom:none}.setting-item.xml-rules-item[data-v-40a4165e]{border-bottom:none;padding-bottom:8px}.setting-label[data-v-40a4165e]{flex:1;display:flex;flex-direction:column;gap:4px}.setting-title[data-v-40a4165e]{font-size:16px;font-weight:500;color:#e0e0e0}.setting-description[data-v-40a4165e]{font-size:14px;color:#888;line-height:1.4}.setting-control[data-v-40a4165e]{display:flex;align-items:center;margin-left:16px}.switch[data-v-40a4165e]{position:relative;display:inline-block;width:50px;height:24px}.switch input[data-v-40a4165e]{opacity:0;width:0;height:0}.slider[data-v-40a4165e]{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background-color:#404040;transition:.3s;border-radius:24px}.slider[data-v-40a4165e]:before{position:absolute;content:"";height:18px;width:18px;left:3px;bottom:3px;background-color:#fff;transition:.3s;border-radius:50%}input:checked+.slider[data-v-40a4165e]{background-color:#007acc}input:checked+.slider[data-v-40a4165e]:before{transform:translateX(26px)}.number-input[data-v-40a4165e]{width:80px;padding:8px 12px;background-color:#2a2a2a;border:1px solid #404040;border-radius:8px;color:#e0e0e0;font-size:14px;text-align:center;outline:none;transition:border-color .2s ease}.number-input[data-v-40a4165e]:focus{border-color:#007acc}.number-input[data-v-40a4165e]::placeholder{color:#888}.number-input[data-v-40a4165e]::-webkit-outer-spin-button,.number-input[data-v-40a4165e]::-webkit-inner-spin-button{-webkit-appearance:none;appearance:none;margin:0}.number-input[type=number][data-v-40a4165e]{-webkit-appearance:textfield;appearance:textfield}.setting-section-header[data-v-40a4165e]{padding:16px 16px 8px 16px;display:flex;align-items:center;gap:12px}.setting-section-header h3[data-v-40a4165e]{margin:0;font-size:18px;font-weight:600;color:#e0e0e0}.setting-section-header .section-description[data-v-40a4165e]{font-size:14px;color:#888;line-height:1.4}.folding-rules-fullwidth[data-v-40a4165e]{margin-top:8px;padding:0 16px}.folding-rules-container[data-v-40a4165e]{width:100%;border:1px solid #404040;border-radius:8px;overflow:hidden}.rules-header[data-v-40a4165e]{display:grid;grid-template-columns:1fr 1fr 1fr 1fr 1fr auto;gap:12px;padding:12px 16px;background-color:#2a2a2a;border-bottom:1px solid #404040;font-size:12px;font-weight:500;color:#b0b0b0;text-transform:uppercase;letter-spacing:.5px}.header-cell[data-v-40a4165e]{text-align:center;padding:4px 0}.folding-rule-row[data-v-40a4165e]{display:grid;grid-template-columns:1fr 1fr 1fr 1fr 1fr auto;gap:12px;padding:12px 16px;background-color:#1a1a1a;border-bottom:1px solid #2a2a2a;align-items:center}.folding-rule-row[data-v-40a4165e]:last-child{border-bottom:none}.folding-rule-row[data-v-40a4165e]:hover{background-color:#202020}.rule-cell[data-v-40a4165e]{display:flex;align-items:center;justify-content:center;min-height:32px}.field-label[data-v-40a4165e]{font-size:12px;font-weight:500;color:#b0b0b0;text-transform:uppercase;letter-spacing:.5px}.text-input[data-v-40a4165e]{padding:6px 8px;background-color:#2a2a2a;border:1px solid #404040;border-radius:4px;color:#e0e0e0;font-size:13px;outline:none;transition:border-color .2s ease;width:100%;min-width:80px}.text-input[data-v-40a4165e]:focus{border-color:#007acc}.text-input[data-v-40a4165e]::placeholder{color:#666}.text-input.compact[data-v-40a4165e]{padding:4px 6px;font-size:12px;min-width:60px}.select-input[data-v-40a4165e]{padding:6px 8px;background-color:#2a2a2a;border:1px solid #404040;border-radius:4px;color:#e0e0e0;font-size:13px;outline:none;cursor:pointer;transition:border-color .2s ease;width:100%;min-width:80px}.select-input[data-v-40a4165e]:focus{border-color:#007acc}.select-input.compact[data-v-40a4165e]{padding:4px 6px;font-size:12px;min-width:60px}.radio-group[data-v-40a4165e]{display:flex;flex-direction:column;gap:4px;width:100%}.radio-group.compact[data-v-40a4165e]{gap:2px}.radio-option[data-v-40a4165e]{display:flex;align-items:center;gap:4px;cursor:pointer;padding:2px 4px;border-radius:3px;transition:background-color .2s ease;justify-content:center}.radio-option[data-v-40a4165e]:hover{background-color:hsla(0,0%,100%,.05)}.radio-option.compact[data-v-40a4165e]{padding:1px 2px;gap:2px}.radio-option input[type=radio][data-v-40a4165e]{margin:0;width:14px;height:14px;accent-color:#007acc;cursor:pointer}.radio-option .radio-label[data-v-40a4165e]{font-size:11px;color:#b0b0b0;-webkit-user-select:none;user-select:none;white-space:nowrap}.delete-rule-btn[data-v-40a4165e]{padding:6px 10px;background-color:#dc3545;border:none;border-radius:4px;color:#fff;font-size:11px;font-weight:500;cursor:pointer;transition:background-color .2s ease;white-space:nowrap;min-width:50px}.delete-rule-btn[data-v-40a4165e]:hover{background-color:#c82333}.delete-rule-btn.compact[data-v-40a4165e]{padding:4px 8px;font-size:10px;min-width:40px}.add-rule-row[data-v-40a4165e]{display:flex;justify-content:center;padding:12px 0}.add-rule-btn[data-v-40a4165e]{padding:10px 20px;background-color:#007acc;border:none;border-radius:8px;color:#fff;font-size:14px;font-weight:500;cursor:pointer;transition:background-color .2s ease}.add-rule-btn[data-v-40a4165e]:hover{background-color:#0056b3}@media (max-width:768px){.settings-header[data-v-40a4165e]{padding:16px 12px 12px 12px}.settings-header h2[data-v-40a4165e]{font-size:20px}.setting-item[data-v-40a4165e]{padding:12px}.setting-title[data-v-40a4165e]{font-size:15px}.setting-description[data-v-40a4165e]{font-size:13px}.number-input[data-v-40a4165e]{width:70px;padding:6px 10px;font-size:13px}.rules-header[data-v-40a4165e]{font-size:10px;padding:8px 12px}.folding-rule-row[data-v-40a4165e]{padding:8px 12px;gap:6px}.rule-cell[data-v-40a4165e]{min-height:28px}.text-input.compact[data-v-40a4165e],.select-input.compact[data-v-40a4165e]{font-size:11px;padding:3px 4px;min-width:45px}.radio-option.compact .radio-label[data-v-40a4165e]{font-size:10px}.delete-rule-btn.compact[data-v-40a4165e]{padding:3px 6px;font-size:9px;min-width:35px}}
.summary-tab-container[data-v-3de5c4ec]{width:100%;height:100%;display:flex;flex-direction:column;background-color:#1a1a1a;color:#e0e0e0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif}.summary-content[data-v-3de5c4ec]{flex:1;padding:16px;overflow-y:auto;display:flex;flex-direction:column;min-height:var(--v70237b32);max-height:var(--v70237b32)}.summary-content[data-v-3de5c4ec]::-webkit-scrollbar{width:8px}.summary-content[data-v-3de5c4ec]::-webkit-scrollbar-track{background:#2a2a2a;border-radius:4px}.summary-content[data-v-3de5c4ec]::-webkit-scrollbar-thumb{background:#555;border-radius:4px}.summary-content[data-v-3de5c4ec]::-webkit-scrollbar-thumb:hover{background:#666}.summary-section[data-v-3de5c4ec]{margin-bottom:16px}.summary-section[data-v-3de5c4ec]:last-child{margin-bottom:0}.section-title[data-v-3de5c4ec]{font-size:18px;font-weight:600;color:#007acc;margin:0 0 12px 0;padding-bottom:8px;border-bottom:2px solid #007acc}.add-summary-button[data-v-3de5c4ec]{padding:8px 16px;border:none;border-radius:6px;font-size:14px;font-weight:500;cursor:pointer;transition:background-color .2s;background:#007acc;color:#fff;margin-top:12px;width:100%}.add-summary-button[data-v-3de5c4ec]:hover{background:#005a99}.summary-list[data-v-3de5c4ec]{display:flex;flex-direction:column;gap:8px}.summary-row[data-v-3de5c4ec]{background:#252525;padding:12px 16px;border-radius:8px;border:1px solid #404040;display:flex;flex-direction:column;gap:8px;font-size:14px;transition:background-color .2s}.summary-row[data-v-3de5c4ec]:hover{background:#2a2a2a;border-color:#555}.new-summary-row[data-v-3de5c4ec]{background:#2a2a2a;border-color:#007acc;border-style:dashed}.summary-first-row[data-v-3de5c4ec]{display:flex;justify-content:space-between;align-items:center;gap:12px}.summary-weighting-last-message-group[data-v-3de5c4ec]{display:flex;gap:12px;align-items:center}.summary-datetime-row[data-v-3de5c4ec]{margin-bottom:4px}.summary-datetime[data-v-3de5c4ec]{font-weight:500;color:#4caf50;font-size:14px;flex-shrink:0}.summary-weighting[data-v-3de5c4ec]{font-weight:500;color:#ff9800;font-size:13px}.summary-last-message-id[data-v-3de5c4ec]{font-weight:500;color:#bb86fc;font-size:13px}.summary-status[data-v-3de5c4ec]{font-weight:500;font-size:12px;padding:2px 6px;border-radius:4px;text-align:center;min-width:50px}.summary-status.status-used[data-v-3de5c4ec]{background-color:#4caf50;color:#fff}.summary-status.status-unused[data-v-3de5c4ec]{background-color:#ff9800;color:#fff}.summary-content-display[data-v-3de5c4ec]{color:#a0a0a0;line-height:1.4;font-size:13px}.summary-actions[data-v-3de5c4ec]{display:flex;gap:8px}.edit-summary-button[data-v-3de5c4ec],.delete-summary-button[data-v-3de5c4ec]{padding:6px 12px;border:none;border-radius:4px;font-size:12px;cursor:pointer;transition:background-color .2s}.edit-summary-button[data-v-3de5c4ec]{background:#007acc;color:#fff}.edit-summary-button[data-v-3de5c4ec]:hover{background:#005a99}.delete-summary-button[data-v-3de5c4ec]{background:#f44336;color:#fff}.delete-summary-button[data-v-3de5c4ec]:hover{background:#da190b}.no-summaries-message[data-v-3de5c4ec]{background:#252525;padding:16px 12px;border-radius:6px;border:1px solid #404040;color:#888;text-align:center;font-size:14px;font-style:italic}.summary-edit-mode[data-v-3de5c4ec]{display:flex;flex-direction:column;gap:8px}.summary-edit-first-row[data-v-3de5c4ec]{display:flex;justify-content:space-between;align-items:center;gap:12px}.summary-weighting-last-message-input-group[data-v-3de5c4ec]{display:flex;gap:12px;align-items:center}.summary-weighting-input-group[data-v-3de5c4ec],.summary-last-message-id-input-group[data-v-3de5c4ec]{display:flex;gap:4px;align-items:center;font-size:13px;color:#a0a0a0}.summary-edit-actions[data-v-3de5c4ec]{display:flex;gap:8px;justify-content:flex-end}.summary-edit-datetime-row[data-v-3de5c4ec]{margin-bottom:4px}.summary-datetime-input-group[data-v-3de5c4ec]{display:flex;gap:4px;flex-shrink:0;font-weight:500;color:#4caf50;font-size:14px}.summary-datetime-input[data-v-3de5c4ec]{background:#333;border:1px solid #555;border-radius:4px;color:#4caf50;font-size:14px;padding:4px 8px;width:35px;-webkit-appearance:none;appearance:none;text-align:center}.summary-datetime-input[data-v-3de5c4ec]:focus{outline:none;border-color:#007acc}.summary-datetime-input[data-v-3de5c4ec]::-webkit-outer-spin-button,.summary-datetime-input[data-v-3de5c4ec]::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}.summary-datetime-input[type=number][data-v-3de5c4ec]{-webkit-appearance:textfield;appearance:textfield}.summary-datetime-year-input[data-v-3de5c4ec]{width:60px}.summary-weighting-input[data-v-3de5c4ec]{background:#333;border:1px solid #555;border-radius:4px;color:#ff9800;font-size:14px;padding:4px 8px;width:60px;-webkit-appearance:none;appearance:none;text-align:center}.summary-weighting-input[data-v-3de5c4ec]:focus{outline:none;border-color:#007acc}.summary-weighting-input[data-v-3de5c4ec]::-webkit-outer-spin-button,.summary-weighting-input[data-v-3de5c4ec]::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}.summary-weighting-input[type=number][data-v-3de5c4ec]{-webkit-appearance:textfield;appearance:textfield}.summary-last-message-id-input[data-v-3de5c4ec]{background:#333;border:1px solid #555;border-radius:4px;color:#9c27b0;font-size:14px;padding:4px 8px;width:40px;-webkit-appearance:none;appearance:none;text-align:center}.summary-last-message-id-input[data-v-3de5c4ec]:focus{outline:none;border-color:#007acc}.summary-last-message-id-input[data-v-3de5c4ec]::-webkit-outer-spin-button,.summary-last-message-id-input[data-v-3de5c4ec]::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}.summary-last-message-id-input[type=number][data-v-3de5c4ec]{-webkit-appearance:textfield;appearance:textfield}.summary-content-input[data-v-3de5c4ec]{background:#333;border:1px solid #555;border-radius:4px;color:#e0e0e0;font-size:13px;padding:6px 8px;resize:vertical;min-height:60px;line-height:1.4;width:100%}.summary-content-input[data-v-3de5c4ec]:focus{outline:none;border-color:#007acc}.confirm-button[data-v-3de5c4ec],.cancel-button[data-v-3de5c4ec]{padding:6px 12px;border:none;border-radius:4px;font-size:12px;cursor:pointer;transition:background-color .2s}.confirm-button[data-v-3de5c4ec]{background:#4caf50;color:#fff}.confirm-button[data-v-3de5c4ec]:hover:not(:disabled){background:#45a049}.confirm-button[data-v-3de5c4ec]:disabled{background:#666;color:#ccc;cursor:not-allowed}.cancel-button[data-v-3de5c4ec]{background:#f44336;color:#fff}.cancel-button[data-v-3de5c4ec]:hover{background:#da190b}@media (max-width:768px){.summary-content[data-v-3de5c4ec]{padding:12px}.section-title[data-v-3de5c4ec]{font-size:18px}.summary-row[data-v-3de5c4ec]{padding:10px 12px;gap:6px}.summary-first-row[data-v-3de5c4ec]{gap:8px}.summary-weighting-last-message-group[data-v-3de5c4ec]{gap:8px}.summary-datetime-row[data-v-3de5c4ec]{margin-bottom:3px}.summary-content-display[data-v-3de5c4ec]{font-size:12px}.summary-actions[data-v-3de5c4ec]{gap:6px}.edit-summary-button[data-v-3de5c4ec],.delete-summary-button[data-v-3de5c4ec]{padding:5px 10px;font-size:11px}.summary-edit-first-row[data-v-3de5c4ec]{gap:8px}.summary-weighting-last-message-input-group[data-v-3de5c4ec]{gap:8px}.summary-edit-actions[data-v-3de5c4ec]{gap:6px}.summary-datetime-input[data-v-3de5c4ec]{font-size:13px;padding:3px 6px}.summary-datetime-year-input[data-v-3de5c4ec]{width:50px}.summary-weighting-input[data-v-3de5c4ec]{width:50px}.summary-last-message-id-input[data-v-3de5c4ec]{width:35px}.summary-content-input[data-v-3de5c4ec]{font-size:12px;padding:4px 6px;min-height:50px}.confirm-button[data-v-3de5c4ec],.cancel-button[data-v-3de5c4ec]{padding:5px 10px;font-size:11px}}
.user-tab-container[data-v-ada46c14]{width:100%;height:100%;display:flex;flex-direction:column;background-color:#1a1a1a;color:#e0e0e0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif}.user-content[data-v-ada46c14]{flex:1;padding:16px;overflow-y:auto;gap:20px;display:flex;flex-direction:column;min-height:var(--v68dcf940);max-height:var(--v68dcf940)}.user-content[data-v-ada46c14]::-webkit-scrollbar{width:8px}.user-content[data-v-ada46c14]::-webkit-scrollbar-track{background:#2a2a2a;border-radius:4px}.user-content[data-v-ada46c14]::-webkit-scrollbar-thumb{background:#555;border-radius:4px}.user-content[data-v-ada46c14]::-webkit-scrollbar-thumb:hover{background:#666}.user-header[data-v-ada46c14]{text-align:center;position:relative}.user-name[data-v-ada46c14]{font-size:28px;font-weight:700;color:#007acc;margin:0;text-shadow:0 2px 4px rgba(0,0,0,.3)}.attributes-grid[data-v-ada46c14]{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:12px;margin-bottom:20px}.attribute-item[data-v-ada46c14]{background:#252525;padding:12px;border-radius:8px;text-align:center;border:1px solid #404040}.attribute-item.full-width[data-v-ada46c14]{grid-column:1/-1;text-align:left;padding:16px}.attribute-item.horizontal[data-v-ada46c14]{display:flex;justify-content:space-between;align-items:center;text-align:left}.attribute-item.horizontal .attribute-label[data-v-ada46c14]{margin-bottom:0;flex-shrink:0}.attribute-item.horizontal .attribute-value[data-v-ada46c14]{margin-left:auto}.attribute-item.horizontal .attribute-input[data-v-ada46c14]{margin-left:8px}.attribute-item.birthday-fullwidth[data-v-ada46c14]{display:flex;justify-content:space-between;align-items:center;text-align:left}.attribute-item.birthday-fullwidth .attribute-label[data-v-ada46c14]{margin-bottom:0;flex-shrink:0}.attribute-item.birthday-fullwidth .attribute-value[data-v-ada46c14]{margin-left:auto}.attribute-item.birthday-fullwidth .birthday-edit-container[data-v-ada46c14]{margin-left:auto;justify-content:flex-end}.attribute-label[data-v-ada46c14]{display:block;font-size:12px;color:#888;margin-bottom:6px;text-transform:uppercase;letter-spacing:.5px;font-weight:500}.attribute-label.unit-label[data-v-ada46c14]{text-transform:none}.attribute-value[data-v-ada46c14]{display:block;font-size:16px;font-weight:600;color:#e0e0e0}.attribute-value.money[data-v-ada46c14]{color:#4caf50;font-weight:700}.attribute-value.no-bold[data-v-ada46c14]{font-weight:400}.section-title[data-v-ada46c14]{font-size:18px;font-weight:600;color:#007acc;margin:20px 0 12px 0;padding-bottom:8px;border-bottom:2px solid #007acc}.relations-section[data-v-ada46c14],.inventory-section[data-v-ada46c14]{margin-bottom:16px}.relations-section[data-v-ada46c14]:last-child,.inventory-section[data-v-ada46c14]:last-child{margin-bottom:0}.relations-list[data-v-ada46c14],.inventory-list[data-v-ada46c14],.relations-edit-list[data-v-ada46c14],.inventory-edit-list[data-v-ada46c14]{display:flex;flex-direction:column;gap:8px}.relation-item[data-v-ada46c14]{background:#252525;padding:10px 12px;border-radius:6px;border:1px solid #404040;font-size:14px;color:#e0e0e0;line-height:1.4}.relation-highlight[data-v-ada46c14]{color:#fff;font-weight:500}.relation-connector[data-v-ada46c14]{color:#888;font-weight:400}.relation-edit-item[data-v-ada46c14]{background:#252525;padding:10px 12px;border-radius:6px;border:1px solid #404040;display:flex;align-items:center;gap:8px;flex-wrap:wrap}.relation-edit-connector[data-v-ada46c14]{color:#888;font-weight:400;font-size:14px;white-space:nowrap}.relation-input[data-v-ada46c14]{background:#333;border:1px solid #555;border-radius:4px;color:#e0e0e0;padding:4px 8px;font-size:14px;flex:1;min-width:50px}.relation-input[data-v-ada46c14]:focus{outline:none;border-color:#007acc}.relation-select[data-v-ada46c14],.inventory-select[data-v-ada46c14]{background:#333;border:1px solid #555;border-radius:4px;color:#e0e0e0;padding:4px 8px;font-size:14px;min-width:120px;flex-shrink:0}.relation-select[data-v-ada46c14]:focus,.inventory-select[data-v-ada46c14]:focus{outline:none;border-color:#007acc}.relation-select option[data-v-ada46c14],.inventory-select option[data-v-ada46c14]{background:#333;color:#e0e0e0}.relation-select option[data-v-ada46c14]:disabled,.inventory-select option[data-v-ada46c14]:disabled{color:#888;font-style:italic}.relation-remove-btn[data-v-ada46c14],.add-relation-btn[data-v-ada46c14],.add-inventory-btn[data-v-ada46c14]{background:#007acc;color:#fff;border:none;padding:8px 16px;border-radius:6px;cursor:pointer;font-size:14px;font-weight:500;margin-top:8px;transition:background-color .2s}.relation-remove-btn[data-v-ada46c14]:hover,.add-relation-btn[data-v-ada46c14]:hover,.add-inventory-btn[data-v-ada46c14]:hover{background:#005a99}.inventory-item[data-v-ada46c14]{background:#252525;padding:10px 12px;border-radius:6px;border:1px solid #404040;display:flex;flex-direction:column;gap:6px}.inventory-first-row[data-v-ada46c14]{display:flex;justify-content:space-between;align-items:center}.item-name-id[data-v-ada46c14]{font-weight:500;color:#fff;font-size:14px}.item-quantity[data-v-ada46c14]{font-weight:600;color:#e0e0e0;background:#007acc;padding:2px 8px;border-radius:12px;font-size:12px}.storage-indicator[data-v-ada46c14]{font-weight:600;color:#fff;background:#4caf50;padding:2px 8px;border-radius:12px;font-size:12px}[data-v-ada46c14] .inventory-item-tag{background:#4caf50;color:#fff;padding:2px 6px;border-radius:4px;font-size:12px;display:flex;align-items:center;gap:4px;white-space:nowrap;flex-shrink:0}[data-v-ada46c14] .storage-item-tag{background:#ff9800;color:#fff;padding:2px 6px;border-radius:4px;font-size:12px;display:flex;align-items:center;gap:4px;white-space:nowrap;flex-shrink:0}.inventory-second-row[data-v-ada46c14]{font-size:12px;color:#a0a0a0;line-height:1.6}.inventory-tags-container[data-v-ada46c14]{display:flex;flex-wrap:wrap;gap:4px;align-items:flex-start;row-gap:6px;margin-top:4px}.inventory-third-row[data-v-ada46c14]{display:flex;flex-direction:column;gap:4px}.no-inventory[data-v-ada46c14]{color:#888;font-style:italic;font-size:13px}.inventory-items[data-v-ada46c14]{display:flex;flex-wrap:wrap;gap:4px}.inventory-edit-item[data-v-ada46c14]{background:#252525;padding:10px 12px;border-radius:6px;border:1px solid #404040;display:flex;align-items:center;gap:8px;flex-wrap:wrap}.inventory-edit-connector[data-v-ada46c14]{color:#888;font-weight:400;font-size:14px;white-space:nowrap}.inventory-quantity-input[data-v-ada46c14]{background:#333;border:1px solid #555;border-radius:4px;color:#e0e0e0;padding:4px 8px;font-size:14px;width:80px;text-align:center}.inventory-quantity-input[data-v-ada46c14]:focus{outline:none;border-color:#007acc}.inventory-remove-btn[data-v-ada46c14]{background:#f44336;color:#fff;border:none;border-radius:4px;width:24px;height:24px;cursor:pointer;font-size:16px;font-weight:bold;display:flex;align-items:center;justify-content:center;flex-shrink:0;margin-left:auto}.inventory-remove-btn[data-v-ada46c14]:hover{background:#da190b}.attribute-input[data-v-ada46c14]{background:#333;border:1px solid #555;border-radius:4px;color:#e0e0e0;padding:4px 8px;font-size:14px;width:100%}.attribute-input[data-v-ada46c14]:focus{outline:none;border-color:#007acc}.birthday-inputs[data-v-ada46c14]{display:flex;align-items:center;gap:2px;width:auto;margin-left:auto}.birthday-edit-container[data-v-ada46c14]{display:flex;justify-content:flex-start;width:100%}.birthday-input-group[data-v-ada46c14]{display:flex;align-items:center;gap:4px;padding:4px 0}.birthday-month[data-v-ada46c14],.birthday-date[data-v-ada46c14]{width:50px;flex-shrink:0}.birthday-separator[data-v-ada46c14]{color:#888;font-size:14px;white-space:nowrap}.attribute-textarea[data-v-ada46c14]{background:#333;border:1px solid #555;border-radius:4px;color:#e0e0e0;padding:8px;font-size:14px;width:100%;min-height:60px;resize:vertical;font-family:inherit}.attribute-textarea[data-v-ada46c14]:focus{outline:none;border-color:#007acc}.edit-buttons[data-v-ada46c14]{display:flex;justify-content:center;gap:16px;margin-top:20px;padding-top:20px;border-top:1px solid #404040}.edit-button[data-v-ada46c14]{position:absolute;top:0;left:0;padding:8px 16px;border:none;border-radius:6px;font-size:14px;font-weight:500;cursor:pointer;transition:background-color .2s;background:#007acc;color:#fff}.edit-button[data-v-ada46c14]:hover{background:#005a99}.confirm-button[data-v-ada46c14],.cancel-button[data-v-ada46c14]{padding:8px 16px;border:none;border-radius:6px;font-size:14px;font-weight:500;cursor:pointer;transition:background-color .2s}.confirm-button[data-v-ada46c14]{background:#4caf50;color:#fff}.confirm-button[data-v-ada46c14]:hover{background:#45a049}.cancel-button[data-v-ada46c14]{background:#f44336;color:#fff}.cancel-button[data-v-ada46c14]:hover{background:#da190b}@media (max-width:768px){.user-content[data-v-ada46c14]{padding:12px;gap:16px}.user-name[data-v-ada46c14]{font-size:24px}.attributes-grid[data-v-ada46c14]{grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:8px}.attribute-item[data-v-ada46c14]{padding:10px}.attribute-item.full-width[data-v-ada46c14]{padding:12px}.attribute-value[data-v-ada46c14]{font-size:14px}.inventory-item[data-v-ada46c14]{gap:4px}[data-v-ada46c14] .inventory-item-tag{font-size:12px;padding:2px 6px}.inventory-third-row[data-v-ada46c14] .inventory-item-tag{font-size:12px;padding:2px 6px}}.no-relations-message[data-v-ada46c14],.no-inventory-message[data-v-ada46c14]{background:#252525;padding:16px 12px;border-radius:6px;border:1px solid #404040;color:#888;text-align:center;font-size:14px;font-style:italic}
.world-info-container[data-v-ee3aed0a]{width:100%;height:100%;display:flex;flex-direction:column;background-color:#1a1a1a;color:#e0e0e0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif}.world-info-content[data-v-ee3aed0a]{flex:1;padding:12px;gap:16px;overflow-y:auto;display:flex;flex-direction:column;min-height:var(--ae590e90);max-height:var(--ae590e90)}.world-info-content[data-v-ee3aed0a]::-webkit-scrollbar{width:8px}.world-info-content[data-v-ee3aed0a]::-webkit-scrollbar-track{background:#2a2a2a;border-radius:4px}.world-info-content[data-v-ee3aed0a]::-webkit-scrollbar-thumb{background:#555;border-radius:4px}.world-info-content[data-v-ee3aed0a]::-webkit-scrollbar-thumb:hover{background:#666}.section[data-v-ee3aed0a]{background-color:#2a2a2a;padding:20px;border-radius:12px;border:1px solid #404040;margin-bottom:20px}.section h4[data-v-ee3aed0a]{color:#b0b0b0;margin-bottom:16px;font-size:16px;border-bottom:1px solid #404040;padding-bottom:8px}.sortable-container[data-v-ee3aed0a]{margin-bottom:16px}.sortable-item[data-v-ee3aed0a]{margin-bottom:8px;transition:all .2s ease;position:relative}.sortable-item.dragging[data-v-ee3aed0a]{opacity:.7;transform:scale(1.02);box-shadow:0 4px 12px rgba(0,122,204,.3);z-index:1000}.sortable-item[data-v-ee3aed0a]:not(.dragging){transform:translateY(0)}.draggable-fold-bar.incomplete[data-v-ee3aed0a] .fold-bar-btn span{color:#ef4444 !important}.drop-indicator[data-v-ee3aed0a]{height:4px;background:linear-gradient(90deg,#007acc,#005999);border-radius:2px;margin:4px 0;box-shadow:0 0 8px rgba(0,122,204,.6);animation:pulse-ee3aed0a 1.5s ease-in-out infinite;position:relative}.drop-indicator[data-v-ee3aed0a]::before{content:"";position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:8px;height:8px;background:#007acc;border-radius:50%;box-shadow:0 0 12px rgba(0,122,204,.8)}@keyframes pulse-ee3aed0a{0%,100%{opacity:1;transform:scale(1)}50%{opacity:.7;transform:scale(1.1)}}.fold-content[data-v-ee3aed0a]{padding:12px 0}.fold-content .input-group[data-v-ee3aed0a]{margin-bottom:16px}.fold-content .input-group[data-v-ee3aed0a]:last-child{margin-bottom:0}.fold-content .input-group label[data-v-ee3aed0a]{display:block;margin-bottom:6px;color:#b0b0b0;font-weight:500;font-size:13px}.fold-content .input-group .form-input[data-v-ee3aed0a],.fold-content .input-group .form-textarea[data-v-ee3aed0a]{width:100%;padding:8px 12px;background:#2a2a2a;border:1px solid #404040;border-radius:4px;color:#e0e0e0;font-size:14px;font-family:inherit;transition:all .2s ease}.fold-content .input-group .form-input[data-v-ee3aed0a]:focus,.fold-content .input-group .form-textarea[data-v-ee3aed0a]:focus{outline:none;border-color:#007acc;box-shadow:0 0 0 2px rgba(0,122,204,.2)}.fold-content .input-group .form-input[data-v-ee3aed0a]::placeholder,.fold-content .input-group .form-textarea[data-v-ee3aed0a]::placeholder{color:#666}.fold-content .input-group .form-textarea[data-v-ee3aed0a]{resize:vertical;min-height:60px;line-height:1.4}.item-actions[data-v-ee3aed0a]{display:flex;gap:8px;margin-top:12px}.item-actions .action-btn[data-v-ee3aed0a]{flex:1;display:flex;align-items:center;justify-content:center;gap:6px;min-width:0}.generated-result[data-v-ee3aed0a]{margin-top:8px;padding:8px;background-color:#1a1a1a;border:1px solid #404040;border-radius:6px}.generated-result label[data-v-ee3aed0a]{display:block;margin-bottom:4px;color:#007acc;font-size:12px;font-weight:500}.generated-result .generated-text[data-v-ee3aed0a]{color:#e0e0e0;font-size:14px;margin-bottom:8px;word-wrap:break-word;white-space:pre-wrap}.generated-result .replace-btn[data-v-ee3aed0a]{padding:6px 12px;background-color:#28a745;border:none;border-radius:4px;color:#fff;font-size:12px;font-weight:500;cursor:pointer;transition:background-color .2s ease}.generated-result .replace-btn[data-v-ee3aed0a]:hover{background-color:#218838}.remove-btn[data-v-ee3aed0a]{background:#b91c1c;border:1px solid #b91c1c;border-radius:3px;color:#fff;font-size:16px;font-weight:bold;width:20px;height:20px;display:flex;align-items:center;justify-content:center;cursor:pointer}.remove-btn span[data-v-ee3aed0a]{line-height:1;margin-top:-1px}.action-btn[data-v-ee3aed0a]{padding:8px 16px;border:1px solid #555;background:#2a2a2a;color:#e0e0e0;border-radius:4px;cursor:pointer;font-size:13px;font-weight:500;transition:all .2s ease}.action-btn[data-v-ee3aed0a]:hover{background:#404040;border-color:#777}.action-btn.generate[data-v-ee3aed0a]{background:linear-gradient(135deg,#007acc,#005999);border-color:#007acc;color:#fff}.action-btn.generate[data-v-ee3aed0a]:hover:not(:disabled){background:linear-gradient(135deg,#005999,#004477);transform:translateY(-1px)}.action-btn.generate[data-v-ee3aed0a]:active{transform:translateY(0)}.action-btn.generate[data-v-ee3aed0a]:disabled{background-color:#666;cursor:not-allowed;transform:none}.action-btn.apply[data-v-ee3aed0a]{background:linear-gradient(135deg,#28a745,#20c997);border-color:#28a745;color:#fff}.action-btn.apply[data-v-ee3aed0a]:hover:not(:disabled){background:linear-gradient(135deg,#218838,#1aa085);transform:translateY(-1px)}.action-btn.apply[data-v-ee3aed0a]:active{transform:translateY(0)}.action-btn.apply[data-v-ee3aed0a]:disabled{background-color:#666;cursor:not-allowed;transform:none}.action-btn.delete[data-v-ee3aed0a]{background:#3a1a1a;border-color:#622}.action-btn.delete[data-v-ee3aed0a]:hover{background:#622}.add-item-section[data-v-ee3aed0a]{text-align:center;margin-top:16px}.add-btn[data-v-ee3aed0a]{padding:10px 20px;background:linear-gradient(135deg,#007acc,#005999);border:none;color:#fff;border-radius:6px;cursor:pointer;font-size:14px;font-weight:500;transition:all .2s ease}.add-btn[data-v-ee3aed0a]:hover{background:linear-gradient(135deg,#005999,#004477);transform:translateY(-1px)}.add-btn[data-v-ee3aed0a]:active{transform:translateY(0)}@media (max-width:768px){.world-info-content[data-v-ee3aed0a]{padding:12px}.section[data-v-ee3aed0a]{padding:16px}.item-actions[data-v-ee3aed0a]{gap:6px}.item-actions .action-btn[data-v-ee3aed0a]{padding:6px 12px;font-size:12px}.add-btn[data-v-ee3aed0a]{width:100%}}.loading-spinner[data-v-ee3aed0a]{display:inline-block;width:16px;height:16px;border:2px solid #fff;border-top:2px solid rgba(0,0,0,0);border-radius:50%;animation:spin-ee3aed0a 1s linear infinite;flex-shrink:0}@keyframes spin-ee3aed0a{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
.main-interface-container[data-v-9fb68f82]{display:flex;flex-direction:column;width:100%;height:100%;background-color:#1a1a1a;color:#e0e0e0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif}.main-content[data-v-9fb68f82]{flex:1;display:flex;flex-direction:column}.conversation-area[data-v-9fb68f82]{display:flex;flex-direction:column;flex:1;background-color:#1a1a1a}.user-area[data-v-9fb68f82]{display:flex;flex-direction:column;flex:1;background-color:#1a1a1a}.character-area[data-v-9fb68f82]{display:flex;flex-direction:column;flex:1;background-color:#1a1a1a}.item-area[data-v-9fb68f82]{display:flex;flex-direction:column;flex:1;background-color:#1a1a1a}.storage-area[data-v-9fb68f82]{display:flex;flex-direction:column;flex:1;background-color:#1a1a1a}.location-area[data-v-9fb68f82]{display:flex;flex-direction:column;flex:1;background-color:#1a1a1a}.promise-area[data-v-9fb68f82]{display:flex;flex-direction:column;flex:1;background-color:#1a1a1a}.summary-area[data-v-9fb68f82]{display:flex;flex-direction:column;flex:1;background-color:#1a1a1a}.world-info-area[data-v-9fb68f82]{display:flex;flex-direction:column;flex:1;background-color:#1a1a1a}.settings-area[data-v-9fb68f82]{display:flex;flex-direction:column;flex:1;background-color:#1a1a1a}.tab-navigation[data-v-9fb68f82]{display:flex;flex-direction:column;background-color:#2a2a2a;border-bottom:1px solid #404040;flex-shrink:0}.tab-navigation.top[data-v-9fb68f82]{border-top:none}.time-row[data-v-9fb68f82]{display:flex;padding:4px 12px;background-color:rgba(0,0,0,.3);border-bottom:1px solid #404040;align-items:center}.current-time[data-v-9fb68f82]{font-size:14px;font-weight:600;color:#fff;font-family:"Courier New",monospace}.tab-row[data-v-9fb68f82]{display:flex;border-bottom:1px solid #404040}.tab-row[data-v-9fb68f82]:last-child{border-bottom:none}.tab-button[data-v-9fb68f82]{flex:1;padding:10px;background:none;border:none;border-right:1px solid #404040;color:#b0b0b0;font-size:16px;cursor:pointer;transition:all .2s ease}.tab-button.active[data-v-9fb68f82]{color:#007acc;background-color:#3a3a3a}.tab-button[data-v-9fb68f82]:hover{background-color:#3a3a3a}.tab-button[data-v-9fb68f82]:last-child{border-right:none}@media (max-width:768px){.tab-button[data-v-9fb68f82]{padding:8px;font-size:14px}}.slide-right-enter-active[data-v-9fb68f82],.slide-right-leave-active[data-v-9fb68f82]{transition:all .2s cubic-bezier(0.25,0.46,0.45,0.94)}.slide-right-enter-from[data-v-9fb68f82]{opacity:0;transform:translateX(-50px)}.slide-right-leave-to[data-v-9fb68f82]{opacity:0;transform:translateX(50px)}.slide-left-enter-active[data-v-9fb68f82],.slide-left-leave-active[data-v-9fb68f82]{transition:all .2s cubic-bezier(0.25,0.46,0.45,0.94)}.slide-left-enter-from[data-v-9fb68f82]{opacity:0;transform:translateX(50px)}.slide-left-leave-to[data-v-9fb68f82]{opacity:0;transform:translateX(-50px)}.no-transition-enter-active[data-v-9fb68f82],.no-transition-leave-active[data-v-9fb68f82]{transition:none}.no-transition-enter-from[data-v-9fb68f82],.no-transition-leave-to[data-v-9fb68f82]{opacity:1;transform:none}
.app-container[data-v-e8f6a8aa]{display:flex;flex-direction:column;width:100%;height:100%;background-color:#1a1a1a;color:#e0e0e0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif}.initialization-wrapper[data-v-e8f6a8aa]{height:100%;width:100%;display:flex;flex-direction:column}
body{overflow-y:auto}
</style></head><body><div id="app"></div></body>